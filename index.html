<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro - Ï†ÑÏõîÏÑ∏ Í≥ÑÏÇ∞Í∏∞</title>
    <meta name="description" content="Ï†ÑÏõîÏÑ∏ ÎπÑÏö© ÎπÑÍµê, ÏïàÏ†Ñ ÏßÑÎã®, Ï§ëÍ∞úÎ≥¥Ïàò Í≥ÑÏÇ∞, ÎåÄÏ∂ú Í≥ÑÏÇ∞ Îì± Î∂ÄÎèôÏÇ∞ ÏûÑÎåÄÏ∞® ÌïÑÏàò Í≥ÑÏÇ∞Í∏∞">
    <meta name="keywords" content="Ï†ÑÏõîÏÑ∏, Ï†ÑÏÑ∏, ÏõîÏÑ∏, Ï§ëÍ∞úÎ≥¥Ïàò, Î∂ÄÎèôÏÇ∞, Í≥ÑÏÇ∞Í∏∞, Ï∑®ÎìùÏÑ∏, DSR, LTV">
    <meta property="og:title" content="Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro">
    <meta property="og:description" content="Ï†ÑÏõîÏÑ∏ ÎπÑÏö© ÎπÑÍµê, ÏïàÏ†Ñ ÏßÑÎã®, ÎåÄÏ∂ú Í≥ÑÏÇ∞ Îì± Î∂ÄÎèôÏÇ∞ ÌïÑÏàò ÎèÑÍµ¨">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Î∂ÄÎèôÏÇ∞ÎßàÏä§ÌÑ∞">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%234f46e5' rx='20' width='100' height='100'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>üè†</text></svg>">

    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Kakao SDK for sharing -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"
        integrity="sha384-6MFdIr0zOira1CHQkedUqJVql0YtcZA1P0nbPrQYJXVJZUkTk/oX4U9GhLYGH0v8"
        crossorigin="anonymous"></script>

    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    },
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        resultPop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '50%': { transform: 'scale(1.02)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        numberPop: {
                            '0%': { transform: 'scale(1.1)', opacity: '0.8' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        toast: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '10%': { transform: 'translateY(0)', opacity: '1' },
                            '90%': { transform: 'translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100%)', opacity: '0' },
                        },
                        countUp: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        pulse: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.6' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        glow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(99, 102, 241, 0.3)' },
                            '50%': { boxShadow: '0 0 40px rgba(99, 102, 241, 0.6)' },
                        },
                        bounceSoft: {
                            '0%': { transform: 'scale(0.95)' },
                            '50%': { transform: 'scale(1.02)' },
                            '100%': { transform: 'scale(1)' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-10px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'result-pop': 'resultPop 0.3s ease-out',
                        'number-pop': 'numberPop 0.2s ease-out',
                        'toast': 'toast 3s ease-in-out forwards',
                        'count-up': 'countUp 0.4s ease-out',
                        'pulse-slow': 'pulse 2s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite',
                        'bounce-soft': 'bounceSoft 0.5s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css");

        body {
            font-family: "Pretendard", sans-serif;
        }

        /* ========== PREMIUM UI STYLES ========== */

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }


        /* Button Shine Effect */
        .btn-shine {
            position: relative;
            overflow: hidden;
        }

        .btn-shine::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-shine:hover::after {
            left: 100%;
        }

        /* Premium Button */
        .btn-premium {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-premium:active {
            transform: translateY(0);
        }

        /* Input Focus Glow */
        .input-glow:focus {
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
            border-color: #6366f1;
        }

        /* Result Number Animation */
        .result-highlight {
            animation: resultPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }


        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            pointer-events: none;
        }

        .toast {
            background: #1e293b;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: toast 3s ease-in-out forwards;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Scroll fade indicator for horizontal scrollable areas */
        .scroll-fade-container {
            position: relative;
        }

        .scroll-fade-container::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 40px;
            background: linear-gradient(to left, white, transparent);
            pointer-events: none;
            opacity: 0.8;
        }

        .dark .scroll-fade-container::after {
            background: linear-gradient(to left, #1e293b, transparent);
        }

        /* Hide scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Enhanced focus styles for accessibility */
        input:focus-visible,
        button:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }

        /* Shimmer loading effect */
        .shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
        }

        .dark .shimmer {
            background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
            background-size: 200% 100%;
        }

        /* ========== UI/UX ENHANCEMENTS ========== */

        /* Tab Indicator Animation - renamed to avoid conflict */
        .tab-indicator-line {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 3px 3px 0 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Tool Category Header */
        .tool-category-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-left: 3px solid #6366f1;
            padding: 8px 12px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
        }

        /* Tool Card Enhanced */
        .tool-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .tool-card:hover {
            transform: translateY(-2px);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
        }

        .tool-card:active {
            transform: scale(0.98);
        }

        /* Result Card Glow */
        .result-glow {
            position: relative;
        }

        .result-glow::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(236, 72, 153, 0.3));
            border-radius: inherit;
            z-index: -1;
            filter: blur(8px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .result-glow:hover::before {
            opacity: 1;
        }

        /* Stagger Animation for Lists */
        .stagger-item {
            opacity: 0;
            animation: slideUp 0.4s ease-out forwards;
        }

        .stagger-item:nth-child(1) {
            animation-delay: 0.05s;
        }

        .stagger-item:nth-child(2) {
            animation-delay: 0.1s;
        }

        .stagger-item:nth-child(3) {
            animation-delay: 0.15s;
        }

        .stagger-item:nth-child(4) {
            animation-delay: 0.2s;
        }

        .stagger-item:nth-child(5) {
            animation-delay: 0.25s;
        }

        .stagger-item:nth-child(6) {
            animation-delay: 0.3s;
        }

        /* Input Focus Enhanced */
        .input-enhanced {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .input-enhanced:focus {
            border-color: #6366f1;
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Number Display Animation */
        .number-animate {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .number-animate.updated {
            animation: numberPop 0.3s ease-out;
        }

        /* Scroll Arrow Enhanced */
        .scroll-arrow {
            transition: all 0.2s ease;
            opacity: 0.7;
        }

        .scroll-arrow:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .scroll-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            nav,
            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            #root {
                padding: 0;
                box-shadow: none;
                border: none;
            }

            #root>div {
                border: none;
                shadow: none;
            }

            .animate-slide-up,
            .animate-fade-in,
            .animate-result-pop {
                animation: none !important;
                transform: none !important;
                opacity: 1 !important;
            }
        }

        /* Hide Number Spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Enhanced Touch Targets (44px min) */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }

        /* Input Focus Glow Effect */
        input:focus,
        select:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
            transition: box-shadow 0.2s ease;
        }

        .dark input:focus,
        .dark select:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
        }

        /* Error Input State */
        .input-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15) !important;
        }

        /* Button Press Effect */
        button:active:not(:disabled) {
            transform: scale(0.97);
        }

        /* Card Hover Lift Effect */
        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .dark .card-hover:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        /* Result Number Pop Animation */
        .result-number {
            animation: resultPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Header Scroll Shadow */
        .header-shadow {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .dark .header-shadow {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Tab Indicator Animation */
        .tab-indicator {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Scroll Hint Fade - using inline gradient */
        .scroll-hint {
            position: relative;
            -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }

        /* Enhanced Scroll Indicator */
        .scroll-container {
            position: relative;
        }

        .scroll-container::after {
            content: '‚Ä∫';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            font-weight: bold;
            color: rgba(100, 116, 139, 0.5);
            pointer-events: none;
            animation: scrollBounce 1.5s ease-in-out infinite;
            z-index: 10;
        }

        .scroll-container.scroll-end::after {
            display: none;
        }

        @keyframes scrollBounce {

            0%,
            100% {
                transform: translateY(-50%) translateX(0);
                opacity: 0.5;
            }

            50% {
                transform: translateY(-50%) translateX(3px);
                opacity: 1;
            }
        }

        /* Ripple Effect for Buttons */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            transform: scale(0);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }

        .ripple:active::after {
            transform: scale(2);
            opacity: 1;
            transition: transform 0s, opacity 0s;
        }

        /* Subtle Pulse for Active Elements */
        .active-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 0.5rem;
        }

        .dark .skeleton {
            background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
            background-size: 200% 100%;
        }

        /* Improved Transition for Theme Toggle */
        .theme-transition {
            transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease;
        }

        /* Bottom Navigation Safe Area */
        .pb-safe {
            padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
        }

        /* Enhanced Dark Mode Depth */
        .dark .card-depth {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        .card-depth {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Empty State Styling */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1.5rem;
            text-align: center;
        }

        .empty-state-icon {
            width: 4rem;
            height: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Unified Input Focus Ring */
        .input-unified:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .dark .input-unified:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }

        /* Sub-tab scrollable area gradient */
        .subtab-scroll {
            position: relative;
            overflow-x: auto;
        }

        .subtab-scroll::before,
        .subtab-scroll::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2rem;
            pointer-events: none;
            z-index: 5;
        }

        .subtab-scroll::after {
            right: 0;
            background: linear-gradient(to left, rgba(248, 250, 252, 1) 0%, transparent 100%);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 selection:bg-blue-100 min-h-screen pb-20 md:pb-0">

    <div id="root"></div>
    <div id="error-log"
        style="display:none; padding: 20px; background: #fee; border-bottom: 1px solid #f99; color: #c00;"></div>

    <script>
        // Global Error Handler with improved debugging
        window.onerror = function (message, source, lineno, colno, error) {
            // Handle "Script error." from external CDN scripts (CORS limitation)
            if (message === 'Script error.' && lineno === 0) {
                console.warn('[External Script] CORS-restricted error detected. Check browser DevTools for details.');
                return true; // Suppress the error from showing in UI
            }

            const errorDiv = document.getElementById('error-log');
            if (errorDiv) {
                errorDiv.style.display = 'block';
                const timestamp = new Date().toLocaleTimeString();
                errorDiv.innerHTML += `<div style="margin-bottom:8px;"><strong>[${timestamp}] Error:</strong> ${message}<br><small>at ${source || 'unknown'}:${lineno || '?'}:${colno || '?'}</small></div>`;
            }
            console.error('Caught error:', { message, source, lineno, colno, error });
            return false;
        };

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function (event) {
            console.error('Unhandled promise rejection:', event.reason);
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('./sw.js')
                    .then(function (registration) {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                    })
                    .catch(function (error) {
                        console.warn('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useCallback, useId, memo } = React;

        // --- Icons (Inline SVGs with React.memo for performance) ---
        const IconBase = memo(({ children, size = 24, className = "", ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
                {...props}
            >
                {children}
            </svg>
        ));

        // --- Icons (Memoized for performance) ---
        const Home = memo((props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>);
        const Shield = memo((props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></IconBase>);
        const Calculator = memo((props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>);
        const DollarSign = memo((props) => <IconBase {...props}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconBase>);
        const PenTool = memo((props) => <IconBase {...props}><path d="m12 19 7-7 3 3-7 7-3-3z" /><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" /><path d="m2 2 7.586 7.586" /><circle cx="11" cy="11" r="2" /></IconBase>);
        const CheckCircle = memo((props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>);
        const AlertTriangle = memo((props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></IconBase>);
        const Info = memo((props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></IconBase>);
        const ArrowRightLeft = memo((props) => <IconBase {...props}><path d="m16 3 4 4-4 4" /><path d="M20 7H4" /><path d="m8 21-4-4 4-4" /><path d="M4 17h16" /></IconBase>);
        const MessageCircle = memo((props) => <IconBase {...props}><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z" /></IconBase>);
        const Copy = memo((props) => <IconBase {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></IconBase>);
        const Check = memo((props) => <IconBase {...props}><polyline points="20 6 9 17 4 12" /></IconBase>);
        const Grid = memo((props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" /><path d="M3 9h18" /><path d="M9 21V9" /></IconBase>);
        const ClipboardList = memo((props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></IconBase>);
        const BookOpen = memo((props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>);
        const Search = memo((props) => <IconBase {...props}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></IconBase>);
        const CheckSquare = memo((props) => <IconBase {...props}><polyline points="9 11 12 14 22 4" /><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" /></IconBase>);
        const Printer = memo((props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9" /><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><rect width="12" height="8" x="6" y="14" /></IconBase>);
        const TrendingUp = memo((props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></IconBase>);
        const PieChart = memo((props) => <IconBase {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></IconBase>);
        const Download = memo((props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></IconBase>);
        const Bookmark = memo((props) => <IconBase {...props}><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z" /></IconBase>);
        const RefreshCw = memo((props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></IconBase>);
        const X = memo((props) => <IconBase {...props}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></IconBase>);
        const Share2 = memo((props) => <IconBase {...props}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></IconBase>);
        const RotateCcw = memo((props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></IconBase>);
        const History = memo((props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></IconBase>);
        const ChevronLeft = memo((props) => <IconBase {...props}><path d="m15 18-6-6 6-6" /></IconBase>);
        const ChevronRight = memo((props) => <IconBase {...props}><path d="m9 18 6-6-6-6" /></IconBase>);
        const HelpCircle = memo((props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><path d="M12 17h.01" /></IconBase>);
        const Trash2 = memo((props) => <IconBase {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></IconBase>);
        const Percent = memo((props) => <IconBase {...props}><line x1="19" y1="5" x2="5" y2="19" /><circle cx="6.5" cy="6.5" r="2.5" /><circle cx="17.5" cy="17.5" r="2.5" /></IconBase>);
        const Users = memo((props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></IconBase>);
        const Building = memo((props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2" ry="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M12 6h.01" /><path d="M12 10h.01" /><path d="M12 14h.01" /><path d="M16 10h.01" /><path d="M16 14h.01" /><path d="M8 10h.01" /><path d="M8 14h.01" /></IconBase>);
        const Link2 = memo((props) => <IconBase {...props}><path d="M9 17H7A5 5 0 0 1 7 7h2" /><path d="M15 7h2a5 5 0 1 1 0 10h-2" /><line x1="8" x2="16" y1="12" y2="12" /></IconBase>);
        const FileDown = memo((props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M12 18v-6" /><path d="m9 15 3 3 3-3" /></IconBase>);
        const Award = memo((props) => <IconBase {...props}><circle cx="12" cy="8" r="6" /><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11" /></IconBase>);
        const Banknote = memo((props) => <IconBase {...props}><rect width="20" height="12" x="2" y="6" rx="2" /><circle cx="12" cy="12" r="2" /><path d="M6 12h.01M18 12h.01" /></IconBase>);
        const BarChart3 = memo((props) => <IconBase {...props}><path d="M3 3v18h18" /><path d="M18 17V9" /><path d="M13 17V5" /><path d="M8 17v-3" /></IconBase>);
        const FileText = memo((props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" x2="8" y1="13" y2="13" /><line x1="16" x2="8" y1="17" y2="17" /><line x1="10" x2="8" y1="9" y2="9" /></IconBase>);
        const Calendar = memo((props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></IconBase>);

        // --- Constants ---
        // ÌïúÍµ≠ÏùÄÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ (2026.01.01 Í∏∞Ï§Ä, Î≥ÄÎèô Ïãú ÏóÖÎç∞Ïù¥Ìä∏ ÌïÑÏöî)
        const BOK_RATE_DEFAULT = 2.50;
        const BOK_RATE_DATE_DEFAULT = "2026.01.01";

        // Precompiled regex patterns for performance
        const REGEX_COMMA = /\B(?=(\d{3})+(?!\d))/g;
        const REGEX_NON_DIGIT = /[^\d.-]/g;
        const REGEX_LEADING_ZEROS = /^0+(?=\d)/;

        // Korean number units (cached for formatKoreanNumber)
        const KOREAN_UNITS = [
            { value: 100000000, unit: 'Ïñµ' },
            { value: 10000000, unit: 'Ï≤úÎßå' },
            { value: 10000, unit: 'Îßå' },
            { value: 1000, unit: 'Ï≤ú' }
        ];

        // Debounce delay constants
        const DEBOUNCE_DELAY_DEFAULT = 300;
        const DEBOUNCE_DELAY_FAST = 100;

        // --- Safe Utility Functions for Defensive Programming ---

        // Safe division - prevents NaN, Infinity, and division by zero
        const safeDivide = (numerator, denominator, defaultValue = 0) => {
            if (!denominator || denominator === 0) return defaultValue;
            const result = numerator / denominator;
            return isFinite(result) ? result : defaultValue;
        };

        // Safe parseFloat - always returns a valid number
        const safeParseFloat = (value, defaultValue = 0) => {
            if (value === null || value === undefined || value === '') return defaultValue;
            const parsed = parseFloat(String(value).replace(/,/g, ''));
            return isNaN(parsed) ? defaultValue : parsed;
        };

        // Safe parseInt - always returns a valid integer
        const safeParseInt = (value, defaultValue = 0) => {
            if (value === null || value === undefined || value === '') return defaultValue;
            const parsed = parseInt(String(value).replace(/,/g, ''), 10);
            return isNaN(parsed) ? defaultValue : parsed;
        };

        // Safe array access - prevents out of bounds errors
        const safeArrayAccess = (arr, index, defaultValue = null) => {
            if (!Array.isArray(arr)) return defaultValue;
            if (index < 0 || index >= arr.length) return defaultValue;
            return arr[index] ?? defaultValue;
        };

        // Clamp number within range
        const clampNumber = (value, min, max) => {
            const num = safeParseFloat(value, min);
            return Math.min(Math.max(num, min), max);
        };

        // --- Utils ---
        // LocalStorage cache to minimize redundant access
        const localStorageCache = {};

        const getSafeLocalStorage = (key, defaultValue = '') => {
            // Check cache first
            if (localStorageCache[key] !== undefined) {
                return localStorageCache[key];
            }
            try {
                const saved = localStorage.getItem(key);
                const value = (saved === null || saved === '') ? defaultValue : saved;
                localStorageCache[key] = value;
                return value;
            } catch (e) {
                console.warn('localStorage access failed:', e);
                return defaultValue;
            }
        };

        const setSafeLocalStorage = (key, value) => {
            try {
                const stringValue = typeof value === 'string' ? value : JSON.stringify(value);
                localStorage.setItem(key, stringValue);
                localStorageCache[key] = stringValue; // Update cache
            } catch (e) {
                console.warn('localStorage write failed:', e);
            }
        };

        // Debounced localStorage write (reduces write frequency)
        const debouncedSetStorage = (() => {
            const timers = {};
            return (key, value, delay = 300) => {
                clearTimeout(timers[key]);
                timers[key] = setTimeout(() => setSafeLocalStorage(key, value), delay);
            };
        })();

        // Input validation utilities
        const ValidationRules = {
            positive: (value) => parseNumber(value) >= 0,
            required: (value) => value !== '' && value !== null && value !== undefined,
            maxValue: (max) => (value) => parseNumber(value) <= max,
            minValue: (min) => (value) => parseNumber(value) >= min,
            range: (min, max) => (value) => {
                const num = parseNumber(value);
                return num >= min && num <= max;
            }
        };

        const validateInput = (value, rules) => {
            for (const rule of rules) {
                if (!rule(value)) return false;
            }
            return true;
        };

        // Custom hook for loading state
        const useLoading = (initialState = false) => {
            const [isLoading, setIsLoading] = useState(initialState);
            const withLoading = useCallback(async (fn) => {
                setIsLoading(true);
                try {
                    await fn();
                } finally {
                    setIsLoading(false);
                }
            }, []);
            return [isLoading, setIsLoading, withLoading];
        };

        // Custom hook for persisted state with optimized localStorage
        const usePersistedState = (key, defaultValue) => {
            const [value, setValue] = useState(() => {
                const saved = getSafeLocalStorage(key, '');
                if (saved === '') return defaultValue;
                try {
                    return JSON.parse(saved);
                } catch {
                    return saved;
                }
            });

            useEffect(() => {
                debouncedSetStorage(key, typeof value === 'string' ? value : JSON.stringify(value));
            }, [key, value]);

            return [value, setValue];
        };

        const formatNumber = (num) => {
            if (!num && num !== 0) return '';
            return Math.round(num).toString().replace(REGEX_COMMA, ',');
        };

        // ÌïúÍ∏Ä Í∏àÏï° ÌëúÏãú (1Ïñµ 5Ï≤úÎßåÏõê ÌòïÏãù) - uses cached KOREAN_UNITS
        const formatKoreanNumber = (num) => {
            if (!num && num !== 0) return '';
            const value = Math.round(parseFloat(num) || 0);
            if (value === 0) return '0Ïõê';

            let result = '';
            let remaining = value;

            for (const { value: unitValue, unit } of KOREAN_UNITS) {
                if (remaining >= unitValue) {
                    const count = Math.floor(remaining / unitValue);
                    result += count + unit + ' ';
                    remaining = remaining % unitValue;
                }
            }

            if (remaining > 0 && value < 10000) {
                result += remaining;
            }

            return result.trim() + 'Ïõê';
        };

        // Ï∂ïÏïΩ Ïà´Ïûê ÌëúÏãú (ÌÅ∞ Ïà´ÏûêÏö©)
        const formatCompactNumber = (num) => {
            if (!num && num !== 0) return '';
            const value = Math.abs(parseFloat(num) || 0);
            const sign = parseFloat(num) < 0 ? '-' : '';

            if (value >= 1e16) return sign + (value / 1e16).toFixed(1) + 'Í≤Ω';
            if (value >= 1e12) return sign + (value / 1e12).toFixed(1) + 'Ï°∞';
            if (value >= 1e8) return sign + (value / 1e8).toFixed(1) + 'Ïñµ';
            if (value >= 1e4) return sign + (value / 1e4).toFixed(1) + 'Îßå';
            return sign + formatNumber(value);
        };

        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïú†Ìã∏Î¶¨Ìã∞
        const copyToClipboard = async (text, showToastFn) => {
            try {
                await navigator.clipboard.writeText(text);
                if (showToastFn) showToastFn('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                return true;
            } catch (err) {
                console.error('Failed to copy:', err);
                return false;
            }
        };

        const parseNumber = (str) => {
            if (!str) return 0;
            return parseInt(str.toString().replace(/,/g, ''), 10) || 0;
        };

        const formatDate = (timestamp) => {
            const date = new Date(timestamp);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${month}/${day} ${hours}:${minutes}`;
        };

        // Í≥ÑÏÇ∞ ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨
        const saveToHistory = (type, data) => {
            try {
                const history = JSON.parse(localStorage.getItem('calcHistory') || '[]');
                history.unshift({
                    type,
                    data,
                    timestamp: Date.now()
                });
                localStorage.setItem('calcHistory', JSON.stringify(history.slice(0, 20)));
            } catch (e) {
                console.warn('Failed to save history:', e);
            }
        };

        const getHistory = () => {
            try {
                return JSON.parse(localStorage.getItem('calcHistory') || '[]');
            } catch (e) {
                return [];
            }
        };

        const clearHistory = () => {
            try {
                localStorage.removeItem('calcHistory');
            } catch (e) {
                console.warn('Failed to clear history:', e);
            }
        };

        // Î≥¥Ï¶ùÎ≥¥ÌóòÎ£å Í≥ÑÏÇ∞ Ïú†Ìã∏
        const calculateInsuranceFee = (deposit, years = 1) => {
            // HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∏∞Ï§Ä (2024 Í∏∞Ï§Ä ÏïΩ 0.115%~0.154%)
            const baseRate = 0.00128; // ÌèâÍ∑† 0.128%
            return Math.floor(deposit * baseRate * years);
        };

        // Ï†ÑÏõîÏÑ∏Ï†ÑÌôòÏú® Í≥ÑÏÇ∞
        const calculateConversion = (deposit, rate) => {
            // ÏõîÏÑ∏ = (Î≥¥Ï¶ùÍ∏à √ó Ï†ÑÌôòÏú®) / 12
            return Math.floor((deposit * (rate / 100)) / 12);
        };

        const calculateDepositFromMonthly = (monthly, rate) => {
            // Î≥¥Ï¶ùÍ∏à = (ÏõîÏÑ∏ √ó 12) / Ï†ÑÌôòÏú®
            if (rate <= 0) return 0;
            return Math.floor((monthly * 12) / (rate / 100));
        };

        // --- URL Í≥µÏú† Ïú†Ìã∏Î¶¨Ìã∞ ---
        const generateShareUrl = (calcType, params) => {
            const url = new URL(window.location.href.split('?')[0]);
            url.searchParams.set('calc', calcType);
            Object.entries(params).forEach(([key, value]) => {
                if (value) url.searchParams.set(key, value);
            });
            return url.toString();
        };

        const parseShareUrl = () => {
            const params = new URLSearchParams(window.location.search);
            return {
                calc: params.get('calc'),
                params: Object.fromEntries(params.entries())
            };
        };

        // Share Button Component
        const ShareButton = ({ calcType, params, showToast }) => {
            const handleShare = async () => {
                const url = generateShareUrl(calcType, params);

                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro Í≥ÑÏÇ∞ Í≤∞Í≥º',
                            text: `${calcType} Í≥ÑÏÇ∞ Í≤∞Í≥ºÎ•º ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî!`,
                            url: url
                        });
                    } catch (err) {
                        if (err.name !== 'AbortError') {
                            await copyToClipboard(url, showToast);
                        }
                    }
                } else {
                    await copyToClipboard(url, showToast);
                    if (showToast) showToast('Í≥µÏú† ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                }
            };

            return (
                <button
                    onClick={handleShare}
                    className="p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 rounded-xl transition-all active:scale-95"
                    title="Í≤∞Í≥º Í≥µÏú†ÌïòÍ∏∞"
                    aria-label="Í≥ÑÏÇ∞ Í≤∞Í≥º Í≥µÏú†"
                >
                    <Share2 size={18} />
                </button>
            );
        };

        // Quick History Component (ÏµúÍ∑º Í≥ÑÏÇ∞ Îπ†Î•∏ Ï†ëÍ∑º)
        const QuickHistory = ({ onSelect }) => {
            const [history, setHistory] = useState([]);
            const [isOpen, setIsOpen] = useState(false);

            useEffect(() => {
                setHistory(getHistory().slice(0, 5)); // ÏµúÍ∑º 5Í∞úÎßå
            }, [isOpen]);

            if (history.length === 0) return null;

            const typeLabels = {
                cost: 'ÎπÑÏö©ÎπÑÍµê',
                safety: 'ÏïàÏ†ÑÏßÑÎã®',
                fee: 'Ï§ëÍ∞úÎ≥¥Ïàò',
                loan: 'ÎåÄÏ∂úÍ≥ÑÏÇ∞',
                buying: 'Ï∑®ÎìùÏÑ∏',
                dsr: 'DSR',
                property: 'Ïû¨ÏÇ∞ÏÑ∏'
            };

            return (
                <div className="relative">
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-xl transition-all"
                        title="ÏµúÍ∑º Í≥ÑÏÇ∞"
                        aria-label="ÏµúÍ∑º Í≥ÑÏÇ∞ Í∏∞Î°ù"
                    >
                        <History size={18} />
                    </button>
                    {isOpen && (
                        <>
                            <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />
                            <div className="absolute right-0 top-full mt-2 w-64 bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 z-50 animate-fade-in overflow-hidden">
                                <div className="p-3 border-b border-slate-100 dark:border-slate-700">
                                    <p className="text-xs font-bold text-slate-400 uppercase">ÏµúÍ∑º Í≥ÑÏÇ∞</p>
                                </div>
                                <div className="max-h-60 overflow-y-auto">
                                    {history.map((item, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => {
                                                if (onSelect) onSelect(item);
                                                setIsOpen(false);
                                            }}
                                            className="w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors border-b border-slate-50 dark:border-slate-700 last:border-0"
                                        >
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs font-bold text-blue-500">{typeLabels[item.type] || item.type}</span>
                                                <span className="text-[10px] text-slate-400">{formatDate(item.timestamp)}</span>
                                            </div>
                                            <p className="text-sm font-bold text-slate-700 dark:text-slate-200 mt-1 truncate">
                                                {item.result || 'Í≤∞Í≥º ÏóÜÏùå'}
                                            </p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        // --- Skeleton Loading Component ---
        const Skeleton = ({ className = "" }) => (
            <div className={`animate-pulse bg-slate-200 dark:bg-slate-700 rounded-xl ${className}`}></div>
        );

        // --- Error Boundary Component ---
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ErrorBoundary caught an error:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="p-8 m-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-3xl text-center">
                            <div className="text-4xl mb-4">‚ö†Ô∏è</div>
                            <h2 className="text-lg font-bold text-red-800 dark:text-red-200 mb-2">Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</h2>
                            <p className="text-sm text-red-600 dark:text-red-300 mb-4">ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÍ±∞ÎÇò Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.</p>
                            <button
                                onClick={() => window.location.reload()}
                                className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold text-sm transition-colors"
                            >
                                ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // --- Common Components ---
        // Loading Spinner Component
        const LoadingSpinner = ({ size = 'md', className = '' }) => {
            const sizes = { sm: 'w-4 h-4', md: 'w-6 h-6', lg: 'w-10 h-10' };
            return (
                <div className={`animate-spin rounded-full border-2 border-slate-200 dark:border-slate-600 border-t-indigo-600 dark:border-t-indigo-400 ${sizes[size]} ${className}`}></div>
            );
        };

        // Empty State Component with hint support
        const EmptyState = ({ message, hint, icon: Icon = Info, action, actionLabel }) => (
            <div className="text-center py-16 text-slate-400 dark:text-slate-500 bg-white dark:bg-slate-800 rounded-[2rem] border-2 border-dashed border-slate-200 dark:border-slate-600 animate-fade-in">
                <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                    <Icon className="w-8 h-8 opacity-60" />
                </div>
                <p className="font-bold text-slate-500 dark:text-slate-400">{message}</p>
                {hint && (
                    <p className="text-sm mt-2 text-slate-400 dark:text-slate-500 max-w-xs mx-auto">{hint}</p>
                )}
                {action && (
                    <button
                        onClick={action}
                        className="mt-4 px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-bold rounded-xl transition-all active:scale-95"
                    >
                        {actionLabel || 'ÏãúÏûëÌïòÍ∏∞'}
                    </button>
                )}
            </div>
        );

        // Copy Button Component
        const CopyButton = ({ text, showToast, className = '' }) => {
            const [copied, setCopied] = useState(false);

            const handleCopy = async () => {
                const success = await copyToClipboard(text, showToast);
                if (success) {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }
            };

            return (
                <button
                    onClick={handleCopy}
                    className={`p-2 rounded-xl transition-all active:scale-95 ${copied
                        ? 'bg-green-100 dark:bg-green-900/40 text-green-600 dark:text-green-400'
                        : 'bg-white/60 dark:bg-slate-700/60 text-slate-500 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-700'} ${className}`}
                    title="Í≤∞Í≥º Î≥µÏÇ¨"
                >
                    {copied ? <Check size={16} /> : <Copy size={16} />}
                </button>
            );
        };

        // Tooltip Component for help information
        const Tooltip = ({ children, content }) => {
            const [show, setShow] = useState(false);
            return (
                <div className="relative inline-flex items-center">
                    <button
                        type="button"
                        onMouseEnter={() => setShow(true)}
                        onMouseLeave={() => setShow(false)}
                        onClick={() => setShow(!show)}
                        className="p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                        aria-label="ÎèÑÏõÄÎßê"
                    >
                        <HelpCircle size={14} />
                    </button>
                    {show && (
                        <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 dark:bg-slate-700 text-white text-xs rounded-lg shadow-lg z-50 w-48 animate-fade-in">
                            {content}
                            <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800 dark:border-t-slate-700"></div>
                        </div>
                    )}
                </div>
            );
        };

        // ========== NEW COMPONENTS START ==========

        // Kakao Share Button Component
        const KakaoShareButton = ({ title, description, buttonText = 'Í≤∞Í≥º ÌôïÏù∏ÌïòÍ∏∞' }) => {
            const [isInitialized, setIsInitialized] = useState(false);

            useEffect(() => {
                // Initialize Kakao SDK (use your own app key in production)
                if (window.Kakao && !window.Kakao.isInitialized()) {
                    // Note: Replace with your Kakao JavaScript Key for production
                    try {
                        window.Kakao.init('YOUR_KAKAO_APP_KEY');
                        setIsInitialized(true);
                    } catch (e) {
                        // console.warn('Kakao SDK not initialized - demo mode');
                    }
                } else if (window.Kakao?.isInitialized()) {
                    setIsInitialized(true);
                }
            }, []);

            const handleKakaoShare = () => {
                if (window.Kakao?.Share) {
                    window.Kakao.Share.sendDefault({
                        objectType: 'feed',
                        content: {
                            title: title || 'Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro Í≥ÑÏÇ∞ Í≤∞Í≥º',
                            description: description || 'Î∂ÄÎèôÏÇ∞ Í≥ÑÏÇ∞ Í≤∞Í≥ºÎ•º ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî!',
                            imageUrl: 'https://via.placeholder.com/300x200?text=Î∂ÄÎèôÏÇ∞ÎßàÏä§ÌÑ∞Pro',
                            link: {
                                webUrl: window.location.href,
                                mobileWebUrl: window.location.href
                            }
                        },
                        buttons: [{
                            title: buttonText,
                            link: {
                                webUrl: window.location.href,
                                mobileWebUrl: window.location.href
                            }
                        }]
                    });
                } else {
                    // Fallback: URL copy
                    const shareText = `${title}\n${description}\n${window.location.href}`;
                    navigator.clipboard.writeText(shareText);
                    alert('Í≥µÏú† ÎßÅÌÅ¨Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\nÏπ¥Ïπ¥Ïò§ÌÜ°Ïóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî.');
                }
            };

            return (
                <button
                    onClick={handleKakaoShare}
                    className="flex items-center gap-2 px-4 py-2.5 bg-[#FEE500] hover:bg-[#FDD835] text-[#3C1E1E] rounded-xl font-bold text-sm transition-all active:scale-95 shadow-sm"
                    title="Ïπ¥Ïπ¥Ïò§ÌÜ°ÏúºÎ°ú Í≥µÏú†"
                >
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <path d="M12 3C6.48 3 2 6.48 2 10.5c0 2.53 1.67 4.76 4.17 6.07l-.87 3.25c-.08.3.23.55.5.39l3.85-2.56c.78.1 1.58.15 2.35.15 5.52 0 10-3.48 10-7.8S17.52 3 12 3z" />
                    </svg>
                    Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú†
                </button>
            );
        };

        // Loan Pie Chart Component using Chart.js
        const LoanPieChart = ({ principal, interest, title = "ÏõêÍ∏à vs Ïù¥Ïûê" }) => {
            const chartRef = React.useRef(null);
            const chartInstanceRef = React.useRef(null);

            useEffect(() => {
                if (!chartRef.current || !window.Chart) return;

                // Destroy existing chart
                if (chartInstanceRef.current) {
                    chartInstanceRef.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');

                chartInstanceRef.current = new window.Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ÏõêÍ∏à', 'Ïù¥Ïûê'],
                        datasets: [{
                            data: [principal, interest],
                            backgroundColor: [
                                '#6366f1',
                                '#ec4899'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 3,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#475569',
                                    font: { weight: 'bold', size: 12 },
                                    padding: 16
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: ${formatNumber(value)}Ïõê (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });

                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }
                };
            }, [principal, interest]);

            const total = principal + interest;
            const interestRatio = total > 0 ? ((interest / total) * 100).toFixed(1) : 0;

            return (
                <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h4 className="text-sm font-bold text-slate-700 text-center mb-4 flex items-center justify-center gap-2">
                        <PieChart size={16} className="text-indigo-500" />
                        {title}
                    </h4>
                    <div className="relative w-48 h-48 mx-auto">
                        <canvas ref={chartRef}></canvas>
                        <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                            <span className="text-xs text-slate-400">Ïù¥Ïûê ÎπÑÏú®</span>
                            <span className="text-2xl font-black text-pink-500">{interestRatio}%</span>
                        </div>
                    </div>
                    <div className="mt-4 grid grid-cols-2 gap-3 text-center text-xs">
                        <div className="p-2 bg-indigo-50 rounded-lg">
                            <span className="text-slate-500 block">ÏõêÍ∏à</span>
                            <span className="font-bold text-indigo-600">{formatCompactNumber(principal)}</span>
                        </div>
                        <div className="p-2 bg-pink-50 rounded-lg">
                            <span className="text-slate-500 block">Ïù¥Ïûê</span>
                            <span className="font-bold text-pink-600">{formatCompactNumber(interest)}</span>
                        </div>
                    </div>
                </div>
            );
        };

        // Excel Export Button Component
        const ExcelExportButton = ({ data, filename = 'Î∂ÄÎèôÏÇ∞ÎßàÏä§ÌÑ∞_Îç∞Ïù¥ÌÑ∞' }) => {
            const handleExport = () => {
                if (!window.XLSX) {
                    alert('Excel ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    // Get history data if no data provided
                    const exportData = data || getHistory();

                    if (!exportData || exportData.length === 0) {
                        alert('ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                        return;
                    }

                    // Format data for Excel
                    const formattedData = exportData.map((item, idx) => ({
                        'Î≤àÌò∏': idx + 1,
                        'Ïú†Ìòï': item.type || '-',
                        'Í≤∞Í≥º': item.result || '-',
                        'ÎÇ†Ïßú': item.timestamp ? new Date(item.timestamp).toLocaleString('ko-KR') : '-',
                        'ÏÉÅÏÑ∏': JSON.stringify(item.data || {})
                    }));

                    // Create workbook and worksheet
                    const ws = window.XLSX.utils.json_to_sheet(formattedData);
                    const wb = window.XLSX.utils.book_new();
                    window.XLSX.utils.book_append_sheet(wb, ws, 'Í≥ÑÏÇ∞ Í∏∞Î°ù');

                    // Set column widths
                    ws['!cols'] = [
                        { wch: 5 },
                        { wch: 12 },
                        { wch: 25 },
                        { wch: 20 },
                        { wch: 50 }
                    ];

                    // Download
                    const date = new Date().toISOString().split('T')[0];
                    window.XLSX.writeFile(wb, `${filename}_${date}.xlsx`);
                } catch (err) {
                    console.error('Excel export error:', err);
                    alert('Excel ÌååÏùº ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            };

            return (
                <button
                    onClick={handleExport}
                    className="flex items-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold text-sm transition-all active:scale-95 shadow-lg shadow-green-200 dark:shadow-none w-full justify-center"
                >
                    <FileDown size={18} />
                    Excel Îã§Ïö¥Î°úÎìú
                </button>
            );
        };

        // External Links Panel Component
        const ExternalLinksPanel = () => {
            const links = [
                {
                    id: 'bok',
                    label: 'ÌïúÍµ≠ÏùÄÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨',
                    url: 'https://www.bok.or.kr/portal/singl/baseRate/progress.do',
                    icon: 'üè¶',
                    color: 'from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border-blue-100 dark:border-blue-800'
                },
                {
                    id: 'molit',
                    label: 'Íµ≠ÌÜ†Î∂Ä Í≥µÏãúÍ∞ÄÍ≤©',
                    url: 'https://www.realtyprice.kr/',
                    icon: 'üèõÔ∏è',
                    color: 'from-emerald-50 to-teal-50 dark:from-emerald-900/30 dark:to-teal-900/30 border-emerald-100 dark:border-emerald-800'
                },
                {
                    id: 'kb',
                    label: 'KBÎ∂ÄÎèôÏÇ∞ ÏãúÏÑ∏',
                    url: 'https://kbland.kr/',
                    icon: 'üè†',
                    color: 'from-amber-50 to-orange-50 dark:from-amber-900/30 dark:to-orange-900/30 border-amber-100 dark:border-amber-800'
                },
                {
                    id: 'naver',
                    label: 'ÎÑ§Ïù¥Î≤Ñ Î∂ÄÎèôÏÇ∞',
                    url: 'https://land.naver.com/',
                    icon: 'üìç',
                    color: 'from-green-50 to-lime-50 dark:from-green-900/30 dark:to-lime-900/30 border-green-100 dark:border-green-800'
                },
                {
                    id: 'registry',
                    label: 'Îì±Í∏∞Î∂ÄÎì±Î≥∏ Ïó¥Îûå',
                    url: 'https://www.iros.go.kr/',
                    icon: 'üìú',
                    color: 'from-purple-50 to-violet-50 dark:from-purple-900/30 dark:to-violet-900/30 border-purple-100 dark:border-purple-800'
                },
                {
                    id: 'hug',
                    label: 'HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò',
                    url: 'https://www.khug.or.kr/',
                    icon: 'üõ°Ô∏è',
                    color: 'from-rose-50 to-pink-50 dark:from-rose-900/30 dark:to-pink-900/30 border-rose-100 dark:border-rose-800'
                }
            ];

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Link2 className="w-4 h-4 mr-2 text-indigo-600" /> Ïô∏Î∂Ä Ïó∞Îèô Î∞îÎ°úÍ∞ÄÍ∏∞
                    </h4>
                    <div className="grid grid-cols-2 gap-3">
                        {links.map(link => (
                            <a
                                key={link.id}
                                href={link.url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className={`p-4 rounded-xl bg-gradient-to-br ${link.color} border border-slate-100 hover:shadow-md transition-all active:scale-95 group`}
                            >
                                <div className="text-2xl mb-2">{link.icon}</div>
                                <p className="text-xs font-bold text-slate-700 group-hover:text-indigo-600 transition-colors">
                                    {link.label}
                                </p>
                                <p className="text-[10px] text-slate-400 mt-1">ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Î¶º ‚Üí</p>
                            </a>
                        ))}
                    </div>
                </div>
            );
        };

        // Î≥µÎπÑ ÌòëÏÉÅ ÎèÑÏö∞ÎØ∏
        const BrokerFeeNegotiator = () => {
            const [price, setPrice] = useState('');
            const [dealType, setDealType] = useState('Îß§Îß§');
            const [propType, setPropType] = useState('Ï£ºÌÉù');

            const result = useMemo(() => {
                const val = parseNumber(price);
                if (!val) return null;

                // Calculate legal max fee
                let maxRate = 0;
                let maxFee = 0;

                if (propType === 'Ï£ºÌÉù') {
                    if (dealType === 'ÏûÑÎåÄÏ∞®') {
                        if (val < 50000000) { maxRate = 0.5; maxFee = 200000; }
                        else if (val < 100000000) { maxRate = 0.4; maxFee = 300000; }
                        else if (val < 600000000) { maxRate = 0.3; }
                        else { maxRate = 0.4; }
                    } else {
                        if (val < 50000000) { maxRate = 0.6; maxFee = 250000; }
                        else if (val < 200000000) { maxRate = 0.5; maxFee = 800000; }
                        else if (val < 900000000) { maxRate = 0.4; }
                        else { maxRate = 0.5; }
                    }
                } else {
                    maxRate = propType === 'Ïò§ÌîºÏä§ÌÖî' ? 0.5 : 0.9;
                }

                let legalMax = Math.floor(val * (maxRate / 100));
                if (maxFee > 0 && legalMax > maxFee) legalMax = maxFee;

                const negotiated90 = Math.floor(legalMax * 0.9);
                const negotiated80 = Math.floor(legalMax * 0.8);
                const negotiated70 = Math.floor(legalMax * 0.7);

                return { legalMax, negotiated90, negotiated80, negotiated70, maxRate };
            }, [price, dealType, propType]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <DollarSign className="w-4 h-4 mr-2 text-green-600" /> Î≥µÎπÑ ÌòëÏÉÅ ÎèÑÏö∞ÎØ∏
                    </h4>
                    <div className="space-y-4">
                        <div className="flex gap-2">
                            <button onClick={() => setDealType('Îß§Îß§')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${dealType === 'Îß§Îß§' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-500'}`}>Îß§Îß§</button>
                            <button onClick={() => setDealType('ÏûÑÎåÄÏ∞®')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${dealType === 'ÏûÑÎåÄÏ∞®' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-500'}`}>ÏûÑÎåÄÏ∞®</button>
                        </div>
                        <NumberInput label="Í±∞ÎûòÍ∏àÏï°" value={price} onChange={setPrice} color="green" />
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="p-4 bg-red-50 rounded-xl text-center">
                                <p className="text-xs text-red-500 font-bold">Î≤ïÏ†ï ÏÉÅÌïúÏï° ({result.maxRate}%)</p>
                                <p className="text-2xl font-black text-red-600">{formatNumber(result.legalMax)}Ïõê</p>
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                                <div className="p-3 bg-green-50 rounded-xl text-center">
                                    <p className="text-[10px] text-slate-500">10% Ìï†Ïù∏</p>
                                    <p className="text-sm font-bold text-green-600">{formatNumber(result.negotiated90)}Ïõê</p>
                                </div>
                                <div className="p-3 bg-emerald-50 rounded-xl text-center">
                                    <p className="text-[10px] text-slate-500">20% Ìï†Ïù∏</p>
                                    <p className="text-sm font-bold text-emerald-600">{formatNumber(result.negotiated80)}Ïõê</p>
                                </div>
                                <div className="p-3 bg-teal-50 rounded-xl text-center">
                                    <p className="text-[10px] text-slate-500">30% Ìï†Ïù∏</p>
                                    <p className="text-sm font-bold text-teal-600">{formatNumber(result.negotiated70)}Ïõê</p>
                                </div>
                            </div>
                            <p className="text-xs text-center text-slate-400">üí° ÌòëÏÉÅ Ïãú "Î≤ïÏ†ï ÏÉÅÌïúÏï° Í∏∞Ï§ÄÏúºÎ°ú Ï°∞Í∏à Ìï†Ïù∏ Î∂ÄÌÉÅÎìúÎ†§Ïöî" ÎùºÍ≥† ÎßêÌï¥Î≥¥ÏÑ∏Ïöî</p>
                        </div>
                    )}
                </div>
            );
        };

        // Î¶¨Î™®Îç∏ÎßÅ ROI Í≥ÑÏÇ∞Í∏∞
        const RemodelingROICalculator = () => {
            const [currentValue, setCurrentValue] = useState('');
            const [remodelingCost, setRemodelingCost] = useState('');
            const [expectedValue, setExpectedValue] = useState('');

            const result = useMemo(() => {
                const current = parseNumber(currentValue);
                const cost = parseNumber(remodelingCost);
                const expected = parseNumber(expectedValue);

                if (!current || !cost) return null;

                const valueIncrease = expected - current;
                const roi = cost > 0 ? ((valueIncrease - cost) / cost) * 100 : 0;
                const netGain = valueIncrease - cost;

                return { valueIncrease, roi, netGain, totalInvestment: current + cost };
            }, [currentValue, remodelingCost, expectedValue]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <PenTool className="w-4 h-4 mr-2 text-purple-600" /> Î¶¨Î™®Îç∏ÎßÅ ROI Í≥ÑÏÇ∞Í∏∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÌòÑÏû¨ ÏãúÏÑ∏" value={currentValue} onChange={setCurrentValue} color="violet" />
                        <NumberInput label="Î¶¨Î™®Îç∏ÎßÅ ÎπÑÏö©" value={remodelingCost} onChange={setRemodelingCost} color="violet" />
                        <NumberInput label="ÏòàÏÉÅ ÏãúÏÑ∏ (Î¶¨Î™®Îç∏ÎßÅ ÌõÑ)" value={expectedValue} onChange={setExpectedValue} color="violet" />
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-4 rounded-xl text-center ${result.roi >= 0 ? 'bg-green-50' : 'bg-red-50'}`}>
                                <p className="text-xs text-slate-500 font-bold">Ìà¨Ïûê ÏàòÏùµÎ•† (ROI)</p>
                                <p className={`text-3xl font-black ${result.roi >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                    {result.roi >= 0 ? '+' : ''}{result.roi.toFixed(1)}%
                                </p>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div className="p-3 bg-slate-50 rounded-xl text-center">
                                    <p className="text-[10px] text-slate-500">Í∞ÄÏπò ÏÉÅÏäπ</p>
                                    <p className="text-sm font-bold text-indigo-600">{formatCompactNumber(result.valueIncrease)}</p>
                                </div>
                                <div className="p-3 bg-slate-50 rounded-xl text-center">
                                    <p className="text-[10px] text-slate-500">ÏàúÏàòÏùµ</p>
                                    <p className={`text-sm font-bold ${result.netGain >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                        {result.netGain >= 0 ? '+' : ''}{formatCompactNumber(result.netGain)}
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Í≥µÎèôÎ™ÖÏùò ÏãúÎÆ¨Î†àÏù¥ÏÖò
        const JointOwnershipSimulator = () => {
            const [price, setPrice] = useState('');
            const [ownershipRatio, setOwnershipRatio] = useState('50');

            const result = useMemo(() => {
                const p = parseNumber(price);
                const ratio = parseFloat(ownershipRatio) / 100;
                if (!p) return null;

                // Îã®ÎèÖÎ™ÖÏùò Ï∑®ÎìùÏÑ∏ (6Ïñµ Ïù¥Ìïò 1%, 9Ïñµ Ïù¥Ìïò 1~3%, 9Ïñµ Ï¥àÍ≥º 3%)
                let singleTaxRate = 0.01;
                if (p > 900000000) singleTaxRate = 0.03;
                else if (p > 600000000) singleTaxRate = 0.01 + ((p - 600000000) / 300000000) * 0.02;

                const singleTax = Math.floor(p * singleTaxRate);

                // Í≥µÎèôÎ™ÖÏùò (Í∞ÅÏûê ÏßÄÎ∂ÑÏóê Îî∞Îùº Í≥ÑÏÇ∞, ÏÜåÏï° Í∞êÎ©¥ Ìö®Í≥º)
                const share1 = p * ratio;
                const share2 = p * (1 - ratio);

                const calcTax = (amount) => {
                    if (amount <= 600000000) return amount * 0.01;
                    if (amount <= 900000000) return amount * 0.01 + (amount - 600000000) * 0.02 / 300000000 * (amount - 600000000);
                    return amount * 0.03;
                };

                let jointTax = Math.floor(calcTax(share1) + calcTax(share2));
                // Ïã§Ï†úÎ°úÎäî Îçî Î≥µÏû°ÌïòÏßÄÎßå, Í∞ÑÎã®ÌôîÎ•º ÏúÑÌï¥ ÏßÄÎ∂ÑÎ≥Ñ Í∞úÎ≥Ñ Ï†ÅÏö© Ìö®Í≥º ÏãúÎÆ¨Î†àÏù¥ÏÖò

                const savings = singleTax - jointTax;

                return { singleTax, jointTax, savings, share1, share2, ratio };
            }, [price, ownershipRatio]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Users className="w-4 h-4 mr-2 text-blue-600" /> Í≥µÎèôÎ™ÖÏùò ÏãúÎÆ¨Î†àÏù¥ÏÖò
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Îß§Îß§Í∞Ä" value={price} onChange={setPrice} color="blue" />
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">ÏßÄÎ∂Ñ ÎπÑÏú® (Î≥∏Ïù∏ : Î∞∞Ïö∞Ïûê)</label>
                            <div className="flex gap-2">
                                {['50', '60', '70', '80'].map(r => (
                                    <button
                                        key={r}
                                        onClick={() => setOwnershipRatio(r)}
                                        className={`flex-1 py-2 rounded-lg text-xs font-bold ${ownershipRatio === r ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >
                                        {r}:{100 - parseInt(r)}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="grid grid-cols-2 gap-3">
                                <div className="p-4 bg-slate-100 rounded-xl text-center">
                                    <p className="text-xs text-slate-500 font-bold">Îã®ÎèÖÎ™ÖÏùò Ï∑®ÎìùÏÑ∏</p>
                                    <p className="text-lg font-black text-slate-700">{formatNumber(result.singleTax)}Ïõê</p>
                                </div>
                                <div className="p-4 bg-blue-50 rounded-xl text-center">
                                    <p className="text-xs text-blue-500 font-bold">Í≥µÎèôÎ™ÖÏùò Ï∑®ÎìùÏÑ∏</p>
                                    <p className="text-lg font-black text-blue-600">{formatNumber(result.jointTax)}Ïõê</p>
                                </div>
                            </div>
                            <div className={`p-4 rounded-xl text-center ${result.savings > 0 ? 'bg-green-50' : 'bg-slate-50'}`}>
                                <p className="text-xs text-slate-500">Ï†àÍ∞ê Ìö®Í≥º</p>
                                <p className={`text-2xl font-black ${result.savings > 0 ? 'text-green-600' : 'text-slate-500'}`}>
                                    {result.savings > 0 ? '-' : ''}{formatNumber(Math.abs(result.savings))}Ïõê
                                </p>
                            </div>
                            <p className="text-xs text-center text-slate-400">
                                üí° Í≥µÎèôÎ™ÖÏùò Ïãú ÏñëÎèÑÏÑ∏, Ï¢ÖÎ∂ÄÏÑ∏ Î∂ÑÏÇ∞ Ìö®Í≥ºÎèÑ ÏûàÏäµÎãàÎã§
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        // Î™©Ìëú ÏàòÏùµÎ•† Îã¨ÏÑ± ÏõîÏÑ∏ Ïó≠ÏÇ∞
        const RentYieldTargetCalculator = () => {
            const [price, setPrice] = useState('');
            const [deposit, setDeposit] = useState('');
            const [targetYield, setTargetYield] = useState('5');

            const result = useMemo(() => {
                const p = parseNumber(price);
                const d = parseNumber(deposit);
                const target = parseFloat(targetYield) / 100;

                if (!p) return null;

                // Î™©Ìëú ÏàòÏùµÎ•† = (Ïó∞ ÏõîÏÑ∏ ÏàòÏûÖ / (Îß§Îß§Í∞Ä - Î≥¥Ï¶ùÍ∏à)) √ó 100
                // Ïó≠ÏÇ∞: Ïó∞ ÏõîÏÑ∏ = Î™©Ìëú ÏàòÏùµÎ•† √ó (Îß§Îß§Í∞Ä - Î≥¥Ï¶ùÍ∏à)
                const investment = p - d;
                const annualRent = investment * target;
                const monthlyRent = Math.floor(annualRent / 12);

                return { investment, annualRent, monthlyRent, targetYield: target * 100 };
            }, [price, deposit, targetYield]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-orange-600" /> ÏõîÏÑ∏ ÏàòÏùµÎ•† Î™©Ìëú Í≥ÑÏÇ∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Îß§Îß§Í∞Ä" value={price} onChange={setPrice} color="orange" />
                        <NumberInput label="Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="orange" />
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">Î™©Ìëú ÏàòÏùµÎ•† (%)</label>
                            <div className="flex gap-2">
                                {['3', '4', '5', '6', '7'].map(r => (
                                    <button
                                        key={r}
                                        onClick={() => setTargetYield(r)}
                                        className={`flex-1 py-2 rounded-lg text-xs font-bold ${targetYield === r ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >
                                        {r}%
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="p-4 bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl text-center">
                                <p className="text-xs text-orange-500 font-bold">{result.targetYield}% ÏàòÏùµÎ•† Îã¨ÏÑ±ÏùÑ ÏúÑÌïú ÏõîÏÑ∏</p>
                                <p className="text-4xl font-black text-orange-600">{formatNumber(result.monthlyRent)}<span className="text-lg">Ïõê</span></p>
                            </div>
                            <div className="grid grid-cols-2 gap-3 text-center text-xs">
                                <div className="p-3 bg-slate-50 rounded-lg">
                                    <p className="text-slate-500">Ïã§Ìà¨ÏûêÍ∏à</p>
                                    <p className="font-bold text-slate-700">{formatCompactNumber(result.investment)}</p>
                                </div>
                                <div className="p-3 bg-slate-50 rounded-lg">
                                    <p className="text-slate-500">Ïó∞ ÏõîÏÑ∏ ÏàòÏûÖ</p>
                                    <p className="font-bold text-slate-700">{formatCompactNumber(result.annualRent)}</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Ï†ÑÏÑ∏ ÎßåÍ∏∞ D-day Í≥ÑÏÇ∞Í∏∞
        const LeaseExpiryCalculator = () => {
            const [startDate, setStartDate] = useState('');
            const [contractYears, setContractYears] = useState('2');

            const result = useMemo(() => {
                if (!startDate) return null;

                const start = new Date(startDate);
                const years = parseInt(contractYears);
                const expiry = new Date(start);
                expiry.setFullYear(expiry.getFullYear() + years);

                const today = new Date();
                const diffTime = expiry.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                // Í∞±Ïã† ÌÜµÎ≥¥ Í∏∞Í∞Ñ (ÎßåÎ£å 6Í∞úÏõî Ï†Ñ ~ 1Í∞úÏõî Ï†Ñ)
                const renewalStart = new Date(expiry);
                renewalStart.setMonth(renewalStart.getMonth() - 6);
                const renewalEnd = new Date(expiry);
                renewalEnd.setMonth(renewalEnd.getMonth() - 1);

                const isRenewalPeriod = today >= renewalStart && today <= renewalEnd;
                const daysUntilRenewalStart = Math.ceil((renewalStart.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));

                return {
                    expiry,
                    diffDays,
                    isExpired: diffDays < 0,
                    renewalStart,
                    renewalEnd,
                    isRenewalPeriod,
                    daysUntilRenewalStart
                };
            }, [startDate, contractYears]);

            const formatDateKr = (date) => {
                return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Calendar className="w-4 h-4 mr-2 text-rose-600" /> Ï†ÑÏÑ∏ ÎßåÍ∏∞ D-day
                    </h4>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">Í≥ÑÏïΩ ÏãúÏûëÏùº</label>
                            <input
                                type="date"
                                value={startDate}
                                onChange={e => setStartDate(e.target.value)}
                                className="w-full px-4 py-3 bg-slate-50 rounded-xl font-medium outline-none input-unified"
                            />
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">Í≥ÑÏïΩ Í∏∞Í∞Ñ</label>
                            <div className="flex gap-2">
                                {['1', '2', '3', '4'].map(y => (
                                    <button
                                        key={y}
                                        onClick={() => setContractYears(y)}
                                        className={`flex-1 py-2 rounded-lg text-xs font-bold ${contractYears === y ? 'bg-rose-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >
                                        {y}ÎÖÑ
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-6 rounded-2xl text-center ${result.isExpired ? 'bg-red-100' : result.diffDays <= 30 ? 'bg-orange-100' : 'bg-blue-50'}`}>
                                <p className="text-xs font-bold text-slate-500 mb-2">Í≥ÑÏïΩ ÎßåÎ£åÏùº</p>
                                <p className="text-lg font-bold text-slate-700 mb-3">{formatDateKr(result.expiry)}</p>
                                <p className={`text-5xl font-black ${result.isExpired ? 'text-red-600' : result.diffDays <= 30 ? 'text-orange-600' : 'text-blue-600'}`}>
                                    D{result.diffDays >= 0 ? '-' : '+'}{Math.abs(result.diffDays)}
                                </p>
                            </div>

                            {result.isRenewalPeriod && (
                                <div className="p-4 bg-green-50 rounded-xl text-center border-2 border-green-200">
                                    <p className="text-sm font-bold text-green-600">üîî ÏßÄÍ∏àÏù¥ Í∞±Ïã† ÌÜµÎ≥¥ Í∏∞Í∞ÑÏûÖÎãàÎã§!</p>
                                    <p className="text-xs text-green-500 mt-1">Í∞±Ïã†Ï≤≠Íµ¨Í∂å ÏÇ¨Ïö© Ïãú ÏßëÏ£ºÏù∏ÏóêÍ≤å ÌÜµÎ≥¥ÌïòÏÑ∏Ïöî</p>
                                </div>
                            )}

                            {!result.isRenewalPeriod && result.daysUntilRenewalStart > 0 && (
                                <div className="p-3 bg-slate-50 rounded-xl text-center">
                                    <p className="text-xs text-slate-500">Í∞±Ïã† ÌÜµÎ≥¥ Í∞ÄÎä•ÏùºÍπåÏßÄ <span className="font-bold text-indigo-600">{result.daysUntilRenewalStart}Ïùº</span></p>
                                    <p className="text-[10px] text-slate-400 mt-1">({formatDateKr(result.renewalStart)} ~ {formatDateKr(result.renewalEnd)})</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // Enhanced Tax Calendar Component
        const EnhancedTaxCalendar = () => {
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
            const [customEvents, setCustomEvents] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('taxCalendarEvents') || '[]') || [];
                } catch {
                    return [];
                }
            });
            const [newEvent, setNewEvent] = useState({ date: '', title: '' });

            const taxSchedule = [
                { month: 0, day: 31, title: 'Ï¢ÖÌï©ÏÜåÎìùÏÑ∏ Ï§ëÍ∞ÑÏòàÎÇ©', type: 'income', color: 'blue' },
                { month: 0, day: 31, title: 'Î∂ÄÍ∞ÄÍ∞ÄÏπòÏÑ∏ Ïã†Í≥† (2Í∏∞)', type: 'vat', color: 'purple' },
                { month: 2, day: 31, title: 'Î≤ïÏù∏ÏÑ∏ Ïã†Í≥†', type: 'corporate', color: 'indigo' },
                { month: 4, day: 31, title: 'Ï¢ÖÌï©ÏÜåÎìùÏÑ∏ ÌôïÏ†ïÏã†Í≥†', type: 'income', color: 'blue' },
                { month: 5, day: 1, title: 'Ïû¨ÏÇ∞ÏÑ∏ Í≥ºÏÑ∏Í∏∞Ï§ÄÏùº', type: 'property', color: 'teal' },
                { month: 6, day: 16, title: 'Ïû¨ÏÇ∞ÏÑ∏ 1Í∏∞Î∂Ñ ÎÇ©Î∂Ä ÏãúÏûë', type: 'property', color: 'teal' },
                { month: 6, day: 31, title: 'Ïû¨ÏÇ∞ÏÑ∏ 1Í∏∞Î∂Ñ ÎÇ©Î∂Ä ÎßàÍ∞ê', type: 'property', color: 'teal' },
                { month: 7, day: 25, title: 'Î∂ÄÍ∞ÄÍ∞ÄÏπòÏÑ∏ Ïã†Í≥† (1Í∏∞)', type: 'vat', color: 'purple' },
                { month: 8, day: 16, title: 'Ïû¨ÏÇ∞ÏÑ∏ 2Í∏∞Î∂Ñ ÎÇ©Î∂Ä ÏãúÏûë', type: 'property', color: 'teal' },
                { month: 8, day: 30, title: 'Ïû¨ÏÇ∞ÏÑ∏ 2Í∏∞Î∂Ñ ÎÇ©Î∂Ä ÎßàÍ∞ê', type: 'property', color: 'teal' },
                { month: 10, day: 30, title: 'Ï¢ÖÌï©ÏÜåÎìùÏÑ∏ Ï§ëÍ∞ÑÏòàÎÇ©', type: 'income', color: 'blue' },
                { month: 11, day: 1, title: 'Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏ ÎÇ©Î∂Ä ÏãúÏûë', type: 'property', color: 'rose' },
                { month: 11, day: 15, title: 'Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏ ÎÇ©Î∂Ä ÎßàÍ∞ê', type: 'property', color: 'rose' }
            ];

            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];

            const eventsThisMonth = taxSchedule.filter(e => e.month === selectedMonth);

            const addEvent = () => {
                if (!newEvent.date || !newEvent.title) return;
                const updated = [...customEvents, { ...newEvent, id: Date.now() }];
                setCustomEvents(updated);
                localStorage.setItem('taxCalendarEvents', JSON.stringify(updated));
                setNewEvent({ date: '', title: '' });
            };

            const removeEvent = (id) => {
                const updated = customEvents.filter(e => e.id !== id);
                setCustomEvents(updated);
                localStorage.setItem('taxCalendarEvents', JSON.stringify(updated));
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Calendar className="w-4 h-4 mr-2 text-indigo-600" /> ÏÑ∏Í∏à Ï∫òÎ¶∞Îçî
                    </h4>

                    {/* Month Selector */}
                    <div className="flex overflow-x-auto gap-1 pb-3 mb-4 scrollbar-hide">
                        {monthNames.map((name, idx) => (
                            <button
                                key={idx}
                                onClick={() => setSelectedMonth(idx)}
                                className={`flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${selectedMonth === idx ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                            >
                                {name}
                            </button>
                        ))}
                    </div>

                    {/* Events List */}
                    <div className="space-y-2 mb-4">
                        {eventsThisMonth.length > 0 ? (
                            eventsThisMonth.map((event, idx) => (
                                <div key={idx} className={`p-3 rounded-xl bg-${event.color}-50 border-l-4 border-${event.color}-500`}>
                                    <div className="flex justify-between items-center">
                                        <span className={`text-xs font-bold text-${event.color}-600`}>{event.day}Ïùº</span>
                                        <span className={`text-[10px] px-2 py-0.5 rounded-full bg-${event.color}-100 text-${event.color}-600`}>
                                            {event.type}
                                        </span>
                                    </div>
                                    <p className="text-sm font-bold text-slate-700 mt-1">{event.title}</p>
                                </div>
                            ))
                        ) : (
                            <div className="text-center py-6 text-slate-400">
                                Ïù¥ Îã¨ÏóêÎäî ÏòàÏ†ïÎêú ÏÑ∏Í∏à ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§
                            </div>
                        )}
                    </div>

                    {/* Custom Event */}
                    <div className="border-t border-slate-100 pt-4">
                        <p className="text-xs font-bold text-slate-500 mb-2">üìå Í∞úÏù∏ ÏùºÏ†ï Ï∂îÍ∞Ä</p>
                        <div className="flex gap-2">
                            <input
                                type="date"
                                value={newEvent.date}
                                onChange={e => setNewEvent({ ...newEvent, date: e.target.value })}
                                className="flex-1 px-3 py-2 bg-slate-50 rounded-lg text-xs outline-none"
                            />
                            <input
                                type="text"
                                value={newEvent.title}
                                onChange={e => setNewEvent({ ...newEvent, title: e.target.value })}
                                placeholder="ÏùºÏ†ï Ï†úÎ™©"
                                className="flex-1 px-3 py-2 bg-slate-50 rounded-lg text-xs outline-none"
                            />
                            <button onClick={addEvent} className="px-4 py-2 bg-indigo-600 text-white rounded-lg text-xs font-bold">Ï∂îÍ∞Ä</button>
                        </div>
                        {customEvents.length > 0 && (
                            <div className="mt-3 space-y-1">
                                {customEvents.map(e => (
                                    <div key={e.id} className="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                                        <span className="text-xs"><span className="font-bold">{e.date}</span> - {e.title}</span>
                                        <button onClick={() => removeEvent(e.id)} className="text-red-400 hover:text-red-600"><X size={14} /></button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ========== NEW COMPONENTS END ==========


        // Reset Button Component
        const ResetButton = ({ onClick, className = '' }) => (
            <button
                type="button"
                onClick={onClick}
                className={`p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all active:scale-95 ${className}`}
                title="Ï¥àÍ∏∞Ìôî"
                aria-label="ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî"
            >
                <RotateCcw size={18} />
            </button>
        );

        // Result Card Component (reusable for calculation results) - with animation and copy
        const ResultCard = ({ title, value, subtitle, copyText, showToast, colorClass = 'from-blue-50 to-indigo-50', borderClass = 'border-blue-100', children, animate = true }) => (
            <div className={`group bg-gradient-to-br ${colorClass} p-6 rounded-[2.5rem] border ${borderClass} shadow-lg relative card-hover ${animate ? 'animate-fade-in' : ''}`}>
                {copyText && showToast && (
                    <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                        <CopyButton text={copyText} showToast={showToast} />
                    </div>
                )}
                {title && (
                    <div className="text-center mb-4">
                        <p className="text-sm font-bold opacity-60 uppercase tracking-widest mb-1">{title}</p>
                        <p className="text-4xl font-black result-number text-slate-900">{value}</p>
                        {subtitle && <p className="text-xs opacity-50 mt-1">{subtitle}</p>}
                    </div>
                )}
                {children}
            </div>
        );

        // Detail Row Component (for result breakdowns)
        // Detail Row Component (for result breakdowns)
        const DetailRow = ({ label, value, highlight = false, negative = false }) => (
            <div className={`flex justify-between text-sm ${highlight ? 'font-bold text-slate-800' : 'font-medium text-slate-600'}`}>
                <span>{label}</span>
                <span className={negative ? 'text-green-600' : ''}>{value}</span>
            </div>
        );

        const NumberInput = React.memo(({
            label,
            value,
            onChange,
            unit = 'Ïõê',
            placeholder = '0',
            color = 'blue',
            enableUnitToggle = true,
            showKorean = true,
            min = 0,
            max = null,
            required = false,
            errorMessage = ''
        }) => {
            const [unitMode, setUnitMode] = useState(() => getSafeLocalStorage('unitMode', 'ÎßåÏõê'));
            const [isTouched, setIsTouched] = useState(false);
            const [hasError, setHasError] = useState(false);
            const inputId = useId();

            // Save unit mode preference (debounced)
            useEffect(() => {
                debouncedSetStorage('unitMode', unitMode);
            }, [unitMode]);

            // Validate input
            useEffect(() => {
                if (!isTouched) return;
                const numValue = parseNumber(value);
                let isValid = true;

                if (required && !value) isValid = false;
                if (min !== null && numValue < min) isValid = false;
                if (max !== null && numValue > max) isValid = false;

                setHasError(!isValid && value !== '');
            }, [value, min, max, required, isTouched]);

            const handleChange = (e) => {
                const rawValue = e.target.value.replace(/,/g, '');
                if (!isNaN(rawValue) && rawValue !== '') {
                    if (enableUnitToggle && unitMode === 'ÎßåÏõê') {
                        onChange(String(Math.round(parseFloat(rawValue || 0) * 10000)));
                    } else {
                        onChange(rawValue);
                    }
                } else if (rawValue === '') {
                    onChange('');
                }
            };

            const handleBlur = () => setIsTouched(true);

            const displayValue = useMemo(() => {
                if (!value) return '';
                if (enableUnitToggle && unitMode === 'ÎßåÏõê') {
                    const manwon = Math.round(parseNumber(value) / 10000);
                    return formatNumber(manwon);
                }
                return formatNumber(value);
            }, [value, unitMode, enableUnitToggle]);

            const koreanDisplay = useMemo(() => {
                if (!showKorean || !value) return '';
                return formatKoreanNumber(value);
            }, [value, showKorean]);

            const focusColors = {
                blue: 'focus:ring-blue-500',
                orange: 'focus:ring-orange-500',
                green: 'focus:ring-emerald-500',
                violet: 'focus:ring-violet-500',
                cyan: 'focus:ring-cyan-500'
            };

            const errorClasses = hasError ? 'ring-red-400 bg-red-50' : '';

            return (
                <div className="flex flex-col space-y-1.5">
                    <div className="flex justify-between items-center">
                        <label htmlFor={inputId} className="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">
                            {label}
                            {required && <span className="text-red-500 ml-0.5">*</span>}
                        </label>
                        {enableUnitToggle && (
                            <div className="flex text-[11px] font-bold">
                                <button
                                    onClick={() => setUnitMode('Ïõê')}
                                    type="button"
                                    className={`px-3 py-1.5 min-h-[32px] rounded-l-lg transition-all active:scale-95 ${unitMode === 'Ïõê' ? 'bg-slate-800 text-white shadow-sm' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                >Ïõê</button>
                                <button
                                    onClick={() => setUnitMode('ÎßåÏõê')}
                                    type="button"
                                    className={`px-3 py-1.5 min-h-[32px] rounded-r-lg transition-all active:scale-95 ${unitMode === 'ÎßåÏõê' ? 'bg-slate-800 text-white shadow-sm' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                >ÎßåÏõê</button>
                            </div>
                        )}
                    </div>
                    <div className="relative group">
                        <input
                            id={inputId}
                            type="text"
                            inputMode="numeric"
                            value={displayValue}
                            onChange={handleChange}
                            onBlur={handleBlur}
                            onFocus={(e) => e.target.select()}
                            placeholder={placeholder}
                            aria-label={label}
                            aria-invalid={hasError}
                            className={`w-full pl-5 pr-14 py-4 text-right border-0 bg-slate-50 rounded-2xl shadow-sm ring-1 ring-slate-200 ${focusColors[color]} focus:ring-2 focus:bg-white outline-none transition-all font-bold text-slate-800 text-lg group-hover:ring-slate-300 ${errorClasses}`}
                        />
                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm font-medium pointer-events-none">
                            {enableUnitToggle ? unitMode : unit}
                        </span>
                    </div>
                    {hasError && errorMessage && (
                        <p className="text-xs text-red-500 ml-1 flex items-center gap-1">
                            <AlertTriangle size={12} /> {errorMessage}
                        </p>
                    )}
                    {showKorean && koreanDisplay && !hasError && (
                        <div className="text-xs text-slate-400 ml-1 font-medium">
                            ‚âà {koreanDisplay}
                        </div>
                    )}
                </div>
            );
        });

        const ToggleGroup = React.memo(({ options, value, onChange, color = 'blue' }) => {
            const activeClasses = {
                blue: 'bg-white text-blue-600 shadow-md ring-1 ring-black/5',
                green: 'bg-white text-emerald-600 shadow-md ring-1 ring-black/5',
                violet: 'bg-white text-violet-600 shadow-md ring-1 ring-black/5',
                orange: 'bg-white text-orange-600 shadow-md ring-1 ring-black/5',
            };

            return (
                <div role="radiogroup" className="flex bg-slate-100/80 p-1.5 rounded-2xl">
                    {options.map((option) => (
                        <button
                            role="radio"
                            aria-checked={value === option}
                            key={option}
                            onClick={() => onChange(option)}
                            className={`flex-1 py-3 min-h-[44px] text-xs font-bold rounded-xl transition-all active:scale-95 ${value === option
                                ? activeClasses[color] || activeClasses.blue
                                : 'text-slate-400 hover:text-slate-600 hover:bg-white/50'
                                }`}
                        >
                            {option}
                        </button>
                    ))}
                </div>
            );
        });

        // --- Constants for ToggleGroups ---
        const OPTIONS_PROP_TYPE = ['Ï£ºÌÉù', 'Ïò§ÌîºÏä§ÌÖî', 'ÏÉÅÍ∞Ä'];
        const OPTIONS_DEAL_TYPE = ['ÏûÑÎåÄÏ∞®', 'Îß§Îß§'];
        const OPTIONS_LOAN_METHOD = ['ÎßåÍ∏∞ÏùºÏãú', 'ÏõêÎ¶¨Í∏àÍ∑†Îì±', 'ÏõêÍ∏àÍ∑†Îì±'];
        const OPTIONS_REGION = ['ÎπÑÍ∑úÏ†ú', 'Í∑úÏ†ú(Ï°∞Ï†ï)'];
        const OPTIONS_COUNT = ['1Ï±Ñ', '2Ï±Ñ', '3Ï±Ñ+'];
        const OPTIONS_YEARS = ['1', '2', '3'];

        // --- Tabs ---
        // 1. Cost Comparison
        const CostCompareTab = () => {
            const [jDeposit, setJDeposit] = useState(() => getSafeLocalStorage('jDeposit'));
            const [jLoanAmount, setJLoanAmount] = useState(() => getSafeLocalStorage('jLoanAmount'));
            const [jRate, setJRate] = useState(() => getSafeLocalStorage('jRate', '4.5'));
            const [jRatio, setJRatio] = useState(() => getSafeLocalStorage('jRatio', '80'));
            const [wDeposit, setWDeposit] = useState(() => getSafeLocalStorage('wDeposit'));
            const [wMonthly, setWMonthly] = useState(() => getSafeLocalStorage('wMonthly'));
            const [wRate, setWRate] = useState(() => getSafeLocalStorage('wRate', '5.0'));
            const [income, setIncome] = useState(() => getSafeLocalStorage('income'));

            // ÌÜµÌï© localStorage Ï†ÄÏû• (ÏÑ±Îä• ÏµúÏ†ÅÌôî)
            useEffect(() => {
                debouncedSetStorage('jDeposit', jDeposit);
                debouncedSetStorage('jLoanAmount', jLoanAmount);
                debouncedSetStorage('jRate', jRate);
                debouncedSetStorage('jRatio', jRatio);
                debouncedSetStorage('wDeposit', wDeposit);
                debouncedSetStorage('wMonthly', wMonthly);
                debouncedSetStorage('wRate', wRate);
                debouncedSetStorage('income', income);
            }, [jDeposit, jLoanAmount, jRate, jRatio, wDeposit, wMonthly, wRate, income]);

            // ÎåÄÏ∂úÍ∏àÏï° ÏûÖÎ†•Ïãú ÏûêÎèô ÎåÄÏ∂úÎπÑÏú® Í≥ÑÏÇ∞
            const handleLoanAmountChange = useCallback((value) => {
                setJLoanAmount(value);
                const depVal = parseNumber(jDeposit);
                const loanVal = parseNumber(value);
                if (depVal > 0 && loanVal > 0) {
                    const ratio = Math.round((loanVal / depVal) * 100);
                    setJRatio(String(Math.min(ratio, 100)));
                }
            }, [jDeposit]);

            // ÎåÄÏ∂úÎπÑÏú® ÏûÖÎ†•Ïãú ÏûêÎèô ÎåÄÏ∂úÍ∏àÏï° Í≥ÑÏÇ∞
            const handleRatioChange = useCallback((value) => {
                setJRatio(value);
                const depVal = parseNumber(jDeposit);
                const ratioVal = parseFloat(value) || 0;
                if (depVal > 0) {
                    const loanAmount = Math.round(depVal * (ratioVal / 100));
                    setJLoanAmount(String(loanAmount));
                }
            }, [jDeposit]);

            // Î≥¥Ï¶ùÍ∏à Î≥ÄÍ≤ΩÏãú ÎåÄÏ∂úÍ∏àÏï° Ïû¨Í≥ÑÏÇ∞
            useEffect(() => {
                const depVal = parseNumber(jDeposit);
                const ratioVal = parseFloat(jRatio) || 0;
                if (depVal > 0 && ratioVal > 0) {
                    const loanAmount = Math.round(depVal * (ratioVal / 100));
                    setJLoanAmount(String(loanAmount));
                }
            }, [jDeposit]);

            const result = useMemo(() => {
                const jDepVal = parseNumber(jDeposit);
                const jRateVal = parseFloat(jRate) || 0;
                const jLoanVal = parseNumber(jLoanAmount) || (jDepVal * (parseFloat(jRatio) / 100));
                const wDepVal = parseNumber(wDeposit);
                const wMonVal = parseNumber(wMonthly);
                const wRateVal = parseFloat(wRate) || 0;

                const jMonthlyCost = (jLoanVal * (jRateVal / 100)) / 12;

                const wMonthlyOppCost = (wDepVal * (wRateVal / 100)) / 12;
                const wTotalCost = wMonVal + wMonthlyOppCost;

                const diff = Math.abs(jMonthlyCost - wTotalCost);
                const winner = jMonthlyCost < wTotalCost ? 'Ï†ÑÏÑ∏' : 'ÏõîÏÑ∏';

                const incomeVal = parseNumber(income);
                let rir = 0;
                if (incomeVal > 0) {
                    const currentCost = winner === 'Ï†ÑÏÑ∏' ? jMonthlyCost : wTotalCost;
                    rir = (currentCost / incomeVal) * 100;
                }

                return { jMonthlyCost, wTotalCost, diff, winner, rir, incomeVal, jLoanVal };
            }, [jDeposit, jLoanAmount, jRate, jRatio, wDeposit, wMonthly, wRate, income]);

            const maxVal = Math.max(result.jMonthlyCost, result.wTotalCost, 1);

            // Reset function
            const handleReset = () => {
                setJDeposit('');
                setJLoanAmount('');
                setJRate('4.5');
                setJRatio('80');
                setWDeposit('');
                setWMonthly('');
                setWRate('5.0');
                setIncome('');
            };

            // Share function
            const [copied, setCopied] = useState(false);
            const handleShare = () => {
                const text = `[Ï†ÑÏõîÏÑ∏ ÎπÑÍµê Í≤∞Í≥º]\n\nüìä ${result.winner} Ïú†Î¶¨\nüí∞ Îß§Ïõî ÏïΩ ${formatNumber(parseInt(result.diff))}Ïõê Ï†àÏïΩ\n\nüìç Ï†ÑÏÑ∏ ÏõîÎπÑÏö©: ${formatNumber(parseInt(result.jMonthlyCost))}Ïõê\nüìç ÏõîÏÑ∏ Ï¥ùÎπÑÏö©: ${formatNumber(parseInt(result.wTotalCost))}Ïõê\n\n- Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro`;
                navigator.clipboard.writeText(text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    {/* Base Rate Info + Buttons */}
                    <div className="flex justify-between items-start gap-2">
                        <div className="flex-1 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-2xl flex items-center justify-between border border-blue-100/50 shadow-sm">
                            <div className="flex items-center gap-3">
                                <div className="bg-white p-2 rounded-full shadow-sm text-blue-600">
                                    <TrendingUp size={20} />
                                </div>
                                <div>
                                    <span className="text-xs font-bold text-blue-600 uppercase tracking-wider block mb-0.5">Bank of Korea Rate ({BOK_RATE_DATE_DEFAULT})</span>
                                    <div className="text-lg font-extrabold text-slate-800 flex items-center gap-2 flex-wrap">
                                        ÌïúÍµ≠ÏùÄÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ {BOK_RATE_DEFAULT.toFixed(2)}%
                                        <a href="https://www.bok.or.kr/portal/singl/baseRate/progress.do?dataSeCd=01&menuNo=200656" target="_blank" rel="noopener noreferrer" className="text-[10px] bg-blue-100/50 hover:bg-white text-blue-700 px-2 py-0.5 rounded-full border border-blue-200 transition-all no-print">
                                            ÏµúÏã† ÌôïÏù∏ ‚Üí
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <button
                                onClick={() => {
                                    // ÌÜ†Ïä§Ìä∏Î°ú ÌòÑÏû¨ Í∏àÎ¶¨ ÏÉÅÌÉú ÏïåÎ†§Ï£ºÍ∏∞
                                    alert(`‚úÖ ÌòÑÏû¨ Í∏∞Ï§ÄÍ∏àÎ¶¨: ${BOK_RATE_DEFAULT}%\nüìÖ ÎßàÏßÄÎßâ Í∏àÌÜµÏúÑ Í≤∞Ï†ïÏùº: ${BOK_RATE_DATE_DEFAULT}\n\nÏµúÏã† Í∏àÎ¶¨Îäî ÌïúÍµ≠ÏùÄÌñâ Í≥µÏãù ÌôàÌéòÏù¥ÏßÄÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.`);
                                }}
                                className="p-2 bg-white/50 rounded-xl text-blue-600 hover:bg-white transition-all no-print ml-2"
                                title="Í∏∞Ï§ÄÍ∏àÎ¶¨ ÌôïÏù∏"
                                aria-label="Í∏∞Ï§ÄÍ∏àÎ¶¨ ÌôïÏù∏"
                            >
                                <RefreshCw size={16} />
                            </button>
                        </div>
                        <button
                            onClick={handleReset}
                            className="p-3 bg-white rounded-2xl border border-slate-100 shadow-sm text-slate-400 hover:text-red-500 hover:border-red-200 transition-all no-print"
                            title="ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî"
                            aria-label="ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî"
                        >
                            <RotateCcw size={20} />
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:border-blue-200 transition-colors">
                            <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                                <span className="w-2 h-2 rounded-full bg-blue-500 mr-2 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></span>
                                Ï†ÑÏÑ∏ Ï°∞Í±¥
                            </h3>
                            <div className="space-y-5">
                                <NumberInput label="Î≥¥Ï¶ùÍ∏à" value={jDeposit} onChange={setJDeposit} color="blue" />
                                <NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={jLoanAmount} onChange={handleLoanAmountChange} color="blue" />
                                <div className="flex gap-3">
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">ÎåÄÏ∂úÍ∏àÎ¶¨ (%)</label>
                                        <input type="number" value={jRate} onChange={(e) => setJRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white font-bold text-slate-700 transition-all font-mono tracking-tight" />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">ÎåÄÏ∂úÎπÑÏú® (%)</label>
                                        <input type="number" value={jRatio} onChange={(e) => handleRatioChange(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white font-bold text-slate-700 transition-all font-mono tracking-tight" />
                                    </div>
                                </div>
                                {parseNumber(jDeposit) > 0 && parseNumber(jLoanAmount) > 0 && (
                                    <div className="text-xs text-blue-600 bg-blue-50 px-3 py-2 rounded-xl">
                                        üí° ÎåÄÏ∂úÍ∏à: {formatKoreanNumber(jLoanAmount)} ({jRatio}%) ‚Üí Ïõî Ïù¥Ïûê: {formatKoreanNumber(result.jMonthlyCost)}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:border-orange-200 transition-colors">
                            <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                                <span className="w-2 h-2 rounded-full bg-orange-500 mr-2 shadow-[0_0_10px_rgba(249,115,22,0.5)]"></span>
                                ÏõîÏÑ∏ Ï°∞Í±¥
                            </h3>
                            <div className="space-y-5">
                                <NumberInput label="Î≥¥Ï¶ùÍ∏à" value={wDeposit} onChange={setWDeposit} color="orange" />
                                <NumberInput label="ÏõîÏÑ∏" value={wMonthly} onChange={setWMonthly} color="orange" />
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">Ï†ÑÌôòÏú® (%)</label>
                                    <div className="relative group">
                                        <input
                                            type="number"
                                            value={wRate}
                                            onChange={(e) => setWRate(e.target.value)}
                                            placeholder="0"
                                            className="w-full pl-5 pr-10 py-4 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-orange-500 focus:bg-white font-bold text-slate-700 transition-all font-mono tracking-tight text-lg"
                                        />
                                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm font-medium pointer-events-none">
                                            %
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-slate-900 text-white p-8 rounded-[2.5rem] shadow-2xl shadow-blue-900/20 relative overflow-hidden animate-result-pop">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-blue-500/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                        <div className="absolute bottom-0 left-0 w-48 h-48 bg-orange-500/20 rounded-full blur-3xl -ml-16 -mb-16 pointer-events-none"></div>

                        <div className="relative z-10">
                            {/* Share Button */}
                            <button
                                onClick={handleShare}
                                className={`absolute top-0 right-0 p-2.5 rounded-xl transition-all no-print ${copied ? 'bg-green-500 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20 hover:text-white'}`}
                                title="Í≤∞Í≥º Í≥µÏú†"
                                aria-label="Í≤∞Í≥º Í≥µÏú†ÌïòÍ∏∞"
                            >
                                {copied ? <CheckCircle size={18} /> : <Share2 size={18} />}
                            </button>

                            <div className="text-center mb-10">
                                <p className="text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-3">Recommendation</p>
                                <div className={`text-4xl md:text-5xl font-black flex justify-center items-center gap-4 mb-4 ${result.winner === 'Ï†ÑÏÑ∏' ? 'text-blue-400' : 'text-orange-400'}`}>
                                    {result.winner === 'Ï†ÑÏÑ∏' ? <Home size={40} strokeWidth={2.5} /> : <CheckCircle size={40} strokeWidth={2.5} />}
                                    <span>{result.winner} Ïú†Î¶¨</span>
                                </div>
                                <p className="text-slate-300 font-medium">
                                    Îß§Ïõî ÏïΩ <span className="text-white font-extrabold text-xl mx-1 bg-white/10 px-2 py-1 rounded-lg animate-number-pop">{formatNumber(parseInt(result.diff))}Ïõê</span> Îçî Ï†ÄÎ†¥Ìï¥Ïöî
                                </p>
                            </div>

                            <div className="flex items-end justify-center h-40 gap-8 md:gap-16 px-4 relative z-10">
                                <div className="flex flex-col items-center w-24 group">
                                    <span className="mb-3 text-sm font-bold text-blue-300 transition-opacity duration-300">{formatNumber(parseInt(result.jMonthlyCost))}</span>
                                    <div
                                        className="w-16 bg-gradient-to-t from-blue-600 to-blue-400 rounded-t-2xl transition-all duration-700 relative shadow-lg shadow-blue-500/30 group-hover:w-20"
                                        style={{ height: `${Math.max(Math.round((result.jMonthlyCost / maxVal) * 120), 16)}px` }}
                                    ></div>
                                    <span className="mt-4 text-sm font-bold text-slate-400 uppercase tracking-wider">Ï†ÑÏÑ∏</span>
                                </div>
                                <div className="flex flex-col items-center w-24 group">
                                    <span className="mb-3 text-sm font-bold text-orange-300 transition-opacity duration-300">{formatNumber(parseInt(result.wTotalCost))}</span>
                                    <div
                                        className="w-16 bg-gradient-to-t from-orange-600 to-orange-400 rounded-t-2xl transition-all duration-700 relative shadow-lg shadow-orange-500/30 group-hover:w-20"
                                        style={{ height: `${Math.max(Math.round((result.wTotalCost / maxVal) * 120), 16)}px` }}
                                    ></div>
                                    <span className="mt-4 text-sm font-bold text-slate-400 uppercase tracking-wider">ÏõîÏÑ∏</span>
                                </div>
                                <div className="absolute bottom-9 w-full border-b border-white/10 -z-10 bg-gradient-to-r from-transparent via-white/20 to-transparent h-[1px]"></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. Safety Tab
        const SafetyTab = () => {
            const [price, setPrice] = useState(() => getSafeLocalStorage('sPrice'));
            const [bond, setBond] = useState(() => getSafeLocalStorage('sBond'));
            const [deposit, setDeposit] = useState(() => getSafeLocalStorage('sDeposit'));

            useEffect(() => {
                debouncedSetStorage('sPrice', price);
                debouncedSetStorage('sBond', bond);
                debouncedSetStorage('sDeposit', deposit);
            }, [price, bond, deposit]);

            const analysis = useMemo(() => {
                const priceVal = parseNumber(price) || 0;
                const bondVal = parseNumber(bond) || 0;
                const depositVal = parseNumber(deposit) || 0;
                if (priceVal <= 0) return null;

                const totalDebt = bondVal + depositVal;
                const ratio = (totalDebt / priceVal) * 100;

                // NaN/Infinity Î∞©Ïñ¥
                if (!isFinite(ratio) || isNaN(ratio)) return null;


                let status = 'ÏïàÏ†Ñ';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';
                let barColor = 'bg-emerald-500';
                let icon = <CheckCircle className="w-8 h-8 text-emerald-500" />;

                if (ratio > 80) {
                    status = 'ÏúÑÌóò (Íπ°ÌÜµÏ†ÑÏÑ∏)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                    barColor = 'bg-red-500';
                    icon = <AlertTriangle className="w-8 h-8 text-red-500" />;
                } else if (ratio > 60) {
                    status = 'Ï£ºÏùò ÌïÑÏöî';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                    barColor = 'bg-orange-500';
                    icon = <Info className="w-8 h-8 text-orange-500" />;
                }

                return { ratio, totalDebt, status, colorClass, barColor, icon };
            }, [price, bond, deposit]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-5">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Shield className="w-5 h-5 mr-3 text-emerald-600" />
                            ÏïàÏ†Ñ ÏßÑÎã® Îç∞Ïù¥ÌÑ∞
                        </h3>
                        <NumberInput label="Îß§Îß§ ÏãúÏÑ∏ (KBÏãúÏÑ∏/Ïã§Í±∞ÎûòÍ∞Ä)" value={price} onChange={setPrice} color="green" />
                        <NumberInput label="ÏÑ†ÏàúÏúÑ Ï±ÑÍ∂å (Í∑ºÏ†ÄÎãπ Îì±)" value={bond} onChange={setBond} color="green" />
                        <NumberInput label="ÎÇòÏùò Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="green" />
                    </div>

                    {analysis ? (
                        <div className={`p-6 rounded-[2rem] border ${analysis.colorClass} transition-all duration-500 shadow-sm relative overflow-hidden`}>
                            <div className="relative z-10">
                                <div className="flex items-center gap-4 mb-6">
                                    <div className="bg-white p-3 rounded-2xl shadow-sm ring-1 ring-black/5">
                                        {analysis.icon}
                                    </div>
                                    <div>
                                        <h4 className="text-2xl font-black">{analysis.status}</h4>
                                        <p className="text-sm font-semibold opacity-70 mt-1">Ï†ÑÏÑ∏Í∞ÄÏú® {analysis.ratio.toFixed(1)}%</p>
                                    </div>
                                </div>

                                <div className="bg-white/60 rounded-2xl p-5 space-y-4 text-sm font-medium backdrop-blur-md border border-white/50">
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-600">ÎÇ¥ Î≥¥Ï¶ùÍ∏à + ÏúµÏûê</span>
                                        <span className="font-bold text-lg">{formatNumber(analysis.totalDebt)}Ïõê</span>
                                    </div>

                                    <div className="w-full bg-slate-200/50 rounded-full h-4 overflow-hidden relative">
                                        {/* ÏïàÏ†Ñ Íµ¨Í∞Ñ ÌëúÏãúÏÑ† */}
                                        <div className="absolute left-[60%] top-0 bottom-0 w-0.5 bg-slate-300 z-10" title="ÏïàÏ†ÑÏÑ† (60%)"></div>
                                        <div className="absolute left-[80%] top-0 bottom-0 w-0.5 bg-slate-300 z-10" title="ÏúÑÌóòÏÑ† (80%)"></div>

                                        <div
                                            className={`h-full rounded-full transition-all duration-1000 ease-out shadow-sm ${analysis.barColor}`}
                                            style={{ width: `${Math.min(analysis.ratio, 100)}%` }}
                                        ></div>
                                    </div>

                                    <div className="flex justify-between text-[11px] font-bold text-slate-400 uppercase tracking-wide">
                                        <span>0%</span>
                                        <span className="text-green-600">60% Safe</span>
                                        <span className="text-red-500">80% Risk</span>
                                        <span>100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-col items-center justify-center py-20 bg-white rounded-3xl border-2 border-dashed border-slate-200 text-slate-400">
                            <Shield className="w-16 h-16 mb-4 text-slate-200 stroke-1" />
                            <p className="text-sm font-bold">Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÏïàÏ†ÑÎèÑÎ•º Î∂ÑÏÑùÌï©ÎãàÎã§</p>
                        </div>
                    )}
                </div>
            );
        };

        // 3. Fee Tab
        const FeeTab = () => {
            const [propType, setPropType] = useState('Ï£ºÌÉù');
            const [dealType, setDealType] = useState('ÏûÑÎåÄÏ∞®');
            const [amount, setAmount] = useState('');

            const result = useMemo(() => {
                const val = parseNumber(amount);
                if (!val) return null;

                let rate = 0;
                let limit = 0;

                if (propType === 'Ï£ºÌÉù') {
                    if (dealType === 'ÏûÑÎåÄÏ∞®') {
                        if (val < 50000000) { rate = 0.5; limit = 200000; }
                        else if (val < 100000000) { rate = 0.4; limit = 300000; }
                        else if (val < 600000000) { rate = 0.3; }
                        else if (val < 1500000000) { rate = 0.4; }
                        else { rate = 0.6; }
                    } else {
                        if (val < 50000000) { rate = 0.6; limit = 250000; }
                        else if (val < 200000000) { rate = 0.5; limit = 800000; }
                        else if (val < 900000000) { rate = 0.4; }
                        else { rate = 0.5; }
                    }
                } else if (propType === 'Ïò§ÌîºÏä§ÌÖî') {
                    rate = dealType === 'ÏûÑÎåÄÏ∞®' ? 0.4 : 0.5;
                } else {
                    rate = 0.9;
                }

                let fee = Math.floor(val * (rate / 100));
                if (limit > 0 && fee > limit) fee = limit;
                const vat = Math.floor(fee * 0.1);

                return { rate, fee, vat, total: fee + vat, limit };
            }, [propType, dealType, amount]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Calculator className="w-5 h-5 mr-3 text-emerald-600" />Í≥ÑÏÇ∞ Ï°∞Í±¥
                        </h3>
                        <div className="space-y-6">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î¨ºÍ±¥ Ï¢ÖÎ•ò</label>
                                <ToggleGroup options={OPTIONS_PROP_TYPE} value={propType} onChange={setPropType} color="green" />
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í±∞Îûò Ï¢ÖÎ•ò</label>
                                <ToggleGroup options={OPTIONS_DEAL_TYPE} value={dealType} onChange={setDealType} color="green" />
                            </div>

                            <NumberInput label="Í±∞Îûò Í∏àÏï° (Î≥¥Ï¶ùÍ∏à/Îß§Îß§Í∞Ä)" value={amount} onChange={setAmount} color="green" />
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-emerald-50 to-teal-50 p-7 rounded-[2.5rem] border border-emerald-100 shadow-lg shadow-emerald-100 relative overflow-hidden">
                            <Calculator className="absolute -bottom-6 -right-6 w-40 h-40 text-emerald-500 opacity-5 rotate-12" />

                            <div className="relative z-10 text-emerald-900">
                                <div className="flex justify-between items-center mb-6">
                                    <h4 className="text-sm font-black uppercase tracking-widest opacity-60">Estimated Fee</h4>
                                    <span className="bg-white/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold text-emerald-600 shadow-sm border border-emerald-100">{result.rate}% Ï†ÅÏö©</span>
                                </div>

                                <div className="space-y-3 mb-8 bg-white/60 backdrop-blur-xl p-5 rounded-2xl border border-white/50">
                                    <div className="flex justify-between text-slate-600 font-medium text-sm">
                                        <span>Ï§ëÍ∞úÏàòÏàòÎ£å</span>
                                        <span>{formatNumber(result.fee)}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-slate-600 font-medium text-sm">
                                        <span>Î∂ÄÍ∞ÄÏÑ∏(10%)</span>
                                        <span>{formatNumber(result.vat)}Ïõê</span>
                                    </div>
                                    {result.limit > 0 && (
                                        <div className="text-xs font-bold text-emerald-600 text-right mt-1">* ÌïúÎèÑÏï° {formatNumber(result.limit)}Ïõê Ï†ÅÏö©</div>
                                    )}
                                </div>

                                <div className="flex justify-between items-end border-t border-emerald-200/50 pt-5">
                                    <span className="font-bold text-emerald-800">Ï¥ù ÏòàÏÉÅ Í∏àÏï°</span>
                                    <span className="text-4xl font-black text-emerald-700 tracking-tight">{formatNumber(result.total)}<span className="text-xl font-medium ml-1 text-emerald-600 align-baseline">Ïõê</span></span>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200">
                            Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // 4. Loan Tab
        const LoanTab = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [rate, setRate] = useState('4.0');
            const [period, setPeriod] = useState('24');
            const [method, setMethod] = useState('ÎßåÍ∏∞ÏùºÏãú');

            const result = useMemo(() => {
                const principal = parseNumber(loanAmount);
                const r = parseFloat(rate) / 100 / 12;
                const n = parseInt(period);

                if (!principal || !n) return null;

                let monthlyPayment = 0;
                let totalInterest = 0;
                let desc = "";

                if (method === 'ÎßåÍ∏∞ÏùºÏãú') {
                    monthlyPayment = principal * r;
                    totalInterest = monthlyPayment * n;
                    desc = "Îß§Îã¨ Ïù¥ÏûêÎßå, ÏõêÍ∏àÏùÄ ÎßåÍ∏∞Ïóê";
                } else if (method === 'ÏõêÎ¶¨Í∏àÍ∑†Îì±') {
                    monthlyPayment = (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                    totalInterest = (monthlyPayment * n) - principal;
                    desc = "ÏõêÍ∏à+Ïù¥ÏûêÎ•º Îß§Îã¨ ÎòëÍ∞ôÏù¥";
                } else if (method === 'ÏõêÍ∏àÍ∑†Îì±') {
                    const firstMonthInterest = principal * r;
                    const principalPayment = principal / n;
                    monthlyPayment = principalPayment + firstMonthInterest;
                    const lastMonthInterest = (principal / n) * r;
                    totalInterest = (n * (firstMonthInterest + lastMonthInterest)) / 2;
                    desc = "Ï≤´ Îã¨Ïù¥ Í∞ÄÏû• ÎπÑÏã∏Í≥† Í∞êÏÜå";
                }

                return { monthlyPayment, totalInterest, totalPayment: principal + totalInterest, desc };
            }, [loanAmount, rate, period, method]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <DollarSign className="w-5 h-5 mr-3 text-violet-600" /> ÎåÄÏ∂ú Ï°∞Í±¥
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="violet" />

                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ïó∞ Ïù¥ÏûêÏú® (%)</label>
                                    <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full px-4 py-4 border-0 bg-slate-50 rounded-2xl text-right outline-none focus:ring-2 focus:ring-violet-500 focus:bg-white font-bold text-slate-700 transition-all" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í∏∞Í∞Ñ (Í∞úÏõî)</label>
                                    <input type="number" value={period} onChange={e => setPeriod(e.target.value)} className="w-full px-4 py-4 border-0 bg-slate-50 rounded-2xl text-right outline-none focus:ring-2 focus:ring-violet-500 focus:bg-white font-bold text-slate-700 transition-all" />
                                </div>
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÏÉÅÌôò Î∞©Ïãù</label>
                                <ToggleGroup options={OPTIONS_LOAN_METHOD} value={method} onChange={setMethod} color="violet" />
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-violet-50 p-6 rounded-[2.5rem] border border-violet-100 shadow-lg shadow-violet-100/50 relative">
                            <div className="absolute top-5 right-5 bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full ring-1 ring-violet-200">
                                <span className="text-violet-700 text-xs font-bold">{result.desc}</span>
                            </div>

                            <div className="mt-8 space-y-4">
                                <div className="flex justify-between items-center bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/5">
                                    <span className="text-slate-500 font-bold text-sm uppercase tracking-wide">
                                        {method === 'ÏõêÍ∏àÍ∑†Îì±' ? 'Ï≤´ Îã¨ ÎÇ©ÏûÖÍ∏à' : 'Ïõî ÏòàÏÉÅ ÎÇ©ÏûÖÍ∏à'}
                                    </span>
                                    <span className="text-2xl font-black text-violet-600">{formatNumber(Math.round(result.monthlyPayment))}Ïõê</span>
                                </div>

                                <div className="px-4 py-2 space-y-3">
                                    <div className="flex justify-between text-sm text-slate-600 font-medium">
                                        <span>Ï¥ù Ïù¥Ïûê ÎπÑÏö©</span>
                                        <span>{formatNumber(Math.round(result.totalInterest))}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-sm text-slate-600 font-medium">
                                        <span>Ï¥ù ÏÉÅÌôò Í∏àÏï°</span>
                                        <span className="font-bold text-slate-800">{formatNumber(Math.round(result.totalPayment))}Ïõê</span>
                                    </div>
                                </div>
                            </div>

                            {/* Pie Chart Visualization */}
                            <div className="mt-6">
                                <LoanPieChart
                                    principal={parseNumber(loanAmount)}
                                    interest={Math.round(result.totalInterest)}
                                    title="ÏõêÍ∏à vs Ï¥ù Ïù¥Ïûê"
                                />
                            </div>

                            {/* Share Buttons */}
                            <div className="mt-4 flex gap-2 justify-center">
                                <KakaoShareButton
                                    title={`ÎåÄÏ∂ú Í≥ÑÏÇ∞ Í≤∞Í≥º - ${method}`}
                                    description={`Ïõî ÎÇ©ÏûÖÍ∏à: ${formatNumber(Math.round(result.monthlyPayment))}Ïõê / Ï¥ù Ïù¥Ïûê: ${formatNumber(Math.round(result.totalInterest))}Ïõê`}
                                />
                                <ShareButton
                                    calcType="ÎåÄÏ∂úÍ≥ÑÏÇ∞"
                                    params={{ loanAmount, rate, period, method }}
                                    showToast={null}
                                />
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            ÎåÄÏ∂ú Ï°∞Í±¥ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };


        // 6. Buying Tab (NEW)
        const BuyingTab = () => {
            const [price, setPrice] = useState('');
            const [region, setRegion] = useState('non-adj'); // adj (jojeong), non-adj
            const [count, setCount] = useState('1'); // 1, 2, 3+
            const [isFirstTimeBuyer, setIsFirstTimeBuyer] = useState(false); // ÏÉùÏï†ÏµúÏ¥à Í∞êÎ©¥

            const result = useMemo(() => {
                const p = parseNumber(price);
                if (!p) return null;

                let taxRate = 0.01; // Default 1% (1 house, non-adj, <600m)

                if (count === '1') {
                    if (p <= 600000000) taxRate = 0.01;
                    else if (p <= 900000000) taxRate = 0.01 + ((p - 600000000) / 300000000) * 0.02; // 1~3%
                    else taxRate = 0.03;
                } else if (count === '2') {
                    taxRate = region === 'adj' ? 0.08 : 0.01; // 8% if adj, else basic (simplified 1-3%)
                    if (region !== 'adj') {
                        if (p <= 600000000) taxRate = 0.01;
                        else if (p <= 900000000) taxRate = 0.01 + ((p - 600000000) / 300000000) * 0.02;
                        else taxRate = 0.03;
                    }
                } else { // 3+
                    taxRate = region === 'adj' ? 0.12 : 0.08;
                }

                const eduTax = taxRate * 0.1; // Local Education Tax (Simplified)
                const specialTax = p > 850000000 ? 0.002 : 0; // Rural Special Tax (Simplified condition)

                let acquisitionTax = Math.floor(p * taxRate);
                let totalTax = Math.floor(p * (taxRate + eduTax + specialTax));

                // ÏÉùÏï†ÏµúÏ¥à Í∞êÎ©¥ Ï†ÅÏö© (12Ïñµ Ïù¥Ìïò, ÏµúÎåÄ 200ÎßåÏõê Í∞êÎ©¥)
                let firstTimeBuyerDiscount = 0;
                if (isFirstTimeBuyer && count === '1' && p <= 1200000000) {
                    firstTimeBuyerDiscount = Math.min(acquisitionTax, 2000000);
                    acquisitionTax = acquisitionTax - firstTimeBuyerDiscount;
                    totalTax = totalTax - firstTimeBuyerDiscount;
                }

                // Bond Discount (Simplified 10% burden of 2.6% bond rate roughly)
                const bondRate = 0.026; // Approx
                const discountRate = 0.12; // 12% discount cost
                const bondCost = Math.floor(p * bondRate * discountRate);

                return { acquisitionTax, totalTax, bondCost, taxRate: (taxRate * 100).toFixed(2), firstTimeBuyerDiscount };
            }, [price, region, count, isFirstTimeBuyer]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Home className="w-5 h-5 mr-3 text-blue-600" /> Îß§Ïàò ÏÑ∏Í∏à Í≥ÑÏÇ∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Îß§Îß§ Í∞ÄÍ≤©" value={price} onChange={setPrice} color="blue" />

                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÏßÄÏó≠ Íµ¨Î∂Ñ</label>
                                    <ToggleGroup options={OPTIONS_REGION} value={region === 'non-adj' ? 'ÎπÑÍ∑úÏ†ú' : 'Í∑úÏ†ú(Ï°∞Ï†ï)'} onChange={(v) => setRegion(v === 'ÎπÑÍ∑úÏ†ú' ? 'non-adj' : 'adj')} color="blue" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ï£ºÌÉù Ïàò</label>
                                    <ToggleGroup options={OPTIONS_COUNT} value={count === '1' ? '1Ï±Ñ' : count === '2' ? '2Ï±Ñ' : '3Ï±Ñ+'} onChange={(v) => setCount(v === '1Ï±Ñ' ? '1' : v === '2Ï±Ñ' ? '2' : '3')} color="blue" />
                                </div>
                            </div>

                            <label className="flex items-center gap-3 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl cursor-pointer border border-green-100 hover:shadow-md transition-all">
                                <input type="checkbox" checked={isFirstTimeBuyer} onChange={(e) => setIsFirstTimeBuyer(e.target.checked)} className="w-5 h-5 rounded accent-green-500" />
                                <div>
                                    <span className="text-sm font-bold text-green-800">üè† ÏÉùÏï†ÏµúÏ¥à Ï£ºÌÉù Íµ¨ÏûÖ</span>
                                    <p className="text-xs text-green-600">12Ïñµ Ïù¥Ìïò Ï£ºÌÉù, ÏµúÎåÄ 200ÎßåÏõê Ï∑®ÎìùÏÑ∏ Í∞êÎ©¥</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-blue-50 p-6 rounded-[2.5rem] border border-blue-100 shadow-lg relative">
                            <div className="text-center mb-8">
                                <p className="text-sm font-bold text-blue-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ Ï¥ù ÌïÑÏöî ÏûêÍ∏à (ÏÑ∏Í∏à+Ï±ÑÍ∂å)</p>
                                <p className="text-4xl font-black text-blue-900">{formatNumber(result.totalTax + result.bondCost)}Ïõê</p>
                            </div>

                            <div className="bg-white rounded-2xl p-5 space-y-3 shadow-sm ring-1 ring-black/5">
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>Ï∑®ÎìùÏÑ∏ ({result.taxRate}%)</span>
                                    <span>{formatNumber(result.acquisitionTax)}Ïõê</span>
                                </div>
                                {result.firstTimeBuyerDiscount > 0 && (
                                    <div className="flex justify-between text-sm font-bold text-green-600">
                                        <span>üéâ ÏÉùÏï†ÏµúÏ¥à Í∞êÎ©¥</span>
                                        <span>-{formatNumber(result.firstTimeBuyerDiscount)}Ïõê</span>
                                    </div>
                                )}
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>ÏßÄÎ∞©ÍµêÏú°ÏÑ∏ Îì±</span>
                                    <span>{formatNumber(result.totalTax - result.acquisitionTax)}Ïõê</span>
                                </div>
                                <div className="h-px bg-slate-100 my-2"></div>
                                <div className="flex justify-between text-sm font-bold text-slate-800">
                                    <span>Íµ≠ÎØºÏ£ºÌÉùÏ±ÑÍ∂å (Ìï†Ïù∏Îß§ÎèÑ Í∞ÄÏ†ï)</span>
                                    <span>ÏïΩ {formatNumber(result.bondCost)}Ïõê</span>
                                </div>
                            </div>
                            <p className="text-xs text-center text-blue-300 mt-4">* Ïã§Ï†ú ÏÑ∏Í∏àÏùÄ Î©¥Ï†Å, Í∞êÎ©¥ÏöîÍ±¥(ÏÉùÏï†ÏµúÏ¥à Îì±)Ïóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏäµÎãàÎã§.</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Îß§Îß§Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // 7. DSR Calculator Tab (NEW)
        const DSRTab = () => {
            const [income, setIncome] = useState('');
            const [debt, setDebt] = useState(''); // Annual Principle + Interest
            const [newDebt, setNewDebt] = useState(''); // New Loan Annual P+I

            const result = useMemo(() => {
                const inc = parseNumber(income);
                const d = parseNumber(debt);
                const nd = parseNumber(newDebt);

                if (!inc) return null;

                const totalDebtPayment = d + nd;
                const dsr = (totalDebtPayment / inc) * 100;

                let status = 'Ïó¨Ïú†';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';

                if (dsr > 50) {
                    status = 'Ï¥àÍ≥º (Î∂àÍ∞Ä)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                } else if (dsr > 40) {
                    status = 'Ï£ºÏùò (ÌïúÎèÑÏ†ëÍ∑º)';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                }

                return { dsr, status, colorClass };
            }, [income, debt, newDebt]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <DollarSign className="w-5 h-5 mr-3 text-indigo-600" /> DSR Í≥ÑÏÇ∞ (Ï¥ùÎ∂ÄÏ±ÑÏõêÎ¶¨Í∏àÏÉÅÌôòÎπÑÏú®)
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ïó∞ ÏÜåÎìù" value={income} onChange={setIncome} color="violet" />
                            <NumberInput label="Í∏∞Ï°¥ ÎåÄÏ∂ú Ïó∞ ÏõêÎ¶¨Í∏à ÏÉÅÌôòÏï°" value={debt} onChange={setDebt} color="violet" />
                            <NumberInput label="Ïã†Í∑ú ÎåÄÏ∂ú Ïó∞ ÏõêÎ¶¨Í∏à (ÏòàÏÉÅ)" value={newDebt} onChange={setNewDebt} color="violet" />
                        </div>
                    </div>

                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] border ${result.colorClass} shadow-lg relative overflow-hidden`}>
                            <div className="text-center">
                                <div className="text-sm font-bold opacity-60 uppercase tracking-widest mb-2">My DSR</div>
                                <div className="text-5xl font-black mb-2">{result.dsr.toFixed(2)}%</div>
                                <div className="inline-block px-3 py-1 rounded-full bg-white/50 backdrop-blur-sm font-bold text-sm border border-white/20">
                                    {result.status}
                                </div>
                            </div>
                            <div className="w-full bg-white/40 rounded-full h-4 mt-6 backdrop-blur-sm border border-white/30 p-0.5">
                                <div
                                    className={`h-full rounded-full transition-all duration-1000 shadow-sm ${result.dsr > 40 ? 'bg-red-500' : 'bg-emerald-500'}`}
                                    style={{ width: `${Math.min(result.dsr, 100)}%` }}
                                ></div>
                            </div>
                            <p className="text-xs text-center opacity-60 mt-4">* 1Í∏àÏúµÍ∂å 40%, 2Í∏àÏúµÍ∂å 50% Í∑úÏ†ú Ï†ÅÏö© (2026)</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            ÏÜåÎìùÍ≥º Î∂ÄÏ±Ñ Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };


        // 8. LTV Tab (Restored)
        const LTVTab = () => {
            const [value, setValue] = useState('');
            const [loan, setLoan] = useState('');

            const result = useMemo(() => {
                const v = parseNumber(value);
                const l = parseNumber(loan);
                if (!v) return null;

                const ltv = (l / v) * 100;

                let status = 'ÏïàÏ†Ñ';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';

                if (ltv > 70) {
                    status = 'ÏúÑÌóò (Í≥†ÏúÑÌóòÍµ∞)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                } else if (ltv > 50) {
                    status = 'Ï£ºÏùò (ÎπÑÏú® ÎÜíÏùå)';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                }

                return { ltv, status, colorClass };
            }, [value, loan]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <PieChart className="w-5 h-5 mr-3 text-purple-600 dark:text-purple-400" /> Ï£ºÌÉùÎã¥Î≥¥ÎåÄÏ∂ú ÎπÑÏú® (LTV)
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï£ºÌÉù ÏûêÏÇ∞ Í∞ÄÏπò (Îß§Îß§Í∞Ä)" value={value} onChange={setValue} color="violet" />
                            <NumberInput label="ÎåÄÏ∂ú Ìù¨Îßù Í∏àÏï°" value={loan} onChange={setLoan} color="violet" />
                        </div>
                    </div>

                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] border ${result.colorClass} shadow-lg relative overflow-hidden transition-all duration-500`}>
                            <div className="relative z-10">
                                <div className="text-center mb-6">
                                    <div className="text-sm font-bold opacity-60 uppercase tracking-widest mb-2">Calculated LTV</div>
                                    <div className="text-5xl font-black mb-2">{result.ltv.toFixed(1)}<span className="text-3xl font-bold ml-1">%</span></div>
                                    <div className="inline-block px-3 py-1 rounded-full bg-white/50 backdrop-blur-sm font-bold text-sm border border-white/20">
                                        {result.status}
                                    </div>
                                </div>

                                <div className="w-full bg-white/40 rounded-full h-6 p-1 backdrop-blur-sm border border-white/30">
                                    <div
                                        className={`h-full rounded-full transition-all duration-1000 shadow-sm ${result.ltv > 70 ? 'bg-red-500' : result.ltv > 50 ? 'bg-orange-500' : 'bg-emerald-500'}`}
                                        style={{ width: `${Math.min(result.ltv, 100)}%` }}
                                    ></div>
                                </div>
                                <div className="flex justify-between text-[10px] font-bold opacity-50 mt-2 px-1">
                                    <span>0%</span>
                                    <span>40%</span>
                                    <span>60%</span>
                                    <span>80%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ LTVÎ•º Í≥ÑÏÇ∞Ìï©ÎãàÎã§
                        </div>
                    )}
                </div>
            );
        }

        // 9. Capital Gains Tax Calculator (ÏñëÎèÑÏÜåÎìùÏÑ∏ Í≥ÑÏÇ∞Í∏∞)
        const CapitalGainsTaxTab = () => {
            const [acquisitionPrice, setAcquisitionPrice] = useState('');
            const [salePrice, setSalePrice] = useState('');
            const [expenses, setExpenses] = useState('');
            const [holdingYears, setHoldingYears] = useState('3');
            const [isOneHouse, setIsOneHouse] = useState(false);
            const [isRegulated, setIsRegulated] = useState(false);

            const result = useMemo(() => {
                const acq = parseNumber(acquisitionPrice);
                const sale = parseNumber(salePrice);
                const exp = parseNumber(expenses);
                const years = parseInt(holdingYears) || 0;

                if (!acq || !sale) return null;

                // ÏñëÎèÑÏ∞®Ïùµ
                const gain = sale - acq - exp;
                if (gain <= 0) return { gain: 0, tax: 0, localTax: 0, total: 0, deduction: 0, taxableGain: 0, rate: 0 };

                // Ïû•Í∏∞Î≥¥Ïú†ÌäπÎ≥ÑÍ≥µÏ†ú (1ÏÑ∏ÎåÄ1Ï£ºÌÉù: Ïó∞ 8%, ÏµúÎåÄ 80% / ÏùºÎ∞ò: Ïó∞ 2%, ÏµúÎåÄ 30%)
                let deductionRate = 0;
                if (isOneHouse && years >= 2) {
                    deductionRate = Math.min(years * 0.08, 0.8); // Ïó∞ 8%, ÏµúÎåÄ 80%
                } else if (years >= 3) {
                    deductionRate = Math.min((years - 2) * 0.02, 0.3); // 3ÎÖÑÎ∂ÄÌÑ∞ Ïó∞ 2%, ÏµúÎåÄ 30%
                }

                const deduction = Math.floor(gain * deductionRate);
                const basicDeduction = 2500000; // Í∏∞Î≥∏Í≥µÏ†ú 250ÎßåÏõê
                const taxableGain = Math.max(gain - deduction - basicDeduction, 0);

                // ÏñëÎèÑÏÜåÎìùÏÑ∏Ïú® (2026ÎÖÑ Í∏∞Ï§Ä ÎàÑÏßÑÏÑ∏Ïú®)
                let tax = 0;
                let rate = 0;
                if (taxableGain <= 14000000) {
                    tax = taxableGain * 0.06;
                    rate = 6;
                } else if (taxableGain <= 50000000) {
                    tax = 840000 + (taxableGain - 14000000) * 0.15;
                    rate = 15;
                } else if (taxableGain <= 88000000) {
                    tax = 6240000 + (taxableGain - 50000000) * 0.24;
                    rate = 24;
                } else if (taxableGain <= 150000000) {
                    tax = 15360000 + (taxableGain - 88000000) * 0.35;
                    rate = 35;
                } else if (taxableGain <= 300000000) {
                    tax = 37060000 + (taxableGain - 150000000) * 0.38;
                    rate = 38;
                } else if (taxableGain <= 500000000) {
                    tax = 94060000 + (taxableGain - 300000000) * 0.40;
                    rate = 40;
                } else if (taxableGain <= 1000000000) {
                    tax = 174060000 + (taxableGain - 500000000) * 0.42;
                    rate = 42;
                } else {
                    tax = 384060000 + (taxableGain - 1000000000) * 0.45;
                    rate = 45;
                }

                // Îã®Í∏∞Î≥¥Ïú† Ï§ëÍ≥º (1ÎÖÑ ÎØ∏Îßå: 70%, 2ÎÖÑ ÎØ∏Îßå: 60%)
                if (isRegulated && years < 1) {
                    tax = taxableGain * 0.70;
                    rate = 70;
                } else if (isRegulated && years < 2) {
                    tax = taxableGain * 0.60;
                    rate = 60;
                }

                tax = Math.floor(tax);
                const localTax = Math.floor(tax * 0.1); // ÏßÄÎ∞©ÏÜåÎìùÏÑ∏ 10%
                const total = tax + localTax;

                return { gain, deduction, taxableGain, tax, localTax, total, rate };
            }, [acquisitionPrice, salePrice, expenses, holdingYears, isOneHouse, isRegulated]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <TrendingUp className="w-5 h-5 mr-3 text-rose-600" /> ÏñëÎèÑÏÜåÎìùÏÑ∏ Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï∑®ÎìùÍ∞ÄÏï° (Îß§ÏûÖÍ∞Ä)" value={acquisitionPrice} onChange={setAcquisitionPrice} color="blue" />
                            <NumberInput label="ÏñëÎèÑÍ∞ÄÏï° (Îß§ÎèÑÍ∞Ä)" value={salePrice} onChange={setSalePrice} color="blue" />
                            <NumberInput label="ÌïÑÏöîÍ≤ΩÎπÑ (Ï∑®ÎìùÏÑ∏, Ï§ëÍ∞úÎ≥¥Ïàò Îì±)" value={expenses} onChange={setExpenses} color="blue" />

                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î≥¥Ïú† Í∏∞Í∞Ñ (ÎÖÑ)</label>
                                <div className="flex gap-2">
                                    {['1', '2', '3', '5', '10'].map(y => (
                                        <button
                                            key={y}
                                            onClick={() => setHoldingYears(y)}
                                            className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${holdingYears === y ? 'bg-rose-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                        >
                                            {y}ÎÖÑ
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="flex gap-4">
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" checked={isOneHouse} onChange={(e) => setIsOneHouse(e.target.checked)} className="w-4 h-4 rounded" />
                                    <span className="text-sm font-medium text-slate-700">1ÏÑ∏ÎåÄ 1Ï£ºÌÉù</span>
                                </label>
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" checked={isRegulated} onChange={(e) => setIsRegulated(e.target.checked)} className="w-4 h-4 rounded" />
                                    <span className="text-sm font-medium text-slate-700">Ï°∞Ï†ïÎåÄÏÉÅÏßÄÏó≠</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-rose-50 to-pink-50 p-6 rounded-[2.5rem] border border-rose-100 shadow-lg relative">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-rose-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ ÎÇ©Î∂Ä ÏÑ∏Ïï°</p>
                                <p className="text-4xl font-black text-rose-900">{formatNumber(result.total)}Ïõê</p>
                                {result.total > 0 && <p className="text-xs text-rose-500 mt-1">Ï†ÅÏö©ÏÑ∏Ïú® {result.rate}%</p>}
                            </div>

                            <div className="bg-white rounded-2xl p-5 space-y-3 shadow-sm ring-1 ring-black/5">
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>ÏñëÎèÑÏ∞®Ïùµ</span>
                                    <span>{formatNumber(result.gain)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>Ïû•Í∏∞Î≥¥Ïú†ÌäπÎ≥ÑÍ≥µÏ†ú</span>
                                    <span className="text-green-600">-{formatNumber(result.deduction)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>Í≥ºÏÑ∏ÌëúÏ§Ä</span>
                                    <span>{formatNumber(result.taxableGain)}Ïõê</span>
                                </div>
                                <div className="h-px bg-slate-100 my-2"></div>
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>ÏñëÎèÑÏÜåÎìùÏÑ∏</span>
                                    <span>{formatNumber(result.tax)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-sm font-bold text-slate-800">
                                    <span>ÏßÄÎ∞©ÏÜåÎìùÏÑ∏ (10%)</span>
                                    <span>{formatNumber(result.localTax)}Ïõê</span>
                                </div>
                            </div>
                            <p className="text-xs text-center text-rose-300 mt-4">* Ïã§Ï†ú ÏÑ∏Ïï°ÏùÄ Îã§ÏñëÌïú ÏöîÏù∏Ïóê Îî∞Îùº Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§. Ï∞∏Í≥†Ïö©ÏúºÎ°úÎßå ÌôúÏö©ÌïòÏÑ∏Ïöî.</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Ï∑®ÎìùÍ∞ÄÏôÄ ÏñëÎèÑÍ∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // 11. Property Tax Calculator (Ïû¨ÏÇ∞ÏÑ∏/Ï¢ÖÎ∂ÄÏÑ∏ Í≥ÑÏÇ∞Í∏∞)
        const PropertyTaxTab = () => {
            const [publicPrice, setPublicPrice] = useState('');
            const [isOneHouse, setIsOneHouse] = useState(true);
            const [houseCount, setHouseCount] = useState('1');

            const result = useMemo(() => {
                const price = parseNumber(publicPrice);
                if (!price) return null;

                // Ïû¨ÏÇ∞ÏÑ∏ Í≥ºÏÑ∏ÌëúÏ§Ä (Í≥µÏãúÍ∞ÄÍ≤©Ïùò 60%)
                const taxBase = price * 0.6;

                // Ïû¨ÏÇ∞ÏÑ∏Ïú® (2026ÎÖÑ Í∏∞Ï§Ä)
                let propertyTax = 0;
                if (taxBase <= 60000000) {
                    propertyTax = taxBase * 0.001; // 0.1%
                } else if (taxBase <= 150000000) {
                    propertyTax = 60000 + (taxBase - 60000000) * 0.0015; // 0.15%
                } else if (taxBase <= 300000000) {
                    propertyTax = 195000 + (taxBase - 150000000) * 0.0025; // 0.25%
                } else {
                    propertyTax = 570000 + (taxBase - 300000000) * 0.004; // 0.4%
                }

                // ÎèÑÏãúÏßÄÏó≠Î∂Ñ (0.14%)
                const cityTax = taxBase * 0.0014;

                // ÏßÄÎ∞©ÍµêÏú°ÏÑ∏ (Ïû¨ÏÇ∞ÏÑ∏Ïùò 20%)
                const eduTax = propertyTax * 0.2;

                // Ïû¨ÏÇ∞ÏÑ∏ Ìï©Í≥Ñ
                const totalPropertyTax = Math.floor(propertyTax + cityTax + eduTax);

                // Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏ (Í≥µÏãúÍ∞ÄÍ≤© 9Ïñµ Ï¥àÍ≥º Ïãú, 1ÏÑ∏ÎåÄ1Ï£ºÌÉùÏùÄ 12Ïñµ)
                const jongbuThreshold = isOneHouse ? 1200000000 : 900000000;
                let jongbuTax = 0;
                let jongbuEduTax = 0;

                if (price > jongbuThreshold) {
                    const jongbuBase = (price - jongbuThreshold) * 0.6; // Ï¢ÖÎ∂ÄÏÑ∏ Í≥ºÏÑ∏ÌëúÏ§Ä

                    // Ï¢ÖÎ∂ÄÏÑ∏Ïú® (ÏùºÎ∞ò)
                    if (jongbuBase <= 300000000) {
                        jongbuTax = jongbuBase * 0.005; // 0.5%
                    } else if (jongbuBase <= 600000000) {
                        jongbuTax = 1500000 + (jongbuBase - 300000000) * 0.007; // 0.7%
                    } else if (jongbuBase <= 1200000000) {
                        jongbuTax = 3600000 + (jongbuBase - 600000000) * 0.01; // 1%
                    } else if (jongbuBase <= 5000000000) {
                        jongbuTax = 9600000 + (jongbuBase - 1200000000) * 0.014; // 1.4%
                    } else {
                        jongbuTax = 62800000 + (jongbuBase - 5000000000) * 0.027; // 2.7%
                    }

                    jongbuEduTax = jongbuTax * 0.2; // ÎÜçÏñ¥Ï¥åÌäπÎ≥ÑÏÑ∏
                }

                const totalJongbuTax = Math.floor(jongbuTax + jongbuEduTax);
                const totalTax = totalPropertyTax + totalJongbuTax;

                return { propertyTax: Math.floor(propertyTax), cityTax: Math.floor(cityTax), eduTax: Math.floor(eduTax), totalPropertyTax, jongbuTax: Math.floor(jongbuTax), jongbuEduTax: Math.floor(jongbuEduTax), totalJongbuTax, totalTax };
            }, [publicPrice, isOneHouse, houseCount]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Calculator className="w-5 h-5 mr-3 text-teal-600" /> Ïû¨ÏÇ∞ÏÑ∏ / Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï£ºÌÉù Í≥µÏãúÍ∞ÄÍ≤©" value={publicPrice} onChange={setPublicPrice} color="cyan" />

                            <label className="flex items-center gap-2 cursor-pointer p-3 bg-slate-50 rounded-xl">
                                <input type="checkbox" checked={isOneHouse} onChange={(e) => setIsOneHouse(e.target.checked)} className="w-4 h-4 rounded" />
                                <span className="text-sm font-medium text-slate-700">1ÏÑ∏ÎåÄ 1Ï£ºÌÉù (Ï¢ÖÎ∂ÄÏÑ∏ 12Ïñµ Í≥µÏ†ú)</span>
                            </label>
                        </div>
                    </div>

                    {result ? (
                        <div className="space-y-4">
                            <div className="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-[2rem] border border-teal-100 shadow-lg">
                                <h4 className="text-sm font-bold text-teal-600 mb-4">Ïû¨ÏÇ∞ÏÑ∏ (7Ïõî, 9Ïõî ÎÇ©Î∂Ä)</h4>
                                <div className="bg-white rounded-xl p-4 space-y-2 text-sm">
                                    <div className="flex justify-between text-slate-600">
                                        <span>Ïû¨ÏÇ∞ÏÑ∏</span>
                                        <span>{formatNumber(result.propertyTax)}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-slate-600">
                                        <span>ÎèÑÏãúÏßÄÏó≠Î∂Ñ</span>
                                        <span>{formatNumber(result.cityTax)}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-slate-600">
                                        <span>ÏßÄÎ∞©ÍµêÏú°ÏÑ∏</span>
                                        <span>{formatNumber(result.eduTax)}Ïõê</span>
                                    </div>
                                    <div className="h-px bg-teal-100 my-2"></div>
                                    <div className="flex justify-between font-bold text-teal-800">
                                        <span>ÏÜåÍ≥Ñ</span>
                                        <span>{formatNumber(result.totalPropertyTax)}Ïõê</span>
                                    </div>
                                </div>
                            </div>

                            {result.totalJongbuTax > 0 && (
                                <div className="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-[2rem] border border-red-100 shadow-lg">
                                    <h4 className="text-sm font-bold text-red-600 mb-4">Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏ (12Ïõî ÎÇ©Î∂Ä)</h4>
                                    <div className="bg-white rounded-xl p-4 space-y-2 text-sm">
                                        <div className="flex justify-between text-slate-600">
                                            <span>Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏</span>
                                            <span>{formatNumber(result.jongbuTax)}Ïõê</span>
                                        </div>
                                        <div className="flex justify-between text-slate-600">
                                            <span>ÎÜçÏñ¥Ï¥åÌäπÎ≥ÑÏÑ∏</span>
                                            <span>{formatNumber(result.jongbuEduTax)}Ïõê</span>
                                        </div>
                                        <div className="h-px bg-red-100 my-2"></div>
                                        <div className="flex justify-between font-bold text-red-800">
                                            <span>ÏÜåÍ≥Ñ</span>
                                            <span>{formatNumber(result.totalJongbuTax)}Ïõê</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="bg-slate-900 p-6 rounded-[2rem] text-center">
                                <p className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Ïó∞Í∞Ñ Ï¥ù Î≥¥Ïú†ÏÑ∏</p>
                                <p className="text-4xl font-black text-white">{formatNumber(result.totalTax)}Ïõê</p>
                                <p className="text-sm text-slate-400 mt-2">Ïõî ÏïΩ {formatNumber(Math.round(result.totalTax / 12))}Ïõê</p>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Ï£ºÌÉù Í≥µÏãúÍ∞ÄÍ≤©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // NEW: Î∞òÏ†ÑÏÑ∏ Í≥ÑÏÇ∞Í∏∞
        const SemiJeonseTab = () => {
            const [fullDeposit, setFullDeposit] = useState('');
            const [targetDeposit, setTargetDeposit] = useState('');
            const [targetMonthly, setTargetMonthly] = useState('');
            const [conversionRate, setConversionRate] = useState((BOK_RATE_DEFAULT + 3.5).toFixed(1));

            const result = useMemo(() => {
                const full = parseNumber(fullDeposit);
                const targetDep = parseNumber(targetDeposit);
                const targetMon = parseNumber(targetMonthly);
                const rate = parseFloat(conversionRate) || 0;

                if (!full) return null;

                // Î≥¥Ï¶ùÍ∏à Í∞êÏï°Î∂Ñ ‚Üí ÏõîÏÑ∏ Í≥ÑÏÇ∞
                if (targetDep > 0 && targetDep < full) {
                    const depositDiff = full - targetDep;
                    const calculatedMonthly = Math.floor((depositDiff * (rate / 100)) / 12);
                    return { mode: 'toMonthly', deposit: targetDep, monthly: calculatedMonthly, diff: depositDiff };
                }
                // ÏõîÏÑ∏ ‚Üí ÌïÑÏöî Î≥¥Ï¶ùÍ∏à Í≥ÑÏÇ∞
                if (targetMon > 0) {
                    const requiredDeposit = Math.floor((targetMon * 12) / (rate / 100));
                    const newDeposit = full - requiredDeposit;
                    return { mode: 'toDeposit', deposit: Math.max(newDeposit, 0), monthly: targetMon, diff: requiredDeposit };
                }
                return null;
            }, [fullDeposit, targetDeposit, targetMonthly, conversionRate]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <ArrowRightLeft className="w-5 h-5 mr-3 text-violet-600" /> Î∞òÏ†ÑÏÑ∏ Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÌòÑÏû¨ Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={fullDeposit} onChange={setFullDeposit} color="violet" />
                            <div className="p-4 bg-slate-50 rounded-2xl space-y-4">
                                <p className="text-xs font-bold text-slate-500">Ï†ÑÌôò ÏòµÏÖò (ÌïòÎÇòÎßå ÏûÖÎ†•)</p>
                                <NumberInput label="Ìù¨Îßù Î≥¥Ï¶ùÍ∏à (Í∞êÏï°)" value={targetDeposit} onChange={(v) => { setTargetDeposit(v); setTargetMonthly(''); }} color="violet" />
                                <div className="text-center text-xs text-slate-400 font-bold">ÎòêÎäî</div>
                                <NumberInput label="Ìù¨Îßù ÏõîÏÑ∏" value={targetMonthly} onChange={(v) => { setTargetMonthly(v); setTargetDeposit(''); }} color="violet" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ï†ÑÌôòÏú® (%)</label>
                                <input type="number" value={conversionRate} onChange={(e) => setConversionRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-violet-500" />
                                <p className="text-xs text-slate-400 mt-1 ml-1">* Î≤ïÏ†ï ÏÉÅÌïú: Í∏∞Ï§ÄÍ∏àÎ¶¨({BOK_RATE_DEFAULT}%) + 3.5% = {(BOK_RATE_DEFAULT + 3.5).toFixed(1)}%</p>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-violet-50 to-purple-50 p-6 rounded-[2.5rem] border border-violet-100 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-violet-400 uppercase tracking-widest mb-2">Î∞òÏ†ÑÏÑ∏ Ï°∞Í±¥</p>
                                <p className="text-3xl font-black text-violet-900">Î≥¥Ï¶ùÍ∏à {formatCompactNumber(result.deposit)} + ÏõîÏÑ∏ {formatNumber(result.monthly)}Ïõê</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ï†ÑÌôò Î≥¥Ï¶ùÍ∏à</span><span className="font-bold">{formatCompactNumber(result.diff)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ïó∞Í∞Ñ ÏõîÏÑ∏ Ìï©Í≥Ñ</span><span className="font-bold">{formatNumber(result.monthly * 12)}Ïõê</span></div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏àÍ≥º Ìù¨Îßù Ï°∞Í±¥ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï¶ùÏó¨ÏÑ∏ Í≥ÑÏÇ∞Í∏∞
        const GiftTaxTab = () => {
            const [giftAmount, setGiftAmount] = useState('');
            const [relationship, setRelationship] = useState('child');
            const [isGenerationSkip, setIsGenerationSkip] = useState(false);

            const result = useMemo(() => {
                const amount = parseNumber(giftAmount);
                if (!amount) return null;

                // Ï¶ùÏó¨Ïû¨ÏÇ∞ Í≥µÏ†ú
                const exemptions = { spouse: 600000000, child: 50000000, grandchild: 50000000, other: 10000000 };
                const exemption = exemptions[relationship] || 0;
                const taxableAmount = Math.max(amount - exemption, 0);

                // Ï¶ùÏó¨ÏÑ∏Ïú® (2026 Í∏∞Ï§Ä)
                let tax = 0;
                if (taxableAmount <= 100000000) tax = taxableAmount * 0.1;
                else if (taxableAmount <= 500000000) tax = 10000000 + (taxableAmount - 100000000) * 0.2;
                else if (taxableAmount <= 1000000000) tax = 90000000 + (taxableAmount - 500000000) * 0.3;
                else if (taxableAmount <= 3000000000) tax = 240000000 + (taxableAmount - 1000000000) * 0.4;
                else tax = 1040000000 + (taxableAmount - 3000000000) * 0.5;

                // ÏÑ∏ÎåÄÏÉùÎûµ Í∞ÄÏÇ∞ (Ï°∞Î∂ÄÎ™®‚ÜíÏÜêÏûêÎÖÄ ÏßÅÏ†ë Ï¶ùÏó¨)
                if (isGenerationSkip && (relationship === 'grandchild')) tax = Math.floor(tax * 1.3);

                // Ïã†Í≥†ÏÑ∏Ïï°Í≥µÏ†ú 3%
                const discount = Math.floor(tax * 0.03);
                const finalTax = Math.floor(tax - discount);

                return { exemption, taxableAmount, tax: Math.floor(tax), discount, finalTax };
            }, [giftAmount, relationship, isGenerationSkip]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Banknote className="w-5 h-5 mr-3 text-pink-600" /> Ï¶ùÏó¨ÏÑ∏ Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï¶ùÏó¨ Ïû¨ÏÇ∞Í∞ÄÏï°" value={giftAmount} onChange={setGiftAmount} color="orange" />
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ï¶ùÏó¨ÏûêÏôÄÏùò Í¥ÄÍ≥Ñ</label>
                                <div className="grid grid-cols-2 gap-2">
                                    {[{ id: 'spouse', label: 'Î∞∞Ïö∞Ïûê (6Ïñµ)' }, { id: 'child', label: 'ÏûêÎÖÄ (5Ï≤úÎßå)' }, { id: 'grandchild', label: 'ÏÜêÏûêÎÖÄ (5Ï≤úÎßå)' }, { id: 'other', label: 'Í∏∞ÌÉÄ (1Ï≤úÎßå)' }].map(r => (
                                        <button key={r.id} onClick={() => setRelationship(r.id)} className={`py-3 rounded-xl text-xs font-bold transition-all ${relationship === r.id ? 'bg-pink-500 text-white' : 'bg-slate-100 text-slate-500'}`}>{r.label}</button>
                                    ))}
                                </div>
                            </div>
                            {relationship === 'grandchild' && (
                                <label className="flex items-center gap-2 p-3 bg-yellow-50 rounded-xl cursor-pointer">
                                    <input type="checkbox" checked={isGenerationSkip} onChange={(e) => setIsGenerationSkip(e.target.checked)} className="w-4 h-4 rounded" />
                                    <span className="text-sm font-medium text-yellow-800">ÏÑ∏ÎåÄÏÉùÎûµ Ï¶ùÏó¨ (30% Í∞ÄÏÇ∞)</span>
                                </label>
                            )}
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-pink-50 to-rose-50 p-6 rounded-[2.5rem] border border-pink-100 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-pink-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ Ï¶ùÏó¨ÏÑ∏</p>
                                <p className="text-4xl font-black text-pink-900">{formatNumber(result.finalTax)}Ïõê</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ï¶ùÏó¨Ïû¨ÏÇ∞ Í≥µÏ†ú</span><span className="font-bold text-green-600">-{formatCompactNumber(result.exemption)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Í≥ºÏÑ∏ÌëúÏ§Ä</span><span className="font-bold">{formatCompactNumber(result.taxableAmount)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">ÏÇ∞Ï∂úÏÑ∏Ïï°</span><span className="font-bold">{formatNumber(result.tax)}Ïõê</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ïã†Í≥†ÏÑ∏Ïï°Í≥µÏ†ú (3%)</span><span className="font-bold text-green-600">-{formatNumber(result.discount)}Ïõê</span></div>
                            </div>
                            <p className="text-xs text-center text-pink-300 mt-4">* 10ÎÖÑ ÎÇ¥ ÎèôÏùºÏù∏ Ï¶ùÏó¨ Ìï©ÏÇ∞ Í≥ºÏÑ∏</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Ï¶ùÏó¨ Ïû¨ÏÇ∞Í∞ÄÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: ÏÉÅÏÜçÏÑ∏ Í≥ÑÏÇ∞Í∏∞
        const InheritanceTaxTab = () => {
            const [totalAssets, setTotalAssets] = useState('');
            const [hasSpouse, setHasSpouse] = useState(true);
            const [childCount, setChildCount] = useState('2');
            const [debts, setDebts] = useState('');

            const result = useMemo(() => {
                const assets = parseNumber(totalAssets);
                const debt = parseNumber(debts);
                if (!assets) return null;

                const netAssets = assets - debt;
                if (netAssets <= 0) return { tax: 0, finalTax: 0, deductions: 0, taxableAmount: 0 };

                // Í∏∞Ï¥àÍ≥µÏ†ú 2Ïñµ
                let deductions = 200000000;
                // Î∞∞Ïö∞Ïûê Í≥µÏ†ú (ÏµúÏÜå 5Ïñµ, ÏµúÎåÄ 30Ïñµ - Î≤ïÏ†ïÏÉÅÏÜçÏßÄÎ∂Ñ ÌïúÎèÑ)
                if (hasSpouse) deductions += Math.min(Math.max(netAssets * 0.5, 500000000), 3000000000);
                // ÏûêÎÖÄ Í≥µÏ†ú (1Ïù∏Îãπ 5Ï≤úÎßå)
                deductions += parseInt(childCount) * 50000000;
                // ÏùºÍ¥ÑÍ≥µÏ†ú 5Ïñµ vs Í∏∞Ï¥àÍ≥µÏ†ú+Ïù∏Ï†ÅÍ≥µÏ†ú ÎπÑÍµê
                const basicTotal = 200000000 + parseInt(childCount) * 50000000;
                if (!hasSpouse && basicTotal < 500000000) deductions = 500000000;

                const taxableAmount = Math.max(netAssets - deductions, 0);

                // ÏÉÅÏÜçÏÑ∏Ïú® (Ï¶ùÏó¨ÏÑ∏ÏôÄ ÎèôÏùº)
                let tax = 0;
                if (taxableAmount <= 100000000) tax = taxableAmount * 0.1;
                else if (taxableAmount <= 500000000) tax = 10000000 + (taxableAmount - 100000000) * 0.2;
                else if (taxableAmount <= 1000000000) tax = 90000000 + (taxableAmount - 500000000) * 0.3;
                else if (taxableAmount <= 3000000000) tax = 240000000 + (taxableAmount - 1000000000) * 0.4;
                else tax = 1040000000 + (taxableAmount - 3000000000) * 0.5;

                const discount = Math.floor(tax * 0.03);
                const finalTax = Math.floor(tax - discount);

                return { netAssets, deductions, taxableAmount, tax: Math.floor(tax), discount, finalTax };
            }, [totalAssets, hasSpouse, childCount, debts]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Users className="w-5 h-5 mr-3 text-indigo-600" /> ÏÉÅÏÜçÏÑ∏ Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï¥ù ÏÉÅÏÜçÏû¨ÏÇ∞" value={totalAssets} onChange={setTotalAssets} color="violet" />
                            <NumberInput label="Ï±ÑÎ¨¥ Î∞è Í≥µÍ≥ºÍ∏à" value={debts} onChange={setDebts} color="violet" />
                            <label className="flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-xl cursor-pointer">
                                <input type="checkbox" checked={hasSpouse} onChange={(e) => setHasSpouse(e.target.checked)} className="w-5 h-5 rounded" />
                                <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Î∞∞Ïö∞Ïûê ÏÉùÏ°¥ (Î∞∞Ïö∞Ïûê Í≥µÏ†ú Ï†ÅÏö©)</span>
                            </label>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÏûêÎÖÄ Ïàò</label>
                                <div className="flex gap-2">
                                    {['0', '1', '2', '3', '4'].map(n => (
                                        <button key={n} onClick={() => setChildCount(n)} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${childCount === n ? 'bg-indigo-500 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-500'}`}>{n}Î™Ö</button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/40 dark:to-blue-900/40 p-6 rounded-[2.5rem] border border-indigo-100 dark:border-indigo-800 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-indigo-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ ÏÉÅÏÜçÏÑ∏</p>
                                <p className="text-4xl font-black text-indigo-900 dark:text-indigo-100">{formatNumber(result.finalTax)}Ïõê</p>
                            </div>
                            <div className="bg-white dark:bg-slate-800 rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ïàú ÏÉÅÏÜçÏû¨ÏÇ∞</span><span className="font-bold">{formatCompactNumber(result.netAssets)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ï¥ù Í≥µÏ†úÏï°</span><span className="font-bold text-green-600">-{formatCompactNumber(result.deductions)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Í≥ºÏÑ∏ÌëúÏ§Ä</span><span className="font-bold">{formatCompactNumber(result.taxableAmount)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ïã†Í≥†ÏÑ∏Ïï°Í≥µÏ†ú (3%)</span><span className="font-bold text-green-600">-{formatNumber(result.discount)}Ïõê</span></div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 dark:text-slate-500 bg-white dark:bg-slate-800 rounded-[2rem] border-2 border-dashed border-slate-200 dark:border-slate-600">ÏÉÅÏÜçÏû¨ÏÇ∞ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï£ºÎã¥ÎåÄ ÌïúÎèÑ Í≥ÑÏÇ∞Í∏∞
        const MortgageLimitTab = () => {
            const [annualIncome, setAnnualIncome] = useState('');
            const [propertyValue, setPropertyValue] = useState('');
            const [loanRate, setLoanRate] = useState('4.5');
            const [loanPeriod, setLoanPeriod] = useState('30');
            const [region, setRegion] = useState('non-adj');
            const [isFirstTime, setIsFirstTime] = useState(false);

            const result = useMemo(() => {
                const income = parseNumber(annualIncome);
                const property = parseNumber(propertyValue);
                const rate = parseFloat(loanRate) / 100 / 12;
                const months = parseInt(loanPeriod) * 12;
                if (!income || !property) return null;

                // DSR 40% Í∏∞Ï§Ä ÏµúÎåÄ Ïó∞Í∞Ñ ÏÉÅÌôòÏï°
                const maxAnnualPayment = income * 0.4;
                const maxMonthlyPayment = maxAnnualPayment / 12;

                // ÏõêÎ¶¨Í∏àÍ∑†Îì± Ïó≠ÏÇ∞: P = M * [(1+r)^n - 1] / [r * (1+r)^n]
                let dsrLimit = 0;
                if (rate > 0) {
                    dsrLimit = maxMonthlyPayment * (Math.pow(1 + rate, months) - 1) / (rate * Math.pow(1 + rate, months));
                } else {
                    dsrLimit = maxMonthlyPayment * months;
                }

                // LTV ÌïúÎèÑ (Í∑úÏ†úÏßÄÏó≠: 60%, ÎπÑÍ∑úÏ†ú: 70%, ÏÉùÏï†ÏµúÏ¥à: 80%)
                let ltvRate = region === 'adj' ? 0.6 : 0.7;
                if (isFirstTime) ltvRate = 0.8;
                const ltvLimit = property * ltvRate;

                const finalLimit = Math.min(dsrLimit, ltvLimit);
                const limitingFactor = dsrLimit < ltvLimit ? 'DSR' : 'LTV';

                return { dsrLimit: Math.floor(dsrLimit), ltvLimit: Math.floor(ltvLimit), finalLimit: Math.floor(finalLimit), limitingFactor, ltvRate: ltvRate * 100 };
            }, [annualIncome, propertyValue, loanRate, loanPeriod, region, isFirstTime]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Building className="w-5 h-5 mr-3 text-blue-600" /> Ï£ºÎã¥ÎåÄ ÌïúÎèÑ Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ïó∞ ÏÜåÎìù" value={annualIncome} onChange={setAnnualIncome} color="blue" />
                            <NumberInput label="Ï£ºÌÉù ÏãúÏÑ∏ (Îß§Îß§Í∞Ä)" value={propertyValue} onChange={setPropertyValue} color="blue" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÎåÄÏ∂úÍ∏àÎ¶¨ (%)</label>
                                    <input type="number" value={loanRate} onChange={(e) => setLoanRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-blue-500" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÎåÄÏ∂úÍ∏∞Í∞Ñ (ÎÖÑ)</label>
                                    <select value={loanPeriod} onChange={(e) => setLoanPeriod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="20">20ÎÖÑ</option><option value="30">30ÎÖÑ</option><option value="40">40ÎÖÑ</option>
                                    </select>
                                </div>
                            </div>
                            <ToggleGroup options={OPTIONS_REGION} value={region === 'non-adj' ? 'ÎπÑÍ∑úÏ†ú' : 'Í∑úÏ†ú(Ï°∞Ï†ï)'} onChange={(v) => setRegion(v === 'ÎπÑÍ∑úÏ†ú' ? 'non-adj' : 'adj')} color="blue" />
                            <label className="flex items-center gap-3 p-3 bg-green-50 rounded-xl cursor-pointer">
                                <input type="checkbox" checked={isFirstTime} onChange={(e) => setIsFirstTime(e.target.checked)} className="w-5 h-5 rounded accent-green-500" />
                                <span className="text-sm font-medium text-green-800">ÏÉùÏï†ÏµúÏ¥à Ï£ºÌÉùÍµ¨ÏûÖ (LTV 80%)</span>
                            </label>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-blue-50 to-sky-50 p-6 rounded-[2.5rem] border border-blue-100 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-blue-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ ÎåÄÏ∂ú ÌïúÎèÑ</p>
                                <p className="text-4xl font-black text-blue-900">{formatCompactNumber(result.finalLimit)}</p>
                                <p className="text-xs text-blue-500 mt-1">{result.limitingFactor} Í∏∞Ï§Ä Ï†ÅÏö©</p>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div className="bg-white p-4 rounded-2xl text-center">
                                    <p className="text-xs font-bold text-slate-400 mb-1">DSR 40% ÌïúÎèÑ</p>
                                    <p className="text-lg font-black text-slate-700">{formatCompactNumber(result.dsrLimit)}</p>
                                </div>
                                <div className="bg-white p-4 rounded-2xl text-center">
                                    <p className="text-xs font-bold text-slate-400 mb-1">LTV {result.ltvRate}% ÌïúÎèÑ</p>
                                    <p className="text-lg font-black text-slate-700">{formatCompactNumber(result.ltvLimit)}</p>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Ïó∞ÏÜåÎìùÍ≥º Ï£ºÌÉù ÏãúÏÑ∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï£ºÌÉùÏó∞Í∏à Í≥ÑÏÇ∞Í∏∞
        const ReverseRentTab = () => {
            const [propertyValue, setPropertyValue] = useState('');
            const [age, setAge] = useState('65');
            const [pensionType, setPensionType] = useState('lifetime');

            const result = useMemo(() => {
                const property = parseNumber(propertyValue);
                const ageNum = parseInt(age) || 55;
                if (!property || ageNum < 55) return null;

                // Ï£ºÌÉùÍ∏àÏúµÍ≥µÏÇ¨ Ï£ºÌÉùÏó∞Í∏à ÏòàÏÉÅ ÏõîÏßÄÍ∏âÍ∏à (Í∞ÑÏù¥ Ï∂îÏ†ï)
                // Ïó∞Î†πÎåÄÎ≥Ñ ÏßÄÍ∏âÎ•† (100ÏÑ∏ Í∏∞Ï§Ä Ï¢ÖÏã†Ìòï)
                const payRates = {
                    55: 0.0018, 60: 0.0022, 65: 0.0028, 70: 0.0037, 75: 0.0050, 80: 0.0070
                };
                const nearestAge = [55, 60, 65, 70, 75, 80].reduce((prev, curr) =>
                    Math.abs(curr - ageNum) < Math.abs(prev - ageNum) ? curr : prev
                );
                const baseRate = payRates[nearestAge] || 0.0028;

                // Ï£ºÌÉùÍ∞ÄÍ≤© ÌïúÎèÑ (12Ïñµ ÏÉÅÌïú)
                const cappedProperty = Math.min(property, 1200000000);

                let monthlyPension = Math.floor(cappedProperty * baseRate);
                if (pensionType === 'fixedTerm') monthlyPension = Math.floor(monthlyPension * 1.3); // ÌôïÏ†ïÍ∏∞Í∞ÑÌòï 30% Îçî ÎÜíÏùå

                const annualPension = monthlyPension * 12;
                const totalPension10Y = annualPension * 10;

                return { monthlyPension, annualPension, totalPension10Y, cappedProperty };
            }, [propertyValue, age, pensionType]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Home className="w-5 h-5 mr-3 text-amber-600" /> Ï£ºÌÉùÏó∞Í∏à Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï£ºÌÉù ÏãúÏÑ∏" value={propertyValue} onChange={setPropertyValue} color="orange" />
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ïã†Ï≤≠Ïûê Ïó∞Î†π</label>
                                <input type="number" value={age} onChange={(e) => setAge(e.target.value)} min="55" max="90" className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-amber-500" />
                                <p className="text-xs text-slate-400 mt-1 ml-1">Îßå 55ÏÑ∏ Ïù¥ÏÉÅ Ïã†Ï≤≠ Í∞ÄÎä•</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setPensionType('lifetime')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${pensionType === 'lifetime' ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-500'}`}>Ï¢ÖÏã†Ìòï</button>
                                <button onClick={() => setPensionType('fixedTerm')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${pensionType === 'fixedTerm' ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-500'}`}>ÌôïÏ†ïÍ∏∞Í∞ÑÌòï</button>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-[2.5rem] border border-amber-100 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-amber-500 uppercase tracking-widest mb-2">ÏòàÏÉÅ Ïõî ÏàòÎ†πÏï°</p>
                                <p className="text-4xl font-black text-amber-900">{formatNumber(result.monthlyPension)}Ïõê</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ïó∞Í∞Ñ ÏàòÎ†πÏï°</span><span className="font-bold">{formatCompactNumber(result.annualPension)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">10ÎÖÑÍ∞Ñ Ï¥ù ÏàòÎ†πÏï°</span><span className="font-bold">{formatCompactNumber(result.totalPension10Y)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ï†ÅÏö© Ï£ºÌÉùÍ∞ÄÍ≤©</span><span className="font-bold">{formatCompactNumber(result.cappedProperty)}</span></div>
                            </div>
                            <p className="text-xs text-center text-amber-400 mt-4">* HF ÌïúÍµ≠Ï£ºÌÉùÍ∏àÏúµÍ≥µÏÇ¨ Í∏∞Ï§Ä Í∞ÑÏù¥ Ï∂îÏ†ïÏπò</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Ï£ºÌÉù ÏãúÏÑ∏ÏôÄ Ïó∞Î†πÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï†ÑÏÑ∏ vs Îß§Îß§ Î∂ÑÏÑù
        const RentVsBuyTab = () => {
            const [purchasePrice, setPurchasePrice] = useState('');
            const [jeonseDeposit, setJeonseDeposit] = useState('');
            const [years, setYears] = useState('5');
            const [loanRate, setLoanRate] = useState('4.5');
            const [expectedRise, setExpectedRise] = useState('3');

            const result = useMemo(() => {
                const purchase = parseNumber(purchasePrice);
                const jeonse = parseNumber(jeonseDeposit);
                const yearNum = parseInt(years) || 5;
                const rate = parseFloat(loanRate) / 100 || 0.045;
                const rise = parseFloat(expectedRise) / 100 || 0.03;

                if (!purchase || !jeonse) return null;

                // Îß§Îß§ ÎπÑÏö©
                const acquisitionTax = Math.floor(purchase * 0.011); // Ï∑®ÎìùÏÑ∏ ÏïΩ 1.1%
                const loanAmount = purchase - jeonse; // Ï†ÑÏÑ∏Í∏à ÏàòÏ§Ä ÏûêÍ∏∞ÏûêÍ∏à Í∞ÄÏ†ï
                const annualInterest = loanAmount * rate;
                const totalInterest = annualInterest * yearNum;
                const propertyTax = Math.floor(purchase * 0.001 * yearNum); // Ïû¨ÏÇ∞ÏÑ∏ Ïó∞ 0.1%
                const sellingFee = Math.floor(purchase * 0.004); // Îß§ÎèÑ Ï§ëÍ∞úÎπÑ 0.4%
                const capitalGainTax = Math.floor(Math.max((purchase * Math.pow(1 + rise, yearNum) - purchase) * 0.2, 0)); // Í∞ÑÏù¥ ÏñëÎèÑÏÑ∏

                const buyCost = acquisitionTax + totalInterest + propertyTax + sellingFee + capitalGainTax;
                const futureValue = Math.floor(purchase * Math.pow(1 + rise, yearNum));
                const buyNetGain = futureValue - purchase - buyCost;

                // Ï†ÑÏÑ∏ ÎπÑÏö©
                const jeonseInterest = jeonse * rate * yearNum; // Í∏∞ÌöåÎπÑÏö©
                const jeonseMoveFee = 1000000 * (yearNum / 2); // Ïù¥ÏÇ¨ÎπÑ (2ÎÖÑÎßàÎã§)
                const rentCost = jeonseInterest + jeonseMoveFee;

                const difference = buyCost - rentCost;
                const winner = buyNetGain > 0 ? 'Îß§Îß§' : 'Ï†ÑÏÑ∏';
                const breakEvenYear = rise > 0 ? Math.ceil(buyCost / (purchase * rise)) : 0;

                return { buyCost, rentCost, difference, winner, futureValue, buyNetGain, breakEvenYear, capitalGainTax };
            }, [purchasePrice, jeonseDeposit, years, loanRate, expectedRise]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <BarChart3 className="w-5 h-5 mr-3 text-cyan-600" /> Ï†ÑÏÑ∏ vs Îß§Îß§ Î∂ÑÏÑù
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Îß§Îß§Í∞Ä" value={purchasePrice} onChange={setPurchasePrice} color="cyan" />
                            <NumberInput label="Ï†ÑÏÑ∏Í∞Ä" value={jeonseDeposit} onChange={setJeonseDeposit} color="cyan" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">Í±∞Ï£ºÍ∏∞Í∞Ñ (ÎÖÑ)</label>
                                    <select value={years} onChange={(e) => setYears(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-cyan-500">
                                        <option value="3">3ÎÖÑ</option><option value="5">5ÎÖÑ</option><option value="10">10ÎÖÑ</option>
                                    </select>
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">Ïó∞Í∞Ñ ÏÉÅÏäπÎ•† (%)</label>
                                    <input type="number" value={expectedRise} onChange={(e) => setExpectedRise(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-cyan-500" />
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="space-y-4">
                            <div className={`p-6 rounded-[2.5rem] shadow-lg ${result.winner === 'Îß§Îß§' ? 'bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100' : 'bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-100'}`}>
                                <div className="text-center mb-4">
                                    <p className="text-sm font-bold uppercase tracking-widest mb-2 opacity-60">{years}ÎÖÑ Í±∞Ï£º Ïãú</p>
                                    <p className="text-3xl font-black">{result.winner === 'Îß§Îß§' ? 'üè† Îß§Îß§ Ïú†Î¶¨' : 'üîë Ï†ÑÏÑ∏ Ïú†Î¶¨'}</p>
                                    <p className="text-lg font-bold mt-2">{result.buyNetGain > 0 ? `ÏàúÏù¥Ïùµ ${formatCompactNumber(result.buyNetGain)}` : `ÎπÑÏö© ${formatCompactNumber(Math.abs(result.difference))} Ï†àÏïΩ`}</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div className="bg-white p-4 rounded-2xl text-center shadow-sm border border-slate-100">
                                    <p className="text-xs font-bold text-blue-500 mb-1">Îß§Îß§ Ï¥ùÎπÑÏö©</p>
                                    <p className="text-lg font-black text-slate-700">{formatCompactNumber(result.buyCost)}</p>
                                </div>
                                <div className="bg-white p-4 rounded-2xl text-center shadow-sm border border-slate-100">
                                    <p className="text-xs font-bold text-orange-500 mb-1">Ï†ÑÏÑ∏ Ï¥ùÎπÑÏö©</p>
                                    <p className="text-lg font-black text-slate-700">{formatCompactNumber(result.rentCost)}</p>
                                </div>
                            </div>
                            {result.breakEvenYear > 0 && result.breakEvenYear < 30 && (
                                <p className="text-center text-sm text-slate-500">üìä ÏÜêÏùµÎ∂ÑÍ∏∞Ï†ê: ÏïΩ {result.breakEvenYear}ÎÖÑ</p>
                            )}
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Îß§Îß§Í∞ÄÏôÄ Ï†ÑÏÑ∏Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: ÎÇ¥ÏßëÍ∞ÄÍ≤© Í≥ÑÏÇ∞Í∏∞ (Affordability)
        const AffordabilityTab = () => {
            const [monthlyBudget, setMonthlyBudget] = useState('');
            const [savings, setSavings] = useState('');
            const [annualIncome, setAnnualIncome] = useState('');
            const [loanRate, setLoanRate] = useState('4.5');
            const [loanPeriod, setLoanPeriod] = useState('30');

            const result = useMemo(() => {
                const budget = parseNumber(monthlyBudget);
                const cash = parseNumber(savings);
                const income = parseNumber(annualIncome);
                const rate = parseFloat(loanRate) / 100 / 12;
                const months = parseInt(loanPeriod) * 12;

                if (!budget || !cash) return null;

                // DSR 40% Í∏∞Ï§Ä ÏµúÎåÄ ÎåÄÏ∂ú ÌïúÎèÑ
                let maxLoanByDSR = Infinity;
                if (income > 0) {
                    const maxAnnualPayment = income * 0.4;
                    const maxMonthlyPayment = Math.min(budget, maxAnnualPayment / 12);
                    if (rate > 0) {
                        maxLoanByDSR = maxMonthlyPayment * (Math.pow(1 + rate, months) - 1) / (rate * Math.pow(1 + rate, months));
                    } else {
                        maxLoanByDSR = maxMonthlyPayment * months;
                    }
                }

                // Ïõî ÏÉÅÌôòÏï° Í∏∞Ï§Ä ÏµúÎåÄ ÎåÄÏ∂ú
                let maxLoanByPayment = 0;
                if (rate > 0) {
                    maxLoanByPayment = budget * (Math.pow(1 + rate, months) - 1) / (rate * Math.pow(1 + rate, months));
                } else {
                    maxLoanByPayment = budget * months;
                }

                const maxLoan = Math.min(maxLoanByDSR, maxLoanByPayment);
                const ltvRate = 0.7; // ÎπÑÍ∑úÏ†ú LTV 70%
                const maxPriceByLTV = (cash + maxLoan) / (1 - (1 - ltvRate));
                const recommendedPrice = Math.floor(cash + maxLoan);

                return { maxLoan: Math.floor(maxLoan), recommendedPrice, cash };
            }, [monthlyBudget, savings, annualIncome, loanRate, loanPeriod]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Home className="w-5 h-5 mr-3 text-emerald-600" /> ÎÇ¥ Ïßë Í∞ÄÍ≤© Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ïõî Í∞ÄÏö© Ï£ºÍ±∞ÎπÑ (ÏÉÅÌôòÏï°)" value={monthlyBudget} onChange={setMonthlyBudget} color="green" />
                            <NumberInput label="Î≥¥Ïú† ÌòÑÍ∏à (ÏûêÍ∏∞ÏûêÍ∏à)" value={savings} onChange={setSavings} color="green" />
                            <NumberInput label="Ïó∞ ÏÜåÎìù (ÏÑ†ÌÉù)" value={annualIncome} onChange={setAnnualIncome} color="green" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">ÎåÄÏ∂úÍ∏àÎ¶¨ (%)</label>
                                    <input type="number" value={loanRate} onChange={(e) => setLoanRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-emerald-500" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">ÎåÄÏ∂úÍ∏∞Í∞Ñ</label>
                                    <select value={loanPeriod} onChange={(e) => setLoanPeriod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-2xl font-bold outline-none">
                                        <option value="20">20ÎÖÑ</option><option value="30">30ÎÖÑ</option><option value="40">40ÎÖÑ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-emerald-50 to-teal-50 p-6 rounded-[2.5rem] border border-emerald-100 shadow-lg">
                            <div className="text-center mb-6">
                                <p className="text-sm font-bold text-emerald-500 uppercase tracking-widest mb-2">Íµ¨Îß§ Í∞ÄÎä• Ï£ºÌÉù Í∞ÄÍ≤©</p>
                                <p className="text-4xl font-black text-emerald-900">{formatCompactNumber(result.recommendedPrice)}</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">ÏûêÍ∏∞ÏûêÍ∏à</span><span className="font-bold">{formatCompactNumber(result.cash)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">ÏòàÏÉÅ ÎåÄÏ∂ú ÌïúÎèÑ</span><span className="font-bold">{formatCompactNumber(result.maxLoan)}</span></div>
                            </div>
                            <p className="text-xs text-center text-emerald-400 mt-4">* Ïã§Ï†ú ÎåÄÏ∂ú ÌïúÎèÑÎäî Ïã†Ïö©ÎèÑ, ÏÜåÎìùÏ¶ùÎπôÏóê Îî∞Îùº Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Ïõî Í∞ÄÏö© Ï£ºÍ±∞ÎπÑÏôÄ Î≥¥Ïú† ÌòÑÍ∏àÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: ÏÉÅÌôò Ïä§ÏºÄÏ§ÑÌëú
        const AmortizationScheduleTab = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [rate, setRate] = useState('4.5');
            const [period, setPeriod] = useState('360');
            const [method, setMethod] = useState('equal'); // equal: ÏõêÎ¶¨Í∏àÍ∑†Îì±, principal: ÏõêÍ∏àÍ∑†Îì±

            const schedule = useMemo(() => {
                const principal = parseNumber(loanAmount);
                const monthlyRate = parseFloat(rate) / 100 / 12;
                const n = parseInt(period);
                if (!principal || !n || monthlyRate <= 0) return null;

                const items = [];
                let remaining = principal;

                if (method === 'equal') {
                    // ÏõêÎ¶¨Í∏àÍ∑†Îì±
                    const monthlyPayment = (principal * monthlyRate * Math.pow(1 + monthlyRate, n)) / (Math.pow(1 + monthlyRate, n) - 1);
                    for (let i = 1; i <= Math.min(n, 12); i++) {
                        const interest = remaining * monthlyRate;
                        const principalPay = monthlyPayment - interest;
                        remaining -= principalPay;
                        items.push({ month: i, payment: Math.floor(monthlyPayment), principal: Math.floor(principalPay), interest: Math.floor(interest), remaining: Math.floor(Math.max(remaining, 0)) });
                    }
                } else {
                    // ÏõêÍ∏àÍ∑†Îì±
                    const monthlyPrincipal = principal / n;
                    for (let i = 1; i <= Math.min(n, 12); i++) {
                        const interest = remaining * monthlyRate;
                        const payment = monthlyPrincipal + interest;
                        remaining -= monthlyPrincipal;
                        items.push({ month: i, payment: Math.floor(payment), principal: Math.floor(monthlyPrincipal), interest: Math.floor(interest), remaining: Math.floor(Math.max(remaining, 0)) });
                    }
                }

                return items;
            }, [loanAmount, rate, period, method]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <ClipboardList className="w-5 h-5 mr-3 text-purple-600" /> ÏÉÅÌôò Ïä§ÏºÄÏ§ÑÌëú
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="violet" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">Í∏àÎ¶¨ (%)</label>
                                    <input type="number" value={rate} onChange={(e) => setRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold outline-none" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase block mb-2 ml-1">Í∏∞Í∞Ñ</label>
                                    <select value={period} onChange={(e) => setPeriod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-2xl font-bold outline-none">
                                        <option value="120">10ÎÖÑ</option><option value="240">20ÎÖÑ</option><option value="360">30ÎÖÑ</option>
                                    </select>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setMethod('equal')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${method === 'equal' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-500'}`}>ÏõêÎ¶¨Í∏àÍ∑†Îì±</button>
                                <button onClick={() => setMethod('principal')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${method === 'principal' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-500'}`}>ÏõêÍ∏àÍ∑†Îì±</button>
                            </div>
                        </div>
                    </div>

                    {schedule && schedule.length > 0 ? (
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-xs">
                                    <thead className="bg-slate-50">
                                        <tr>
                                            <th className="py-3 px-2 text-left font-bold text-slate-500">ÌöåÏ∞®</th>
                                            <th className="py-3 px-2 text-right font-bold text-slate-500">ÏÉÅÌôòÏï°</th>
                                            <th className="py-3 px-2 text-right font-bold text-slate-500">ÏõêÍ∏à</th>
                                            <th className="py-3 px-2 text-right font-bold text-slate-500">Ïù¥Ïûê</th>
                                            <th className="py-3 px-2 text-right font-bold text-slate-500">ÏûîÏï°</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {schedule.map((row) => (
                                            <tr key={row.month} className="border-t border-slate-100">
                                                <td className="py-2.5 px-2 font-medium">{row.month}Ìöå</td>
                                                <td className="py-2.5 px-2 text-right font-bold">{formatNumber(row.payment)}</td>
                                                <td className="py-2.5 px-2 text-right text-blue-600">{formatNumber(row.principal)}</td>
                                                <td className="py-2.5 px-2 text-right text-red-500">{formatNumber(row.interest)}</td>
                                                <td className="py-2.5 px-2 text-right text-slate-400">{formatCompactNumber(row.remaining)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <p className="text-xs text-center text-slate-400 py-3">* Ï≤´ 12Í∞úÏõî Ïä§ÏºÄÏ§Ñ ÌëúÏãú</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">ÎåÄÏ∂úÍ∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï≤≠ÏïΩ Ï†êÏàò Í≥ÑÏÇ∞Í∏∞ (Í∞ÄÏ†êÏ†ú)
        const SubscriptionScoreTab = () => {
            const [noHouseYears, setNoHouseYears] = useState('10');
            const [dependents, setDependents] = useState('3');
            const [accountYears, setAccountYears] = useState('5');

            const result = useMemo(() => {
                const years = parseInt(noHouseYears) || 0;
                const deps = parseInt(dependents) || 0;
                const accYears = parseInt(accountYears) || 0;

                // Î¨¥Ï£ºÌÉù Í∏∞Í∞Ñ Ï†êÏàò (ÏµúÎåÄ 32Ï†ê)
                let noHouseScore = 0;
                if (years >= 15) noHouseScore = 32;
                else if (years >= 14) noHouseScore = 30;
                else if (years >= 13) noHouseScore = 28;
                else if (years >= 12) noHouseScore = 26;
                else if (years >= 11) noHouseScore = 24;
                else if (years >= 10) noHouseScore = 22;
                else if (years >= 9) noHouseScore = 20;
                else if (years >= 8) noHouseScore = 18;
                else if (years >= 7) noHouseScore = 16;
                else if (years >= 6) noHouseScore = 14;
                else if (years >= 5) noHouseScore = 12;
                else if (years >= 4) noHouseScore = 10;
                else if (years >= 3) noHouseScore = 8;
                else if (years >= 2) noHouseScore = 6;
                else if (years >= 1) noHouseScore = 2;

                // Î∂ÄÏñëÍ∞ÄÏ°± Ïàò Ï†êÏàò (ÏµúÎåÄ 35Ï†ê)
                let dependentScore = 5; // 0Î™ÖÎèÑ 5Ï†ê
                if (deps >= 6) dependentScore = 35;
                else if (deps === 5) dependentScore = 30;
                else if (deps === 4) dependentScore = 25;
                else if (deps === 3) dependentScore = 20;
                else if (deps === 2) dependentScore = 15;
                else if (deps === 1) dependentScore = 10;

                // Ï≤≠ÏïΩÌÜµÏû• Í∞ÄÏûÖÍ∏∞Í∞Ñ Ï†êÏàò (ÏµúÎåÄ 17Ï†ê)
                let accountScore = 1;
                if (accYears >= 15) accountScore = 17;
                else if (accYears >= 14) accountScore = 16;
                else if (accYears >= 13) accountScore = 15;
                else if (accYears >= 12) accountScore = 14;
                else if (accYears >= 11) accountScore = 13;
                else if (accYears >= 10) accountScore = 12;
                else if (accYears >= 9) accountScore = 11;
                else if (accYears >= 8) accountScore = 10;
                else if (accYears >= 7) accountScore = 9;
                else if (accYears >= 6) accountScore = 8;
                else if (accYears >= 5) accountScore = 7;
                else if (accYears >= 4) accountScore = 6;
                else if (accYears >= 3) accountScore = 5;
                else if (accYears >= 2) accountScore = 4;
                else if (accYears >= 1) accountScore = 3;

                const totalScore = noHouseScore + dependentScore + accountScore;
                const maxScore = 84;
                const percentage = (totalScore / maxScore) * 100;

                let grade = 'C';
                let gradeColor = 'text-orange-500';
                if (totalScore >= 70) { grade = 'S'; gradeColor = 'text-purple-600'; }
                else if (totalScore >= 60) { grade = 'A'; gradeColor = 'text-blue-600'; }
                else if (totalScore >= 50) { grade = 'B'; gradeColor = 'text-green-600'; }

                return { noHouseScore, dependentScore, accountScore, totalScore, maxScore, percentage, grade, gradeColor };
            }, [noHouseYears, dependents, accountYears]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Award className="w-5 h-5 mr-3 text-purple-600" /> Ï≤≠ÏïΩ Í∞ÄÏ†ê Í≥ÑÏÇ∞Í∏∞
                        </h3>
                        <div className="space-y-5">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î¨¥Ï£ºÌÉù Í∏∞Í∞Ñ (ÎÖÑ)</label>
                                <input type="number" value={noHouseYears} onChange={(e) => setNoHouseYears(e.target.value)} min="0" max="30" className="w-full px-5 py-4 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-purple-500 font-bold text-slate-700 text-lg" />
                                <p className="text-xs text-slate-400 mt-1 ml-1">Îßå 30ÏÑ∏ Ïù¥ÏÉÅ ÎØ∏ÌòºÏùÄ Î¨¥Ï£ºÌÉùÍ∏∞Í∞Ñ ÏÇ∞Ï†ï</p>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î∂ÄÏñëÍ∞ÄÏ°± Ïàò (Î™Ö)</label>
                                <div className="flex gap-2">
                                    {['0', '1', '2', '3', '4', '5', '6'].map(n => (
                                        <button key={n} onClick={() => setDependents(n)} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${dependents === n ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-500'}`}>{n}{n === '6' ? '+' : ''}</button>
                                    ))}
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ï≤≠ÏïΩÌÜµÏû• Í∞ÄÏûÖ Í∏∞Í∞Ñ (ÎÖÑ)</label>
                                <input type="number" value={accountYears} onChange={(e) => setAccountYears(e.target.value)} min="0" max="20" className="w-full px-5 py-4 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-purple-500 font-bold text-slate-700 text-lg" />
                            </div>
                        </div>
                    </div>

                    <div className="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-[2.5rem] border border-purple-100 shadow-lg">
                        <div className="text-center mb-6">
                            <p className="text-sm font-bold text-purple-400 uppercase tracking-widest mb-2">My Score</p>
                            <div className="flex items-center justify-center gap-4">
                                <span className={`text-6xl font-black ${result.gradeColor}`}>{result.grade}</span>
                                <div>
                                    <p className="text-4xl font-black text-purple-900">{result.totalScore}<span className="text-lg font-bold text-purple-400">/{result.maxScore}</span></p>
                                    <p className="text-sm text-purple-500">ÏÉÅÏúÑ {Math.round(100 - result.percentage)}% ÏòàÏÉÅ</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl p-4 space-y-3 shadow-sm">
                            <div className="flex justify-between text-sm">
                                <span className="text-slate-600">Î¨¥Ï£ºÌÉù Í∏∞Í∞Ñ</span>
                                <span className="font-bold text-purple-600">{result.noHouseScore}Ï†ê / 32Ï†ê</span>
                            </div>
                            <div className="flex justify-between text-sm">
                                <span className="text-slate-600">Î∂ÄÏñëÍ∞ÄÏ°± Ïàò</span>
                                <span className="font-bold text-purple-600">{result.dependentScore}Ï†ê / 35Ï†ê</span>
                            </div>
                            <div className="flex justify-between text-sm">
                                <span className="text-slate-600">Ï≤≠ÏïΩÌÜµÏû• Í∏∞Í∞Ñ</span>
                                <span className="font-bold text-purple-600">{result.accountScore}Ï†ê / 17Ï†ê</span>
                            </div>
                        </div>

                        <div className="mt-4 w-full bg-purple-200 rounded-full h-4 overflow-hidden">
                            <div className="h-full bg-gradient-to-r from-purple-500 to-indigo-500 rounded-full transition-all duration-1000" style={{ width: `${result.percentage}%` }}></div>
                        </div>
                    </div>
                </div>
            );
        };

        // NEW: DTI Í≥ÑÏÇ∞Í∏∞
        const DTITab = () => {
            const [annualIncome, setAnnualIncome] = useState('');
            const [annualRepayment, setAnnualRepayment] = useState('');

            const result = useMemo(() => {
                const income = parseNumber(annualIncome);
                const repay = parseNumber(annualRepayment);
                if (!income) return null;

                const dti = (repay / income) * 100;

                let status = 'Ïó¨Ïú†';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';
                if (dti > 60) { status = 'ÏúÑÌóò (ÌïúÎèÑ Ï¥àÍ≥º)'; colorClass = 'bg-red-50 border-red-200 text-red-900'; }
                else if (dti > 40) { status = 'Ï£ºÏùò (ÌïúÎèÑ Í∑ºÏ†ë)'; colorClass = 'bg-orange-50 border-orange-200 text-orange-900'; }

                return { dti, status, colorClass };
            }, [annualIncome, annualRepayment]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Percent className="w-5 h-5 mr-3 text-sky-600" /> DTI Í≥ÑÏÇ∞ (Ï¥ùÎ∂ÄÏ±ÑÏÉÅÌôòÎπÑÏú®)
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ïó∞ ÏÜåÎìù" value={annualIncome} onChange={setAnnualIncome} color="cyan" />
                            <NumberInput label="Ïó∞Í∞Ñ ÎåÄÏ∂ú ÏõêÎ¶¨Í∏à ÏÉÅÌôòÏï°" value={annualRepayment} onChange={setAnnualRepayment} color="cyan" />
                        </div>
                    </div>

                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] border ${result.colorClass} shadow-lg`}>
                            <div className="text-center">
                                <div className="text-sm font-bold opacity-60 uppercase tracking-widest mb-2">My DTI</div>
                                <div className="text-5xl font-black mb-2">{result.dti.toFixed(2)}%</div>
                                <div className="inline-block px-3 py-1 rounded-full bg-white/50 font-bold text-sm">{result.status}</div>
                            </div>
                            <div className="w-full bg-white/40 rounded-full h-4 mt-6 p-0.5">
                                <div className={`h-full rounded-full transition-all duration-1000 ${result.dti > 40 ? 'bg-red-500' : 'bg-emerald-500'}`} style={{ width: `${Math.min(result.dti, 100)}%` }}></div>
                            </div>
                            <p className="text-xs text-center opacity-60 mt-4">* DTI Í∑úÏ†ú: Ìà¨Í∏∞ÏßÄÏó≠ 40%, Ï°∞Ï†ïÏßÄÏó≠ 50%, Í∏∞ÌÉÄ 60%</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">ÏÜåÎìùÍ≥º ÏÉÅÌôòÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï†ÑÏÑ∏ÏûêÍ∏àÎåÄÏ∂ú ÌïúÎèÑ Í≥ÑÏÇ∞Í∏∞
        const JeonseLoanLimitTab = () => {
            const [deposit, setDeposit] = useState('');
            const [annualIncome, setAnnualIncome] = useState('');
            const [creditGrade, setCreditGrade] = useState('good');

            const result = useMemo(() => {
                const dep = parseNumber(deposit);
                const income = parseNumber(annualIncome);
                if (!dep) return null;

                // Î≤ÑÌåÄÎ™©Ï†ÑÏÑ∏ÎåÄÏ∂ú (ÏµúÎåÄ 2Ïñµ)
                const buteomokLimit = Math.min(dep * 0.8, 200000000);
                const buteomokRate = 2.1; // Ï†ÄÏÜåÎìùÏ∏µ Í∏∞Ï§Ä

                // Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨ Ï†ÑÏÑ∏ÎåÄÏ∂ú (ÏµúÎåÄ 5Ïñµ)
                const kakaoLimit = Math.min(dep * 0.8, 500000000);
                const kakaoRate = creditGrade === 'excellent' ? 3.8 : creditGrade === 'good' ? 4.2 : 4.8;

                // ÏùÄÌñâÍ∂å ÏùºÎ∞ò Ï†ÑÏÑ∏ÎåÄÏ∂ú (ÏµúÎåÄ 4Ïñµ)
                const bankLimit = Math.min(dep * 0.8, 400000000);
                const bankRate = creditGrade === 'excellent' ? 4.0 : creditGrade === 'good' ? 4.5 : 5.0;

                return { buteomokLimit, buteomokRate, kakaoLimit, kakaoRate, bankLimit, bankRate };
            }, [deposit, annualIncome, creditGrade]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Banknote className="w-5 h-5 mr-3 text-green-600" /> Ï†ÑÏÑ∏ÏûêÍ∏àÎåÄÏ∂ú ÌïúÎèÑ
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="green" />
                            <NumberInput label="Ïó∞ ÏÜåÎìù (ÏÑ†ÌÉù)" value={annualIncome} onChange={setAnnualIncome} color="green" />
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ïã†Ïö©Îì±Í∏â</label>
                                <div className="flex gap-2">
                                    {[{ id: 'excellent', label: 'Ïö∞Ïàò (1-3)' }, { id: 'good', label: 'ÏñëÌò∏ (4-6)' }, { id: 'normal', label: 'Î≥¥ÌÜµ (7-9)' }].map(g => (
                                        <button key={g.id} onClick={() => setCreditGrade(g.id)} className={`flex-1 py-3 rounded-xl text-xs font-bold transition-all ${creditGrade === g.id ? 'bg-green-500 text-white' : 'bg-slate-100 text-slate-500'}`}>{g.label}</button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="space-y-4">
                            <div className="bg-gradient-to-r from-blue-50 to-sky-50 p-5 rounded-2xl border border-blue-100">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <p className="text-xs font-bold text-blue-600 mb-1">Î≤ÑÌåÄÎ™© Ï†ÑÏÑ∏ÎåÄÏ∂ú</p>
                                        <p className="text-2xl font-black text-blue-900">{formatCompactNumber(result.buteomokLimit)}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs text-slate-500">ÏòàÏÉÅ Í∏àÎ¶¨</p>
                                        <p className="text-lg font-bold text-blue-600">{result.buteomokRate}%</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-gradient-to-r from-yellow-50 to-amber-50 p-5 rounded-2xl border border-yellow-100">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <p className="text-xs font-bold text-amber-600 mb-1">Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨ Ï†ÑÏÑ∏ÎåÄÏ∂ú</p>
                                        <p className="text-2xl font-black text-amber-900">{formatCompactNumber(result.kakaoLimit)}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs text-slate-500">ÏòàÏÉÅ Í∏àÎ¶¨</p>
                                        <p className="text-lg font-bold text-amber-600">{result.kakaoRate}%</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-gradient-to-r from-slate-50 to-gray-50 p-5 rounded-2xl border border-slate-200">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <p className="text-xs font-bold text-slate-600 mb-1">ÏãúÏ§ëÏùÄÌñâ Ï†ÑÏÑ∏ÎåÄÏ∂ú</p>
                                        <p className="text-2xl font-black text-slate-900">{formatCompactNumber(result.bankLimit)}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs text-slate-500">ÏòàÏÉÅ Í∏àÎ¶¨</p>
                                        <p className="text-lg font-bold text-slate-600">{result.bankRate}%</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-xs text-center text-slate-400">* Ïã§Ï†ú ÌïúÎèÑÏôÄ Í∏àÎ¶¨Îäî Ïã¨ÏÇ¨ Í≤∞Í≥ºÏóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏäµÎãàÎã§</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Î≥¥Ï¶ùÍ∏àÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Ï£ºÎã¥ÎåÄ ÏÉÅÌôò ÎπÑÍµê ÏãúÍ∞ÅÌôî
        const LoanCompareTab = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [rate, setRate] = useState('4.5');
            const [period, setPeriod] = useState('360'); // 30ÎÖÑ = 360Í∞úÏõî

            const result = useMemo(() => {
                const principal = parseNumber(loanAmount);
                const ratePercent = parseFloat(rate) || 0;
                const n = parseInt(period);
                if (!principal || !n) return null;

                // Handle zero interest rate edge case
                if (ratePercent === 0) {
                    const monthlyPayment = principal / n;
                    return {
                        bullet: { total: principal, interest: 0, monthly: 0 },
                        equal: { total: principal, interest: 0, monthly: monthlyPayment },
                        principal: { total: principal, interest: 0, first: monthlyPayment },
                        maxTotal: principal
                    };
                }

                const r = ratePercent / 100 / 12;

                // ÎßåÍ∏∞ÏùºÏãú
                const bulletInterest = principal * r * n;
                const bulletTotal = principal + bulletInterest;
                const bulletMonthly = principal * r;

                // ÏõêÎ¶¨Í∏àÍ∑†Îì±
                const equalPayment = (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                const equalTotal = equalPayment * n;
                const equalInterest = equalTotal - principal;

                // ÏõêÍ∏àÍ∑†Îì±
                const principalPayment = principal / n;
                const firstInterest = principal * r;
                const principalFirst = principalPayment + firstInterest;
                let principalTotalInterest = 0;
                for (let i = 0; i < n; i++) {
                    principalTotalInterest += (principal - (principalPayment * i)) * r;
                }
                const principalTotal = principal + principalTotalInterest;

                const maxTotal = Math.max(bulletTotal, equalTotal, principalTotal);

                return {
                    bullet: { total: bulletTotal, interest: bulletInterest, monthly: bulletMonthly },
                    equal: { total: equalTotal, interest: equalInterest, monthly: equalPayment },
                    principal: { total: principalTotal, interest: principalTotalInterest, first: principalFirst },
                    maxTotal
                };
            }, [loanAmount, rate, period]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <BarChart3 className="w-5 h-5 mr-3 text-indigo-600" /> ÏÉÅÌôòÎ∞©Ïãù ÎπÑÍµê
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="violet" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í∏àÎ¶¨ (%)</label>
                                    <input type="number" value={rate} onChange={(e) => setRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í∏∞Í∞Ñ</label>
                                    <select value={period} onChange={(e) => setPeriod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="120">10ÎÖÑ</option>
                                        <option value="180">15ÎÖÑ</option>
                                        <option value="240">20ÎÖÑ</option>
                                        <option value="300">25ÎÖÑ</option>
                                        <option value="360">30ÎÖÑ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="space-y-4">
                            <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="text-sm font-bold text-slate-600 mb-4">Ï¥ù ÏÉÅÌôòÍ∏àÏï° ÎπÑÍµê</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center gap-3">
                                        <span className="w-20 text-xs font-bold text-slate-500">ÎßåÍ∏∞ÏùºÏãú</span>
                                        <div className="flex-1 bg-slate-100 rounded-full h-6 overflow-hidden">
                                            <div className="h-full bg-red-400 rounded-full" style={{ width: `${(result.bullet.total / result.maxTotal) * 100}%` }}></div>
                                        </div>
                                        <span className="text-sm font-bold w-24 text-right">{formatCompactNumber(result.bullet.total)}</span>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="w-20 text-xs font-bold text-slate-500">ÏõêÎ¶¨Í∏àÍ∑†Îì±</span>
                                        <div className="flex-1 bg-slate-100 rounded-full h-6 overflow-hidden">
                                            <div className="h-full bg-blue-400 rounded-full" style={{ width: `${(result.equal.total / result.maxTotal) * 100}%` }}></div>
                                        </div>
                                        <span className="text-sm font-bold w-24 text-right">{formatCompactNumber(result.equal.total)}</span>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="w-20 text-xs font-bold text-slate-500">ÏõêÍ∏àÍ∑†Îì±</span>
                                        <div className="flex-1 bg-slate-100 rounded-full h-6 overflow-hidden">
                                            <div className="h-full bg-green-400 rounded-full" style={{ width: `${(result.principal.total / result.maxTotal) * 100}%` }}></div>
                                        </div>
                                        <span className="text-sm font-bold w-24 text-right">{formatCompactNumber(result.principal.total)}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-3 gap-3">
                                <div className="bg-red-50 p-4 rounded-2xl text-center">
                                    <p className="text-[10px] font-bold text-red-500 mb-1">ÎßåÍ∏∞ÏùºÏãú</p>
                                    <p className="text-lg font-black text-red-700">{formatCompactNumber(result.bullet.interest)}</p>
                                    <p className="text-[10px] text-red-400">Ï¥ù Ïù¥Ïûê</p>
                                </div>
                                <div className="bg-blue-50 p-4 rounded-2xl text-center">
                                    <p className="text-[10px] font-bold text-blue-500 mb-1">ÏõêÎ¶¨Í∏àÍ∑†Îì±</p>
                                    <p className="text-lg font-black text-blue-700">{formatCompactNumber(result.equal.interest)}</p>
                                    <p className="text-[10px] text-blue-400">Ï¥ù Ïù¥Ïûê</p>
                                </div>
                                <div className="bg-green-50 p-4 rounded-2xl text-center">
                                    <p className="text-[10px] font-bold text-green-500 mb-1">ÏõêÍ∏àÍ∑†Îì±</p>
                                    <p className="text-lg font-black text-green-700">{formatCompactNumber(result.principal.interest)}</p>
                                    <p className="text-[10px] text-green-400">Ï¥ù Ïù¥Ïûê</p>
                                </div>
                            </div>

                            <div className="bg-green-100 p-4 rounded-2xl text-center">
                                <p className="text-sm font-bold text-green-800">
                                    üí° ÏõêÍ∏àÍ∑†Îì± ÏÑ†ÌÉù Ïãú ÎßåÍ∏∞ÏùºÏãú ÎåÄÎπÑ <span className="text-green-600">{formatCompactNumber(result.bullet.interest - result.principal.interest)}</span> Ï†àÏïΩ!
                                </p>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">ÎåÄÏ∂úÍ∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: ÏûÑÎåÄÏàòÏùµÎ•† ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ (Phase 2)
        const RentalYieldTab = () => {
            const [purchasePrice, setPurchasePrice] = useState('');
            const [monthlyRent, setMonthlyRent] = useState('');
            const [jeonseDeposit, setJeonseDeposit] = useState('');
            const [vacancyRate, setVacancyRate] = useState('5');
            const [repairCost, setRepairCost] = useState('');
            const [propertyTax, setPropertyTax] = useState('');

            const result = useMemo(() => {
                const price = parseNumber(purchasePrice);
                const rent = parseNumber(monthlyRent);
                const deposit = parseNumber(jeonseDeposit);
                const vacancy = parseFloat(vacancyRate) / 100 || 0;
                const repair = parseNumber(repairCost);
                const tax = parseNumber(propertyTax);

                if (!price || !rent) return null;

                const annualRent = rent * 12;
                const effectiveRent = annualRent * (1 - vacancy);
                const totalCosts = repair + tax;
                const netIncome = effectiveRent - totalCosts;
                const investment = price - deposit;
                const grossYield = (annualRent / price) * 100;
                const netYield = investment > 0 ? (netIncome / investment) * 100 : 0;

                return { annualRent, effectiveRent, netIncome, grossYield, netYield, totalCosts };
            }, [purchasePrice, monthlyRent, jeonseDeposit, vacancyRate, repairCost, propertyTax]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <TrendingUp className="w-5 h-5 mr-3 text-green-600" /> ÏûÑÎåÄÏàòÏùµÎ•† ÏãúÎÆ¨Î†àÏù¥ÌÑ∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Îß§ÏûÖÍ∞Ä" value={purchasePrice} onChange={setPurchasePrice} color="green" />
                            <NumberInput label="Ïõî ÏûÑÎåÄÎ£å" value={monthlyRent} onChange={setMonthlyRent} color="green" />
                            <NumberInput label="Ï†ÑÏÑ∏Î≥¥Ï¶ùÍ∏à (ÏÑ†ÌÉù)" value={jeonseDeposit} onChange={setJeonseDeposit} color="green" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 block mb-1">Í≥µÏã§Î•† (%)</label>
                                    <input type="number" value={vacancyRate} onChange={e => setVacancyRate(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                                </div>
                                <div className="flex-1">
                                    <NumberInput label="Ïó∞Í∞Ñ ÏàòÏÑ†ÎπÑ" value={repairCost} onChange={setRepairCost} color="green" enableUnitToggle={false} showKorean={false} />
                                </div>
                            </div>
                            <NumberInput label="Ïó∞Í∞Ñ Ïû¨ÏÇ∞ÏÑ∏" value={propertyTax} onChange={setPropertyTax} color="green" enableUnitToggle={false} showKorean={false} />
                        </div>
                    </div>
                    {result ? (
                        <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-[2.5rem] border border-green-100 shadow-lg">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div className="text-center p-4 bg-white rounded-2xl">
                                    <p className="text-xs font-bold text-slate-500 mb-1">Ï¥ùÏàòÏùµÎ•†</p>
                                    <p className="text-2xl font-black text-green-600">{result.grossYield.toFixed(2)}%</p>
                                </div>
                                <div className="text-center p-4 bg-white rounded-2xl">
                                    <p className="text-xs font-bold text-slate-500 mb-1">Ïã§ÏßàÏàòÏùµÎ•†</p>
                                    <p className="text-2xl font-black text-emerald-600">{result.netYield.toFixed(2)}%</p>
                                </div>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ïó∞Í∞Ñ ÏûÑÎåÄÎ£å</span><span className="font-bold">{formatCompactNumber(result.annualRent)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Í≥µÏã§ Î∞òÏòÅ</span><span className="font-bold">{formatCompactNumber(result.effectiveRent)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ïó∞Í∞Ñ ÎπÑÏö©</span><span className="font-bold text-red-500">-{formatCompactNumber(result.totalCosts)}</span></div>
                                <div className="h-px bg-slate-200"></div>
                                <div className="flex justify-between font-bold"><span>ÏàúÏûÑÎåÄÏÜåÎìù</span><span className="text-green-600">{formatCompactNumber(result.netIncome)}</span></div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Îß§ÏûÖÍ∞ÄÏôÄ Ïõî ÏûÑÎåÄÎ£åÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Îã§Ï£ºÌÉùÏûê Î≥¥Ïú†ÏÑ∏ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Phase 2)
        const MultiPropertyTaxTab = () => {
            const [properties, setProperties] = useState([{ price: '', location: 'non-regulated' }]);

            const addProperty = () => setProperties([...properties, { price: '', location: 'non-regulated' }]);
            const removeProperty = (idx) => setProperties(properties.filter((_, i) => i !== idx));
            const updateProperty = (idx, field, value) => {
                const updated = [...properties];
                updated[idx][field] = value;
                setProperties(updated);
            };

            const result = useMemo(() => {
                const prices = properties.map(p => parseNumber(p.price)).filter(p => p > 0);
                if (prices.length === 0) return null;

                const totalPrice = prices.reduce((a, b) => a + b, 0);
                const count = prices.length;

                // Ïû¨ÏÇ∞ÏÑ∏ (Í∞ÑÏù¥ Í≥ÑÏÇ∞: 0.1% ~ 0.4%)
                let propertyTax = 0;
                prices.forEach(p => {
                    if (p <= 600000000) propertyTax += p * 0.001;
                    else if (p <= 1500000000) propertyTax += p * 0.0015;
                    else propertyTax += p * 0.004;
                });

                // Ï¢ÖÎ∂ÄÏÑ∏ (Îã§Ï£ºÌÉù Ï§ëÍ≥º)
                let jongbuTax = 0;
                const threshold = count >= 3 ? 600000000 : count >= 2 ? 900000000 : 1100000000;
                const excess = totalPrice - threshold;
                if (excess > 0) {
                    const rate = count >= 3 ? 0.05 : count >= 2 ? 0.025 : 0.01;
                    jongbuTax = excess * rate;
                }

                return { propertyTax: Math.floor(propertyTax), jongbuTax: Math.floor(jongbuTax), total: Math.floor(propertyTax + jongbuTax), count, totalPrice };
            }, [properties]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Building className="w-5 h-5 mr-3 text-purple-600" /> Îã§Ï£ºÌÉù Î≥¥Ïú†ÏÑ∏ ÏãúÎÆ¨Î†àÏù¥ÏÖò
                        </h3>
                        <div className="space-y-4">
                            {properties.map((prop, idx) => (
                                <div key={idx} className="p-4 bg-slate-50 rounded-2xl">
                                    <div className="flex justify-between items-center mb-3">
                                        <span className="text-sm font-bold text-purple-600">Ï£ºÌÉù {idx + 1}</span>
                                        {properties.length > 1 && <button onClick={() => removeProperty(idx)} className="text-red-500 text-xs font-bold">ÏÇ≠Ï†ú</button>}
                                    </div>
                                    <NumberInput label="Í≥µÏãúÍ∞ÄÍ≤©" value={prop.price} onChange={(v) => updateProperty(idx, 'price', v)} color="violet" />
                                </div>
                            ))}
                            <button onClick={addProperty} className="w-full py-3 bg-purple-100 text-purple-600 rounded-xl font-bold text-sm">+ Ï£ºÌÉù Ï∂îÍ∞Ä</button>
                        </div>
                    </div>
                    {result && (
                        <div className="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-[2.5rem] border border-purple-100 shadow-lg">
                            <div className="text-center mb-4">
                                <p className="text-sm font-bold text-purple-500 mb-1">{result.count}Ï£ºÌÉù Ïó∞Í∞Ñ Î≥¥Ïú†ÏÑ∏</p>
                                <p className="text-4xl font-black text-purple-800">{formatCompactNumber(result.total)}</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ï¥ù Í≥µÏãúÍ∞ÄÍ≤©</span><span className="font-bold">{formatCompactNumber(result.totalPrice)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ïû¨ÏÇ∞ÏÑ∏</span><span className="font-bold">{formatCompactNumber(result.propertyTax)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">Ï¢ÖÌï©Î∂ÄÎèôÏÇ∞ÏÑ∏</span><span className="font-bold">{formatCompactNumber(result.jongbuTax)}</span></div>
                            </div>
                            <p className="text-xs text-center text-purple-400 mt-4">* Í∞ÑÏù¥ Ï∂îÏ†ïÏπò, Ïã§Ï†ú ÏÑ∏Í∏àÍ≥º Îã§Î•º Ïàò ÏûàÏùå</p>
                        </div>
                    )}
                </div>
            );
        };

        // NEW: Ïû¨Í±¥Ï∂ï/Î¶¨Î™®Îç∏ÎßÅ ÏàòÏùµÎ∂ÑÏÑù (Phase 2)
        const ReconstructionTab = () => {
            const [currentValue, setCurrentValue] = useState('');
            const [contribution, setContribution] = useState('');
            const [expectedValue, setExpectedValue] = useState('');
            const [duration, setDuration] = useState('5');

            const result = useMemo(() => {
                const current = parseNumber(currentValue);
                const contrib = parseNumber(contribution);
                const expected = parseNumber(expectedValue);
                const years = parseInt(duration) || 1;

                if (!current || !expected) return null;

                const totalInvestment = current + contrib;
                const profit = expected - totalInvestment;
                const roi = totalInvestment > 0 ? (profit / totalInvestment) * 100 : 0;
                const annualRoi = roi / years;

                return { totalInvestment, profit, roi, annualRoi, isPositive: profit > 0 };
            }, [currentValue, contribution, expectedValue, duration]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Building className="w-5 h-5 mr-3 text-amber-600" /> Ïû¨Í±¥Ï∂ï/Î¶¨Î™®Îç∏ÎßÅ ÏàòÏùµÎ∂ÑÏÑù
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÌòÑÏû¨ ÏãúÏÑ∏ (Íµ¨Ï∂ï)" value={currentValue} onChange={setCurrentValue} color="orange" />
                            <NumberInput label="Ï∂îÍ∞Ä Î∂ÑÎã¥Í∏à" value={contribution} onChange={setContribution} color="orange" />
                            <NumberInput label="ÏôÑÍ≥µ ÌõÑ ÏòàÏÉÅ ÏãúÏÑ∏" value={expectedValue} onChange={setExpectedValue} color="orange" />
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÏòàÏÉÅ ÏÜåÏöîÍ∏∞Í∞Ñ (ÎÖÑ)</label>
                                <input type="number" value={duration} onChange={e => setDuration(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                    </div>
                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] shadow-lg ${result.isPositive ? 'bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-100' : 'bg-red-50 border border-red-200'}`}>
                            <div className="text-center mb-4">
                                <p className="text-sm font-bold mb-1">{result.isPositive ? 'ÏòàÏÉÅ ÏàòÏùµÎ•†' : 'ÏòàÏÉÅ ÏÜêÏã§'}</p>
                                <p className={`text-4xl font-black ${result.isPositive ? 'text-amber-700' : 'text-red-600'}`}>{result.roi.toFixed(1)}%</p>
                                <p className="text-sm text-slate-500">Ïó∞ ÌôòÏÇ∞ {result.annualRoi.toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-2xl p-4 space-y-2 text-sm">
                                <div className="flex justify-between"><span className="text-slate-500">Ï¥ù Ìà¨ÏûêÍ∏à</span><span className="font-bold">{formatCompactNumber(result.totalInvestment)}</span></div>
                                <div className="flex justify-between"><span className="text-slate-500">{result.isPositive ? 'ÏòàÏÉÅ ÏàòÏùµ' : 'ÏòàÏÉÅ ÏÜêÏã§'}</span><span className={`font-bold ${result.isPositive ? 'text-green-600' : 'text-red-600'}`}>{result.isPositive ? '+' : ''}{formatCompactNumber(result.profit)}</span></div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">ÌòÑÏû¨ ÏãúÏÑ∏ÏôÄ ÏòàÏÉÅ ÏãúÏÑ∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // NEW: Í∞≠Ìà¨Ïûê ROI Î∂ÑÏÑù
        const GapInvestmentTab = () => {
            const [purchasePrice, setPurchasePrice] = useState('');
            const [jeonseDeposit, setJeonseDeposit] = useState('');
            const [expectedRise, setExpectedRise] = useState('5');
            const [holdingYears, setHoldingYears] = useState('3');

            const result = useMemo(() => {
                const price = parseNumber(purchasePrice);
                const jeonse = parseNumber(jeonseDeposit);
                const riseRate = parseFloat(expectedRise) / 100 || 0;
                const years = parseInt(holdingYears) || 1;

                if (!price || !jeonse) return null;

                // Ï†ÑÏÑ∏Í∞ÄÍ∞Ä Îß§Îß§Í∞ÄÎ≥¥Îã§ ÎÜíÏúºÎ©¥ Í∞≠Ìà¨Ïûê Î∂àÍ∞Ä
                if (jeonse >= price) {
                    return { error: 'Ï†ÑÏÑ∏Í∞ÄÍ∞Ä Îß§Îß§Í∞ÄÎ≥¥Îã§ ÎÜíÏäµÎãàÎã§', gap: 0 };
                }

                const gap = price - jeonse; // Ìà¨ÏûêÍ∏à (Í∞≠)
                const acquisitionTax = Math.floor(price * 0.011); // Ï∑®ÎìùÏÑ∏ ÏïΩ 1.1%
                const totalInvestment = gap + acquisitionTax;

                // Ïó∞Í∞Ñ ÏÉÅÏäπÎ•† Í∏∞Ï§Ä ÏãúÏÑ∏ ÏÉÅÏäπ
                const futurePrice = price * Math.pow(1 + riseRate, years);
                const priceGain = futurePrice - price;

                // ÏñëÎèÑÏ∞®Ïùµ (Îã®Ïàú Í≥ÑÏÇ∞)
                const estimatedTax = priceGain > 0 ? Math.floor(priceGain * 0.2) : 0; // Í∞ÑÏù¥ ÏñëÎèÑÏÑ∏ 20%
                const netProfit = priceGain - estimatedTax;

                const roi = totalInvestment > 0 ? (netProfit / totalInvestment) * 100 : 0;
                const annualRoi = years > 0 ? roi / years : 0;

                return { gap, acquisitionTax, totalInvestment, futurePrice, priceGain, estimatedTax, netProfit, roi, annualRoi };
            }, [purchasePrice, jeonseDeposit, expectedRise, holdingYears]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <TrendingUp className="w-5 h-5 mr-3 text-cyan-600" /> Í∞≠Ìà¨Ïûê ROI Î∂ÑÏÑù
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Îß§Îß§Í∞Ä" value={purchasePrice} onChange={setPurchasePrice} color="cyan" />
                            <NumberInput label="Ï†ÑÏÑ∏Í∞Ä (Î≥¥Ï¶ùÍ∏à)" value={jeonseDeposit} onChange={setJeonseDeposit} color="cyan" />
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ïó∞Í∞Ñ ÏÉÅÏäπÎ•† (%)</label>
                                    <input type="number" value={expectedRise} onChange={(e) => setExpectedRise(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-cyan-500" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î≥¥Ïú† Í∏∞Í∞Ñ (ÎÖÑ)</label>
                                    <input type="number" value={holdingYears} onChange={(e) => setHoldingYears(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-cyan-500" />
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        result.error ? (
                            <div className="bg-red-50 p-6 rounded-[2rem] border border-red-200 text-center">
                                <p className="text-lg font-bold text-red-600">‚ö†Ô∏è {result.error}</p>
                                <p className="text-sm text-red-500 mt-2">Ï†ÑÏÑ∏Í∞ÄÏú®Ïù¥ 100%Î•º Ï¥àÍ≥ºÌïòÎ©¥ Í∞≠Ìà¨ÏûêÍ∞Ä Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§.</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="bg-gradient-to-br from-cyan-50 to-teal-50 p-6 rounded-[2rem] border border-cyan-100 shadow-lg">
                                    <div className="text-center mb-4">
                                        <p className="text-sm font-bold text-cyan-500 uppercase tracking-widest mb-1">ÏòàÏÉÅ ÏàòÏùµÎ•† (ROI)</p>
                                        <p className="text-5xl font-black text-cyan-800">{result.roi.toFixed(1)}%</p>
                                        <p className="text-sm text-cyan-600">Ïó∞ ÌôòÏÇ∞ {result.annualRoi.toFixed(1)}%</p>
                                    </div>
                                </div>

                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-3 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-slate-500">Ìà¨ÏûêÍ∏à (Í∞≠)</span>
                                        <span className="font-bold">{formatCompactNumber(result.gap)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-slate-500">Ï∑®ÎìùÏÑ∏</span>
                                        <span className="font-bold">{formatCompactNumber(result.acquisitionTax)}</span>
                                    </div>
                                    <div className="h-px bg-slate-100"></div>
                                    <div className="flex justify-between font-bold">
                                        <span>Ï¥ù Ìà¨ÏûêÍ∏à</span>
                                        <span className="text-cyan-600">{formatCompactNumber(result.totalInvestment)}</span>
                                    </div>
                                    <div className="h-px bg-slate-100"></div>
                                    <div className="flex justify-between">
                                        <span className="text-slate-500">{holdingYears}ÎÖÑ ÌõÑ ÏòàÏÉÅ ÏãúÏÑ∏</span>
                                        <span className="font-bold">{formatCompactNumber(result.futurePrice)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-slate-500">ÏãúÏÑ∏ Ï∞®Ïùµ</span>
                                        <span className="font-bold text-green-600">+{formatCompactNumber(result.priceGain)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-slate-500">ÏòàÏÉÅ ÏñëÎèÑÏÑ∏</span>
                                        <span className="font-bold text-red-500">-{formatCompactNumber(result.estimatedTax)}</span>
                                    </div>
                                    <div className="h-px bg-slate-100"></div>
                                    <div className="flex justify-between font-bold text-lg">
                                        <span>ÏàúÏàòÏùµ</span>
                                        <span className="text-cyan-600">{formatCompactNumber(result.netProfit)}</span>
                                    </div>
                                </div>
                                <p className="text-xs text-center text-slate-400">* Îã®Ïàú ÏãúÎÆ¨Î†àÏù¥ÏÖòÏù¥Î©∞ Ïã§Ï†ú ÏàòÏùµÍ≥º Îã§Î•º Ïàò ÏûàÏäµÎãàÎã§</p>
                            </div>
                        )
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">Îß§Îß§Í∞ÄÏôÄ Ï†ÑÏÑ∏Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // 12. Rent Increase Calculator (ÏõîÏÑ∏ Ïù∏ÏÉÅÎ•† Í≥ÑÏÇ∞Í∏∞)
        const RentIncreaseCalc = () => {
            const [currentRent, setCurrentRent] = useState('');
            const [currentDeposit, setCurrentDeposit] = useState('');
            const [increaseRate, setIncreaseRate] = useState('5');

            const result = useMemo(() => {
                const rent = parseNumber(currentRent);
                const deposit = parseNumber(currentDeposit);
                const rate = parseFloat(increaseRate) / 100 || 0.05;

                if (!rent && !deposit) return null;

                const maxRentIncrease = Math.floor(rent * rate);
                const maxDepositIncrease = Math.floor(deposit * rate);
                const newMaxRent = rent + maxRentIncrease;
                const newMaxDeposit = deposit + maxDepositIncrease;

                // Ï†ÑÌôò ÏòµÏÖò Í≥ÑÏÇ∞ (Ï†ÑÌôòÏú® 6%)
                const conversionRate = 0.06;
                const rentToDeposit = Math.floor((maxRentIncrease * 12) / conversionRate);
                const depositToRent = Math.floor((maxDepositIncrease * conversionRate) / 12);

                return { maxRentIncrease, maxDepositIncrease, newMaxRent, newMaxDeposit, rentToDeposit, depositToRent };
            }, [currentRent, currentDeposit, increaseRate]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-green-600" /> ÏõîÏÑ∏ Ïù∏ÏÉÅÎ•† Í≥ÑÏÇ∞ (5% ÏÉÅÌïú)
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÌòÑÏû¨ ÏõîÏÑ∏" value={currentRent} onChange={setCurrentRent} color="green" />
                        <NumberInput label="ÌòÑÏû¨ Î≥¥Ï¶ùÍ∏à" value={currentDeposit} onChange={setCurrentDeposit} color="green" />

                        <div>
                            <label className="text-xs font-bold text-slate-500 ml-1 block mb-2">Ïù∏ÏÉÅÎ•† (%)</label>
                            <input type="number" value={increaseRate} onChange={(e) => setIncreaseRate(e.target.value)} max="5" className="w-full px-4 py-3 text-right bg-slate-50 rounded-xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-green-500" />
                        </div>

                        {result && (
                            <div className="mt-4 p-4 bg-green-50 rounded-2xl space-y-3">
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600">Ïù∏ÏÉÅ ÌõÑ ÏµúÎåÄ ÏõîÏÑ∏</span>
                                    <span className="font-bold text-green-700">{formatNumber(result.newMaxRent)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600">Ïù∏ÏÉÅ ÌõÑ ÏµúÎåÄ Î≥¥Ï¶ùÍ∏à</span>
                                    <span className="font-bold text-green-700">{formatNumber(result.newMaxDeposit)}Ïõê</span>
                                </div>
                                <p className="text-xs text-slate-400 mt-2">* Ï£ºÌÉùÏûÑÎåÄÏ∞®Î≥¥Ìò∏Î≤ï Í∏∞Ï§Ä 5% ÏÉÅÌïú</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 13. Registration Fee Calculator (Îì±Í∏∞ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞)
        const RegistrationFeeCalc = () => {
            const [salePrice, setSalePrice] = useState('');
            const [loanAmount, setLoanAmount] = useState('');

            const result = useMemo(() => {
                const price = parseNumber(salePrice);
                const loan = parseNumber(loanAmount);

                if (!price) return null;

                // Îì±Î°ùÎ©¥ÌóàÏÑ∏ (ÏÜåÏú†Í∂åÏù¥Ï†Ñ: 2%)
                const registrationTax = Math.floor(price * 0.02);

                // ÏßÄÎ∞©ÍµêÏú°ÏÑ∏ (Îì±Î°ùÎ©¥ÌóàÏÑ∏Ïùò 20%)
                const localEduTax = Math.floor(registrationTax * 0.2);

                // ÎåÄÎ≤ïÏõê ÏàòÏûÖÏ¶ùÏßÄ (ÏùºÎ∞ò 15,000Ïõê)
                const courtStamp = 15000;

                // Î≤ïÎ¨¥ÏÇ¨ ÏàòÏàòÎ£å (ÏïΩ 30~50ÎßåÏõê Ï∂îÏ†ï)
                const lawyerFee = 400000;

                // Ï±ÑÍ∂åÏÑ§Ï†ïÎπÑÏö© (ÎåÄÏ∂úÏù¥ ÏûàÎäî Í≤ΩÏö∞)
                let mortgageFee = 0;
                if (loan > 0) {
                    // Ï±ÑÍ∂åÏµúÍ≥†Ïï° ÏÑ§Ï†ï (Î≥¥ÌÜµ ÎåÄÏ∂úÍ∏àÏùò 120%)
                    const maxLoan = loan * 1.2;
                    mortgageFee = Math.floor(maxLoan * 0.002); // ÏÑ§Ï†ïÎπÑ 0.2%
                }

                const total = registrationTax + localEduTax + courtStamp + lawyerFee + mortgageFee;

                return { registrationTax, localEduTax, courtStamp, lawyerFee, mortgageFee, total };
            }, [salePrice, loanAmount]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <ClipboardList className="w-4 h-4 mr-2 text-indigo-600" /> Îì±Í∏∞ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Îß§Îß§Í∞ÄÍ≤©" value={salePrice} onChange={setSalePrice} color="violet" />
                        <NumberInput label="ÎåÄÏ∂úÍ∏àÏï° (ÏÑ†ÌÉù)" value={loanAmount} onChange={setLoanAmount} color="violet" />

                        {result && (
                            <div className="mt-4 p-4 bg-indigo-50 rounded-2xl space-y-2 text-sm">
                                <div className="flex justify-between text-slate-600">
                                    <span>Îì±Î°ùÎ©¥ÌóàÏÑ∏</span>
                                    <span>{formatNumber(result.registrationTax)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-slate-600">
                                    <span>ÏßÄÎ∞©ÍµêÏú°ÏÑ∏</span>
                                    <span>{formatNumber(result.localEduTax)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-slate-600">
                                    <span>ÎåÄÎ≤ïÏõê ÏàòÏûÖÏ¶ùÏßÄ</span>
                                    <span>{formatNumber(result.courtStamp)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-slate-600">
                                    <span>Î≤ïÎ¨¥ÏÇ¨ ÏàòÏàòÎ£å (Ï∂îÏ†ï)</span>
                                    <span>ÏïΩ {formatNumber(result.lawyerFee)}Ïõê</span>
                                </div>
                                {result.mortgageFee > 0 && (
                                    <div className="flex justify-between text-slate-600">
                                        <span>Í∑ºÏ†ÄÎãπ ÏÑ§Ï†ïÎπÑ</span>
                                        <span>{formatNumber(result.mortgageFee)}Ïõê</span>
                                    </div>
                                )}
                                <div className="h-px bg-indigo-200 my-2"></div>
                                <div className="flex justify-between font-bold text-indigo-800">
                                    <span>Ï¥ù Îì±Í∏∞ÎπÑÏö©</span>
                                    <span>ÏïΩ {formatNumber(result.total)}Ïõê</span>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 5. Tools Tab & Components
        const UnitConverter = () => {
            const [pyung, setPyung] = useState('');
            const [sqm, setSqm] = useState('');
            const sqmId = useId();
            const pyungId = useId();

            const handleSqmChange = (val) => {
                setSqm(val);
                if (val) setPyung((parseFloat(val) / 3.3058).toFixed(2));
                else setPyung('');
            };

            const handlePyungChange = (val) => {
                setPyung(val);
                if (val) setSqm((parseFloat(val) * 3.3058).toFixed(2));
                else setSqm('');
            };

            return (
                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex items-center gap-6 relative">
                        <div className="flex-1 text-center group">
                            <input
                                id={sqmId}
                                type="number"
                                value={sqm}
                                onChange={e => handleSqmChange(e.target.value)}
                                className="w-full py-6 bg-slate-50 rounded-3xl text-center font-black text-3xl outline-none focus:ring-2 focus:ring-indigo-500 text-slate-800 transition-all group-hover:bg-indigo-50 group-hover:text-indigo-600"
                                placeholder="0"
                            />
                            <label htmlFor={sqmId} className="text-xs font-bold text-slate-400 mt-3 block uppercase tracking-widest">Ï†úÍ≥±ÎØ∏ÌÑ∞ („é°)</label>
                        </div>
                        <div className="bg-slate-100 p-3 rounded-full text-slate-400">
                            <ArrowRightLeft size={20} />
                        </div>
                        <div className="flex-1 text-center group">
                            <input
                                id={pyungId}
                                type="number"
                                value={pyung}
                                onChange={e => handlePyungChange(e.target.value)}
                                className="w-full py-6 bg-slate-50 rounded-3xl text-center font-black text-3xl outline-none focus:ring-2 focus:ring-indigo-500 text-slate-800 transition-all group-hover:bg-indigo-50 group-hover:text-indigo-600"
                                placeholder="0"
                            />
                            <label htmlFor={pyungId} className="text-xs font-bold text-slate-400 mt-3 block uppercase tracking-widest">Ìèâ (py)</label>
                        </div>
                    </div>
                </div>
            );
        }

        const MessageWizard = () => {
            const [msgType, setMsgType] = useState('repair');
            const [copied, setCopied] = useState(false);

            const templates = {
                repair: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÎã§Î¶ÑÏù¥ ÏïÑÎãàÎùº ÏßëÏóê ÏàòÎ¶¨Í∞Ä ÌïÑÏöîÌïú Í≥≥Ïù¥ ÏÉùÍ≤® Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\n- Ï¶ùÏÉÅ: \n- ÏÇ¨ÏßÑ Ï≤®Î∂Ä: (ÏÇ¨ÏßÑ)\n- Î∞©Î¨∏ Í∞ÄÎä• ÏãúÍ∞Ñ: \n\nÎßéÏù¥ Î∞îÏÅòÏãúÍ≤†ÏßÄÎßå ÌôïÏù∏ ÌõÑ ÎãµÎ≥Ä Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.\nÍ∞êÏÇ¨Ìï©ÎãàÎã§.`,
                end: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÍ≥ÑÏïΩ ÎßåÎ£åÏùº(202X.XX.XX)Ïóê ÎßûÏ∂∞ Ïù¥ÏÇ¨Î•º Í≥ÑÌöçÌïòÍ≥† ÏûàÏñ¥ ÎØ∏Î¶¨ Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\nÎ≥¥Ï¶ùÍ∏à Î∞òÌôò ÏùºÏ†ï ÎÖºÏùòÍ∞Ä ÌïÑÏöîÌï† Í≤É Í∞ôÏäµÎãàÎã§.\nÌé∏ÌïòÏã§ Îïå Ïó∞ÎùΩ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.`,
                extend: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÍ≥ÑÏïΩ ÎßåÎ£åÍ∞Ä Îã§Í∞ÄÏò§ÎäîÎç∞, ÌòπÏãú Ïó∞Ïû•ÌïòÏó¨ Îçî Í±∞Ï£ºÌï† Ïàò ÏûàÏùÑÏßÄ Ïó¨Ï≠àÏñ¥Î≥¥Í≥†Ïûê Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\nÏ°∞Í±¥ Î≥ÄÎèôÏÇ¨Ìï≠Ïù¥ ÏûàÎã§Î©¥ ÎßêÏîÄ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.\nÍ∞êÏÇ¨Ìï©ÎãàÎã§.`
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(templates[msgType]);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
                        {[{ id: 'repair', label: 'üõ† ÏàòÎ¶¨ ÏöîÏ≤≠' }, { id: 'end', label: 'üëã Ìá¥Í±∞ ÌÜµÎ≥¥' }, { id: 'extend', label: 'ü§ù Ïó∞Ïû• ÏöîÏ≤≠' }].map(t => (
                            <button
                                key={t.id}
                                onClick={() => setMsgType(t.id)}
                                className={`px-4 py-2.5 rounded-full whitespace-nowrap text-xs font-bold transition-all border ${msgType === t.id ? 'bg-pink-50 text-pink-600 border-pink-200 shadow-sm' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`}
                            >
                                {t.label}
                            </button>
                        ))}
                    </div>

                    <div className="relative group">
                        <textarea
                            className="w-full h-56 p-6 bg-slate-50 rounded-3xl border-0 text-sm leading-7 resize-none focus:ring-2 focus:ring-pink-500 outline-none text-slate-700 font-medium transition-all group-hover:bg-white group-hover:shadow-inner"
                            value={templates[msgType]}
                            readOnly
                        ></textarea>
                        <button
                            onClick={copyToClipboard}
                            className={`absolute bottom-5 right-5 px-5 py-2.5 rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg ${copied ? 'bg-green-500 text-white transform scale-105' : 'bg-slate-900 hover:bg-black text-white'}`}
                        >
                            {copied ? <CheckCircle size={14} /> : <Copy size={14} />} {copied ? 'Î≥µÏÇ¨ ÏôÑÎ£å' : 'ÌÖçÏä§Ìä∏ Î≥µÏÇ¨'}
                        </button>
                    </div>
                </div>
            );
        }

        const MovingChecklist = () => {
            const [checked, setChecked] = usePersistedState('checklist', {});

            const toggle = (id) => {
                setChecked(prev => ({ ...prev, [id]: !prev[id] }));
            }

            const sections = [
                { title: 'D-30 (Ìïú Îã¨ Ï†Ñ)', items: ['Ïßë ÎÇ¥ÎÜìÍ∏∞ / ÎßåÍ∏∞ ÌÜµÎ≥¥', 'Ïù¥ÏÇ¨ÏóÖÏ≤¥ ÏïåÏïÑÎ≥¥Í∏∞', 'Í∞ÄÍµ¨/Í∞ÄÏ†Ñ Î∞∞Ïπò Íµ¨ÏÉÅ'] },
                { title: 'D-14 (2Ï£º Ï†Ñ)', items: ['Ï£ºÏÜå Î≥ÄÍ≤Ω (Ïö∞Ìé∏Î¨º)', 'ÌèêÍ∏∞Î¨º Ïä§Ìã∞Ïª§ Íµ¨Îß§', 'ÏûÖÏ£º Ï≤≠ÏÜå ÏòàÏïΩ', 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏòàÏïΩ'] },
                { title: 'D-1 (Ï†ÑÎÇ†)', items: ['Í∑ÄÏ§ëÌíà Î≥ÑÎèÑ Î≥¥Í¥Ä', 'ÏÑ∏ÌÉÅÍ∏∞ Î¨º ÎπºÍ∏∞', 'Ïì∞Î†àÍ∏∞ Î¥âÌà¨ Ï§ÄÎπÑ', 'ÌòÑÍ∏à Ï§ÄÎπÑ (ÏûîÍ∏àÏö©)'] },
                { title: 'D-Day (Ïù¥ÏÇ¨ ÎãπÏùº)', items: ['Í≥µÍ≥ºÍ∏à Ï†ïÏÇ∞ (ÏàòÎèÑ/Ï†ÑÍ∏∞)', 'Î∂ÄÎèôÏÇ∞ ÏûîÍ∏à ÏπòÎ•¥Í∏∞', 'Ï†ÑÏûÖ Ïã†Í≥† / ÌôïÏ†ï ÏùºÏûê', 'Ïù∏ÌÑ∞ÎÑ∑ Ïù¥Ï†Ñ ÏÑ§Ïπò'] }
            ];

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="space-y-8">
                        {sections.map((section, sIdx) => (
                            <div key={sIdx}>
                                <h4 className="text-xs font-bold text-amber-600 bg-amber-50 inline-block px-3 py-1 rounded-lg mb-3">{section.title}</h4>
                                <div className="space-y-2">
                                    {section.items.map((item, iIdx) => {
                                        const id = `${sIdx}-${iIdx}`;
                                        const isChecked = checked[id];
                                        return (
                                            <div
                                                key={id}
                                                onClick={() => toggle(id)}
                                                className={`flex items-center p-3.5 rounded-xl cursor-pointer transition-all group ${isChecked ? 'bg-slate-50 text-slate-400' : 'bg-white border border-slate-100 hover:border-amber-200 hover:shadow-sm'}`}
                                            >
                                                <div className={`w-5 h-5 rounded-md border-2 flex items-center justify-center mr-3 transition-colors ${isChecked ? 'bg-amber-400 border-amber-400' : 'border-slate-300 group-hover:border-amber-400'}`}>
                                                    {isChecked && <CheckSquare size={14} className="text-white" />}
                                                </div>
                                                <span className={`text-sm font-medium ${isChecked ? 'line-through decoration-slate-300' : 'text-slate-700'}`}>{item}</span>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )
        }

        const Dictionary = () => {
            const [searchTerm, setSearchTerm] = useState('');

            const terms = [
                { t: 'ÎåÄÌï≠Î†•', d: 'ÏßëÏ£ºÏù∏Ïù¥ Î∞îÎÄåÏñ¥ÎèÑ Í≥ÑÏÜç ÏÇ¥ Ïàò ÏûàÍ≥†, Î≥¥Ï¶ùÍ∏àÏùÑ ÎèåÎ†§Î∞õÏùÑ ÎïåÍπåÏßÄ ÎÇòÍ∞ÄÏßÄ ÏïäÏïÑÎèÑ ÎêòÎäî Í∂åÎ¶¨.' },
                { t: 'Ïö∞ÏÑ†Î≥ÄÏ†úÍ∂å', d: 'ÏßëÏù¥ Í≤ΩÎß§Î°ú ÎÑòÏñ¥Í∞îÏùÑ Îïå, ÌõÑÏàúÏúÑ Í∂åÎ¶¨ÏûêÎ≥¥Îã§ Î®ºÏ†Ä ÎèàÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Í∂åÎ¶¨. (ÌôïÏ†ïÏùºÏûê ÌïÑÏàò)' },
                { t: 'Í∑ºÏ†ÄÎãπÍ∂å', d: 'ÏßëÏ£ºÏù∏Ïù¥ ÏßëÏùÑ Îã¥Î≥¥Î°ú ÎπöÏùÑ Ï°åÎã§Îäî Îúª. Îì±Í∏∞Î∂ÄÎì±Î≥∏Ïùò Ï±ÑÍ∂åÏµúÍ≥†Ïï° ÌôïÏù∏Ïù¥ Ï§ëÏöîÌï®.' },
                { t: 'ÌôïÏ†ïÏùºÏûê', d: 'Í≥ÑÏïΩÏÑúÍ∞Ä Ï°¥Ïû¨Ìï®ÏùÑ Ï¶ùÎ™ÖÌïòÎäî Î≤ïÏ†Å ÎÇ†Ïßú. Ï£ºÎØºÏÑºÌÑ∞ÎÇò Îì±Í∏∞ÏÜåÏóêÏÑú Î∞õÏùå.' },
                { t: 'Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò', d: 'Ï†ÑÏÑ∏Í∏àÏùÑ Î™ª ÎèåÎ†§Î∞õÏùÑ Îïå Î≥¥Ï¶ù Í∏∞Í¥Ä(HUG Îì±)Ïù¥ ÎåÄÏã† Í∞öÏïÑÏ£ºÎäî ÏÉÅÌíà.' },
                { t: 'ÏûÑÏ∞®Í∂åÎì±Í∏∞', d: 'Ïù¥ÏÇ¨Î•º Í∞ÄÎçîÎùºÎèÑ ÎåÄÌï≠Î†•Í≥º Ïö∞ÏÑ†Î≥ÄÏ†úÍ∂åÏùÑ Ïú†ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Îì±Í∏∞Î∂ÄÏóê Í∏∞Î°ùÌïòÎäî Í≤É.' }
            ];

            const filtered = terms.filter(item => item.t.includes(searchTerm));

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2 h-[500px] flex flex-col">
                    <div className="relative mb-6">
                        <input
                            type="text"
                            placeholder="Í∂ÅÍ∏àÌïú Ïö©Ïñ¥ Í≤ÄÏÉâ..."
                            className="w-full pl-11 pr-4 py-4 bg-slate-50 rounded-2xl border-0 outline-none focus:ring-2 focus:ring-cyan-400 text-sm font-bold text-slate-800 transition-all focus:bg-white"
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                    </div>

                    <div className="space-y-3 overflow-y-auto pr-2 custom-scrollbar flex-1">
                        {filtered.length > 0 ? filtered.map((item, idx) => (
                            <div key={idx} className="bg-cyan-50/30 p-5 rounded-2xl border border-cyan-100/50 hover:bg-cyan-50/80 transition-colors">
                                <h4 className="font-bold text-cyan-900 mb-1.5">{item.t}</h4>
                                <p className="text-sm text-slate-600 leading-relaxed font-medium">{item.d}</p>
                            </div>
                        )) : (
                            <div className="text-center py-10 text-slate-400 text-sm font-medium">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
                        )}
                    </div>
                </div>
            )
        }

        // Ï†ÑÏõîÏÑ∏Ï†ÑÌôòÏú® Í≥ÑÏÇ∞Í∏∞
        const ConversionCalculator = () => {
            const [mode, setMode] = useState('toMonthly'); // toMonthly or toDeposit
            const [deposit, setDeposit] = useState('');
            const [monthly, setMonthly] = useState('');
            const [rate, setRate] = useState('5.0');

            const result = useMemo(() => {
                const rateVal = parseFloat(rate) || 0;
                if (mode === 'toMonthly') {
                    const depVal = parseNumber(deposit);
                    return calculateConversion(depVal, rateVal);
                } else {
                    const monVal = parseNumber(monthly);
                    return calculateDepositFromMonthly(monVal, rateVal);
                }
            }, [mode, deposit, monthly, rate]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex gap-2 mb-6">
                        <button
                            onClick={() => setMode('toMonthly')}
                            className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${mode === 'toMonthly' ? 'bg-violet-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'}`}
                        >
                            Î≥¥Ï¶ùÍ∏à ‚Üí ÏõîÏÑ∏
                        </button>
                        <button
                            onClick={() => setMode('toDeposit')}
                            className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${mode === 'toDeposit' ? 'bg-violet-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'}`}
                        >
                            ÏõîÏÑ∏ ‚Üí Î≥¥Ï¶ùÍ∏à
                        </button>
                    </div>

                    <div className="space-y-4">
                        {mode === 'toMonthly' ? (
                            <NumberInput label="Ï†ÑÌôòÌï† Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="violet" />
                        ) : (
                            <NumberInput label="Ï†ÑÌôòÌï† ÏõîÏÑ∏" value={monthly} onChange={setMonthly} color="violet" />
                        )}

                        <div>
                            <label className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 block ml-1">Ï†ÑÌôòÏú® (%)</label>
                            <input
                                type="number"
                                value={rate}
                                onChange={(e) => setRate(e.target.value)}
                                className="w-full px-5 py-4 text-right bg-slate-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-violet-500 font-bold text-slate-700 text-lg"
                            />
                            <p className="text-xs text-slate-400 mt-2 ml-1">* Î≤ïÏ†ï Ï†ÑÌôòÏú® ÏÉÅÌïú: Í∏∞Ï§ÄÍ∏àÎ¶¨({BOK_RATE_DEFAULT}%) + 3.5% = {(BOK_RATE_DEFAULT + 3.5).toFixed(1)}%</p>
                        </div>
                    </div>

                    <div className="mt-6 p-6 bg-gradient-to-r from-violet-50 to-purple-50 rounded-2xl">
                        <p className="text-sm font-medium text-violet-600 mb-2">
                            {mode === 'toMonthly' ? 'Ï†ÑÌôò Ïãú ÏõîÏÑ∏ Í∏àÏï°' : 'Ï†ÑÌôò Ïãú Î≥¥Ï¶ùÍ∏à Í∏àÏï°'}
                        </p>
                        <p className="text-3xl font-black text-violet-900">
                            {formatNumber(result)} <span className="text-lg font-bold">Ïõê</span>
                        </p>
                        {mode === 'toMonthly' && result > 0 && (
                            <p className="text-xs text-slate-500 mt-2">
                                Ïó∞Í∞Ñ {formatNumber(result * 12)}Ïõê Ï∂îÍ∞Ä ÏßÄÏ∂ú
                            </p>
                        )}
                    </div>
                </div>
            );
        };

        // Î≥¥Ï¶ùÎ≥¥ÌóòÎ£å Í≥ÑÏÇ∞Í∏∞
        const InsuranceCalculator = () => {
            const [deposit, setDeposit] = useState('');
            const [years, setYears] = useState('2');
            const [insuranceType, setInsuranceType] = useState('hug');

            const result = useMemo(() => {
                const depVal = parseNumber(deposit);
                const yearsVal = parseInt(years) || 1;

                // Î≥¥ÌóòÎ£åÏú® (Ïã§Ï†úÎäî Î≥¥Ï¶ùÍ∏à, ÏßÄÏó≠, Ï£ºÌÉù Ïú†ÌòïÏóê Îî∞Îùº Îã§Î¶Ñ)
                const rates = {
                    hug: 0.00128,      // HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò ÌèâÍ∑† 0.128%
                    sgi: 0.00115,      // SGIÏÑúÏö∏Î≥¥Ï¶ù ÌèâÍ∑† 0.115%
                    rental: 0.0005    // ÏûÑÏ∞®Í∂åÎì±Í∏∞ ÎπÑÏö© ÏïΩ 0.05%
                };

                const rate = rates[insuranceType] || rates.hug;
                const fee = Math.floor(depVal * rate * yearsVal);
                const monthlyFee = Math.floor(fee / (yearsVal * 12));

                return { fee, monthlyFee, rate: rate * 100 };
            }, [deposit, years, insuranceType]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                        {[
                            { id: 'hug', label: 'HUG Ï†ÑÏÑ∏Î≥¥Ï¶ù' },
                            { id: 'sgi', label: 'SGI Ï†ÑÏÑ∏Î≥¥Ï¶ù' },
                            { id: 'rental', label: 'ÏûÑÏ∞®Í∂åÎì±Í∏∞' }
                        ].map(t => (
                            <button
                                key={t.id}
                                onClick={() => setInsuranceType(t.id)}
                                className={`flex-1 py-3 px-3 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${insuranceType === t.id ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'}`}
                            >
                                {t.label}
                            </button>
                        ))}
                    </div>

                    <div className="space-y-4">
                        <NumberInput label="Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="green" enableUnitToggle={true} />

                        <div>
                            <label className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 block ml-1">Í≥ÑÏïΩ Í∏∞Í∞Ñ (ÎÖÑ)</label>
                            <div className="flex gap-2">
                                {OPTIONS_YEARS.map(y => (
                                    <button
                                        key={y}
                                        onClick={() => setYears(y)}
                                        className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${years === y ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >
                                        {y}ÎÖÑ
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="mt-6 p-6 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl">
                        <div className="flex justify-between items-center mb-4">
                            <span className="text-sm font-medium text-emerald-600">ÏòàÏÉÅ Î≥¥ÌóòÎ£å (ÏöîÏú® {result.rate.toFixed(3)}%)</span>
                            <span className="text-2xl font-black text-emerald-900">{formatNumber(result.fee)}Ïõê</span>
                        </div>
                        <div className="flex justify-between items-center text-sm">
                            <span className="text-slate-500">Ïõî ÌôòÏÇ∞</span>
                            <span className="font-bold text-slate-700">ÏïΩ {formatNumber(result.monthlyFee)}Ïõê/Ïõî</span>
                        </div>
                        <p className="text-xs text-slate-400 mt-4">
                            * Ïã§Ï†ú Î≥¥ÌóòÎ£åÎäî Ï£ºÌÉù Ïú†Ìòï, ÏßÄÏó≠, Î≥¥Ï¶ùÍ∏à Íµ¨Í∞ÑÏóê Îî∞Îùº ÏÉÅÏù¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                </div>
            );
        };

        // Í≥ÑÏÇ∞ ÌûàÏä§ÌÜ†Î¶¨
        const HistoryPanel = () => {
            const [history, setHistory] = useState(() => getHistory());

            const handleClear = () => {
                clearHistory();
                setHistory([]);
            };

            const typeLabels = {
                'costCompare': 'Ï†ÑÏõîÏÑ∏ ÎπÑÍµê',
                'safety': 'ÏïàÏ†ÑÏßÑÎã®',
                'fee': 'Ï§ëÍ∞úÎ≥¥Ïàò',
                'loan': 'ÎåÄÏ∂úÍ≥ÑÏÇ∞',
                'tax': 'Ï∑®ÎìùÏÑ∏',
                'dsr': 'DSRÍ≥ÑÏÇ∞',
                'ltv': 'LTVÍ≥ÑÏÇ∞'
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="font-bold text-slate-800 flex items-center gap-2">
                            <History size={18} /> ÏµúÍ∑º Í≥ÑÏÇ∞ Í∏∞Î°ù
                        </h3>
                        {history.length > 0 && (
                            <button
                                onClick={handleClear}
                                className="text-xs text-red-500 hover:text-red-600 font-bold flex items-center gap-1"
                            >
                                <Trash2 size={14} /> Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                            </button>
                        )}
                    </div>

                    {history.length === 0 ? (
                        <div className="text-center py-12 text-slate-400">
                            <History size={40} className="mx-auto mb-3 opacity-30" />
                            <p className="text-sm font-medium">Í≥ÑÏÇ∞ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            <p className="text-xs mt-1">Í≥ÑÏÇ∞ Í≤∞Í≥ºÍ∞Ä ÏûêÎèôÏúºÎ°ú Ï†ÄÏû•Îê©ÎãàÎã§</p>
                        </div>
                    ) : (
                        <div className="space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar">
                            {history.map((item, idx) => (
                                <div key={idx} className="p-4 bg-slate-50 rounded-xl">
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">
                                            {typeLabels[item.type] || item.type}
                                        </span>
                                        <span className="text-xs text-slate-400">{formatDate(item.timestamp)}</span>
                                    </div>
                                    <p className="text-sm font-medium text-slate-700">
                                        {item.data.summary || JSON.stringify(item.data).slice(0, 50)}
                                    </p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // NEW: Ïù¥ÏÇ¨ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞
        const MovingCostCalculator = () => {
            const [fromFloor, setFromFloor] = useState('5');
            const [toFloor, setToFloor] = useState('10');
            const [distance, setDistance] = useState('10');
            const [size, setSize] = useState('2');

            const result = useMemo(() => {
                const from = parseInt(fromFloor) || 1;
                const to = parseInt(toFloor) || 1;
                const dist = parseInt(distance) || 0;
                const sizeNum = parseInt(size) || 1;

                const baseCost = { 1: 250000, 2: 350000, 3: 450000, 4: 600000 };
                const base = baseCost[sizeNum] || 350000;
                const floorCharge = (Math.max(from - 1, 0) + Math.max(to - 1, 0)) * 10000;
                const distCharge = dist > 10 ? (dist - 10) * 5000 : 0;
                const ladderCharge = (from > 5 || to > 5) ? 100000 : 0;

                const minCost = base + floorCharge + distCharge;
                const maxCost = minCost + ladderCharge + 150000;

                return { minCost, maxCost, ladderCharge };
            }, [fromFloor, toFloor, distance, size]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">üöö Ïù¥ÏÇ¨ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞</h4>
                    <div className="space-y-4">
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-500 block mb-1">Ï∂úÎ∞úÏ∏µ</label>
                                <input type="number" value={fromFloor} onChange={e => setFromFloor(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÎèÑÏ∞©Ï∏µ</label>
                                <input type="number" value={toFloor} onChange={e => setToFloor(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">Ïù¥ÎèôÍ±∞Î¶¨ (km)</label>
                            <input type="number" value={distance} onChange={e => setDistance(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">Ïßê Í∑úÎ™®</label>
                            <div className="flex gap-2">
                                {['1', '2', '3', '4'].map(s => (
                                    <button key={s} onClick={() => setSize(s)} className={`flex-1 py-2 rounded-xl text-xs font-bold ${size === s ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-500'}`}>{s}Î£∏</button>
                                ))}
                            </div>
                        </div>
                        <div className="p-4 bg-orange-50 rounded-2xl">
                            <p className="text-sm text-orange-600 mb-1">ÏòàÏÉÅ Ïù¥ÏÇ¨ÎπÑ</p>
                            <p className="text-2xl font-black text-orange-800">{formatNumber(result.minCost)} ~ {formatNumber(result.maxCost)}Ïõê</p>
                            {result.ladderCharge > 0 && <p className="text-xs text-orange-500 mt-1">* ÏÇ¨Îã§Î¶¨Ï∞® ÎπÑÏö© Ìè¨Ìï®</p>}
                        </div>
                    </div>
                </div>
            );
        };

        // NEW: Ïù∏ÌÖåÎ¶¨Ïñ¥ ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞
        const InteriorCostCalculator = () => {
            const [pyung, setPyung] = useState('25');
            const [scope, setScope] = useState('full');

            const result = useMemo(() => {
                const py = parseInt(pyung) || 0;
                const costs = {
                    full: { low: 400, mid: 600, high: 900 },
                    kitchen: { low: 150, mid: 250, high: 400 },
                    bathroom: { low: 100, mid: 180, high: 300 },
                    living: { low: 80, mid: 120, high: 200 }
                };
                const c = costs[scope] || costs.full;
                return {
                    low: py * c.low * 10000,
                    mid: py * c.mid * 10000,
                    high: py * c.high * 10000
                };
            }, [pyung, scope]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">üî® Ïù∏ÌÖåÎ¶¨Ïñ¥ ÎπÑÏö© Í≥ÑÏÇ∞Í∏∞</h4>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">ÌèâÏàò</label>
                            <input type="number" value={pyung} onChange={e => setPyung(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">ÏãúÍ≥µ Î≤îÏúÑ</label>
                            <div className="grid grid-cols-2 gap-2">
                                {[{ id: 'full', l: 'Ï†ÑÏ≤¥Î¶¨Î™®Îç∏ÎßÅ' }, { id: 'kitchen', l: 'Ï£ºÎ∞©' }, { id: 'bathroom', l: 'ÏöïÏã§' }, { id: 'living', l: 'Í±∞Ïã§/Î∞©' }].map(s => (
                                    <button key={s.id} onClick={() => setScope(s.id)} className={`py-2 rounded-xl text-xs font-bold ${scope === s.id ? 'bg-pink-500 text-white' : 'bg-slate-100 text-slate-500'}`}>{s.l}</button>
                                ))}
                            </div>
                        </div>
                        <div className="grid grid-cols-3 gap-2">
                            <div className="p-3 bg-slate-100 rounded-xl text-center">
                                <p className="text-[10px] text-slate-500 mb-1">Ï†ÄÍ∞Ä</p>
                                <p className="font-black text-slate-700">{formatCompactNumber(result.low)}</p>
                            </div>
                            <div className="p-3 bg-pink-50 rounded-xl text-center">
                                <p className="text-[10px] text-pink-500 mb-1">Ï§ëÍ∞Ñ</p>
                                <p className="font-black text-pink-700">{formatCompactNumber(result.mid)}</p>
                            </div>
                            <div className="p-3 bg-slate-100 rounded-xl text-center">
                                <p className="text-[10px] text-slate-500 mb-1">Í≥†Í∏â</p>
                                <p className="font-black text-slate-700">{formatCompactNumber(result.high)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // NEW: Í¥ÄÎ¶¨ÎπÑ Î∂ÑÏÑùÍ∏∞
        const MaintenanceFeeAnalyzer = () => {
            const [fee, setFee] = useState('');
            const [area, setArea] = useState('');

            const result = useMemo(() => {
                const f = parseNumber(fee);
                const a = parseFloat(area) || 0;
                if (!f || !a) return null;
                const pyung = a / 3.3058;
                const perPyung = Math.round(f / pyung);
                let status = 'Ï†ÅÏ†ï', color = 'emerald';
                if (perPyung > 15000) { status = 'ÎÜíÏùå'; color = 'red'; }
                else if (perPyung > 10000) { status = 'Î≥¥ÌÜµ'; color = 'orange'; }
                return { perPyung, status, color, pyung: pyung.toFixed(1) };
            }, [fee, area]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4">üìä Í¥ÄÎ¶¨ÎπÑ Î∂ÑÏÑùÍ∏∞</h4>
                    <div className="space-y-4">
                        <NumberInput label="Ïõî Í¥ÄÎ¶¨ÎπÑ" value={fee} onChange={setFee} color="green" />
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">Ï†ÑÏö©Î©¥Ï†Å („é°)</label>
                            <input type="number" value={area} onChange={e => setArea(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                        </div>
                        {result && (
                            <div className={`p-4 bg-${result.color}-50 rounded-2xl`}>
                                <div className="flex justify-between items-center">
                                    <span className="text-sm text-slate-600">ÌèâÎãπ Í¥ÄÎ¶¨ÎπÑ</span>
                                    <span className="text-xl font-black">{formatNumber(result.perPyung)}Ïõê</span>
                                </div>
                                <p className="text-xs text-slate-500 mt-2">ÏïΩ {result.pyung}Ìèâ Í∏∞Ï§Ä | ÏàòÏ§Ä: <span className="font-bold">{result.status}</span></p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // NEW: ÎåÄÏ∂ú Ï°∞Í∏∞ÏÉÅÌôò Î∂ÑÏÑù
        const EarlyRepaymentAnalyzer = () => {
            const [balance, setBalance] = useState('');
            const [rate, setRate] = useState('4.5');
            const [remaining, setRemaining] = useState('120');
            const [repayAmount, setRepayAmount] = useState('');
            const [feeRate, setFeeRate] = useState('1.2');

            const result = useMemo(() => {
                const bal = parseNumber(balance);
                const rep = parseNumber(repayAmount);
                const r = parseFloat(rate) / 100;
                const months = parseInt(remaining) || 0;
                const fr = parseFloat(feeRate) / 100;
                if (!bal || !rep) return null;

                const fee = Math.floor(rep * fr);
                const savedInterest = Math.floor(rep * r * (months / 12));
                const netBenefit = savedInterest - fee;

                return { fee, savedInterest, netBenefit, isWorth: netBenefit > 0 };
            }, [balance, rate, remaining, repayAmount, feeRate]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4">üí∞ Ï°∞Í∏∞ÏÉÅÌôò Î∂ÑÏÑù</h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎåÄÏ∂ú ÏûîÏï°" value={balance} onChange={setBalance} color="violet" />
                        <NumberInput label="Ï°∞Í∏∞ÏÉÅÌôò Í∏àÏï°" value={repayAmount} onChange={setRepayAmount} color="violet" />
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-500 block mb-1">Í∏àÎ¶¨(%)</label>
                                <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÎÇ®ÏùÄÍ∏∞Í∞Ñ(Ïõî)</label>
                                <input type="number" value={remaining} onChange={e => setRemaining(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÏàòÏàòÎ£å(%)</label>
                                <input type="number" value={feeRate} onChange={e => setFeeRate(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                        {result && (
                            <div className={`p-4 rounded-2xl ${result.isWorth ? 'bg-green-50' : 'bg-red-50'}`}>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between"><span>Ï°∞Í∏∞ÏÉÅÌôò ÏàòÏàòÎ£å</span><span className="font-bold text-red-600">-{formatNumber(result.fee)}Ïõê</span></div>
                                    <div className="flex justify-between"><span>Ï†àÍ∞ê Ïù¥Ïûê</span><span className="font-bold text-green-600">+{formatNumber(result.savedInterest)}Ïõê</span></div>
                                    <div className="h-px bg-slate-200"></div>
                                    <div className="flex justify-between font-bold text-lg">
                                        <span>ÏàúÏù¥Ïùµ</span>
                                        <span className={result.isWorth ? 'text-green-600' : 'text-red-600'}>{result.netBenefit > 0 ? '+' : ''}{formatNumber(result.netBenefit)}Ïõê</span>
                                    </div>
                                </div>
                                <p className="text-xs mt-3 text-center font-bold">{result.isWorth ? '‚úÖ Ï°∞Í∏∞ÏÉÅÌôò Ïú†Î¶¨' : '‚ùå Ï°∞Í∏∞ÏÉÅÌôò Î∂àÎ¶¨'}</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // NEW: Í≥ÑÏïΩ Í¥ÄÎ¶¨ ÎåÄÏãúÎ≥¥Îìú (Phase 3)
        const ContractManager = () => {
            const [contracts, setContracts] = usePersistedState('contracts', []);

            const addContract = () => {
                if (!newContract.name || !newContract.endDate) return;
                setContracts([...contracts, { ...newContract, id: Date.now() }]);
                setNewContract({ name: '', startDate: '', endDate: '', deposit: '', rent: '' });
                setShowForm(false);
            };

            const deleteContract = (id) => setContracts(contracts.filter(c => c.id !== id));

            const getDDay = (endDate) => {
                const diff = new Date(endDate) - new Date();
                return Math.ceil(diff / (1000 * 60 * 60 * 24));
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex justify-between items-center mb-4">
                        <h4 className="text-sm font-bold text-slate-800">üìã Í≥ÑÏïΩ Í¥ÄÎ¶¨</h4>
                        <button onClick={() => setShowForm(!showForm)} className="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg">{showForm ? 'Îã´Í∏∞' : '+ Ï∂îÍ∞Ä'}</button>
                    </div>
                    {showForm && (
                        <div className="mb-4 p-4 bg-slate-50 rounded-2xl space-y-3">
                            <input placeholder="Í≥ÑÏïΩÎ™Ö (Ïòà: Ïó≠ÏÇºÎèô Ïò§ÌîºÏä§ÌÖî)" value={newContract.name} onChange={e => setNewContract({ ...newContract, name: e.target.value })} className="w-full px-3 py-2 bg-white rounded-xl text-sm font-medium outline-none" />
                            <div className="flex gap-2">
                                <input type="date" value={newContract.startDate} onChange={e => setNewContract({ ...newContract, startDate: e.target.value })} className="flex-1 px-3 py-2 bg-white rounded-xl text-sm font-medium outline-none" />
                                <input type="date" value={newContract.endDate} onChange={e => setNewContract({ ...newContract, endDate: e.target.value })} className="flex-1 px-3 py-2 bg-white rounded-xl text-sm font-medium outline-none" />
                            </div>
                            <button onClick={addContract} className="w-full py-2 bg-blue-500 text-white rounded-xl font-bold text-sm">Ï†ÄÏû•</button>
                        </div>
                    )}
                    {contracts.length === 0 ? (
                        <div className="text-center py-8 text-slate-400 text-sm">Îì±Î°ùÎêú Í≥ÑÏïΩÏù¥ ÏóÜÏäµÎãàÎã§</div>
                    ) : (
                        <div className="space-y-3">
                            {contracts.map(c => {
                                const dday = getDDay(c.endDate);
                                const isUrgent = dday <= 60 && dday > 0;
                                const isExpired = dday <= 0;
                                return (
                                    <div key={c.id} className={`p-4 rounded-xl ${isExpired ? 'bg-red-50' : isUrgent ? 'bg-orange-50' : 'bg-slate-50'}`}>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="font-bold text-sm">{c.name}</p>
                                                <p className="text-xs text-slate-500">{c.startDate} ~ {c.endDate}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className={`text-lg font-black ${isExpired ? 'text-red-600' : isUrgent ? 'text-orange-600' : 'text-blue-600'}`}>D{dday > 0 ? '-' : '+'}{Math.abs(dday)}</p>
                                                <button onClick={() => deleteContract(c.id)} className="text-xs text-red-400">ÏÇ≠Ï†ú</button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        // NEW: Îß§Î¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ (Phase 4)
        const PropertyChecklistTool = () => {
            const [checked, setChecked] = usePersistedState('propertyChecklist', {});

            const toggle = (id) => setChecked(prev => ({ ...prev, [id]: !prev[id] }));
            const resetAll = () => setChecked({});

            const categories = [
                { title: 'üè† Ïô∏Î∂Ä/Í≥µÏö©', items: ['ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏÉÅÌÉú', 'Î≥µÎèÑ Ï≤≠Í≤∞ÎèÑ', 'Ï£ºÏ∞®Ïû• ÏÉÅÌÉú', 'CCTV ÏÑ§Ïπò Ïó¨Î∂Ä', 'ÌÉùÎ∞∞Ìï®/Ïö∞Ìé∏Ìï®'] },
                { title: 'üöø ÏàòÎèÑ/Î∞∞Ïàò', items: ['ÏàòÏïï ÌÖåÏä§Ìä∏', 'Ïò®Ïàò ÏûëÎèô', 'Î∞∞ÏàòÍµ¨ ÎÉÑÏÉà', 'ÌôîÏû•Ïã§ Î¨º ÎÇ¥Î¶º', 'ÎàÑÏàò ÌùîÏ†Å'] },
                { title: 'üí° Ï†ÑÍ∏∞/Í∞ÄÏä§', items: ['ÏΩòÏÑºÌä∏ ÏûëÎèô', 'Ï†ÑÎì± Ï†êÎì±', 'Í∞ÄÏä§Î†åÏßÄ Ï†êÌôî', 'Î≥¥ÏùºÎü¨ ÏûëÎèô', 'ÏóêÏñ¥Ïª® ÏÑ§Ïπò Í∞ÄÎä•'] },
                { title: 'ü™ü Ï∞ΩÎ¨∏/ÌôòÍ∏∞', items: ['Ï∞ΩÎ¨∏ Í∞úÌèê', 'Î∞©Ï∂©Îßù ÏÉÅÌÉú', 'Í≥∞Ìå°Ïù¥ ÌùîÏ†Å', 'Í≤∞Î°ú ÌòÑÏÉÅ', 'ÌôòÍ∏∞ ÏãúÏÑ§'] },
                { title: 'üìã Í∏∞ÌÉÄ', items: ['Î≤ΩÏßÄ ÏÉÅÌÉú', 'Ïû•Ìåê/ÎßàÎ£® ÏÉÅÌÉú', 'ÎèÑÏñ¥ÎùΩ ÏÉÅÌÉú', 'Ïù∏ÌÑ∞Ìè∞ ÏûëÎèô', 'ÏòµÏÖò ÏÉÅÌÉú'] }
            ];

            const total = categories.reduce((sum, c) => sum + c.items.length, 0);
            const done = Object.values(checked).filter(Boolean).length;

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2 h-[500px] flex flex-col">
                    <div className="flex justify-between items-center mb-4">
                        <h4 className="text-sm font-bold text-slate-800">üîç Îß§Î¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h4>
                        <div className="flex items-center gap-2">
                            <span className="text-xs font-bold text-green-600">{done}/{total}</span>
                            <button onClick={resetAll} className="text-xs text-red-500 font-bold">Ï¥àÍ∏∞Ìôî</button>
                        </div>
                    </div>
                    <div className="w-full bg-slate-200 rounded-full h-2 mb-4">
                        <div className="bg-green-500 h-2 rounded-full transition-all" style={{ width: `${(done / total) * 100}%` }}></div>
                    </div>
                    <div className="flex-1 overflow-y-auto space-y-4 pr-2">
                        {categories.map((cat, cIdx) => (
                            <div key={cIdx}>
                                <h5 className="text-xs font-bold text-slate-600 mb-2">{cat.title}</h5>
                                <div className="grid grid-cols-2 gap-2">
                                    {cat.items.map((item, iIdx) => {
                                        const id = `${cIdx}-${iIdx}`;
                                        return (
                                            <button key={id} onClick={() => toggle(id)} className={`py-2 px-3 rounded-lg text-xs font-medium text-left transition-all ${checked[id] ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'}`}>
                                                {checked[id] ? '‚úì ' : ''}{item}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // NEW: ÏÑ∏Í∏à Ï∫òÎ¶∞Îçî (Phase 4)
        const TaxCalendar = () => {
            const taxEvents = [
                { month: 1, title: 'ÏûêÎèôÏ∞®ÏÑ∏ 1Í∏∞Î∂Ñ', desc: '6Ïõî ÎÇ©Î∂Ä (1~6ÏõîÎ∂Ñ)' },
                { month: 6, title: 'Ïû¨ÏÇ∞ÏÑ∏ 1Í∏∞Î∂Ñ', desc: '7/16~7/31 ÎÇ©Î∂Ä' },
                { month: 7, title: 'Ïû¨ÏÇ∞ÏÑ∏ 1Í∏∞Î∂Ñ ÎÇ©Î∂Ä', desc: 'ÏÇ∞Ï∂úÏÑ∏Ïï° 50%' },
                { month: 9, title: 'Ïû¨ÏÇ∞ÏÑ∏ 2Í∏∞Î∂Ñ ÎÇ©Î∂Ä', desc: 'ÏÇ∞Ï∂úÏÑ∏Ïï° 50%' },
                { month: 11, title: 'Ï¢ÖÎ∂ÄÏÑ∏ Í≥†ÏßÄ', desc: '12/1~12/15 ÎÇ©Î∂Ä' },
                { month: 12, title: 'Ï¢ÖÎ∂ÄÏÑ∏ ÎÇ©Î∂Ä', desc: '12/1~12/15' }
            ];

            const currentMonth = new Date().getMonth() + 1;

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4">üìÖ 2026ÎÖÑ ÏÑ∏Í∏à Ï∫òÎ¶∞Îçî</h4>
                    <div className="space-y-3">
                        {taxEvents.map((event, idx) => {
                            const isPast = event.month < currentMonth;
                            const isCurrent = event.month === currentMonth;
                            return (
                                <div key={idx} className={`p-3 rounded-xl flex items-center gap-3 ${isCurrent ? 'bg-blue-50 border-2 border-blue-200' : isPast ? 'bg-slate-50 opacity-50' : 'bg-slate-50'}`}>
                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-black text-sm ${isCurrent ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'}`}>{event.month}Ïõî</div>
                                    <div>
                                        <p className="font-bold text-sm">{event.title}</p>
                                        <p className="text-xs text-slate-500">{event.desc}</p>
                                    </div>
                                    {isCurrent && <span className="ml-auto text-xs font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded">Ïù¥Î≤àÎã¨</span>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // NEW: Í≥ÑÏïΩÍ∞±Ïã†Ï≤≠Íµ¨Í∂å Ïπ¥Ïö¥ÌÑ∞ (Phase 3)
        const RenewalRightTracker = () => {
            const [firstContractDate, setFirstContractDate] = useState('');
            const [usedRenewal, setUsedRenewal] = useState(false);

            const result = useMemo(() => {
                if (!firstContractDate) return null;

                const firstDate = new Date(firstContractDate);
                const today = new Date();

                // ÏµúÏ¥à Í≥ÑÏïΩÏùºÎ°úÎ∂ÄÌÑ∞ Í≤ΩÍ≥º Í∏∞Í∞Ñ
                const diffMs = today - firstDate;
                const diffYears = diffMs / (1000 * 60 * 60 * 24 * 365);

                // Í∞±Ïã†Í∂å ÏÇ¨Ïö© Í∞ÄÎä• Ïó¨Î∂Ä (ÏµúÏ¥à Í≥ÑÏïΩ ÌõÑ 2ÎÖÑ~4ÎÖÑ ÏÇ¨Ïù¥)
                const canUseRenewal = diffYears >= 2 && diffYears < 4 && !usedRenewal;
                const remainingRights = usedRenewal ? 0 : 1;

                // Îã§Ïùå Í∞±Ïã† Í∞ÄÎä•Ïùº (ÏµúÏ¥à Í≥ÑÏïΩÏùº + 2ÎÖÑ)
                const renewalDate = new Date(firstDate);
                renewalDate.setFullYear(renewalDate.getFullYear() + 2);

                // Í≥ÑÏïΩ ÎßåÎ£å ÏòàÏ†ïÏùº (Í∞±Ïã†Í∂å ÏÇ¨Ïö© Ïãú +4ÎÖÑ, ÎØ∏ÏÇ¨Ïö© Ïãú +2ÎÖÑ)
                const expiryDate = new Date(firstDate);
                expiryDate.setFullYear(expiryDate.getFullYear() + (usedRenewal ? 4 : 2));

                const daysUntilRenewal = Math.ceil((renewalDate - today) / (1000 * 60 * 60 * 24));
                const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));

                return { canUseRenewal, remainingRights, renewalDate, expiryDate, daysUntilRenewal, daysUntilExpiry, diffYears };
            }, [firstContractDate, usedRenewal]);

            const formatDate = (date) => date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Calendar className="w-4 h-4 mr-2 text-blue-600" /> Í≥ÑÏïΩÍ∞±Ïã†Ï≤≠Íµ¨Í∂å Ïπ¥Ïö¥ÌÑ∞
                    </h4>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">ÏµúÏ¥à Í≥ÑÏïΩÏùº</label>
                            <input
                                type="date"
                                value={firstContractDate}
                                onChange={e => setFirstContractDate(e.target.value)}
                                className="w-full px-4 py-3 bg-slate-50 rounded-xl font-medium outline-none input-unified"
                            />
                        </div>
                        <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <span className="text-sm font-medium">Í∞±Ïã†Í∂å ÏÇ¨Ïö© Ïó¨Î∂Ä</span>
                            <button
                                onClick={() => setUsedRenewal(!usedRenewal)}
                                className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${usedRenewal ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}
                            >
                                {usedRenewal ? 'ÏÇ¨Ïö©Ìï®' : 'ÎØ∏ÏÇ¨Ïö©'}
                            </button>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-4 rounded-xl text-center ${result.canUseRenewal ? 'bg-green-50' : 'bg-slate-100'}`}>
                                <p className="text-xs font-bold text-slate-500 mb-1">ÎÇ®ÏùÄ Í∞±Ïã†Í∂å</p>
                                <p className={`text-3xl font-black ${result.remainingRights > 0 ? 'text-green-600' : 'text-slate-400'}`}>
                                    {result.remainingRights}Ìöå
                                </p>
                                <p className="text-xs mt-1 text-slate-500">
                                    {result.canUseRenewal ? '‚úì Í∞±Ïã†Í∂å ÏÇ¨Ïö© Í∞ÄÎä•' : result.usedRenewal ? 'Ïù¥ÎØ∏ ÏÇ¨Ïö©Ìï®' : 'ÏïÑÏßÅ Í∞±Ïã† ÏãúÍ∏∞ ÏïÑÎãò'}
                                </p>
                            </div>
                            <div className="grid grid-cols-2 gap-3 text-center">
                                <div className="p-3 bg-blue-50 rounded-xl">
                                    <p className="text-xs font-bold text-blue-500">Í∞±Ïã† Í∞ÄÎä•Ïùº</p>
                                    <p className="text-sm font-bold mt-1">{formatDate(result.renewalDate)}</p>
                                    {result.daysUntilRenewal > 0 && <p className="text-xs text-slate-500">D-{result.daysUntilRenewal}</p>}
                                </div>
                                <div className="p-3 bg-orange-50 rounded-xl">
                                    <p className="text-xs font-bold text-orange-500">Í≥ÑÏïΩ ÎßåÎ£åÏùº</p>
                                    <p className="text-sm font-bold mt-1">{formatDate(result.expiryDate)}</p>
                                    <p className="text-xs text-slate-500">D{result.daysUntilExpiry > 0 ? '-' : '+'}{Math.abs(result.daysUntilExpiry)}</p>
                                </div>
                            </div>
                            <p className="text-xs text-center text-slate-400 mt-2">
                                üí° Í∞±Ïã†Ï≤≠Íµ¨Í∂åÏùÄ 2020ÎÖÑ 7Ïõî 31Ïùº Ïù¥ÌõÑ Ï≤¥Í≤∞ Í≥ÑÏïΩÏóê Ï†ÅÏö©Îê©ÎãàÎã§
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        // NEW: ÏûÑÎåÄÎ£å Ï¶ùÏï° ÌïúÎèÑ Í≥ÑÏÇ∞Í∏∞ (Phase 3)
        const RentCapCalculator = () => {
            const [currentDeposit, setCurrentDeposit] = useState('');
            const [currentRent, setCurrentRent] = useState('');
            const [conversionRate, setConversionRate] = useState('2.5');

            const result = useMemo(() => {
                const deposit = parseNumber(currentDeposit);
                const rent = parseNumber(currentRent);
                const rate = parseFloat(conversionRate) / 100 || 0.025;

                if (!deposit && !rent) return null;

                // ÏõîÏÑ∏ ÌôòÏÇ∞Ïï° (Î≥¥Ï¶ùÍ∏àÏùÑ ÏõîÏÑ∏Î°ú ÌôòÏÇ∞)
                const depositAsRent = (deposit * rate) / 12;
                const totalRentEquivalent = rent + depositAsRent;

                // 5% ÏÉÅÌïú
                const maxIncrease = totalRentEquivalent * 0.05;
                const maxNewTotal = totalRentEquivalent * 1.05;

                // ÏÉà ÏõîÏÑ∏ ÏµúÎåÄÏπò
                const maxNewRent = rent * 1.05;
                const maxNewDeposit = deposit * 1.05;

                return {
                    depositAsRent,
                    totalRentEquivalent,
                    maxIncrease,
                    maxNewTotal,
                    maxNewRent: Math.floor(maxNewRent),
                    maxNewDeposit: Math.floor(maxNewDeposit),
                    increasedRent: Math.floor(rent * 0.05),
                    increasedDeposit: Math.floor(deposit * 0.05)
                };
            }, [currentDeposit, currentRent, conversionRate]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-amber-600" /> ÏûÑÎåÄÎ£å Ï¶ùÏï° ÌïúÎèÑ (5%)
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÌòÑÏû¨ Î≥¥Ï¶ùÍ∏à" value={currentDeposit} onChange={setCurrentDeposit} color="orange" />
                        <NumberInput label="ÌòÑÏû¨ ÏõîÏÑ∏" value={currentRent} onChange={setCurrentRent} color="orange" />
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">Ï†ÑÏõîÏÑ∏ Ï†ÑÌôòÏú® (%)</label>
                            <input
                                type="number"
                                value={conversionRate}
                                onChange={e => setConversionRate(e.target.value)}
                                step="0.1"
                                className="w-full px-4 py-3 text-right bg-slate-50 rounded-xl font-bold outline-none input-unified"
                            />
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4">
                            <div className="p-4 bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl">
                                <p className="text-xs font-bold text-amber-600 text-center mb-3">5% ÏÉÅÌïú Ï†ÅÏö© Ïãú ÏµúÎåÄ Ï¶ùÍ∞ÄÎ∂Ñ</p>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-white p-3 rounded-xl text-center">
                                        <p className="text-xs text-slate-500">Î≥¥Ï¶ùÍ∏à</p>
                                        <p className="text-lg font-black text-amber-600">+{formatCompactNumber(result.increasedDeposit)}</p>
                                        <p className="text-xs text-slate-400">‚Üí {formatCompactNumber(result.maxNewDeposit)}</p>
                                    </div>
                                    <div className="bg-white p-3 rounded-xl text-center">
                                        <p className="text-xs text-slate-500">ÏõîÏÑ∏</p>
                                        <p className="text-lg font-black text-orange-600">+{formatNumber(result.increasedRent)}Ïõê</p>
                                        <p className="text-xs text-slate-400">‚Üí {formatNumber(result.maxNewRent)}Ïõê</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-xs text-center text-slate-400 mt-3">
                                ‚ö†Ô∏è ÏûÑÎåÄÏ∞®3Î≤ï Ï†ÅÏö©: Í≥ÑÏïΩÍ∞±Ïã† Ïãú 5% Ï¥àÍ≥º Ïù∏ÏÉÅ Î∂àÍ∞Ä
                            </p>
                        </div>
                    )}
                </div>
            );
        };



        // NEW: Í≤∞Í≥º Ïù¥ÎØ∏ÏßÄ Ï†ÄÏû• (Phase 5)
        const ExportButton = () => {
            const handleExport = async () => {
                const element = document.getElementById('root'); // Capture entire app or specific area
                if (!element) return;

                // Toast notification (mock)
                const showToast = (msg) => {
                    const toast = document.createElement('div');
                    toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in-up';
                    toast.textContent = msg;
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 2000);
                };

                showToast('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...');

                try {
                    const canvas = await html2canvas(element, {
                        backgroundColor: document.documentElement.classList.contains('dark') ? '#0f172a' : '#f8fafc',
                        scale: 2
                    });

                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = `Î∂ÄÎèôÏÇ∞ÎßàÏä§ÌÑ∞_Í≤∞Í≥º_${new Date().toLocaleDateString()}.png`;
                    link.click();

                    showToast('Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                } catch (err) {
                    console.error(err);
                    showToast('Ïù¥ÎØ∏ÏßÄ Ï†ÄÏû• Ïã§Ìå®');
                }
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2 text-center">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center justify-center">
                        <Download className="w-4 h-4 mr-2 text-blue-600" /> Í≤∞Í≥º Ï†ÄÏû•
                    </h4>
                    <p className="text-xs text-slate-500 mb-4">ÌòÑÏû¨ ÌôîÎ©¥ÏùÑ Ïù¥ÎØ∏ÏßÄÎ°ú Ï†ÄÏû•Ìï©ÎãàÎã§.</p>
                    <button
                        onClick={handleExport}
                        className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-200 transition-all active:scale-95"
                    >
                        ÌôîÎ©¥ Ï∫°Ï≤ò Î∞è Îã§Ïö¥Î°úÎìú
                    </button>
                    <div className="mt-4 p-3 bg-slate-50 rounded-xl text-xs text-left text-slate-500">
                        üí° PCÏóêÏÑúÎäî Îã§Ïö¥Î°úÎìú Ìè¥ÎçîÏóê Ï†ÄÏû•ÎêòÎ©∞, Î™®Î∞îÏùºÏóêÏÑúÎäî Ïù¥ÎØ∏ÏßÄ Í∏∏Í≤å ÎàÑÎ•¥Í∏∞Î°ú Ï†ÄÏû•Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                    </div>
                </div>
            );
        };

        // NEW: Îß§Î¨º ÎπÑÍµê (Phase 5)
        const CompareTab = () => {
            const [properties, setProperties] = useState([{ id: 1, name: 'A Îß§Î¨º', price: '', jeonse: '' }]);

            const addProperty = () => {
                if (properties.length >= 3) return;
                setProperties([...properties, { id: Date.now(), name: String.fromCharCode(65 + properties.length) + ' Îß§Î¨º', price: '', jeonse: '' }]);
            };

            const removeProperty = (id) => {
                setProperties(properties.filter(p => p.id !== id));
            };

            const updateProperty = (id, field, value) => {
                setProperties(properties.map(p => p.id === id ? { ...p, [field]: value } : p));
            };

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center mb-2">
                        <h4 className="text-sm font-bold text-slate-800 flex items-center">
                            <ArrowRightLeft className="w-4 h-4 mr-2 text-purple-600" /> Îß§Î¨º ÎπÑÍµê ({properties.length}/3)
                        </h4>
                        {properties.length < 3 && (
                            <button onClick={addProperty} className="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition-colors">
                                + Îß§Î¨º Ï∂îÍ∞Ä
                            </button>
                        )}
                    </div>

                    <div className="overflow-x-auto pb-2">
                        <div className="flex gap-3 min-w-max">
                            {properties.map((p, idx) => {
                                const priceVal = parseNumber(p.price);
                                const jeonseVal = parseNumber(p.jeonse);
                                const gap = priceVal && jeonseVal ? priceVal - jeonseVal : 0;
                                const rate = priceVal ? ((jeonseVal / priceVal) * 100).toFixed(1) : 0;

                                return (
                                    <div key={p.id} className="w-40 flex-shrink-0 bg-white p-4 rounded-2xl shadow-sm border border-slate-100 card-depth relative">
                                        {properties.length > 1 && (
                                            <button onClick={() => removeProperty(p.id)} className="absolute top-2 right-2 text-slate-300 hover:text-red-500">
                                                <X size={16} />
                                            </button>
                                        )}
                                        <input
                                            value={p.name}
                                            onChange={e => updateProperty(p.id, 'name', e.target.value)}
                                            className="w-full text-sm font-bold text-center mb-3 bg-transparent outline-none border-b border-transparent focus:border-slate-300"
                                        />
                                        <div className="space-y-3">
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-400 block mb-1">Îß§Îß§Í∞Ä</label>
                                                <input
                                                    value={formatNumber(p.price)}
                                                    onChange={e => updateProperty(p.id, 'price', e.target.value)}
                                                    className="w-full text-right bg-slate-50 px-2 py-1 rounded text-sm font-bold outline-none"
                                                    placeholder="0"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-400 block mb-1">Ï†ÑÏÑ∏Í∞Ä</label>
                                                <input
                                                    value={formatNumber(p.jeonse)}
                                                    onChange={e => updateProperty(p.id, 'jeonse', e.target.value)}
                                                    className="w-full text-right bg-slate-50 px-2 py-1 rounded text-sm font-bold outline-none"
                                                    placeholder="0"
                                                />
                                            </div>
                                            <div className="pt-2 border-t border-slate-100">
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-[10px] text-slate-500">Í∞≠</span>
                                                    <span className="text-xs font-bold text-indigo-600">{formatCompactNumber(gap)}</span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-[10px] text-slate-500">Ï†ÑÏÑ∏Í∞ÄÏú®</span>
                                                    <span className="text-xs font-bold text-slate-700">{rate}%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // NEW: ÌîÑÎ¶¨ÏÖã Í¥ÄÎ¶¨ (Phase 5)
        const PresetManager = () => {
            const [presets, setPresets] = usePersistedState('userPresets', []);
            const [name, setName] = useState('');

            const savePreset = () => {
                if (!name) return;
                const newPreset = { id: Date.now(), name, date: new Date().toLocaleDateString() };
                const updated = [newPreset, ...presets];
                setPresets(updated);
                setName('');
            };

            const deletePreset = (id) => {
                setPresets(presets.filter(p => p.id !== id));
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Bookmark className="w-4 h-4 mr-2 text-yellow-500" /> Ï¶êÍ≤®Ï∞æÍ∏∞/ÌîÑÎ¶¨ÏÖã
                    </h4>
                    <div className="flex gap-2 mb-4">
                        <input
                            value={name}
                            onChange={e => setName(e.target.value)}
                            placeholder="ÏÑ§Ï†ï Ïù¥Î¶Ñ (Ïòà: ÏÑúÏö∏ ÏïÑÌååÌä∏ Ìà¨Ïûê)"
                            className="flex-1 px-3 py-2 bg-slate-50 rounded-xl text-sm outline-none"
                        />
                        <button
                            onClick={savePreset}
                            disabled={!name}
                            className="bg-slate-800 text-white px-4 py-2 rounded-xl text-xs font-bold disabled:opacity-50"
                        >
                            Ï†ÄÏû•
                        </button>
                    </div>
                    <div className="space-y-2">
                        {presets.length === 0 ? (
                            <div className="text-center py-4 text-slate-400 text-xs">Ï†ÄÏû•Îêú ÌîÑÎ¶¨ÏÖãÏù¥ ÏóÜÏäµÎãàÎã§.</div>
                        ) : (
                            presets.map(p => (
                                <div key={p.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-xl">
                                    <div>
                                        <p className="text-sm font-bold text-slate-700">{p.name}</p>
                                        <p className="text-[10px] text-slate-400">{p.date}</p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button className="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">Î∂àÎü¨Ïò§Í∏∞</button>
                                        <button onClick={() => deletePreset(p.id)} className="text-slate-300 hover:text-red-500"><X size={14} /></button>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // ========== NEW FEATURES START ==========

        // ÏÉÅÏàò: ÏùÄÌñâÎ≥Ñ Í∏àÎ¶¨ Îç∞Ïù¥ÌÑ∞ (2026.01 Í∏∞Ï§Ä)
        const BANK_RATES_DATA = [
            { name: 'Íµ≠ÎØºÏùÄÌñâ', rate: 3.85, color: 'from-yellow-50 to-amber-50', border: 'border-yellow-200' },
            { name: 'Ïã†ÌïúÏùÄÌñâ', rate: 3.92, color: 'from-blue-50 to-indigo-50', border: 'border-blue-200' },
            { name: 'Ïö∞Î¶¨ÏùÄÌñâ', rate: 3.88, color: 'from-sky-50 to-cyan-50', border: 'border-sky-200' },
            { name: 'ÌïòÎÇòÏùÄÌñâ', rate: 3.79, color: 'from-teal-50 to-emerald-50', border: 'border-teal-200' },
            { name: 'Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨', rate: 3.65, color: 'from-yellow-50 to-orange-50', border: 'border-yellow-300' },
            { name: 'ÌÜ†Ïä§Î±ÖÌÅ¨', rate: 3.72, color: 'from-indigo-50 to-purple-50', border: 'border-indigo-200' },
        ];

        // 1. ÏùÄÌñâÎ≥Ñ Í∏àÎ¶¨ ÎπÑÍµê
        const BankRateComparison = () => {
            const [loanAmount, setLoanAmount] = useState('');

            const results = useMemo(() => {
                const amount = parseNumber(loanAmount) || 0;
                if (amount <= 0) return null;
                return BANK_RATES_DATA.map(bank => {
                    const monthlyInterest = Math.floor(amount * (bank.rate / 100) / 12);
                    const yearlyInterest = Math.floor(amount * (bank.rate / 100));
                    // NaN/Infinity Î∞©Ïñ¥
                    return {
                        ...bank,
                        monthlyInterest: isFinite(monthlyInterest) ? monthlyInterest : 0,
                        yearlyInterest: isFinite(yearlyInterest) ? yearlyInterest : 0
                    };
                }).sort((a, b) => a.rate - b.rate);
            }, [loanAmount]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Building className="w-4 h-4 mr-2 text-blue-600" /> ÏùÄÌñâÎ≥Ñ Í∏àÎ¶¨ ÎπÑÍµê (2026.01 Í∏∞Ï§Ä)
                    </h4>
                    <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="blue" />
                    {results ? (
                        <div className="mt-4 space-y-2">
                            {results.map((bank, idx) => (
                                <div key={bank.name} className={`p-4 rounded-xl bg-gradient-to-r ${bank.color} ${bank.border} border flex justify-between items-center ${idx === 0 ? 'ring-2 ring-green-300' : ''}`}>
                                    <div>
                                        <p className="font-bold text-sm">{bank.name} {idx === 0 && <span className="text-xs text-green-600 ml-1">ÏµúÏ†Ä!</span>}</p>
                                        <p className="text-xs text-slate-500">Ïó∞ {bank.rate}%</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-lg font-black text-slate-800">{formatNumber(bank.monthlyInterest)}Ïõê</p>
                                        <p className="text-xs text-slate-500">Ïõî Ïù¥Ïûê</p>
                                    </div>
                                </div>
                            ))}
                            <p className="text-xs text-center text-slate-400 mt-3">* Í∏àÎ¶¨Îäî Ïã†Ïö©Îì±Í∏â/ÎåÄÏ∂úÏÉÅÌíàÏóê Îî∞Îùº Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§</p>
                        </div>
                    ) : (
                        <div className="text-center py-8 text-slate-400 text-sm mt-4">ÎåÄÏ∂ú Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</div>
                    )}
                </div>
            );
        };

        // 2. Í≥†Ï†ï vs Î≥ÄÎèôÍ∏àÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞
        const FixedVsVariableRate = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [fixedRate, setFixedRate] = useState('4.5');
            const [variableRate, setVariableRate] = useState('3.8');
            const [scenario, setScenario] = useState('up'); // up, stable, down

            const result = useMemo(() => {
                const amount = parseNumber(loanAmount);
                const fixed = parseFloat(fixedRate) || 0;
                const variable = parseFloat(variableRate) || 0;
                if (!amount) return null;

                const years = 5;
                const rateChanges = { up: [0, 0.5, 1.0, 1.5, 2.0], stable: [0, 0, 0, 0, 0], down: [0, -0.3, -0.5, -0.7, -1.0] };
                const changes = rateChanges[scenario];

                let fixedTotal = 0, variableTotal = 0;
                const yearlyData = [];
                for (let i = 0; i < years; i++) {
                    const yearFixedInterest = amount * (fixed / 100);
                    const yearVariableRate = Math.max(variable + changes[i], 1);
                    const yearVariableInterest = amount * (yearVariableRate / 100);
                    fixedTotal += yearFixedInterest;
                    variableTotal += yearVariableInterest;
                    yearlyData.push({ year: i + 1, fixed: yearFixedInterest, variable: yearVariableInterest, variableRate: yearVariableRate });
                }

                return { fixedTotal, variableTotal, diff: fixedTotal - variableTotal, yearlyData, winner: variableTotal < fixedTotal ? 'variable' : 'fixed' };
            }, [loanAmount, fixedRate, variableRate, scenario]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-purple-600" /> Í≥†Ï†ï vs Î≥ÄÎèôÍ∏àÎ¶¨ (5ÎÖÑ ÏãúÎÆ¨Î†àÏù¥ÏÖò)
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="violet" />
                        <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">Í≥†Ï†ïÍ∏àÎ¶¨ (%)</label>
                                <input type="number" value={fixedRate} onChange={e => setFixedRate(e.target.value)} step="0.1" className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">Î≥ÄÎèôÍ∏àÎ¶¨ (%)</label>
                                <input type="number" value={variableRate} onChange={e => setVariableRate(e.target.value)} step="0.1" className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">Í∏àÎ¶¨ ÏãúÎÇòÎ¶¨Ïò§</label>
                            <div className="flex gap-2">
                                {[{ id: 'up', label: 'üìà ÏÉÅÏäπ', desc: '+2%p' }, { id: 'stable', label: '‚û°Ô∏è Ïú†ÏßÄ', desc: '0%' }, { id: 'down', label: 'üìâ ÌïòÎùΩ', desc: '-1%p' }].map(s => (
                                    <button key={s.id} onClick={() => setScenario(s.id)} className={`flex-1 py-2 px-2 rounded-xl text-xs font-bold transition-all ${scenario === s.id ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                        {s.label}<span className="block text-[10px] opacity-70">{s.desc}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4">
                            <div className="grid grid-cols-2 gap-3 mb-3">
                                <div className={`p-4 rounded-xl text-center ${result.winner === 'fixed' ? 'bg-green-50 ring-2 ring-green-300' : 'bg-slate-50'}`}>
                                    <p className="text-xs text-slate-500">Í≥†Ï†ïÍ∏àÎ¶¨ Ï¥ù Ïù¥Ïûê</p>
                                    <p className="text-xl font-black text-slate-800">{formatCompactNumber(result.fixedTotal)}</p>
                                </div>
                                <div className={`p-4 rounded-xl text-center ${result.winner === 'variable' ? 'bg-green-50 ring-2 ring-green-300' : 'bg-slate-50'}`}>
                                    <p className="text-xs text-slate-500">Î≥ÄÎèôÍ∏àÎ¶¨ Ï¥ù Ïù¥Ïûê</p>
                                    <p className="text-xl font-black text-slate-800">{formatCompactNumber(result.variableTotal)}</p>
                                </div>
                            </div>
                            <div className={`p-3 rounded-xl text-center ${result.diff > 0 ? 'bg-blue-50' : 'bg-orange-50'}`}>
                                <p className="text-sm font-bold">{result.winner === 'variable' ? 'Î≥ÄÎèôÍ∏àÎ¶¨' : 'Í≥†Ï†ïÍ∏àÎ¶¨'}Í∞Ä {formatCompactNumber(Math.abs(result.diff))} Ïú†Î¶¨!</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 3. Ïä§Ìä∏Î†àÏä§ ÌÖåÏä§Ìä∏
        const InterestRateStressTest = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [currentRate, setCurrentRate] = useState('4.0');
            const [period, setPeriod] = useState('360');

            const result = useMemo(() => {
                const amount = parseNumber(loanAmount) || 0;
                const rate = parseFloat(currentRate) || 0;
                const months = parseInt(period) || 360;
                if (amount <= 0 || rate <= 0) return null;

                const calcMonthly = (r) => {
                    const monthlyRate = r / 100 / 12;
                    if (monthlyRate <= 0) return 0;
                    const factor = Math.pow(1 + monthlyRate, months);
                    const denominator = factor - 1;
                    if (denominator === 0) return 0;
                    const payment = (amount * monthlyRate * factor) / denominator;
                    return isFinite(payment) ? payment : 0;
                };

                const current = calcMonthly(rate);
                if (current <= 0) return null;

                const scenarios = [
                    { change: 0, rate: rate, monthly: current, diff: 0, diffPercent: 0 },
                    { change: 1, rate: rate + 1, monthly: calcMonthly(rate + 1), diff: 0, diffPercent: 0 },
                    { change: 2, rate: rate + 2, monthly: calcMonthly(rate + 2), diff: 0, diffPercent: 0 },
                    { change: 3, rate: rate + 3, monthly: calcMonthly(rate + 3), diff: 0, diffPercent: 0 },
                ];
                scenarios.forEach(s => {
                    s.diff = s.monthly - current;
                    s.diffPercent = current > 0 ? (s.diff / current) * 100 : 0;
                });
                return scenarios;
            }, [loanAmount, currentRate, period]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <AlertTriangle className="w-4 h-4 mr-2 text-red-500" /> Í∏àÎ¶¨ Ïä§Ìä∏Î†àÏä§ ÌÖåÏä§Ìä∏
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="red" />
                        <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÌòÑÏû¨ Í∏àÎ¶¨ (%)</label>
                                <input type="number" value={currentRate} onChange={e => setCurrentRate(e.target.value)} step="0.1" className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÎåÄÏ∂ú Í∏∞Í∞Ñ (Í∞úÏõî)</label>
                                <input type="number" value={period} onChange={e => setPeriod(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-2">
                            {result.map((s, idx) => (
                                <div key={idx} className={`p-4 rounded-xl flex justify-between items-center ${idx === 0 ? 'bg-green-50' : idx === 3 ? 'bg-red-50' : 'bg-slate-50'}`}>
                                    <div>
                                        <p className="font-bold text-sm">{s.change === 0 ? 'ÌòÑÏû¨' : `+${s.change}%p Ïù∏ÏÉÅ`}</p>
                                        <p className="text-xs text-slate-500">Ïó∞ {s.rate.toFixed(1)}%</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-lg font-black">{formatNumber(Math.round(s.monthly))}Ïõê</p>
                                        {s.diff > 0 && <p className="text-xs text-red-500 font-bold">+{formatNumber(Math.round(s.diff))}Ïõê ({s.diffPercent.toFixed(1)}%‚Üë)</p>}
                                    </div>
                                </div>
                            ))}
                            <p className="text-xs text-center text-red-400 mt-2">‚ö†Ô∏è Í∏àÎ¶¨ Ïù∏ÏÉÅÏóê ÎåÄÎπÑÌïú Ïó¨Ïú†ÏûêÍ∏àÏùÑ Ï§ÄÎπÑÌïòÏÑ∏Ïöî</p>
                        </div>
                    )}
                </div>
            );
        };

        // 4. Ï§ëÎèÑÏÉÅÌôò ÏµúÏ†ÅÌôî
        const EarlyRepaymentOptimizer = () => {
            const [remainingLoan, setRemainingLoan] = useState('');
            const [rate, setRate] = useState('4.5');
            const [remainingMonths, setRemainingMonths] = useState('240');
            const [extraPayment, setExtraPayment] = useState('');

            const result = useMemo(() => {
                const loan = parseNumber(remainingLoan) || 0;
                const extra = parseNumber(extraPayment) || 0;
                const r = (parseFloat(rate) || 0) / 100 / 12;
                const months = parseInt(remainingMonths) || 240;
                if (loan <= 0 || extra <= 0 || r <= 0) return null;

                const calcPayment = (principal) => {
                    const factor = Math.pow(1 + r, months);
                    const denominator = factor - 1;
                    if (denominator === 0) return 0;
                    const payment = (principal * r * factor) / denominator;
                    return isFinite(payment) ? payment : 0;
                };

                const monthlyPayment = calcPayment(loan);
                const totalInterestWithout = monthlyPayment * months - loan;

                const newLoan = Math.max(loan - extra, 0);
                const newMonthly = newLoan > 0 ? calcPayment(newLoan) : 0;
                const totalInterestWith = newMonthly * months - newLoan;

                const interestSaved = totalInterestWithout - totalInterestWith;
                const prepaymentFee = extra * 0.012; // 1.2% ÎåÄÎûµ ÏàòÏàòÎ£å
                const netSaving = interestSaved - prepaymentFee;

                // NaN Î∞©Ïñ¥
                if (!isFinite(monthlyPayment) || !isFinite(netSaving)) return null;

                return { monthlyPayment, newMonthly, monthlySaved: monthlyPayment - newMonthly, interestSaved, prepaymentFee, netSaving };
            }, [remainingLoan, rate, remainingMonths, extraPayment]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <DollarSign className="w-4 h-4 mr-2 text-green-600" /> Ï§ëÎèÑÏÉÅÌôò ÏµúÏ†ÅÌôî
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎÇ®ÏùÄ ÎåÄÏ∂ú ÏûîÏï°" value={remainingLoan} onChange={setRemainingLoan} color="green" />
                        <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">Í∏àÎ¶¨ (%)</label>
                                <input type="number" value={rate} onChange={e => setRate(e.target.value)} step="0.1" className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">ÎÇ®ÏùÄ Í∏∞Í∞Ñ (Í∞úÏõî)</label>
                                <input type="number" value={remainingMonths} onChange={e => setRemainingMonths(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                        <NumberInput label="Ï§ëÎèÑÏÉÅÌôò Í∏àÏï°" value={extraPayment} onChange={setExtraPayment} color="green" />
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="p-4 bg-green-50 rounded-xl text-center">
                                <p className="text-xs text-green-600 font-bold mb-1">Ïàú Ï†àÍ∞êÏï° (Ïù¥Ïûê Ï†àÍ∞ê - ÏàòÏàòÎ£å)</p>
                                <p className={`text-3xl font-black ${result.netSaving > 0 ? 'text-green-600' : 'text-red-500'}`}>{result.netSaving > 0 ? '+' : ''}{formatCompactNumber(result.netSaving)}</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2 text-xs">
                                <div className="p-3 bg-slate-50 rounded-xl">
                                    <p className="text-slate-500">Ïõî ÏÉÅÌôòÍ∏à Í∞êÏÜå</p>
                                    <p className="font-bold text-slate-800">{formatNumber(Math.round(result.monthlySaved))}Ïõê</p>
                                </div>
                                <div className="p-3 bg-slate-50 rounded-xl">
                                    <p className="text-slate-500">Ï¥ù Ïù¥Ïûê Ï†àÍ∞ê</p>
                                    <p className="font-bold text-green-600">{formatCompactNumber(result.interestSaved)}</p>
                                </div>
                                <div className="p-3 bg-red-50 rounded-xl col-span-2">
                                    <p className="text-slate-500">Ï§ëÎèÑÏÉÅÌôò ÏàòÏàòÎ£å (ÏïΩ 1.2%)</p>
                                    <p className="font-bold text-red-500">-{formatNumber(Math.round(result.prepaymentFee))}Ïõê</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 5. Ïã†Ïö©Ï†êÏàò ÏòÅÌñ• Î∂ÑÏÑù
        const CreditScoreImpact = () => {
            const [currentScore, setCurrentScore] = useState('750');
            const [loanType, setLoanType] = useState('mortgage');
            const [hasMultipleLoans, setHasMultipleLoans] = useState(false);

            const analysis = useMemo(() => {
                const score = parseInt(currentScore) || 750;
                const impacts = {
                    mortgage: { change: -15, recovery: '6-12Í∞úÏõî', desc: 'Ï£ºÌÉùÎã¥Î≥¥ÎåÄÏ∂úÏùÄ Îã¥Î≥¥Í∞Ä ÏûàÏñ¥ ÏòÅÌñ• Ï†ÅÏùå' },
                    jeonse: { change: -10, recovery: '6Í∞úÏõî', desc: 'Ï†ÑÏÑ∏ÏûêÍ∏àÎåÄÏ∂úÎèÑ Î≥¥Ï¶ùÏù¥ ÏûàÏñ¥ ÎπÑÍµêÏ†Å ÏïàÏ†ï' },
                    credit: { change: -30, recovery: '12-18Í∞úÏõî', desc: 'Ïã†Ïö©ÎåÄÏ∂úÏùÄ Î¨¥Îã¥Î≥¥Îùº ÏòÅÌñ• ÌÅº' },
                    card: { change: -20, recovery: '3-6Í∞úÏõî', desc: 'Ïπ¥ÎìúÎ°†ÏùÄ Îã®Í∏∞ÏÑ±ÏúºÎ°ú Îπ†Î•¥Í≤å ÌöåÎ≥µ' },
                };
                const impact = impacts[loanType];
                const multiLoanPenalty = hasMultipleLoans ? -20 : 0;
                const newScore = Math.max(score + impact.change + multiLoanPenalty, 300);
                const grade = newScore >= 900 ? '1Îì±Í∏â' : newScore >= 870 ? '2Îì±Í∏â' : newScore >= 840 ? '3Îì±Í∏â' : newScore >= 805 ? '4Îì±Í∏â' : newScore >= 750 ? '5Îì±Í∏â' : newScore >= 665 ? '6Îì±Í∏â' : '7Îì±Í∏â Ïù¥Ìïò';
                return { ...impact, newScore, grade, multiLoanPenalty };
            }, [currentScore, loanType, hasMultipleLoans]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Award className="w-4 h-4 mr-2 text-amber-500" /> Ïã†Ïö©Ï†êÏàò ÏòÅÌñ• Î∂ÑÏÑù
                    </h4>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">ÌòÑÏû¨ Ïã†Ïö©Ï†êÏàò</label>
                            <input type="number" value={currentScore} onChange={e => setCurrentScore(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">ÎåÄÏ∂ú Ï¢ÖÎ•ò</label>
                            <div className="grid grid-cols-2 gap-2">
                                {[{ id: 'mortgage', label: 'üè† Ï£ºÎã¥ÎåÄ' }, { id: 'jeonse', label: 'üè¢ Ï†ÑÏÑ∏ÎåÄÏ∂ú' }, { id: 'credit', label: 'üí≥ Ïã†Ïö©ÎåÄÏ∂ú' }, { id: 'card', label: 'ü™ô Ïπ¥ÎìúÎ°†' }].map(l => (
                                    <button key={l.id} onClick={() => setLoanType(l.id)} className={`py-2 rounded-xl text-xs font-bold ${loanType === l.id ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                        {l.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <label className="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer">
                            <input type="checkbox" checked={hasMultipleLoans} onChange={e => setHasMultipleLoans(e.target.checked)} className="w-4 h-4 rounded" />
                            <span className="text-sm font-medium">Îã§Ï§ëÏ±ÑÎ¨¥ Î≥¥Ïú† (3Í∞ú Ïù¥ÏÉÅ)</span>
                        </label>
                    </div>
                    <div className="mt-4 space-y-3">
                        <div className="p-4 bg-amber-50 rounded-xl text-center">
                            <p className="text-xs text-amber-600 font-bold mb-1">ÏòàÏÉÅ Ïã†Ïö©Ï†êÏàò</p>
                            <p className="text-3xl font-black text-amber-700">{analysis.newScore}Ï†ê <span className="text-sm">({analysis.grade})</span></p>
                            <p className="text-xs text-slate-500 mt-1">{analysis.change + analysis.multiLoanPenalty}Ï†ê Î≥ÄÎèô ÏòàÏÉÅ</p>
                        </div>
                        <div className="p-3 bg-slate-50 rounded-xl text-xs">
                            <p className="font-bold text-slate-700 mb-1">üí° {analysis.desc}</p>
                            <p className="text-slate-500">ÌöåÎ≥µ Í∏∞Í∞Ñ: {analysis.recovery}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // 6. ÌïÑÏàò ÏÑúÎ•ò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
        const RequiredDocuments = () => {
            const [dealType, setDealType] = useState('buy');
            const [role, setRole] = useState('buyer');
            const [checked, setChecked] = usePersistedState('requiredDocsChecked', {});

            const toggle = (id) => setChecked(prev => ({ ...prev, [id]: !prev[id] }));

            const documents = {
                buy: {
                    buyer: [
                        { id: 'b1', name: 'Ïã†Î∂ÑÏ¶ù (Î≥∏Ïù∏)', required: true },
                        { id: 'b2', name: 'Ïù∏Í∞êÏ¶ùÎ™ÖÏÑú', required: true },
                        { id: 'b3', name: 'Ï£ºÎØºÎì±Î°ùÎì±Î≥∏', required: true },
                        { id: 'b4', name: 'Í∞ÄÏ°±Í¥ÄÍ≥ÑÏ¶ùÎ™ÖÏÑú', required: false },
                        { id: 'b5', name: 'Ïù∏Í∞êÎèÑÏû•', required: true },
                        { id: 'b6', name: 'Í≥ÑÏïΩÍ∏à/ÏûîÍ∏à ÏûÖÍ∏à ÌôïÏù∏ÏÑú', required: true },
                        { id: 'b7', name: 'Ï∑®ÎìùÏûêÍ∏àÏ°∞Îã¨Í≥ÑÌöçÏÑú (9Ïñµ Ïù¥ÏÉÅ)', required: false },
                    ],
                    seller: [
                        { id: 's1', name: 'Ïã†Î∂ÑÏ¶ù (Î≥∏Ïù∏)', required: true },
                        { id: 's2', name: 'Ïù∏Í∞êÏ¶ùÎ™ÖÏÑú (Îß§ÎèÑÏö©)', required: true },
                        { id: 's3', name: 'Îì±Í∏∞Í∂åÎ¶¨Ï¶ù', required: true },
                        { id: 's4', name: 'Ï£ºÎØºÎì±Î°ùÎì±Î≥∏', required: true },
                        { id: 's5', name: 'Ïù∏Í∞êÎèÑÏû•', required: true },
                        { id: 's6', name: 'ÌÜ†ÏßÄ/Í±¥Ï∂ïÎ¨ºÎåÄÏû•', required: true },
                    ],
                },
                jeonse: {
                    tenant: [
                        { id: 't1', name: 'Ïã†Î∂ÑÏ¶ù', required: true },
                        { id: 't2', name: 'Ï£ºÎØºÎì±Î°ùÎì±Î≥∏', required: true },
                        { id: 't3', name: 'Ïù∏Í∞êÏ¶ùÎ™ÖÏÑú', required: false },
                        { id: 't4', name: 'Ïû¨ÏßÅ/ÏÜåÎìùÏ¶ùÎ™ÖÏÑú (Ï†ÑÏÑ∏ÎåÄÏ∂ú Ïãú)', required: false },
                    ],
                    landlord: [
                        { id: 'l1', name: 'Ïã†Î∂ÑÏ¶ù', required: true },
                        { id: 'l2', name: 'Îì±Í∏∞Î∂ÄÎì±Î≥∏', required: true },
                        { id: 'l3', name: 'Í±¥Ï∂ïÎ¨ºÎåÄÏû•', required: true },
                        { id: 'l4', name: 'ÏûÑÎåÄÏù∏ Î≥∏Ïù∏ Í≥ÑÏ¢å', required: true },
                    ],
                },
            };

            const currentDocs = documents[dealType]?.[role] || [];
            const doneCount = currentDocs.filter(d => checked[d.id]).length;

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <ClipboardList className="w-4 h-4 mr-2 text-indigo-600" /> ÌïÑÏàò ÏÑúÎ•ò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                    </h4>
                    <div className="flex gap-2 mb-3">
                        <button onClick={() => { setDealType('buy'); setRole('buyer'); }} className={`flex-1 py-2 rounded-xl text-xs font-bold ${dealType === 'buy' ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600'}`}>Îß§Îß§</button>
                        <button onClick={() => { setDealType('jeonse'); setRole('tenant'); }} className={`flex-1 py-2 rounded-xl text-xs font-bold ${dealType === 'jeonse' ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600'}`}>Ï†ÑÏÑ∏/ÏõîÏÑ∏</button>
                    </div>
                    <div className="flex gap-2 mb-4">
                        {dealType === 'buy' ? (
                            <>
                                <button onClick={() => setRole('buyer')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${role === 'buyer' ? 'bg-slate-800 text-white' : 'bg-slate-100'}`}>Îß§ÏàòÏù∏</button>
                                <button onClick={() => setRole('seller')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${role === 'seller' ? 'bg-slate-800 text-white' : 'bg-slate-100'}`}>Îß§ÎèÑÏù∏</button>
                            </>
                        ) : (
                            <>
                                <button onClick={() => setRole('tenant')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${role === 'tenant' ? 'bg-slate-800 text-white' : 'bg-slate-100'}`}>ÏûÑÏ∞®Ïù∏</button>
                                <button onClick={() => setRole('landlord')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${role === 'landlord' ? 'bg-slate-800 text-white' : 'bg-slate-100'}`}>ÏûÑÎåÄÏù∏</button>
                            </>
                        )}
                    </div>
                    <div className="w-full bg-slate-200 rounded-full h-2 mb-3">
                        <div className="bg-indigo-500 h-2 rounded-full transition-all" style={{ width: `${(doneCount / currentDocs.length) * 100}%` }}></div>
                    </div>
                    <p className="text-xs text-slate-500 text-right mb-3">{doneCount}/{currentDocs.length} ÏôÑÎ£å</p>
                    <div className="space-y-2">
                        {currentDocs.map(doc => (
                            <button key={doc.id} onClick={() => toggle(doc.id)} className={`w-full p-3 rounded-xl text-left flex items-center gap-3 transition-all ${checked[doc.id] ? 'bg-green-50 text-green-700' : 'bg-slate-50 text-slate-700'}`}>
                                <span className={`w-5 h-5 rounded-full flex items-center justify-center text-xs ${checked[doc.id] ? 'bg-green-500 text-white' : 'bg-slate-200'}`}>
                                    {checked[doc.id] ? '‚úì' : ''}
                                </span>
                                <span className="font-medium text-sm">{doc.name}</span>
                                {doc.required && <span className="ml-auto text-xs text-red-500 font-bold">ÌïÑÏàò</span>}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // 7. ÌäπÏïΩ Ï°∞Ìï≠ Í∞ÄÏù¥Îìú
        const SpecialClauseGuide = () => {
            const [category, setCategory] = useState('safety');
            const [copied, setCopied] = useState(null);

            const clauses = {
                safety: [
                    { id: 1, title: 'Ï†ÑÏÑ∏Î≥¥Ï¶ùÍ∏à Î∞òÌôò Î≥¥Ïû•', text: 'ÏûÑÎåÄÏù∏ÏùÄ Í≥ÑÏïΩ Ï¢ÖÎ£å Ïãú ÏûÑÏ∞®Ïù∏ÏóêÍ≤å Î≥¥Ï¶ùÍ∏à Ï†ÑÏï°ÏùÑ Î∞òÌôòÌïòÏó¨Ïïº ÌïòÎ©∞, ÎØ∏Î∞òÌôò Ïãú Ïó∞ 12%Ïùò ÏßÄÏó∞ÏÜêÌï¥Í∏àÏùÑ ÏßÄÍ∏âÌïúÎã§.' },
                    { id: 2, title: 'Í∑ºÏ†ÄÎãπÍ∂å ÏÑ§Ï†ï Ï†úÌïú', text: 'Í≥ÑÏïΩ Ï≤¥Í≤∞ ÌõÑ ÏûÑÎåÄÏù∏ÏùÄ Î≥∏ Î∂ÄÎèôÏÇ∞Ïóê Ï∂îÍ∞Ä Í∑ºÏ†ÄÎãπÍ∂å ÏÑ§Ï†ï Ïãú ÏûÑÏ∞®Ïù∏ÏóêÍ≤å ÏÇ¨Ï†Ñ ÏÑúÎ©¥ ÎèôÏùòÎ•º Î∞õÏïÑÏïº ÌïúÎã§.' },
                    { id: 3, title: 'Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∞ÄÏûÖ', text: 'ÏûÑÏ∞®Ïù∏ÏùÄ HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∞ÄÏûÖÏùÑ ÏöîÏ≤≠Ìï† Ïàò ÏûàÏúºÎ©∞, ÏûÑÎåÄÏù∏ÏùÄ Ïù¥Ïóê ÌïÑÏöîÌïú ÏÑúÎ•ò(ÌôïÏ†ïÏùºÏûêÎ∂Ä ÏûÑÎåÄÏ∞®Í≥ÑÏïΩÏÑú ÏÇ¨Î≥∏ Îì±)Î•º Ï†úÍ≥µÌïúÎã§.' },
                ],
                maintenance: [
                    { id: 4, title: 'ÌïòÏûê Î≥¥Ïàò Ï±ÖÏûÑ', text: 'ÏûÖÏ£º Ï†Ñ Ï°¥Ïû¨ÌïòÎäî ÌïòÏûê(ÎàÑÏàò, Í≥∞Ìå°Ïù¥, Î≥¥ÏùºÎü¨ Í≥†Ïû• Îì±)Îäî ÏûÑÎåÄÏù∏ Ï±ÖÏûÑÏúºÎ°ú ÏûÖÏ£ºÏùº Ï†ÑÍπåÏßÄ Î≥¥Ïàò ÏôÑÎ£åÌïúÎã§.' },
                    { id: 5, title: 'ÎÖ∏ÌõÑÏÑ§ÎπÑ ÍµêÏ≤¥', text: 'ÏóêÏñ¥Ïª®, Î≥¥ÏùºÎü¨ Îì± Ï£ºÏöî ÏÑ§ÎπÑÍ∞Ä ÏûÖÏ£º Ï§ë ÎÖ∏ÌõÑÎ°ú Ïù∏Ìï¥ Í≥†Ïû• Ïãú ÏûÑÎåÄÏù∏Ïù¥ ÍµêÏ≤¥ ÎòêÎäî ÏàòÎ¶¨ ÎπÑÏö©ÏùÑ Î∂ÄÎã¥ÌïúÎã§.' },
                ],
                move: [
                    { id: 6, title: 'Ï°∞Í∏∞ Ìá¥Í±∞ Ïãú Î≥¥Ï¶ùÍ∏à', text: 'ÏûÑÏ∞®Ïù∏Ïù¥ Í≥ÑÏïΩ Í∏∞Í∞Ñ Ï§ë Ìá¥Í±∞Î•º ÏõêÌï† Í≤ΩÏö∞, 2Í∞úÏõî Ï†Ñ ÌÜµÎ≥¥ Ïãú ÏûîÏó¨ Í∏∞Í∞ÑÏóê ÎåÄÌïú ÏõîÏÑ∏ ÏÉÅÎãπÏï°Îßå Í≥µÏ†ú ÌõÑ Î≥¥Ï¶ùÍ∏àÏùÑ Î∞òÌôòÌïúÎã§.' },
                    { id: 7, title: 'Í≥ÑÏïΩ Ìï¥ÏßÄ ÌÜµÎ≥¥', text: 'Í≥ÑÏïΩ ÎßåÎ£å 1Í∞úÏõî Ï†ÑÍπåÏßÄ ÏåçÎ∞© Ï§ë ÏùºÎ∞©Ïù¥ Ìï¥ÏßÄ ÏùòÏÇ¨Î•º ÌÜµÎ≥¥ÌïòÏßÄ ÏïäÏúºÎ©¥ ÎèôÏùº Ï°∞Í±¥ÏúºÎ°ú 2ÎÖÑ Ïó∞Ïû•Îêú Í≤ÉÏúºÎ°ú Î≥∏Îã§.' },
                ],
                etc: [
                    { id: 8, title: 'Î∞òÎ†§ÎèôÎ¨º ÌóàÏö©', text: 'ÏûÑÏ∞®Ïù∏ÏùÄ ÏÜåÌòï Î∞òÎ†§ÎèôÎ¨º(10kg Ïù¥Ìïò)ÏùÑ ÌÇ§Ïö∏ Ïàò ÏûàÏúºÎ©∞, Ìá¥Í±∞ Ïãú Î∞òÎ†§ÎèôÎ¨ºÎ°ú Ïù∏Ìïú ÏÜêÏÉÅÏùÄ ÏûÑÏ∞®Ïù∏Ïù¥ ÏõêÏÉÅÎ≥µÍµ¨ÌïúÎã§.' },
                    { id: 9, title: 'Í¥ÄÎ¶¨ÎπÑ Î≤îÏúÑ', text: 'Í¥ÄÎ¶¨ÎπÑÏóêÎäî Í≥µÏö©Ï†ÑÍ∏∞, ÏàòÎèÑ, ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Ïú†ÏßÄÎπÑÍ∞Ä Ìè¨Ìï®ÎêòÎ©∞, Í∞úÎ≥Ñ ÎÇúÎ∞©ÎπÑ Î∞è Ïù∏ÌÑ∞ÎÑ∑ÏùÄ ÏûÑÏ∞®Ïù∏ Î∂ÄÎã¥ÏúºÎ°ú ÌïúÎã§.' },
                ],
            };

            const handleCopy = (id, text) => {
                navigator.clipboard.writeText(text);
                setCopied(id);
                setTimeout(() => setCopied(null), 2000);
            };

            const currentClauses = clauses[category] || [];

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <FileText className="w-4 h-4 mr-2 text-teal-600" /> ÌäπÏïΩ Ï°∞Ìï≠ Í∞ÄÏù¥Îìú
                    </h4>
                    <div className="flex gap-2 mb-4 overflow-x-auto pb-1">
                        {[{ id: 'safety', label: 'üõ°Ô∏è ÏïàÏ†Ñ' }, { id: 'maintenance', label: 'üîß ÌïòÏûê' }, { id: 'move', label: 'üöö Ìá¥Í±∞' }, { id: 'etc', label: 'üìã Í∏∞ÌÉÄ' }].map(c => (
                            <button key={c.id} onClick={() => setCategory(c.id)} className={`px-3 py-2 rounded-xl text-xs font-bold whitespace-nowrap ${category === c.id ? 'bg-teal-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                {c.label}
                            </button>
                        ))}
                    </div>
                    <div className="space-y-3">
                        {currentClauses.map(clause => (
                            <div key={clause.id} className="p-4 bg-slate-50 rounded-xl">
                                <div className="flex justify-between items-start mb-2">
                                    <p className="font-bold text-sm text-slate-800">{clause.title}</p>
                                    <button onClick={() => handleCopy(clause.id, clause.text)} className={`px-2 py-1 rounded text-xs font-bold transition-all ${copied === clause.id ? 'bg-green-500 text-white' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'}`}>
                                        {copied === clause.id ? 'Î≥µÏÇ¨Îê®!' : 'Î≥µÏÇ¨'}
                                    </button>
                                </div>
                                <p className="text-xs text-slate-600 leading-relaxed">{clause.text}</p>
                            </div>
                        ))}
                    </div>
                    <p className="text-xs text-center text-slate-400 mt-4">üí° ÌïÑÏöîÏóê Îî∞Îùº ÏàòÏ†ïÌïòÏó¨ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî</p>
                </div>
            );
        };

        // 8. Ìà¨ÏûêÌöåÏàòÍ∏∞Í∞Ñ(BEP) Í≥ÑÏÇ∞Í∏∞
        const InvestmentBEPCalculator = () => {
            const [totalInvestment, setTotalInvestment] = useState('');
            const [monthlyRent, setMonthlyRent] = useState('');
            const [vacancyRate, setVacancyRate] = useState('5');
            const [expenses, setExpenses] = useState('10');

            const result = useMemo(() => {
                const investment = parseNumber(totalInvestment) || 0;
                const rent = parseNumber(monthlyRent) || 0;
                const vacancy = parseFloat(vacancyRate) / 100 || 0;
                const exp = parseFloat(expenses) / 100 || 0;
                if (investment <= 0 || rent <= 0) return null;

                const effectiveRent = rent * (1 - vacancy);
                const netRent = effectiveRent * (1 - exp);
                const yearlyNet = netRent * 12;

                // 0 ÎÇòÎàÑÍ∏∞ Î∞©Ïñ¥
                if (yearlyNet <= 0) return null;

                const bepYears = investment / yearlyNet;
                const bepMonths = Math.round(bepYears * 12);
                const roi = (yearlyNet / investment) * 100;

                // NaN/Infinity Î∞©Ïñ¥
                if (!isFinite(bepYears) || !isFinite(roi)) return null;

                return { effectiveRent, netRent, yearlyNet, bepYears, bepMonths, roi };
            }, [totalInvestment, monthlyRent, vacancyRate, expenses]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-emerald-600" /> Ìà¨ÏûêÌöåÏàòÍ∏∞Í∞Ñ (BEP) Í≥ÑÏÇ∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Ï¥ù Ìà¨ÏûêÍ∏àÏï° (Îß§Îß§Í∞Ä+Ï∑®ÎìùÎπÑÏö©)" value={totalInvestment} onChange={setTotalInvestment} color="green" />
                        <NumberInput label="Ïõî ÏûÑÎåÄÎ£å (ÏòàÏÉÅ)" value={monthlyRent} onChange={setMonthlyRent} color="green" />
                        <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">Í≥µÏã§Î•† (%)</label>
                                <input type="number" value={vacancyRate} onChange={e => setVacancyRate(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">Ïö¥ÏòÅÎπÑÏö© (%)</label>
                                <input type="number" value={expenses} onChange={e => setExpenses(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="p-4 bg-emerald-50 rounded-xl text-center">
                                <p className="text-xs text-emerald-600 font-bold mb-1">Ìà¨Ïûê ÌöåÏàò Í∏∞Í∞Ñ (BEP)</p>
                                <p className="text-3xl font-black text-emerald-700">{result.bepYears.toFixed(1)}ÎÖÑ</p>
                                <p className="text-xs text-slate-500">ÏïΩ {result.bepMonths}Í∞úÏõî</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div className="p-3 bg-slate-50 rounded-xl text-center">
                                    <p className="text-xs text-slate-500">Ïó∞ ÏàòÏùµÎ•†</p>
                                    <p className="text-lg font-black text-indigo-600">{result.roi.toFixed(2)}%</p>
                                </div>
                                <div className="p-3 bg-slate-50 rounded-xl text-center">
                                    <p className="text-xs text-slate-500">Ïã§Ïßà Ïõî ÏàòÏùµ</p>
                                    <p className="text-lg font-black text-slate-700">{formatNumber(Math.round(result.netRent))}Ïõê</p>
                                </div>
                            </div>
                            <p className="text-xs text-center text-slate-400">* Í≥µÏã§Î•†/Ïö¥ÏòÅÎπÑ Î∞òÏòÅÎêú ÏàúÏàòÏùµ Í∏∞Ï§Ä</p>
                        </div>
                    )}
                </div>
            );
        };

        // 9. Ïó≠ÏÑ∏Í∂å Í±∞Î¶¨ Í≥ÑÏÇ∞Í∏∞
        const SubwayDistanceCalculator = () => {
            const [distance, setDistance] = useState('');
            const [propertyPrice, setPropertyPrice] = useState('');

            const result = useMemo(() => {
                const dist = parseFloat(distance) || 0;
                const price = parseNumber(propertyPrice);
                if (!dist) return null;

                let grade = '';
                let premium = 0;
                let walkTime = Math.round(dist / 80); // Î∂ÑÏÜç 80m

                if (dist <= 200) { grade = 'Ï¥àÏó≠ÏÑ∏Í∂å'; premium = 15; }
                else if (dist <= 500) { grade = 'Ïó≠ÏÑ∏Í∂å'; premium = 10; }
                else if (dist <= 1000) { grade = 'Ï§ÄÏó≠ÏÑ∏Í∂å'; premium = 5; }
                else { grade = 'Ïó≠ÏÑ∏Í∂å ÏïÑÎãò'; premium = 0; }

                const premiumValue = price ? Math.round(price * (premium / 100)) : 0;

                return { grade, premium, walkTime, premiumValue };
            }, [distance, propertyPrice]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Home className="w-4 h-4 mr-2 text-blue-600" /> Ïó≠ÏÑ∏Í∂å Í±∞Î¶¨ Í≥ÑÏÇ∞
                    </h4>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">ÏßÄÌïòÏ≤†Ïó≠ÍπåÏßÄ Í±∞Î¶¨ (m)</label>
                            <input type="number" value={distance} onChange={e => setDistance(e.target.value)} placeholder="Ïòà: 300" className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                        </div>
                        <NumberInput label="Îß§Î¨º Í∞ÄÍ≤© (ÏÑ†ÌÉùÏÇ¨Ìï≠)" value={propertyPrice} onChange={setPropertyPrice} color="blue" />
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-4 rounded-xl text-center ${result.premium >= 10 ? 'bg-blue-50' : result.premium > 0 ? 'bg-slate-50' : 'bg-red-50'}`}>
                                <p className="text-xs text-slate-600 font-bold mb-1">Ïó≠ÏÑ∏Í∂å Îì±Í∏â</p>
                                <p className={`text-2xl font-black ${result.premium >= 10 ? 'text-blue-600' : result.premium > 0 ? 'text-slate-700' : 'text-red-500'}`}>{result.grade}</p>
                                <p className="text-sm text-slate-500 mt-1">üö∂ ÎèÑÎ≥¥ ÏïΩ {result.walkTime}Î∂Ñ</p>
                            </div>
                            {result.premium > 0 && (
                                <div className="p-3 bg-green-50 rounded-xl text-center">
                                    <p className="text-xs text-green-600 font-bold">ÏòàÏÉÅ ÌîÑÎ¶¨ÎØ∏ÏóÑ</p>
                                    <p className="text-lg font-black text-green-700">+{result.premium}%</p>
                                    {result.premiumValue > 0 && <p className="text-xs text-slate-500">ÏïΩ {formatCompactNumber(result.premiumValue)} ÏÉÅÏäπ Ìö®Í≥º</p>}
                                </div>
                            )}
                            <div className="p-3 bg-slate-50 rounded-xl text-xs text-slate-600">
                                <p className="font-bold mb-1">üìç Ïó≠ÏÑ∏Í∂å Í∏∞Ï§Ä</p>
                                <p>‚Ä¢ Ï¥àÏó≠ÏÑ∏Í∂å: 200m Ïù¥ÎÇ¥</p>
                                <p>‚Ä¢ Ïó≠ÏÑ∏Í∂å: 500m Ïù¥ÎÇ¥</p>
                                <p>‚Ä¢ Ï§ÄÏó≠ÏÑ∏Í∂å: 1km Ïù¥ÎÇ¥</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ========== NEW FEATURES END ==========

        // ========== PHASE 2 NEW FEATURES START ==========

        // 1. Ï†ÑÏÑ∏ÏÇ¨Í∏∞ ÏßÑÎã® Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
        const JeonseFraudChecker = () => {
            const [deposit, setDeposit] = useState('');
            const [marketPrice, setMarketPrice] = useState('');
            const [checks, setChecks] = usePersistedState('fraudChecks', {});

            const toggle = (id) => setChecks(prev => ({ ...prev, [id]: !prev[id] }));

            const checkItems = [
                { id: 'owner', label: 'Îì±Í∏∞Î∂ÄÎì±Î≥∏ ÏÜåÏú†ÏûêÏôÄ Í≥ÑÏïΩÏûê ÎèôÏùº ÌôïÏù∏', critical: true, category: 'Ïã†Ïõê' },
                { id: 'mortgage', label: 'Í∑ºÏ†ÄÎãπ ÏÑ§Ï†ï Í∏àÏï° ÌôïÏù∏ (Ï±ÑÍ∂åÏµúÍ≥†Ïï°)', critical: true, category: 'Îì±Í∏∞' },
                { id: 'seizure', label: 'Í∞ÄÏïïÎ•ò/Í∞ÄÏ≤òÎ∂Ñ ÏóÜÏùå ÌôïÏù∏', critical: true, category: 'Îì±Í∏∞' },
                { id: 'tax', label: 'ÏûÑÎåÄÏù∏ ÏÑ∏Í∏àÏ≤¥ÎÇ© Ïó¨Î∂Ä ÌôïÏù∏', critical: true, category: 'Ïã†Ïõê' },
                { id: 'insurance', label: 'HUG/SGI Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∞ÄÏûÖ', critical: true, category: 'Î≥¥Ìóò' },
                { id: 'ratio', label: 'Ï†ÑÏÑ∏Í∞ÄÏú® 80% Ïù¥Ìïò ÌôïÏù∏', critical: false, category: 'ÏãúÏÑ∏' },
                { id: 'id', label: 'ÏûÑÎåÄÏù∏ Ïã†Î∂ÑÏ¶ù ÌôïÏù∏ (Îì±Í∏∞Í∂åÎ¶¨Ï¶ù ÎåÄÏ°∞)', critical: false, category: 'Ïã†Ïõê' },
                { id: 'visit', label: 'ÌòÑÏû• Î∞©Î¨∏ Î∞è Ïã§Í±∞Ï£ºÏûê ÌôïÏù∏', critical: false, category: 'ÌòÑÏû•' },
                { id: 'account', label: 'ÏûÑÎåÄÏù∏ Î≥∏Ïù∏ Î™ÖÏùò Í≥ÑÏ¢å ÌôïÏù∏', critical: false, category: 'Í≥ÑÏ¢å' },
                { id: 'report', label: 'Ï†ÑÏûÖÏã†Í≥† + ÌôïÏ†ïÏùºÏûê ÏòàÏ†ï', critical: true, category: 'Í∂åÎ¶¨' },
            ];

            const depositVal = parseNumber(deposit);
            const priceVal = parseNumber(marketPrice);
            const jeonseRate = priceVal > 0 ? (depositVal / priceVal * 100) : 0;

            const criticalChecked = checkItems.filter(c => c.critical && checks[c.id]).length;
            const criticalTotal = checkItems.filter(c => c.critical).length;
            const totalChecked = Object.values(checks).filter(Boolean).length;

            const getRiskLevel = () => {
                if (jeonseRate > 90) return { level: 'Í≥†ÏúÑÌóò', color: 'red', icon: 'üö®' };
                if (jeonseRate > 80) return { level: 'Ï£ºÏùò', color: 'orange', icon: '‚ö†Ô∏è' };
                if (criticalChecked < criticalTotal) return { level: 'ÌôïÏù∏ÌïÑÏöî', color: 'yellow', icon: 'üìã' };
                return { level: 'ÏïàÏ†Ñ', color: 'green', icon: '‚úÖ' };
            };

            const risk = getRiskLevel();

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Shield className="w-4 h-4 mr-2 text-red-500" /> Ï†ÑÏÑ∏ÏÇ¨Í∏∞ ÏßÑÎã® Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                    </h4>
                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-3">
                            <NumberInput label="Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="red" />
                            <NumberInput label="ÏãúÏÑ∏ (Îß§Îß§Í∞Ä)" value={marketPrice} onChange={setMarketPrice} color="slate" />
                        </div>
                        {priceVal > 0 && (
                            <div className={`p-4 rounded-xl text-center ${jeonseRate > 90 ? 'bg-red-50' : jeonseRate > 80 ? 'bg-orange-50' : 'bg-green-50'}`}>
                                <p className="text-xs text-slate-500 mb-1">Ï†ÑÏÑ∏Í∞ÄÏú®</p>
                                <p className={`text-3xl font-black ${jeonseRate > 90 ? 'text-red-600' : jeonseRate > 80 ? 'text-orange-500' : 'text-green-600'}`}>
                                    {jeonseRate.toFixed(1)}%
                                </p>
                                <p className="text-xs mt-1">{jeonseRate > 80 ? '‚ö†Ô∏è Íπ°ÌÜµÏ†ÑÏÑ∏ ÏúÑÌóò' : '‚úÖ Ï†ÅÏ†ï ÏàòÏ§Ä'}</p>
                            </div>
                        )}
                        <div className="space-y-2">
                            <p className="text-xs font-bold text-slate-500">ÌïÑÏàò ÌôïÏù∏ÏÇ¨Ìï≠ ({criticalChecked}/{criticalTotal})</p>
                            {checkItems.map(item => (
                                <label key={item.id} className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all ${checks[item.id] ? 'bg-green-50 border border-green-200' : 'bg-slate-50 border border-transparent'}`}>
                                    <input type="checkbox" checked={checks[item.id] || false} onChange={() => toggle(item.id)} className="w-5 h-5 rounded" />
                                    <span className={`text-sm flex-1 ${checks[item.id] ? 'text-green-700' : 'text-slate-600'}`}>
                                        {item.critical && <span className="text-red-500 mr-1">*</span>}
                                        {item.label}
                                    </span>
                                    <span className="text-[10px] px-2 py-0.5 bg-slate-200 text-slate-500 rounded">{item.category}</span>
                                </label>
                            ))}
                        </div>
                        <div className={`p-4 rounded-xl text-center bg-${risk.color}-50`}>
                            <p className="text-xs text-slate-500 mb-1">Ï¢ÖÌï© ÌåêÏ†ï</p>
                            <p className={`text-2xl font-black text-${risk.color}-600`}>{risk.icon} {risk.level}</p>
                            <p className="text-xs text-slate-500 mt-1">Ï≤¥ÌÅ¨ÏôÑÎ£å: {totalChecked}/{checkItems.length}Í∞ú</p>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. ÏõîÏÑ∏ ‚Üî Ï†ÑÏÑ∏ ÏñëÎ∞©Ìñ• ÌôòÏÇ∞Í∏∞
        const BidirectionalRentConverter = () => {
            const [mode, setMode] = useState('jeonseToMonthly');
            const [jeonseDeposit, setJeonseDeposit] = useState('');
            const [monthlyDeposit, setMonthlyDeposit] = useState('');
            const [monthlyRent, setMonthlyRent] = useState('');
            const [conversionRate, setConversionRate] = useState('5.5');

            const result = useMemo(() => {
                const rate = parseFloat(conversionRate) || 5.5;
                if (mode === 'jeonseToMonthly') {
                    const jeonse = parseNumber(jeonseDeposit);
                    const newDeposit = parseNumber(monthlyDeposit);
                    if (jeonse <= 0) return null;
                    const diff = jeonse - newDeposit;
                    const monthly = Math.floor(diff * (rate / 100) / 12);
                    return { monthly, diff, description: `Î≥¥Ï¶ùÍ∏à ${formatCompactNumber(newDeposit)} + ÏõîÏÑ∏ ${formatNumber(monthly)}Ïõê` };
                } else {
                    const deposit = parseNumber(monthlyDeposit);
                    const monthly = parseNumber(monthlyRent);
                    if (monthly <= 0) return null;
                    const convertedDeposit = Math.floor(monthly * 12 / (rate / 100));
                    const totalJeonse = deposit + convertedDeposit;
                    return { totalJeonse, convertedDeposit, description: `ÏàúÏàòÏ†ÑÏÑ∏ ${formatCompactNumber(totalJeonse)}` };
                }
            }, [mode, jeonseDeposit, monthlyDeposit, monthlyRent, conversionRate]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <ArrowRightLeft className="w-4 h-4 mr-2 text-purple-500" /> ÏõîÏÑ∏ ‚Üî Ï†ÑÏÑ∏ ÏñëÎ∞©Ìñ• ÌôòÏÇ∞
                    </h4>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setMode('jeonseToMonthly')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${mode === 'jeonseToMonthly' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                            Ï†ÑÏÑ∏ ‚Üí ÏõîÏÑ∏
                        </button>
                        <button onClick={() => setMode('monthlyToJeonse')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${mode === 'monthlyToJeonse' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                            ÏõîÏÑ∏ ‚Üí Ï†ÑÏÑ∏
                        </button>
                    </div>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-1">Ï†ÑÏõîÏÑ∏Ï†ÑÌôòÏú® (%)</label>
                            <input type="number" value={conversionRate} onChange={e => setConversionRate(e.target.value)} step="0.1" className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" />
                            <p className="text-[10px] text-slate-400 mt-1">* Î≤ïÏ†ï ÏÉÅÌïú: Í∏∞Ï§ÄÍ∏àÎ¶¨(2.5%) + 3.5% = 6.0%</p>
                        </div>
                        {mode === 'jeonseToMonthly' ? (
                            <>
                                <NumberInput label="ÌòÑÏû¨ Ï†ÑÏÑ∏Í∏à" value={jeonseDeposit} onChange={setJeonseDeposit} color="purple" />
                                <NumberInput label="Ï†ÑÌôò ÌõÑ Î≥¥Ï¶ùÍ∏à" value={monthlyDeposit} onChange={setMonthlyDeposit} color="slate" />
                            </>
                        ) : (
                            <>
                                <NumberInput label="ÌòÑÏû¨ Î≥¥Ï¶ùÍ∏à" value={monthlyDeposit} onChange={setMonthlyDeposit} color="slate" />
                                <NumberInput label="ÌòÑÏû¨ ÏõîÏÑ∏" value={monthlyRent} onChange={setMonthlyRent} color="purple" />
                            </>
                        )}
                    </div>
                    {result && (
                        <div className="mt-4 p-4 bg-purple-50 rounded-xl text-center">
                            <p className="text-xs text-purple-600 font-bold mb-1">{mode === 'jeonseToMonthly' ? 'Ï†ÑÌôò Í≤∞Í≥º' : 'Ï†ÑÏÑ∏ ÌôòÏÇ∞Ïï°'}</p>
                            <p className="text-2xl font-black text-purple-700">{result.description}</p>
                            {mode === 'jeonseToMonthly' && (
                                <p className="text-xs text-slate-500 mt-1">Ï∞®Ïï° {formatCompactNumber(result.diff)} Ï†ÑÌôò</p>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // 3. Î≥¥Ï¶ùÍ∏à Î∂ÑÌï†ÎÇ©Î∂Ä Ïä§ÏºÄÏ§ÑÎü¨
        const DepositScheduler = () => {
            const [totalDeposit, setTotalDeposit] = useState('');
            const [contractDate, setContractDate] = useState('');
            const [moveInDate, setMoveInDate] = useState('');
            const [schedule, setSchedule] = useState([
                { id: 'contract', label: 'Í≥ÑÏïΩÍ∏à', percent: 10, date: '' },
                { id: 'interim', label: 'Ï§ëÎèÑÍ∏à', percent: 10, date: '' },
                { id: 'balance', label: 'ÏûîÍ∏à', percent: 80, date: '' },
            ]);

            const updateSchedule = (id, field, value) => {
                setSchedule(schedule.map(s => s.id === id ? { ...s, [field]: value } : s));
            };

            const totalPercent = schedule.reduce((sum, s) => sum + (parseInt(s.percent) || 0), 0);
            const depositVal = parseNumber(totalDeposit);

            const getDday = (dateStr) => {
                if (!dateStr) return null;
                const target = new Date(dateStr);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                target.setHours(0, 0, 0, 0);
                const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                return diff;
            };

            const exportToICS = () => {
                let icsContent = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Î∂ÄÎèôÏÇ∞ÎßàÏä§ÌÑ∞Pro//KR\n`;
                schedule.forEach(s => {
                    if (s.date) {
                        const dateFormatted = s.date.replace(/-/g, '');
                        const amount = Math.floor(depositVal * (parseInt(s.percent) || 0) / 100);
                        icsContent += `BEGIN:VEVENT\nDTSTART;VALUE=DATE:${dateFormatted}\nSUMMARY:${s.label} ÎÇ©Î∂Ä (${formatNumber(amount)}Ïõê)\nDESCRIPTION:Î∂ÄÎèôÏÇ∞ ${s.label} ÎÇ©Î∂ÄÏùº\nEND:VEVENT\n`;
                    }
                });
                icsContent += `END:VCALENDAR`;
                const blob = new Blob([icsContent], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Î≥¥Ï¶ùÍ∏à_ÏùºÏ†ï.ics';
                a.click();
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Calendar className="w-4 h-4 mr-2 text-teal-500" /> Î≥¥Ï¶ùÍ∏à Î∂ÑÌï†ÎÇ©Î∂Ä Ïä§ÏºÄÏ§ÑÎü¨
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Ï¥ù Î≥¥Ï¶ùÍ∏à" value={totalDeposit} onChange={setTotalDeposit} color="teal" />
                        <div className="space-y-3">
                            {schedule.map((s, idx) => {
                                const amount = Math.floor(depositVal * (parseInt(s.percent) || 0) / 100);
                                const dday = getDday(s.date);
                                return (
                                    <div key={s.id} className="p-4 bg-slate-50 rounded-xl">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="font-bold text-sm text-slate-700">{s.label}</span>
                                            {dday !== null && (
                                                <span className={`text-xs font-bold px-2 py-0.5 rounded ${dday < 0 ? 'bg-slate-200 text-slate-500' : dday <= 7 ? 'bg-red-100 text-red-600' : 'bg-teal-100 text-teal-600'}`}>
                                                    {dday < 0 ? 'ÏôÑÎ£å' : dday === 0 ? 'D-Day' : `D-${dday}`}
                                                </span>
                                            )}
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div>
                                                <label className="text-[10px] text-slate-400">ÎπÑÏú® (%)</label>
                                                <input type="number" value={s.percent} onChange={e => updateSchedule(s.id, 'percent', e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-right font-bold text-sm outline-none" />
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-slate-400">ÎÇ†Ïßú</label>
                                                <input type="date" value={s.date} onChange={e => updateSchedule(s.id, 'date', e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-sm outline-none" />
                                            </div>
                                        </div>
                                        {depositVal > 0 && (
                                            <p className="text-xs text-teal-600 font-bold mt-2 text-right">{formatNumber(amount)}Ïõê</p>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                        {totalPercent !== 100 && (
                            <p className="text-xs text-red-500 text-center">‚ö†Ô∏è ÎπÑÏú® Ìï©Í≥Ñ: {totalPercent}% (100% ÌïÑÏöî)</p>
                        )}
                        <button onClick={exportToICS} disabled={!depositVal || totalPercent !== 100} className="w-full py-3 bg-teal-500 hover:bg-teal-600 text-white rounded-xl font-bold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            üìÖ Ï∫òÎ¶∞ÎçîÏóê ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (.ics)
                        </button>
                    </div>
                </div>
            );
        };

        // ========== PHASE 2 NEW FEATURES CONTINUE ==========

        // 4. ÏãúÏÑ∏ Ìä∏ÎûòÏª§ (Îç∞Î™® Îç∞Ïù¥ÌÑ∞)
        const MarketPriceTracker = () => {
            const chartRef = React.useRef(null);
            const chartInstanceRef = React.useRef(null);
            const [selectedDistrict, setSelectedDistrict] = useState('Í∞ïÎÇ®Íµ¨');

            const seoulData = [
                { district: 'Í∞ïÎÇ®Íµ¨', apt: 185000, jeonse: 92000, change: 2.1 },
                { district: 'ÏÑúÏ¥àÍµ¨', apt: 175000, jeonse: 87000, change: 1.8 },
                { district: 'ÏÜ°ÌååÍµ¨', apt: 145000, jeonse: 72000, change: 1.5 },
                { district: 'Ïö©ÏÇ∞Íµ¨', apt: 155000, jeonse: 78000, change: 2.5 },
                { district: 'ÎßàÌè¨Íµ¨', apt: 115000, jeonse: 57000, change: 1.2 },
                { district: 'ÏÑ±ÎèôÍµ¨', apt: 125000, jeonse: 62000, change: 1.0 },
                { district: 'ÏòÅÎì±Ìè¨Íµ¨', apt: 95000, jeonse: 48000, change: 0.8 },
                { district: 'Í¥ëÏßÑÍµ¨', apt: 105000, jeonse: 52000, change: 0.9 },
                { district: 'ÎèôÏûëÍµ¨', apt: 98000, jeonse: 49000, change: 0.7 },
                { district: 'Í∞ïÎèôÍµ¨', apt: 110000, jeonse: 55000, change: 1.1 },
            ];

            useEffect(() => {
                if (!chartRef.current || !window.Chart) return;
                if (chartInstanceRef.current) chartInstanceRef.current.destroy();

                const ctx = chartRef.current.getContext('2d');
                const top5 = [...seoulData].sort((a, b) => b.apt - a.apt).slice(0, 5);

                chartInstanceRef.current = new window.Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: top5.map(d => d.district),
                        datasets: [{
                            label: 'Îß§Îß§ (ÎßåÏõê/„é°)',
                            data: top5.map(d => d.apt),
                            backgroundColor: '#6366f1',
                            borderRadius: 8,
                        }, {
                            label: 'Ï†ÑÏÑ∏ (ÎßåÏõê/„é°)',
                            data: top5.map(d => d.jeonse),
                            backgroundColor: '#ec4899',
                            borderRadius: 8,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { position: 'bottom', labels: { font: { size: 11, weight: 'bold' } } } },
                        scales: { y: { beginAtZero: true, ticks: { callback: v => formatCompactNumber(v * 10000) } } }
                    }
                });

                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); };
            }, []);

            const selected = seoulData.find(d => d.district === selectedDistrict);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <BarChart3 className="w-4 h-4 mr-2 text-indigo-500" /> ÏÑúÏö∏ ÏãúÏÑ∏ Ìä∏ÎûòÏª§ (2026.01 Í∏∞Ï§Ä)
                    </h4>
                    <div className="mb-4">
                        <canvas ref={chartRef} height="200"></canvas>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-slate-500 block mb-2">ÏßÄÏó≠ ÏÑ†ÌÉù</label>
                        <select value={selectedDistrict} onChange={e => setSelectedDistrict(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold outline-none">
                            {seoulData.map(d => <option key={d.district} value={d.district}>{d.district}</option>)}
                        </select>
                    </div>
                    {selected && (
                        <div className="mt-4 grid grid-cols-3 gap-2 text-center">
                            <div className="p-3 bg-indigo-50 rounded-xl">
                                <p className="text-[10px] text-slate-500">Îß§Îß§Í∞Ä</p>
                                <p className="text-lg font-black text-indigo-600">{formatCompactNumber(selected.apt * 10000)}</p>
                            </div>
                            <div className="p-3 bg-pink-50 rounded-xl">
                                <p className="text-[10px] text-slate-500">Ï†ÑÏÑ∏Í∞Ä</p>
                                <p className="text-lg font-black text-pink-600">{formatCompactNumber(selected.jeonse * 10000)}</p>
                            </div>
                            <div className={`p-3 rounded-xl ${selected.change >= 0 ? 'bg-green-50' : 'bg-red-50'}`}>
                                <p className="text-[10px] text-slate-500">Ï†ÑÏõîÎåÄÎπÑ</p>
                                <p className={`text-lg font-black ${selected.change >= 0 ? 'text-green-600' : 'text-red-600'}`}>{selected.change >= 0 ? '+' : ''}{selected.change}%</p>
                            </div>
                        </div>
                    )}
                    <p className="text-[10px] text-slate-400 text-center mt-3">* Îç∞Î™® Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§. Ïã§Ï†ú ÏãúÏÑ∏Îäî KBÎ∂ÄÎèôÏÇ∞/ÎÑ§Ïù¥Î≤ÑÎ∂ÄÎèôÏÇ∞ Ï∞∏Í≥†</p>
                </div>
            );
        };

        // 5. Î≥µÌï© ÎåÄÏ∂ú Í≥ÑÏÇ∞Í∏∞ (Ï£ºÎã¥ÎåÄ + Ïã†Ïö©ÎåÄÏ∂ú DSR)
        const CombinedLoanCalculator = () => {
            const [annualIncome, setAnnualIncome] = useState('');
            const [mortgageAmount, setMortgageAmount] = useState('');
            const [mortgageRate, setMortgageRate] = useState('4.5');
            const [mortgagePeriod, setMortgagePeriod] = useState('360');
            const [creditAmount, setCreditAmount] = useState('');
            const [creditRate, setCreditRate] = useState('6.5');
            const [creditPeriod, setCreditPeriod] = useState('60');

            const result = useMemo(() => {
                const income = parseNumber(annualIncome);
                const mortgage = parseNumber(mortgageAmount);
                const credit = parseNumber(creditAmount);
                if (income <= 0) return null;

                const calcMonthlyPayment = (principal, rate, months) => {
                    if (principal <= 0 || months <= 0) return 0;
                    const r = (parseFloat(rate) || 0) / 100 / 12;
                    if (r <= 0) return principal / months;
                    const factor = Math.pow(1 + r, months);
                    return (principal * r * factor) / (factor - 1);
                };

                const mortgageMonthly = calcMonthlyPayment(mortgage, mortgageRate, parseInt(mortgagePeriod));
                const creditMonthly = calcMonthlyPayment(credit, creditRate, parseInt(creditPeriod));
                const totalMonthly = mortgageMonthly + creditMonthly;
                const annualPayment = totalMonthly * 12;
                const dsr = (annualPayment / income) * 100;
                const limit = 40;
                const remaining = Math.max(0, (income * (limit / 100) - annualPayment) / 12);

                return { mortgageMonthly, creditMonthly, totalMonthly, dsr, remaining, isOver: dsr > limit };
            }, [annualIncome, mortgageAmount, mortgageRate, mortgagePeriod, creditAmount, creditRate, creditPeriod]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Banknote className="w-4 h-4 mr-2 text-emerald-500" /> Î≥µÌï© ÎåÄÏ∂ú Í≥ÑÏÇ∞Í∏∞ (DSR Ìï©ÏÇ∞)
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="Ïó∞ ÏÜåÎìù" value={annualIncome} onChange={setAnnualIncome} color="emerald" />
                        <div className="p-4 bg-indigo-50 rounded-xl">
                            <p className="text-xs font-bold text-indigo-600 mb-2">üè† Ï£ºÌÉùÎã¥Î≥¥ÎåÄÏ∂ú</p>
                            <div className="grid grid-cols-3 gap-2">
                                <div className="col-span-3"><NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={mortgageAmount} onChange={setMortgageAmount} color="indigo" /></div>
                                <div><label className="text-[10px] text-slate-500">Í∏àÎ¶¨(%)</label><input type="number" value={mortgageRate} onChange={e => setMortgageRate(e.target.value)} className="w-full px-2 py-1.5 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                                <div className="col-span-2"><label className="text-[10px] text-slate-500">Í∏∞Í∞Ñ(Í∞úÏõî)</label><input type="number" value={mortgagePeriod} onChange={e => setMortgagePeriod(e.target.value)} className="w-full px-2 py-1.5 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                            </div>
                        </div>
                        <div className="p-4 bg-orange-50 rounded-xl">
                            <p className="text-xs font-bold text-orange-600 mb-2">üí≥ Ïã†Ïö©ÎåÄÏ∂ú</p>
                            <div className="grid grid-cols-3 gap-2">
                                <div className="col-span-3"><NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={creditAmount} onChange={setCreditAmount} color="orange" /></div>
                                <div><label className="text-[10px] text-slate-500">Í∏àÎ¶¨(%)</label><input type="number" value={creditRate} onChange={e => setCreditRate(e.target.value)} className="w-full px-2 py-1.5 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                                <div className="col-span-2"><label className="text-[10px] text-slate-500">Í∏∞Í∞Ñ(Í∞úÏõî)</label><input type="number" value={creditPeriod} onChange={e => setCreditPeriod(e.target.value)} className="w-full px-2 py-1.5 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-4 rounded-xl text-center ${result.isOver ? 'bg-red-50' : 'bg-green-50'}`}>
                                <p className="text-xs text-slate-500 mb-1">Ï¥ù DSR</p>
                                <p className={`text-3xl font-black ${result.isOver ? 'text-red-600' : 'text-green-600'}`}>{result.dsr.toFixed(1)}%</p>
                                <p className="text-xs mt-1">{result.isOver ? '‚ùå ÌïúÎèÑ Ï¥àÍ≥º (40% Ïù¥ÏÉÅ)' : '‚úÖ ÎåÄÏ∂ú Í∞ÄÎä•'}</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2 text-xs">
                                <div className="p-3 bg-indigo-50 rounded-xl"><p className="text-slate-500">Ï£ºÎã¥ÎåÄ ÏõîÏÉÅÌôò</p><p className="font-bold text-indigo-600">{formatNumber(Math.round(result.mortgageMonthly))}Ïõê</p></div>
                                <div className="p-3 bg-orange-50 rounded-xl"><p className="text-slate-500">Ïã†Ïö© ÏõîÏÉÅÌôò</p><p className="font-bold text-orange-600">{formatNumber(Math.round(result.creditMonthly))}Ïõê</p></div>
                            </div>
                            <div className="p-3 bg-slate-50 rounded-xl text-center">
                                <p className="text-xs text-slate-500">Ï∂îÍ∞Ä ÎåÄÏ∂ú Ïó¨Î†• (Ïõî)</p>
                                <p className="text-lg font-black text-slate-700">{formatNumber(Math.round(result.remaining))}Ïõê</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 6. Í∏àÎ¶¨ Ïù∏Ìïò ÏãúÎÆ¨Î†àÏù¥ÌÑ∞
        const InterestRateCutSimulator = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [currentRate, setCurrentRate] = useState('4.5');
            const [period, setPeriod] = useState('360');

            const result = useMemo(() => {
                const amount = parseNumber(loanAmount);
                const rate = parseFloat(currentRate) || 0;
                const months = parseInt(period) || 360;
                if (amount <= 0 || rate <= 0) return null;

                const calcMonthly = (r) => {
                    const monthlyRate = r / 100 / 12;
                    if (monthlyRate <= 0) return 0;
                    const factor = Math.pow(1 + monthlyRate, months);
                    return (amount * monthlyRate * factor) / (factor - 1);
                };

                const scenarios = [0, 0.25, 0.5, 1.0, 1.5].map(cut => {
                    const newRate = Math.max(rate - cut, 0.5);
                    const monthly = calcMonthly(newRate);
                    const baseMonthly = calcMonthly(rate);
                    return { cut, rate: newRate, monthly, saved: baseMonthly - monthly, yearlySaved: (baseMonthly - monthly) * 12 };
                });

                return scenarios;
            }, [loanAmount, currentRate, period]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <TrendingUp className="w-4 h-4 mr-2 text-cyan-500" /> Í∏àÎ¶¨ Ïù∏Ìïò ÏãúÎÆ¨Î†àÏù¥ÌÑ∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎåÄÏ∂ú ÏûîÏï°" value={loanAmount} onChange={setLoanAmount} color="cyan" />
                        <div className="grid grid-cols-2 gap-3">
                            <div><label className="text-xs font-bold text-slate-500 block mb-1">ÌòÑÏû¨ Í∏àÎ¶¨ (%)</label><input type="number" value={currentRate} onChange={e => setCurrentRate(e.target.value)} step="0.1" className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" /></div>
                            <div><label className="text-xs font-bold text-slate-500 block mb-1">ÏûîÏó¨ Í∏∞Í∞Ñ (Í∞úÏõî)</label><input type="number" value={period} onChange={e => setPeriod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" /></div>
                        </div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-2">
                            {result.map((s, idx) => (
                                <div key={idx} className={`p-4 rounded-xl flex justify-between items-center ${idx === 0 ? 'bg-slate-100' : 'bg-cyan-50'}`}>
                                    <div>
                                        <p className="font-bold text-sm">{s.cut === 0 ? 'ÌòÑÏû¨' : `-${s.cut}%p Ïù∏Ìïò`}</p>
                                        <p className="text-xs text-slate-500">Ïó∞ {s.rate.toFixed(2)}%</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-lg font-black text-slate-800">{formatNumber(Math.round(s.monthly))}Ïõê</p>
                                        {s.saved > 0 && <p className="text-xs text-cyan-600 font-bold">Ïõî -{formatNumber(Math.round(s.saved))}Ïõê</p>}
                                    </div>
                                </div>
                            ))}
                            <p className="text-xs text-center text-slate-400 mt-2">üí° ÎåÄÌôòÎåÄÏ∂ú ÎòêÎäî Í∏àÌÜµÏúÑ Í∏àÎ¶¨ Ïù∏Ìïò Ïãú Ï∞∏Í≥†</p>
                        </div>
                    )}
                </div>
            );
        };

        // ========== PHASE 2 NEW FEATURES MORE ==========

        // 7. ÎåÄÌôòÎåÄÏ∂ú Î∂ÑÏÑùÍ∏∞
        const LoanRefinancingAnalyzer = () => {
            const [currentLoan, setCurrentLoan] = useState('');
            const [currentRate, setCurrentRate] = useState('5.0');
            const [remainingMonths, setRemainingMonths] = useState('300');
            const [newRate, setNewRate] = useState('4.0');
            const [newPeriod, setNewPeriod] = useState('360');
            const [refinanceFee, setRefinanceFee] = useState('0.5');

            const result = useMemo(() => {
                const loan = parseNumber(currentLoan);
                const oldRate = parseFloat(currentRate) || 0;
                const oldMonths = parseInt(remainingMonths) || 0;
                const nRate = parseFloat(newRate) || 0;
                const nMonths = parseInt(newPeriod) || 0;
                const fee = parseFloat(refinanceFee) || 0;
                if (loan <= 0 || oldRate <= 0 || nRate <= 0) return null;

                const calcMonthly = (principal, rate, months) => {
                    const r = rate / 100 / 12;
                    if (r <= 0) return principal / months;
                    const factor = Math.pow(1 + r, months);
                    return (principal * r * factor) / (factor - 1);
                };

                const oldMonthly = calcMonthly(loan, oldRate, oldMonths);
                const oldTotalInterest = oldMonthly * oldMonths - loan;
                const newMonthly = calcMonthly(loan, nRate, nMonths);
                const newTotalInterest = newMonthly * nMonths - loan;
                const refinanceCost = loan * (fee / 100);
                const interestSaved = oldTotalInterest - newTotalInterest;
                const netSaving = interestSaved - refinanceCost;
                const monthlySaved = oldMonthly - newMonthly;
                const breakEvenMonths = monthlySaved > 0 ? Math.ceil(refinanceCost / monthlySaved) : 0;

                return { oldMonthly, newMonthly, monthlySaved, oldTotalInterest, newTotalInterest, refinanceCost, interestSaved, netSaving, breakEvenMonths, isWorth: netSaving > 0 };
            }, [currentLoan, currentRate, remainingMonths, newRate, newPeriod, refinanceFee]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <RefreshCw className="w-4 h-4 mr-2 text-violet-500" /> ÎåÄÌôòÎåÄÏ∂ú Î∂ÑÏÑùÍ∏∞
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÌòÑÏû¨ ÎåÄÏ∂ú ÏûîÏï°" value={currentLoan} onChange={setCurrentLoan} color="violet" />
                        <div className="p-4 bg-slate-50 rounded-xl">
                            <p className="text-xs font-bold text-slate-600 mb-2">üìå ÌòÑÏû¨ ÎåÄÏ∂ú</p>
                            <div className="grid grid-cols-2 gap-2">
                                <div><label className="text-[10px] text-slate-500">Í∏àÎ¶¨(%)</label><input type="number" value={currentRate} onChange={e => setCurrentRate(e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                                <div><label className="text-[10px] text-slate-500">ÏûîÏó¨Í∏∞Í∞Ñ(Í∞úÏõî)</label><input type="number" value={remainingMonths} onChange={e => setRemainingMonths(e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                            </div>
                        </div>
                        <div className="p-4 bg-violet-50 rounded-xl">
                            <p className="text-xs font-bold text-violet-600 mb-2">üîÑ Ïã†Í∑ú ÎåÄÏ∂ú</p>
                            <div className="grid grid-cols-2 gap-2">
                                <div><label className="text-[10px] text-slate-500">Í∏àÎ¶¨(%)</label><input type="number" value={newRate} onChange={e => setNewRate(e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                                <div><label className="text-[10px] text-slate-500">Í∏∞Í∞Ñ(Í∞úÏõî)</label><input type="number" value={newPeriod} onChange={e => setNewPeriod(e.target.value)} className="w-full px-3 py-2 bg-white rounded-lg text-sm font-bold text-right outline-none" /></div>
                            </div>
                        </div>
                        <div><label className="text-xs font-bold text-slate-500 block mb-1">ÎåÄÌôò ÏàòÏàòÎ£å (%)</label><input type="number" value={refinanceFee} onChange={e => setRefinanceFee(e.target.value)} step="0.1" className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" /></div>
                    </div>
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-4 rounded-xl text-center ${result.isWorth ? 'bg-green-50' : 'bg-red-50'}`}>
                                <p className="text-xs text-slate-500 mb-1">Ïàú Ï†àÍ∞êÏï°</p>
                                <p className={`text-3xl font-black ${result.isWorth ? 'text-green-600' : 'text-red-600'}`}>{result.netSaving > 0 ? '+' : ''}{formatCompactNumber(result.netSaving)}</p>
                                <p className="text-xs mt-1">{result.isWorth ? '‚úÖ ÎåÄÌôò Ï∂îÏ≤ú' : '‚ùå ÎåÄÌôò ÎπÑÏ∂îÏ≤ú'}</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2 text-xs">
                                <div className="p-3 bg-slate-50 rounded-xl"><p className="text-slate-500">ÌòÑÏû¨ ÏõîÏÉÅÌôò</p><p className="font-bold">{formatNumber(Math.round(result.oldMonthly))}Ïõê</p></div>
                                <div className="p-3 bg-violet-50 rounded-xl"><p className="text-slate-500">ÎåÄÌôò ÌõÑ ÏõîÏÉÅÌôò</p><p className="font-bold text-violet-600">{formatNumber(Math.round(result.newMonthly))}Ïõê</p></div>
                            </div>
                            {result.breakEvenMonths > 0 && (
                                <div className="p-3 bg-amber-50 rounded-xl text-center text-xs">
                                    <p className="text-slate-500">ÏÜêÏùµÎ∂ÑÍ∏∞Ï†ê</p>
                                    <p className="font-bold text-amber-600">{result.breakEvenMonths}Í∞úÏõî ÌõÑ</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // 8. Ï†ïÎ∂Ä Ï†ïÏ±Ö ÎåÄÏ∂ú ÏûêÍ≤© ÌôïÏù∏
        const GovernmentLoanEligibility = () => {
            const [age, setAge] = useState('');
            const [income, setIncome] = useState('');
            const [assets, setAssets] = useState('');
            const [homeOwnership, setHomeOwnership] = useState('none');
            const [isMarried, setIsMarried] = useState(false);
            const [marriageYears, setMarriageYears] = useState('');

            const programs = useMemo(() => {
                const ageVal = parseInt(age) || 0;
                const incomeVal = parseNumber(income);
                const assetVal = parseNumber(assets);
                const marriedYrs = parseInt(marriageYears) || 0;

                const results = [];

                // ÌäπÎ°ÄÎ≥¥Í∏àÏûêÎ¶¨Î°†
                const bogeumjari = {
                    name: 'ÌäπÎ°ÄÎ≥¥Í∏àÏûêÎ¶¨Î°†',
                    icon: 'üè†',
                    eligible: incomeVal <= 70000000 && (homeOwnership === 'none' || homeOwnership === 'one') && assetVal <= 469000000,
                    conditions: ['ÏÜåÎìù 7Ï≤úÎßåÏõê Ïù¥Ìïò', 'Î¨¥Ï£ºÌÉù/1Ï£ºÌÉù', 'ÏàúÏûêÏÇ∞ 4.69Ïñµ Ïù¥Ìïò'],
                    rate: '3.25%~3.95%',
                    maxAmount: '5ÏñµÏõê'
                };
                results.push(bogeumjari);

                // Ïã†ÌòºÎ∂ÄÎ∂Ä Ï†ÑÏö©
                const newlywed = {
                    name: 'Ïã†ÌòºÎ∂ÄÎ∂Ä Ï†ÑÏö© ÎåÄÏ∂ú',
                    icon: 'üíë',
                    eligible: isMarried && marriedYrs <= 7 && incomeVal <= 85000000 && homeOwnership === 'none',
                    conditions: ['Í≤∞Ìòº 7ÎÖÑ Ïù¥ÎÇ¥', 'Î∂ÄÎ∂ÄÌï©ÏÇ∞ 8.5Ï≤úÎßå Ïù¥Ìïò', 'Î¨¥Ï£ºÌÉù'],
                    rate: '2.15%~3.0%',
                    maxAmount: '4ÏñµÏõê'
                };
                results.push(newlywed);

                // ÏÉùÏï†ÏµúÏ¥à
                const firstTime = {
                    name: 'ÏÉùÏï†ÏµúÏ¥à Ï£ºÌÉùÍµ¨ÏûÖ',
                    icon: 'üéâ',
                    eligible: homeOwnership === 'none' && incomeVal <= 70000000,
                    conditions: ['ÏÉùÏï† Ï≤´ Ï£ºÌÉù', 'ÏÜåÎìù 7Ï≤úÎßå Ïù¥Ìïò'],
                    rate: '3.3%~4.0%',
                    maxAmount: '5ÏñµÏõê'
                };
                results.push(firstTime);

                // Ï≤≠ÎÖÑ Î≤ÑÌåÄÎ™©
                const youth = {
                    name: 'Ï≤≠ÎÖÑ Î≤ÑÌåÄÎ™© ÎåÄÏ∂ú',
                    icon: 'üë¶',
                    eligible: ageVal >= 19 && ageVal <= 34 && incomeVal <= 50000000 && homeOwnership === 'none',
                    conditions: ['Îßå 19~34ÏÑ∏', 'ÏÜåÎìù 5Ï≤úÎßå Ïù¥Ìïò', 'Î¨¥Ï£ºÌÉù'],
                    rate: '1.8%~2.4%',
                    maxAmount: '2ÏñµÏõê'
                };
                results.push(youth);

                return results;
            }, [age, income, assets, homeOwnership, isMarried, marriageYears]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <Building className="w-4 h-4 mr-2 text-blue-500" /> Ï†ïÎ∂Ä Ï†ïÏ±Ö ÎåÄÏ∂ú ÏûêÍ≤© ÌôïÏù∏
                    </h4>
                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-3">
                            <div><label className="text-xs font-bold text-slate-500 block mb-1">ÎÇòÏù¥</label><input type="number" value={age} onChange={e => setAge(e.target.value)} placeholder="Îßå ÎÇòÏù¥" className="w-full px-4 py-3 bg-slate-50 rounded-xl text-right font-bold outline-none" /></div>
                            <NumberInput label="Ïó∞ ÏÜåÎìù" value={income} onChange={setIncome} color="blue" />
                        </div>
                        <NumberInput label="Ï¥ù ÏûêÏÇ∞" value={assets} onChange={setAssets} color="slate" />
                        <div>
                            <label className="text-xs font-bold text-slate-500 block mb-2">Ï£ºÌÉù Î≥¥Ïú†</label>
                            <div className="flex gap-2">
                                {[{ id: 'none', label: 'Î¨¥Ï£ºÌÉù' }, { id: 'one', label: '1Ï£ºÌÉù' }, { id: 'multi', label: 'Îã§Ï£ºÌÉù' }].map(o => (
                                    <button key={o.id} onClick={() => setHomeOwnership(o.id)} className={`flex-1 py-2.5 rounded-xl text-xs font-bold ${homeOwnership === o.id ? 'bg-blue-500 text-white' : 'bg-slate-100 text-slate-600'}`}>{o.label}</button>
                                ))}
                            </div>
                        </div>
                        <label className="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer">
                            <input type="checkbox" checked={isMarried} onChange={e => setIsMarried(e.target.checked)} className="w-4 h-4 rounded" />
                            <span className="text-sm font-medium">Í∏∞Ìòº</span>
                            {isMarried && <input type="number" value={marriageYears} onChange={e => setMarriageYears(e.target.value)} placeholder="Í≤∞ÌòºÎÖÑÏàò" className="w-20 px-2 py-1 bg-white rounded text-sm text-right outline-none" />}
                        </label>
                    </div>
                    <div className="mt-4 space-y-2">
                        {programs.map((p, idx) => (
                            <div key={idx} className={`p-4 rounded-xl border ${p.eligible ? 'bg-green-50 border-green-200' : 'bg-slate-50 border-slate-200'}`}>
                                <div className="flex justify-between items-center mb-2">
                                    <p className="font-bold text-sm">{p.icon} {p.name}</p>
                                    <span className={`text-xs font-bold px-2 py-0.5 rounded ${p.eligible ? 'bg-green-200 text-green-700' : 'bg-slate-200 text-slate-500'}`}>{p.eligible ? 'ÏûêÍ≤© Ï∂©Ï°±' : 'ÎØ∏Ï∂©Ï°±'}</span>
                                </div>
                                <div className="text-xs text-slate-500 space-y-1">
                                    <p>Í∏àÎ¶¨: {p.rate} | ÌïúÎèÑ: {p.maxAmount}</p>
                                    <p className="text-[10px]">{p.conditions.join(' / ')}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 9. ÎåÄÏ∂ú ÏÉÅÌôò ÌÉÄÏûÑÎùºÏù∏ Ï∞®Ìä∏
        const LoanRepaymentChart = () => {
            const chartRef = React.useRef(null);
            const chartInstanceRef = React.useRef(null);
            const [loanAmount, setLoanAmount] = useState('');
            const [rate, setRate] = useState('4.5');
            const [period, setPeriod] = useState('360');
            const [viewYears, setViewYears] = useState('5');

            useEffect(() => {
                if (!chartRef.current || !window.Chart) return;
                if (chartInstanceRef.current) chartInstanceRef.current.destroy();

                const amount = parseNumber(loanAmount);
                const r = (parseFloat(rate) || 0) / 100 / 12;
                const months = parseInt(period) || 360;
                const years = parseInt(viewYears) || 5;
                if (amount <= 0 || r <= 0) return;

                const factor = Math.pow(1 + r, months);
                const monthly = (amount * r * factor) / (factor - 1);

                let balance = amount;
                const data = [];
                const maxMonths = Math.min(months, years * 12);

                for (let i = 1; i <= maxMonths; i++) {
                    const interest = balance * r;
                    const principal = monthly - interest;
                    balance = Math.max(0, balance - principal);
                    if (i % 12 === 0 || i === maxMonths) {
                        data.push({ year: Math.ceil(i / 12), principal: amount - balance, interest: (monthly * i) - (amount - balance), balance });
                    }
                }

                const ctx = chartRef.current.getContext('2d');
                chartInstanceRef.current = new window.Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => `${d.year}ÎÖÑ`),
                        datasets: [{
                            label: 'ÏõêÍ∏à ÏÉÅÌôò',
                            data: data.map(d => d.principal),
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99,102,241,0.1)',
                            fill: true,
                            tension: 0.3,
                        }, {
                            label: 'ÎàÑÏ†Å Ïù¥Ïûê',
                            data: data.map(d => d.interest),
                            borderColor: '#ec4899',
                            backgroundColor: 'rgba(236,72,153,0.1)',
                            fill: true,
                            tension: 0.3,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { position: 'bottom', labels: { font: { size: 11, weight: 'bold' } } } },
                        scales: { y: { beginAtZero: true, ticks: { callback: v => formatCompactNumber(v) } } }
                    }
                });

                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); };
            }, [loanAmount, rate, period, viewYears]);

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 card-depth mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <PieChart className="w-4 h-4 mr-2 text-pink-500" /> ÎåÄÏ∂ú ÏÉÅÌôò ÌÉÄÏûÑÎùºÏù∏
                    </h4>
                    <div className="space-y-4">
                        <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="pink" />
                        <div className="grid grid-cols-3 gap-2">
                            <div><label className="text-[10px] text-slate-500">Í∏àÎ¶¨(%)</label><input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-lg text-sm font-bold text-right outline-none" /></div>
                            <div><label className="text-[10px] text-slate-500">Í∏∞Í∞Ñ(Í∞úÏõî)</label><input type="number" value={period} onChange={e => setPeriod(e.target.value)} className="w-full px-3 py-2 bg-slate-50 rounded-lg text-sm font-bold text-right outline-none" /></div>
                            <div><label className="text-[10px] text-slate-500">Ï°∞Ìöå(ÎÖÑ)</label>
                                <select value={viewYears} onChange={e => setViewYears(e.target.value)} className="w-full px-2 py-2 bg-slate-50 rounded-lg text-sm font-bold outline-none">
                                    <option value="1">1ÎÖÑ</option><option value="5">5ÎÖÑ</option><option value="10">10ÎÖÑ</option><option value="30">Ï†ÑÏ≤¥</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div className="mt-4">
                        <canvas ref={chartRef} height="200"></canvas>
                    </div>
                    {parseNumber(loanAmount) > 0 && (
                        <div className="mt-4 grid grid-cols-2 gap-2 text-xs text-center">
                            <div className="p-3 bg-indigo-50 rounded-xl">
                                <p className="text-slate-500">Ïõî ÏÉÅÌôòÍ∏à</p>
                                <p className="font-bold text-indigo-600">{(() => {
                                    const r = (parseFloat(rate) || 0) / 100 / 12;
                                    const n = parseInt(period) || 360;
                                    const p = parseNumber(loanAmount);
                                    if (r <= 0 || p <= 0) return '0';
                                    const f = Math.pow(1 + r, n);
                                    return formatNumber(Math.round((p * r * f) / (f - 1)));
                                })()}Ïõê</p>
                            </div>
                            <div className="p-3 bg-pink-50 rounded-xl">
                                <p className="text-slate-500">Ï¥ù Ïù¥Ïûê</p>
                                <p className="font-bold text-pink-600">{(() => {
                                    const r = (parseFloat(rate) || 0) / 100 / 12;
                                    const n = parseInt(period) || 360;
                                    const p = parseNumber(loanAmount);
                                    if (r <= 0 || p <= 0) return '0';
                                    const f = Math.pow(1 + r, n);
                                    const m = (p * r * f) / (f - 1);
                                    return formatCompactNumber(Math.round(m * n - p));
                                })()}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ========== PHASE 2 COMPLETE ==========

        // NEW: FAQ/Í∞ÄÏù¥Îìú (Phase 4)
        const GuidePanel = () => {
            const [activeGuide, setActiveGuide] = useState(null);

            const guides = [
                { id: 'scam', title: 'üö® Ï†ÑÏÑ∏ ÏÇ¨Í∏∞ ÏòàÎ∞©', content: '1. Îì±Í∏∞Î∂ÄÎì±Î≥∏ ÌôïÏù∏ (Í∑ºÏ†ÄÎãπ, Í∞ÄÏïïÎ•ò)\n2. Ï†ÑÏÑ∏Í∞ÄÏú® 80% Ïù¥Ìïò ÌôïÏù∏\n3. ÏßëÏ£ºÏù∏ Ïã†Î∂ÑÏ¶ù/Îì±Í∏∞Í∂åÎ¶¨Ï¶ù ÎåÄÏ°∞\n4. HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∞ÄÏûÖ\n5. Ï†ÑÏûÖÏã†Í≥† + ÌôïÏ†ïÏùºÏûê Ï¶âÏãú' },
                { id: 'registry', title: 'üìú Îì±Í∏∞Î∂ÄÎì±Î≥∏ Î≥¥Îäî Î≤ï', content: 'Í∞ëÍµ¨: ÏÜåÏú†Í∂å Í¥ÄÎ†® (ÏïïÎ•ò, Í∞ÄÏ≤òÎ∂Ñ)\nÏùÑÍµ¨: Í∑ºÏ†ÄÎãπÍ∂å ÏÑ§Ï†ï (ÎåÄÏ∂ú)\n\n‚úì ÏÜåÏú†Ïûê = Í≥ÑÏïΩ ÏÉÅÎåÄÎ∞©?\n‚úì Í∑ºÏ†ÄÎãπ Ï±ÑÍ∂åÏµúÍ≥†Ïï° ÌôïÏù∏\n‚úì Í∞ÄÏïïÎ•ò/Í∞ÄÏ≤òÎ∂Ñ ÏûàÏúºÎ©¥ ÏúÑÌóò' },
                { id: 'renewal', title: 'üîÑ Í≥ÑÏïΩÍ∞±Ïã†Ï≤≠Íµ¨Í∂å', content: '‚Ä¢ 2ÎÖÑÍ∞Ñ 1Ìöå ÏÇ¨Ïö© Í∞ÄÎä•\n‚Ä¢ ÏûÑÎåÄÎ£å 5% Ïù¥ÏÉÅ Ïù∏ÏÉÅ Î∂àÍ∞Ä\n‚Ä¢ ÎßåÎ£å 6Í∞úÏõî~1Í∞úÏõî Ï†Ñ ÌÜµÎ≥¥\n‚Ä¢ Ïã§Í±∞Ï£º Î™©Ï†Å Ïãú Í±∞Ï†à Í∞ÄÎä•\n‚Ä¢ 2+2ÎÖÑ = ÏµúÎåÄ 4ÎÖÑ Í±∞Ï£º' },
                { id: 'moving', title: 'üì¶ Ïù¥ÏÇ¨ Ï†ÑÏûÖ Ï†àÏ∞®', content: '1. Ïù¥ÏÇ¨ ÎãπÏùº Ï†ÑÏûÖÏã†Í≥† (Ï£ºÎØºÏÑºÌÑ∞)\n2. ÌôïÏ†ïÏùºÏûê Î∞õÍ∏∞ (ÎèôÏãú Í∞ÄÎä•)\n3. Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∞ÄÏûÖÌïòÍ∏∞\n4. Í≥µÍ≥ºÍ∏à Î™ÖÏùò Î≥ÄÍ≤Ω\n5. Ïù∏ÌÑ∞ÎÑ∑ Ïù¥Ï†Ñ ÏÑ§Ïπò' }
            ];

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <h4 className="text-sm font-bold text-slate-800 mb-4">üìö Î∂ÄÎèôÏÇ∞ Í∞ÄÏù¥Îìú</h4>
                    <div className="space-y-2">
                        {guides.map(g => (
                            <div key={g.id}>
                                <button onClick={() => setActiveGuide(activeGuide === g.id ? null : g.id)} className={`w-full py-3 px-4 rounded-xl text-left font-bold text-sm flex justify-between items-center transition-all ${activeGuide === g.id ? 'bg-indigo-50 text-indigo-700' : 'bg-slate-50 text-slate-700 hover:bg-slate-100'}`}>
                                    {g.title}
                                    <span>{activeGuide === g.id ? '‚àí' : '+'}</span>
                                </button>
                                {activeGuide === g.id && (
                                    <div className="p-4 bg-slate-50 rounded-b-xl mt-1 text-sm text-slate-600 whitespace-pre-line">{g.content}</div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ToolsTab = () => {
            const [activeTool, setActiveTool] = usePersistedState('lastTool', 'pyung');
            const [activeToolCategory, setActiveToolCategory] = useState('all');
            const toolsScrollRef = React.useRef(null);
            const [showLeftArrow, setShowLeftArrow] = useState(false);
            const [showRightArrow, setShowRightArrow] = useState(false);

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÎèÑÍµ¨ Í∑∏Î£πÌïë
            const toolCategories = [
                { id: 'all', label: 'Ï†ÑÏ≤¥', icon: Grid },
                { id: 'diagnose', label: 'ÏßÑÎã®', icon: Shield },
                { id: 'calc', label: 'Í≥ÑÏÇ∞', icon: Calculator },
                { id: 'finance', label: 'Í∏àÏúµ', icon: DollarSign },
                { id: 'analysis', label: 'Î∂ÑÏÑù', icon: BarChart3 },
                { id: 'docs', label: 'Î¨∏ÏÑú', icon: FileText },
                { id: 'util', label: 'Ïú†Ìã∏', icon: PenTool },
            ];

            const tools = [
                // ====== ÏßÑÎã® ÎèÑÍµ¨ ======
                { id: 'fraudcheck', label: 'Ï†ÑÏÑ∏ÏÇ¨Í∏∞ÏßÑÎã®', icon: Shield, category: 'diagnose' },
                { id: 'pcheck', label: 'Îß§Î¨ºÏ†êÍ≤Ä', icon: Search, category: 'diagnose' },
                { id: 'checklist', label: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', icon: CheckCircle, category: 'diagnose' },
                // ====== Í≥ÑÏÇ∞ ÎèÑÍµ¨ ======
                { id: 'pyung', label: 'ÌèâÏàòÍ≥ÑÏÇ∞', icon: Grid, category: 'calc' },
                { id: 'convert', label: 'Ï†ÑÌôòÍ≥ÑÏÇ∞', icon: Percent, category: 'calc' },
                { id: 'biconvert', label: 'ÏõîÏÑ∏‚ÜîÏ†ÑÏÑ∏', icon: ArrowRightLeft, category: 'calc' },
                { id: 'compare', label: 'Îß§Î¨ºÎπÑÍµê', icon: ArrowRightLeft, category: 'calc' },
                { id: 'yieldtarget', label: 'ÏàòÏùµÎ•†Î™©Ìëú', icon: TrendingUp, category: 'calc' },
                { id: 'bep', label: 'BEPÍ≥ÑÏÇ∞', icon: TrendingUp, category: 'calc' },
                { id: 'subway', label: 'Ïó≠ÏÑ∏Í∂å', icon: Home, category: 'calc' },
                // ====== Í∏àÏúµ ÎèÑÍµ¨ ======
                { id: 'combinedloan', label: 'Î≥µÌï©ÎåÄÏ∂ú', icon: Banknote, category: 'finance' },
                { id: 'refinance', label: 'ÎåÄÌôòÎ∂ÑÏÑù', icon: RefreshCw, category: 'finance' },
                { id: 'ratecut', label: 'Í∏àÎ¶¨Ïù∏Ìïò', icon: TrendingUp, category: 'finance' },
                { id: 'govloan', label: 'Ï†ïÏ±ÖÎåÄÏ∂ú', icon: Building, category: 'finance' },
                { id: 'loanchart', label: 'ÏÉÅÌôòÏ∞®Ìä∏', icon: PieChart, category: 'finance' },
                { id: 'bankrate', label: 'ÏùÄÌñâÍ∏àÎ¶¨', icon: Building, category: 'finance' },
                { id: 'fixedvar', label: 'Í≥†Ï†ïvsÎ≥ÄÎèô', icon: TrendingUp, category: 'finance' },
                { id: 'stress', label: 'Ïä§Ìä∏Î†àÏä§', icon: AlertTriangle, category: 'finance' },
                { id: 'earlyopt', label: 'Ï§ëÎèÑÏÉÅÌôò+', icon: DollarSign, category: 'finance' },
                { id: 'credit', label: 'Ïã†Ïö©Ï†êÏàò', icon: Award, category: 'finance' },
                { id: 'insurance', label: 'Î≥¥Ï¶ùÎ≥¥Ìóò', icon: Shield, category: 'finance' },
                { id: 'earlyrepay', label: 'Ï°∞Í∏∞ÏÉÅÌôò', icon: DollarSign, category: 'finance' },
                // ====== Î∂ÑÏÑù ÎèÑÍµ¨ ======
                { id: 'marketprice', label: 'ÏãúÏÑ∏Ìä∏ÎûòÏª§', icon: BarChart3, category: 'analysis' },
                { id: 'schedule', label: 'Î≥¥Ï¶ùÍ∏àÏùºÏ†ï', icon: Calendar, category: 'analysis' },
                { id: 'expiry', label: 'ÎßåÍ∏∞D-day', icon: Calendar, category: 'analysis' },
                { id: 'taxcalendar', label: 'ÏÑ∏Í∏àÏ∫òÎ¶∞Îçî', icon: Calendar, category: 'analysis' },
                // ====== Î¨∏ÏÑú/Í≥ÑÏïΩ ÎèÑÍµ¨ ======
                { id: 'docs', label: 'ÌïÑÏàòÏÑúÎ•ò', icon: ClipboardList, category: 'docs' },
                { id: 'clause', label: 'ÌäπÏïΩÏ°∞Ìï≠', icon: FileText, category: 'docs' },
                { id: 'contract', label: 'Í≥ÑÏïΩÍ¥ÄÎ¶¨', icon: FileText, category: 'docs' },
                { id: 'renewal', label: 'Í∞±Ïã†Í∂å', icon: RefreshCw, category: 'docs' },
                { id: 'message', label: 'Î¨∏ÏûêÎßàÎ≤ïÏÇ¨', icon: MessageCircle, category: 'docs' },
                // ====== Ïú†Ìã∏Î¶¨Ìã∞ ======
                { id: 'preset', label: 'ÌîÑÎ¶¨ÏÖã', icon: Bookmark, category: 'util' },
                { id: 'export', label: 'Í≤∞Í≥ºÏ†ÄÏû•', icon: Download, category: 'util' },
                { id: 'excel', label: 'ÏóëÏÖÄÏ†ÄÏû•', icon: FileDown, category: 'util' },
                { id: 'links', label: 'Ïô∏Î∂ÄÏó∞Îèô', icon: Link2, category: 'util' },
                { id: 'broker', label: 'Î≥µÎπÑÌòëÏÉÅ', icon: DollarSign, category: 'util' },
                { id: 'remodel', label: 'Î¶¨Î™®Îç∏ÎßÅROI', icon: PenTool, category: 'util' },
                { id: 'joint', label: 'Í≥µÎèôÎ™ÖÏùò', icon: Users, category: 'util' },
                { id: 'increase', label: 'Ïù∏ÏÉÅÎ•†', icon: TrendingUp, category: 'util' },
                { id: 'registry', label: 'Îì±Í∏∞ÎπÑÏö©', icon: ClipboardList, category: 'util' },
                { id: 'moving', label: 'Ïù¥ÏÇ¨ÎπÑÏö©', icon: Home, category: 'util' },
                { id: 'interior', label: 'Ïù∏ÌÖåÎ¶¨Ïñ¥', icon: PenTool, category: 'util' },
                { id: 'maintenance', label: 'Í¥ÄÎ¶¨ÎπÑ', icon: BarChart3, category: 'util' },
                { id: 'rentcap', label: 'Ï¶ùÏï°ÌïúÎèÑ', icon: TrendingUp, category: 'util' },
                { id: 'calendar', label: 'ÏÑ∏Í∏àÏùºÏ†ï', icon: Calendar, category: 'util' },
                { id: 'guide', label: 'Í∞ÄÏù¥Îìú', icon: HelpCircle, category: 'util' },
                { id: 'dic', label: 'Ïö©Ïñ¥ÏÇ¨Ï†Ñ', icon: BookOpen, category: 'util' },
                { id: 'history', label: 'ÌûàÏä§ÌÜ†Î¶¨', icon: History, category: 'util' },
            ];

            const filteredTools = activeToolCategory === 'all'
                ? tools
                : tools.filter(t => t.category === activeToolCategory);

            // Category tabs scroll
            const categoryScrollRef = React.useRef(null);
            const [showCatLeftArrow, setShowCatLeftArrow] = useState(false);
            const [showCatRightArrow, setShowCatRightArrow] = useState(false);

            const checkCategoryScroll = useCallback(() => {
                const el = categoryScrollRef.current;
                if (!el) return;
                const { scrollLeft, scrollWidth, clientWidth } = el;
                setShowCatLeftArrow(scrollLeft > 0);
                setShowCatRightArrow(scrollLeft < scrollWidth - clientWidth - 5);
            }, []);

            useEffect(() => {
                checkCategoryScroll();
                window.addEventListener('resize', checkCategoryScroll);
                return () => window.removeEventListener('resize', checkCategoryScroll);
            }, [checkCategoryScroll]);

            const scrollCategory = (direction) => {
                const el = categoryScrollRef.current;
                if (!el) return;
                el.scrollBy({
                    left: direction === 'left' ? -150 : 150,
                    behavior: 'smooth'
                });
                setTimeout(checkCategoryScroll, 300);
            };

            const checkScrollButtons = useCallback(() => {
                const el = toolsScrollRef.current;
                if (!el) return;
                const { scrollLeft, scrollWidth, clientWidth } = el;
                setShowLeftArrow(scrollLeft > 0);
                setShowRightArrow(scrollLeft < scrollWidth - clientWidth - 5);
            }, []);

            useEffect(() => {
                checkScrollButtons();
                window.addEventListener('resize', checkScrollButtons);
                return () => window.removeEventListener('resize', checkScrollButtons);
            }, [checkScrollButtons]);

            const scrollToolsMenu = (direction) => {
                const el = toolsScrollRef.current;
                if (!el) return;
                const scrollAmount = el.clientWidth * 0.6;
                el.scrollBy({
                    left: direction === 'left' ? -scrollAmount : scrollAmount,
                    behavior: 'smooth'
                });
                // Update arrow visibility after scroll animation
                setTimeout(checkScrollButtons, 350);
            };

            const ActiveComponent = {
                // ÏßÑÎã® ÎèÑÍµ¨
                fraudcheck: JeonseFraudChecker,
                pcheck: PropertyChecklistTool,
                checklist: MovingChecklist,
                // Í≥ÑÏÇ∞ ÎèÑÍµ¨
                pyung: UnitConverter,
                convert: ConversionCalculator,
                biconvert: BidirectionalRentConverter,
                compare: CompareTab,
                yieldtarget: RentYieldTargetCalculator,
                bep: InvestmentBEPCalculator,
                subway: SubwayDistanceCalculator,
                // Í∏àÏúµ ÎèÑÍµ¨
                combinedloan: CombinedLoanCalculator,
                refinance: LoanRefinancingAnalyzer,
                ratecut: InterestRateCutSimulator,
                govloan: GovernmentLoanEligibility,
                loanchart: LoanRepaymentChart,
                bankrate: BankRateComparison,
                fixedvar: FixedVsVariableRate,
                stress: InterestRateStressTest,
                earlyopt: EarlyRepaymentOptimizer,
                credit: CreditScoreImpact,
                insurance: InsuranceCalculator,
                earlyrepay: EarlyRepaymentAnalyzer,
                // Î∂ÑÏÑù ÎèÑÍµ¨
                marketprice: MarketPriceTracker,
                schedule: DepositScheduler,
                expiry: LeaseExpiryCalculator,
                taxcalendar: EnhancedTaxCalendar,
                // Î¨∏ÏÑú ÎèÑÍµ¨
                docs: RequiredDocuments,
                clause: SpecialClauseGuide,
                contract: ContractManager,
                renewal: RenewalRightTracker,
                message: MessageWizard,
                // Ïú†Ìã∏Î¶¨Ìã∞
                preset: PresetManager,
                export: ExportButton,
                excel: ExcelExportButton,
                links: ExternalLinksPanel,
                broker: BrokerFeeNegotiator,
                remodel: RemodelingROICalculator,
                joint: JointOwnershipSimulator,
                increase: RentIncreaseCalc,
                registry: RegistrationFeeCalc,
                moving: MovingCostCalculator,
                interior: InteriorCostCalculator,
                maintenance: MaintenanceFeeAnalyzer,
                rentcap: RentCapCalculator,
                calendar: TaxCalendar,
                guide: GuidePanel,
                dic: Dictionary,
                history: HistoryPanel,
            }[activeTool];

            return (
                <div className="space-y-4 pb-32 animate-slide-up px-1">
                    {/* Category Filter Tabs with Arrows */}
                    <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-4 relative">
                        {/* Left Arrow */}
                        {showCatLeftArrow && (
                            <button
                                onClick={() => scrollCategory('left')}
                                className="absolute left-2 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white shadow-md border border-slate-200 rounded-full text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 transition-all"
                            >
                                <ChevronLeft size={18} />
                            </button>
                        )}

                        {/* Right Arrow */}
                        {showCatRightArrow && (
                            <button
                                onClick={() => scrollCategory('right')}
                                className="absolute right-2 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white shadow-md border border-slate-200 rounded-full text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 transition-all"
                            >
                                <ChevronRight size={18} />
                            </button>
                        )}

                        <div
                            ref={categoryScrollRef}
                            onScroll={checkCategoryScroll}
                            className="flex gap-2 overflow-x-auto pb-1 no-scrollbar scroll-smooth px-6"
                        >
                            {toolCategories.map(cat => {
                                const count = cat.id === 'all' ? tools.length : tools.filter(t => t.category === cat.id).length;
                                return (
                                    <button
                                        key={cat.id}
                                        onClick={() => setActiveToolCategory(cat.id)}
                                        className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold whitespace-nowrap transition-all shrink-0 ${activeToolCategory === cat.id
                                            ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-200'
                                            : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                            }`}
                                    >
                                        <cat.icon size={16} />
                                        {cat.label}
                                        <span className={`ml-1 px-1.5 py-0.5 rounded text-xs ${activeToolCategory === cat.id ? 'bg-white/20' : 'bg-slate-200'}`}>
                                            {count}
                                        </span>
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {/* Tools Grid */}
                    <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-5 relative overflow-hidden">
                        {/* Dropdown for quick access */}
                        <div className="mb-4">
                            <select
                                value={activeTool}
                                onChange={(e) => setActiveTool(e.target.value)}
                                className="w-full text-sm p-3 rounded-xl bg-slate-50 text-slate-700 border border-slate-200 outline-none focus:ring-2 focus:ring-indigo-100 appearance-none font-bold cursor-pointer transition-all hover:bg-slate-100"
                                style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`, backgroundPosition: 'right 1rem center', backgroundRepeat: 'no-repeat', backgroundSize: '1.2em' }}
                            >
                                <option disabled>ÎèÑÍµ¨ Î∞îÎ°úÍ∞ÄÍ∏∞ ÏÑ†ÌÉù</option>
                                {tools.map(tool => (
                                    <option key={tool.id} value={tool.id}>{tool.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Tools Grid - 3 Columns for better readability */}
                        <div className="grid grid-cols-3 gap-3">
                            {filteredTools.map((tool) => {
                                const isActive = activeTool === tool.id;
                                return (
                                    <button
                                        key={tool.id}
                                        onClick={() => setActiveTool(tool.id)}
                                        className={`flex flex-col items-center justify-center p-4 rounded-2xl transition-all min-h-[88px] ${isActive
                                            ? 'bg-indigo-50 text-indigo-600 ring-2 ring-indigo-300 shadow-sm'
                                            : 'text-slate-500 hover:bg-slate-100 bg-slate-50'
                                            }`}
                                    >
                                        <div className={`mb-2 p-3 rounded-xl transition-all ${isActive ? 'bg-indigo-100 text-indigo-600' : 'bg-slate-100 text-slate-400'
                                            }`}>
                                            <tool.icon size={24} />
                                        </div>
                                        <span className={`text-[11px] font-bold tracking-tight text-center leading-tight ${isActive ? 'text-indigo-700' : 'text-slate-600'
                                            }`}>{tool.label}</span>
                                    </button>
                                );
                            })}
                        </div>

                        {/* Empty State */}
                        {filteredTools.length === 0 && (
                            <div className="text-center py-10 text-slate-400">
                                Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÎèÑÍµ¨Í∞Ä ÏóÜÏäµÎãàÎã§
                            </div>
                        )}
                    </div>

                    {/* Active Tool Content */}
                    <div className="animate-fade-in min-h-[400px]">
                        {ActiveComponent ? <ActiveComponent /> : <div className="text-center py-20 text-slate-400">ÎèÑÍµ¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</div>}
                    </div>
                </div>
            );
        };


        // --- Toast Component ---
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="toast-container">
                    <div className="toast">{message}</div>
                </div>
            );
        };

        // --- App Component ---
        const App = () => {
            const [activeCategory, setActiveCategory] = useState('rent');
            const [activeSubTab, setActiveSubTab] = useState({
                rent: 0,
                buy: 0,
                bank: 0,
                tax: 0,
                subscription: 0,
                tools: 0
            });
            const [toastMessage, setToastMessage] = useState('');

            const showToast = (message) => {
                setToastMessage(message);
            };

            const categories = [
                { id: 'rent', label: 'Ï†ÑÏõîÏÑ∏', icon: Home },
                { id: 'buy', label: 'Îß§Îß§', icon: TrendingUp },
                { id: 'bank', label: 'ÎåÄÏ∂ú', icon: DollarSign },
                { id: 'tax', label: 'ÏÑ∏Í∏à', icon: Calculator },
                { id: 'subscription', label: 'Ï≤≠ÏïΩ', icon: Award },
                { id: 'tools', label: 'ÎèÑÍµ¨', icon: PenTool },
            ];

            const tabs = {
                rent: [
                    { id: 0, label: 'ÎπÑÏö©ÎπÑÍµê', component: CostCompareTab },
                    { id: 1, label: 'ÏïàÏ†ÑÏßÑÎã®', component: SafetyTab },
                    { id: 2, label: 'Î∞òÏ†ÑÏÑ∏', component: SemiJeonseTab },
                    { id: 3, label: 'Ï§ëÍ∞úÎ≥¥Ïàò', component: FeeTab },
                ],
                buy: [
                    { id: 0, label: 'Ï∑®ÎìùÏÑ∏/Ï±ÑÍ∂å', component: BuyingTab },
                    { id: 1, label: 'Ï†ÑÏÑ∏vsÎß§Îß§', component: RentVsBuyTab },
                    { id: 2, label: 'ÎÇ¥ÏßëÍ∞ÄÍ≤©', component: AffordabilityTab },
                    { id: 3, label: 'ÏûÑÎåÄÏàòÏùµÎ•†', component: RentalYieldTab },
                    { id: 4, label: 'Í∞≠Ìà¨ÏûêROI', component: GapInvestmentTab },
                    { id: 5, label: 'Îã§Ï£ºÌÉùÏÑ∏Í∏à', component: MultiPropertyTaxTab },
                    { id: 6, label: 'Ïû¨Í±¥Ï∂ïÎ∂ÑÏÑù', component: ReconstructionTab },
                    { id: 7, label: 'Ï§ëÍ∞úÎ≥¥Ïàò', component: FeeTab },
                ],
                bank: [
                    { id: 0, label: 'ÎåÄÏ∂úÍ≥ÑÏÇ∞', component: LoanTab },
                    { id: 1, label: 'ÏÉÅÌôòÎπÑÍµê', component: LoanCompareTab },
                    { id: 2, label: 'ÏÉÅÌôòÏä§ÏºÄÏ§Ñ', component: AmortizationScheduleTab },
                    { id: 3, label: 'Ï£ºÎã¥ÎåÄÌïúÎèÑ', component: MortgageLimitTab },
                    { id: 4, label: 'Ï£ºÌÉùÏó∞Í∏à', component: ReverseRentTab },
                    { id: 5, label: 'Ï†ÑÏÑ∏ÎåÄÏ∂ú', component: JeonseLoanLimitTab },
                    { id: 6, label: 'DSRÍ≥ÑÏÇ∞', component: DSRTab },
                    { id: 7, label: 'DTIÍ≥ÑÏÇ∞', component: DTITab },
                    { id: 8, label: 'LTVÍ≥ÑÏÇ∞', component: LTVTab },
                ],
                tax: [
                    { id: 0, label: 'ÏñëÎèÑÏÜåÎìùÏÑ∏', component: CapitalGainsTaxTab },
                    { id: 1, label: 'Ïû¨ÏÇ∞ÏÑ∏/Ï¢ÖÎ∂ÄÏÑ∏', component: PropertyTaxTab },
                    { id: 2, label: 'Ï¶ùÏó¨ÏÑ∏', component: GiftTaxTab },
                    { id: 3, label: 'ÏÉÅÏÜçÏÑ∏', component: InheritanceTaxTab },
                ],
                subscription: [
                    { id: 0, label: 'Ï≤≠ÏïΩÏ†êÏàò', component: SubscriptionScoreTab },
                ],
                tools: [
                    { id: 0, label: 'ÎèÑÍµ¨Î™®Ïùå', component: ToolsTab }
                ]
            };

            const currentTabs = tabs[activeCategory];
            const currentSubTabIdx = activeSubTab[activeCategory];
            const ActiveComponent = currentTabs[currentSubTabIdx].component;

            const handlePrint = () => window.print();

            // Track scroll position for header shadow
            const [isScrolled, setIsScrolled] = useState(false);
            const subTabScrollRef = React.useRef(null);
            const [showLeftArrow, setShowLeftArrow] = useState(false);
            const [showRightArrow, setShowRightArrow] = useState(false);

            const checkScrollButtons = useCallback(() => {
                const el = subTabScrollRef.current;
                if (!el) return;
                const { scrollLeft, scrollWidth, clientWidth } = el;
                setShowLeftArrow(scrollLeft > 0);
                // Allow a small buffer (1px) for floating point calculations
                setShowRightArrow(scrollLeft < scrollWidth - clientWidth - 1);
            }, []);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 10);
                window.addEventListener('scroll', handleScroll, { passive: true });

                // Initial check for arrows
                checkScrollButtons();
                window.addEventListener('resize', checkScrollButtons);

                return () => {
                    window.removeEventListener('scroll', handleScroll);
                    window.removeEventListener('resize', checkScrollButtons);
                };
            }, [checkScrollButtons]);

            // Re-check arrows when category changes (tabs content changes)
            useEffect(() => {
                checkScrollButtons();
                // Reset scroll to start when category changes
                if (subTabScrollRef.current) {
                    subTabScrollRef.current.scrollTo({ left: 0, behavior: 'auto' });
                }
            }, [activeCategory, checkScrollButtons]);

            const scrollSubTabs = (direction) => {
                const el = subTabScrollRef.current;
                if (!el) return;
                const scrollAmount = el.clientWidth * 0.6; // Scroll 60% of width
                el.scrollBy({
                    left: direction === 'left' ? -scrollAmount : scrollAmount,
                    behavior: 'smooth'
                });
            };


            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 relative shadow-2xl border-x border-slate-100 pb-24">
                    {/* Toast */}
                    {toastMessage && <Toast message={toastMessage} onClose={() => setToastMessage('')} />}

                    {/* Header with enhanced glassmorphism */}
                    <div className={`bg-white/90 backdrop-blur-xl sticky top-0 z-30 border-b border-slate-200/50 ${isScrolled ? 'shadow-lg shadow-slate-200/50' : ''}`}>
                        <div className="h-16 px-5 flex items-center justify-between">
                            <h1 className="text-lg font-black text-slate-900 flex items-center gap-3 tracking-tight">
                                <div className="relative">
                                    <div className="absolute inset-0 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl blur-lg opacity-40 animate-pulse-slow" />
                                    <div className="relative bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-2.5 rounded-xl text-white shadow-lg shadow-indigo-500/40">
                                        <Home size={18} fill="white" />
                                    </div>
                                </div>
                                <span className="flex items-baseline gap-1.5">
                                    Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞
                                    <span className="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent font-black italic text-xl">Pro</span>
                                </span>
                            </h1>
                            <div className="flex items-center gap-1">
                                <QuickHistory />
                                <button
                                    onClick={handlePrint}
                                    className="p-2.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-xl transition-all no-print touch-target"
                                    title="PDF Ï†ÄÏû• / Ïù∏ÏáÑ"
                                    aria-label="Ïù∏ÏáÑÌïòÍ∏∞"
                                >
                                    <Printer size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Sub Navigation (Top) - with arrow buttons - only show if more than 1 tab */}
                    {currentTabs.length > 1 && (
                        <div className="px-4 mt-4 sticky top-16 z-20">
                            <div className="relative bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden group">

                                {/* Left Arrow */}
                                <div className={`absolute left-0 top-0 bottom-0 z-10 flex items-center transition-opacity duration-300 ${showLeftArrow ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
                                    <div className="absolute inset-0 bg-gradient-to-r from-white via-white/90 to-transparent" />
                                    <button
                                        onClick={() => scrollSubTabs('left')}
                                        className="relative z-10 p-1.5 ml-1 text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors shadow-sm ring-1 ring-slate-900/5"
                                        aria-label="Ïù¥Ï†Ñ Î©îÎâ¥"
                                    >
                                        <ChevronLeft size={18} />
                                    </button>
                                </div>

                                {/* Tab Container */}
                                <div
                                    ref={subTabScrollRef}
                                    onScroll={checkScrollButtons}
                                    className="flex gap-1 overflow-x-auto scrollbar-hide snap-x snap-mandatory p-1.5 mx-0 scroll-smooth"
                                    style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}
                                >
                                    {/* Spacer for left arrow */}
                                    <div className={`flex-shrink-0 transition-all duration-300 ${showLeftArrow ? 'w-8' : 'w-0'}`} />

                                    {currentTabs.map((tab, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => {
                                                setActiveSubTab(prev => ({ ...prev, [activeCategory]: idx }));
                                                // Optional: Center the clicked tab
                                                setTimeout(checkScrollButtons, 300);
                                            }}
                                            className={`flex-shrink-0 min-w-[72px] min-h-[40px] px-4 py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap snap-start ${currentSubTabIdx === idx ? 'bg-gradient-to-r from-slate-900 to-slate-800 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'}`}
                                            aria-selected={currentSubTabIdx === idx}
                                            role="tab"
                                        >
                                            {tab.label}
                                        </button>
                                    ))}

                                    {/* Spacer for right arrow */}
                                    <div className={`flex-shrink-0 transition-all duration-300 ${showRightArrow ? 'w-8' : 'w-0'}`} />
                                </div>

                                {/* Right Arrow */}
                                <div className={`absolute right-0 top-0 bottom-0 z-10 flex items-center transition-opacity duration-300 ${showRightArrow ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
                                    <div className="absolute inset-0 bg-gradient-to-l from-white via-white/90 to-transparent" />
                                    <button
                                        onClick={() => scrollSubTabs('right')}
                                        className="relative z-10 p-1.5 mr-1 text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors shadow-sm ring-1 ring-slate-900/5"
                                        aria-label="Îã§Ïùå Î©îÎâ¥"
                                    >
                                        <ChevronRight size={18} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Main Content */}
                    <main className="p-4">
                        <ActiveComponent />
                    </main>

                    {/* Bottom Navigation (Categories) - Enhanced Premium Design */}
                    <nav className="fixed bottom-0 max-w-md w-full bg-white/95 backdrop-blur-xl border-t border-slate-200/60 pb-safe z-40 rounded-t-[1.5rem] shadow-[0_-4px_30px_rgba(0,0,0,0.1)]" aria-label="Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨">
                        <div className="relative flex justify-around items-center px-2 py-2">
                            {categories.map((cat) => {
                                const Icon = cat.icon;
                                const isActive = activeCategory === cat.id;
                                return (
                                    <button
                                        key={cat.id}
                                        onClick={() => setActiveCategory(cat.id)}
                                        className={`relative flex flex-col items-center justify-center min-w-[60px] min-h-[56px] p-2 rounded-2xl transition-all duration-300 active:scale-90 touch-target group
                                            ${isActive
                                                ? 'text-white'
                                                : 'text-slate-400 hover:text-slate-600'
                                            }`}
                                        aria-label={cat.label}
                                        aria-current={isActive ? 'page' : undefined}
                                    >
                                        {/* Active Pill Background */}
                                        <div className={`absolute inset-1 rounded-2xl transition-all duration-300 ease-out
                                            ${isActive
                                                ? 'bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 shadow-lg shadow-indigo-500/30 scale-100 opacity-100'
                                                : 'scale-75 opacity-0 bg-slate-100'
                                            }`}
                                        />

                                        {/* Icon with animation */}
                                        <div className={`relative z-10 transition-all duration-300 ${isActive ? 'transform -translate-y-0.5' : 'group-hover:scale-110'}`}>
                                            <Icon
                                                size={isActive ? 22 : 20}
                                                strokeWidth={isActive ? 2.5 : 1.8}
                                                fill={isActive ? "currentColor" : "none"}
                                                className="transition-all duration-300"
                                            />
                                        </div>

                                        {/* Label */}
                                        <span className={`relative z-10 text-[10px] font-bold mt-1 transition-all duration-300
                                            ${isActive
                                                ? 'opacity-100 transform translate-y-0'
                                                : 'opacity-50 group-hover:opacity-80'
                                            }`}>
                                            {cat.label}
                                        </span>

                                        {/* Active dot indicator */}
                                        <div className={`absolute -top-0.5 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-white transition-all duration-300 ${isActive ? 'opacity-100 scale-100' : 'opacity-0 scale-0'}`} />
                                    </button>
                                );
                            })}
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <App />
            </ErrorBoundary>
        );

    </script>
</body>

</html>