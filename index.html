<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro - Ï†ÑÏõîÏÑ∏ Í≥ÑÏÇ∞Í∏∞</title>
    <meta name="description" content="Ï†ÑÏõîÏÑ∏ ÎπÑÏö© ÎπÑÍµê, ÏïàÏ†Ñ ÏßÑÎã®, Ï§ëÍ∞úÎ≥¥Ïàò Í≥ÑÏÇ∞, ÎåÄÏ∂ú Í≥ÑÏÇ∞ Îì± Î∂ÄÎèôÏÇ∞ ÏûÑÎåÄÏ∞® ÌïÑÏàò Í≥ÑÏÇ∞Í∏∞">
    <meta name="keywords" content="Ï†ÑÏõîÏÑ∏, Ï†ÑÏÑ∏, ÏõîÏÑ∏, Ï§ëÍ∞úÎ≥¥Ïàò, Î∂ÄÎèôÏÇ∞, Í≥ÑÏÇ∞Í∏∞, Ï∑®ÎìùÏÑ∏, DSR, LTV">
    <meta property="og:title" content="Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro">
    <meta property="og:description" content="Ï†ÑÏõîÏÑ∏ ÎπÑÏö© ÎπÑÍµê, ÏïàÏ†Ñ ÏßÑÎã®, ÎåÄÏ∂ú Í≥ÑÏÇ∞ Îì± Î∂ÄÎèôÏÇ∞ ÌïÑÏàò ÎèÑÍµ¨">
    <meta name="theme-color" content="#4f46e5">

    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    },
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'result-pop': 'resultPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)',
                        'number-pop': 'numberPop 0.3s ease-out',
                        'toast': 'toast 3s ease-in-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        resultPop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '50%': { transform: 'scale(1.02)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        numberPop: {
                            '0%': { transform: 'scale(1.1)', opacity: '0.8' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        toast: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '10%': { transform: 'translateY(0)', opacity: '1' },
                            '90%': { transform: 'translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100%)', opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css");

        body {
            font-family: "Pretendard", sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark Mode Styles */
        .dark body,
        .dark {
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .dark .bg-white {
            background-color: #1e293b;
        }

        .dark .bg-slate-50 {
            background-color: #0f172a;
        }

        .dark .text-slate-900 {
            color: #f1f5f9;
        }

        .dark .text-slate-800 {
            color: #e2e8f0;
        }

        .dark .text-slate-700 {
            color: #cbd5e1;
        }

        .dark .border-slate-100 {
            border-color: #334155;
        }

        .dark .bg-slate-100 {
            background-color: #334155;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            pointer-events: none;
        }

        .toast {
            background: #1e293b;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: toast 3s ease-in-out forwards;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            nav,
            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            #root {
                padding: 0;
                box-shadow: none;
                border: none;
            }

            #root>div {
                border: none;
                shadow: none;
            }

            .animate-slide-up,
            .animate-fade-in,
            .animate-result-pop {
                animation: none !important;
                transform: none !important;
                opacity: 1 !important;
            }
        }

        /* Hide Number Spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 selection:bg-blue-100 min-h-screen pb-20 md:pb-0 transition-colors duration-300">

    <div id="root"></div>
    <div id="error-log"
        style="display:none; padding: 20px; background: #fee; border-bottom: 1px solid #f99; color: #c00;"></div>

    <script>
        // Global Error Handler
        window.onerror = function (message, source, lineno, colno, error) {
            const errorDiv = document.getElementById('error-log');
            errorDiv.style.display = 'block';
            errorDiv.innerHTML += `<strong>Error:</strong> ${message} at ${source}:${lineno}<br>`;
            console.error(error);
        };
    </script>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useId } = React;

        // --- Icons (Inline SVGs to prevent dependency issues) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>;
        const Shield = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></IconBase>;
        const Calculator = (props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>;
        const DollarSign = (props) => <IconBase {...props}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconBase>;
        const PenTool = (props) => <IconBase {...props}><path d="m12 19 7-7 3 3-7 7-3-3z" /><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" /><path d="m2 2 7.586 7.586" /><circle cx="11" cy="11" r="2" /></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></IconBase>;
        const ArrowRightLeft = (props) => <IconBase {...props}><path d="m16 3 4 4-4 4" /><path d="M20 7H4" /><path d="m8 21-4-4 4-4" /><path d="M4 17h16" /></IconBase>;
        const MessageCircle = (props) => <IconBase {...props}><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z" /></IconBase>;
        const Copy = (props) => <IconBase {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></IconBase>;
        const Grid = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" /><path d="M3 9h18" /><path d="M9 21V9" /></IconBase>;
        const ClipboardList = (props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></IconBase>;
        const CheckSquare = (props) => <IconBase {...props}><polyline points="9 11 12 14 22 4" /><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" /></IconBase>;
        const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9" /><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><rect width="12" height="8" x="6" y="14" /></IconBase>;
        const TrendingUp = (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></IconBase>;
        const PieChart = (props) => <IconBase {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></IconBase>;
        const Sun = (props) => <IconBase {...props}><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></IconBase>;
        const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></IconBase>;
        const Share2 = (props) => <IconBase {...props}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></IconBase>;
        const History = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></IconBase>;
        const HelpCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><path d="M12 17h.01" /></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></IconBase>;
        const Percent = (props) => <IconBase {...props}><line x1="19" y1="5" x2="5" y2="19" /><circle cx="6.5" cy="6.5" r="2.5" /><circle cx="17.5" cy="17.5" r="2.5" /></IconBase>;

        // --- Constants ---
        // ÌïúÍµ≠ÏùÄÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ (2025.12.28 Í∏∞Ï§Ä)
        const BOK_RATE_DEFAULT = 2.50;
        const BOK_RATE_DATE_DEFAULT = "2025.12.28";

        // --- Utils ---
        const getSafeLocalStorage = (key, defaultValue = '') => {
            try {
                const saved = localStorage.getItem(key);
                if (saved === null || saved === '') return defaultValue;
                return saved;
            } catch (e) {
                console.warn('localStorage access failed:', e);
                return defaultValue;
            }
        };

        const setSafeLocalStorage = (key, value) => {
            try {
                localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));
            } catch (e) {
                console.warn('localStorage write failed:', e);
            }
        };

        const formatNumber = (num) => {
            if (!num && num !== 0) return '';
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        };

        // ÌïúÍ∏Ä Í∏àÏï° ÌëúÏãú (1Ïñµ 5Ï≤úÎßåÏõê ÌòïÏãù)
        const formatKoreanNumber = (num) => {
            if (!num && num !== 0) return '';
            const value = Math.round(parseFloat(num) || 0);
            if (value === 0) return '0Ïõê';

            const units = [
                { value: 100000000, unit: 'Ïñµ' },
                { value: 10000000, unit: 'Ï≤úÎßå' },
                { value: 10000, unit: 'Îßå' },
                { value: 1000, unit: 'Ï≤ú' }
            ];

            let result = '';
            let remaining = value;

            for (const { value: unitValue, unit } of units) {
                if (remaining >= unitValue) {
                    const count = Math.floor(remaining / unitValue);
                    result += count + unit + ' ';
                    remaining = remaining % unitValue;
                }
            }

            if (remaining > 0 && value < 10000) {
                result += remaining;
            }

            return result.trim() + 'Ïõê';
        };

        const parseNumber = (str) => {
            if (!str) return 0;
            return parseInt(str.toString().replace(/,/g, ''), 10) || 0;
        };

        const formatDate = (timestamp) => {
            const date = new Date(timestamp);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${month}/${day} ${hours}:${minutes}`;
        };

        // Í≥ÑÏÇ∞ ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨
        const saveToHistory = (type, data) => {
            try {
                const history = JSON.parse(localStorage.getItem('calcHistory') || '[]');
                history.unshift({
                    type,
                    data,
                    timestamp: Date.now()
                });
                localStorage.setItem('calcHistory', JSON.stringify(history.slice(0, 20)));
            } catch (e) {
                console.warn('Failed to save history:', e);
            }
        };

        const getHistory = () => {
            try {
                return JSON.parse(localStorage.getItem('calcHistory') || '[]');
            } catch (e) {
                return [];
            }
        };

        const clearHistory = () => {
            try {
                localStorage.removeItem('calcHistory');
            } catch (e) {
                console.warn('Failed to clear history:', e);
            }
        };

        // Î≥¥Ï¶ùÎ≥¥ÌóòÎ£å Í≥ÑÏÇ∞ Ïú†Ìã∏
        const calculateInsuranceFee = (deposit, years = 1) => {
            // HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò Í∏∞Ï§Ä (2024 Í∏∞Ï§Ä ÏïΩ 0.115%~0.154%)
            const baseRate = 0.00128; // ÌèâÍ∑† 0.128%
            return Math.floor(deposit * baseRate * years);
        };

        // Ï†ÑÏõîÏÑ∏Ï†ÑÌôòÏú® Í≥ÑÏÇ∞
        const calculateConversion = (deposit, rate) => {
            // ÏõîÏÑ∏ = (Î≥¥Ï¶ùÍ∏à √ó Ï†ÑÌôòÏú®) / 12
            return Math.floor((deposit * (rate / 100)) / 12);
        };

        const calculateDepositFromMonthly = (monthly, rate) => {
            // Î≥¥Ï¶ùÍ∏à = (ÏõîÏÑ∏ √ó 12) / Ï†ÑÌôòÏú®
            if (rate <= 0) return 0;
            return Math.floor((monthly * 12) / (rate / 100));
        };

        // --- Skeleton Loading Component ---
        const Skeleton = ({ className = "" }) => (
            <div className={`animate-pulse bg-slate-200 dark:bg-slate-700 rounded-xl ${className}`}></div>
        );

        // --- Common Components ---
        const NumberInput = ({ label, value, onChange, unit = 'Ïõê', placeholder = '0', color = 'blue', enableUnitToggle = true, showKorean = true }) => {
            const [unitMode, setUnitMode] = useState(() => getSafeLocalStorage('unitMode', 'ÎßåÏõê'));
            const inputId = useId();

            // Save unit mode preference
            useEffect(() => {
                setSafeLocalStorage('unitMode', unitMode);
            }, [unitMode]);

            const handleChange = (e) => {
                const rawValue = e.target.value.replace(/,/g, '');
                if (!isNaN(rawValue) && rawValue !== '') {
                    if (enableUnitToggle && unitMode === 'ÎßåÏõê') {
                        onChange(String(Math.round(parseFloat(rawValue || 0) * 10000)));
                    } else {
                        onChange(rawValue);
                    }
                } else if (rawValue === '') {
                    onChange('');
                }
            };

            const displayValue = useMemo(() => {
                if (!value) return '';
                if (enableUnitToggle && unitMode === 'ÎßåÏõê') {
                    const manwon = Math.round(parseNumber(value) / 10000);
                    return formatNumber(manwon);
                }
                return formatNumber(value);
            }, [value, unitMode, enableUnitToggle]);

            const koreanDisplay = useMemo(() => {
                if (!showKorean || !value) return '';
                return formatKoreanNumber(value);
            }, [value, showKorean]);

            const focusColors = {
                blue: 'focus:ring-blue-500',
                orange: 'focus:ring-orange-500',
                green: 'focus:ring-emerald-500',
                violet: 'focus:ring-violet-500',
                cyan: 'focus:ring-cyan-500'
            };

            return (
                <div className="flex flex-col space-y-1.5">
                    <div className="flex justify-between items-center">
                        <label htmlFor={inputId} className="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1">{label}</label>
                        {enableUnitToggle && (
                            <div className="flex text-[10px] font-bold">
                                <button
                                    onClick={() => setUnitMode('Ïõê')}
                                    type="button"
                                    className={`px-2 py-0.5 rounded-l-md transition-colors ${unitMode === 'Ïõê' ? 'bg-slate-800 dark:bg-slate-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400'}`}
                                >Ïõê</button>
                                <button
                                    onClick={() => setUnitMode('ÎßåÏõê')}
                                    type="button"
                                    className={`px-2 py-0.5 rounded-r-md transition-colors ${unitMode === 'ÎßåÏõê' ? 'bg-slate-800 dark:bg-slate-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400'}`}
                                >ÎßåÏõê</button>
                            </div>
                        )}
                    </div>
                    <div className="relative group">
                        <input
                            id={inputId}
                            type="text"
                            inputMode="numeric"
                            value={displayValue}
                            onChange={handleChange}
                            placeholder={placeholder}
                            aria-label={label}
                            className={`w-full pl-5 pr-14 py-4 text-right border-0 bg-white dark:bg-slate-700 rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-600 ${focusColors[color]} focus:ring-2 focus:bg-white dark:focus:bg-slate-600 outline-none transition-all font-bold text-slate-800 dark:text-white text-lg group-hover:ring-slate-300 dark:group-hover:ring-slate-500`}
                        />
                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm font-medium pointer-events-none">
                            {enableUnitToggle ? unitMode : unit}
                        </span>
                    </div>
                    {showKorean && koreanDisplay && (
                        <div className="text-xs text-slate-400 dark:text-slate-500 ml-1 font-medium">
                            ‚âà {koreanDisplay}
                        </div>
                    )}
                </div>
            );
        };

        const ToggleGroup = ({ options, value, onChange, color = 'blue' }) => {
            const activeClasses = {
                blue: 'bg-white text-blue-600 shadow-sm ring-1 ring-black/5',
                green: 'bg-white text-emerald-600 shadow-sm ring-1 ring-black/5',
                violet: 'bg-white text-violet-600 shadow-sm ring-1 ring-black/5',
            };

            return (
                <div role="radiogroup" className="flex bg-slate-100/80 p-1.5 rounded-2xl">
                    {options.map((option) => (
                        <button
                            role="radio"
                            aria-checked={value === option}
                            key={option}
                            onClick={() => onChange(option)}
                            className={`flex-1 py-2.5 text-xs font-bold rounded-xl transition-all ${value === option
                                ? activeClasses[color] || activeClasses.blue
                                : 'text-slate-400 hover:text-slate-600'
                                }`}
                        >
                            {option}
                        </button>
                    ))}
                </div>
            );
        };

        // --- Tabs ---
        // 1. Cost Comparison
        const CostCompareTab = () => {
            const [jDeposit, setJDeposit] = useState(() => getSafeLocalStorage('jDeposit'));
            const [jLoanAmount, setJLoanAmount] = useState(() => getSafeLocalStorage('jLoanAmount'));
            const [jRate, setJRate] = useState(() => getSafeLocalStorage('jRate', '4.5'));
            const [jRatio, setJRatio] = useState(() => getSafeLocalStorage('jRatio', '80'));
            const [wDeposit, setWDeposit] = useState(() => getSafeLocalStorage('wDeposit'));
            const [wMonthly, setWMonthly] = useState(() => getSafeLocalStorage('wMonthly'));
            const [wRate, setWRate] = useState(() => getSafeLocalStorage('wRate', '5.0'));
            const [income, setIncome] = useState(() => getSafeLocalStorage('income'));

            useEffect(() => { localStorage.setItem('jDeposit', jDeposit); }, [jDeposit]);
            useEffect(() => { localStorage.setItem('jLoanAmount', jLoanAmount); }, [jLoanAmount]);
            useEffect(() => { localStorage.setItem('jRate', jRate); }, [jRate]);
            useEffect(() => { localStorage.setItem('jRatio', jRatio); }, [jRatio]);
            useEffect(() => { localStorage.setItem('wDeposit', wDeposit); }, [wDeposit]);
            useEffect(() => { localStorage.setItem('wMonthly', wMonthly); }, [wMonthly]);
            useEffect(() => { localStorage.setItem('wRate', wRate); }, [wRate]);
            useEffect(() => { localStorage.setItem('income', income); }, [income]);

            // ÎåÄÏ∂úÍ∏àÏï° ÏûÖÎ†•Ïãú ÏûêÎèô ÎåÄÏ∂úÎπÑÏú® Í≥ÑÏÇ∞
            const handleLoanAmountChange = (value) => {
                setJLoanAmount(value);
                const depVal = parseNumber(jDeposit);
                const loanVal = parseNumber(value);
                if (depVal > 0 && loanVal > 0) {
                    const ratio = Math.round((loanVal / depVal) * 100);
                    setJRatio(String(Math.min(ratio, 100)));
                }
            };

            // ÎåÄÏ∂úÎπÑÏú® ÏûÖÎ†•Ïãú ÏûêÎèô ÎåÄÏ∂úÍ∏àÏï° Í≥ÑÏÇ∞
            const handleRatioChange = (value) => {
                setJRatio(value);
                const depVal = parseNumber(jDeposit);
                const ratioVal = parseFloat(value) || 0;
                if (depVal > 0) {
                    const loanAmount = Math.round(depVal * (ratioVal / 100));
                    setJLoanAmount(String(loanAmount));
                }
            };

            // Î≥¥Ï¶ùÍ∏à Î≥ÄÍ≤ΩÏãú ÎåÄÏ∂úÍ∏àÏï° Ïû¨Í≥ÑÏÇ∞
            useEffect(() => {
                const depVal = parseNumber(jDeposit);
                const ratioVal = parseFloat(jRatio) || 0;
                if (depVal > 0 && ratioVal > 0) {
                    const loanAmount = Math.round(depVal * (ratioVal / 100));
                    setJLoanAmount(String(loanAmount));
                }
            }, [jDeposit]);

            const result = useMemo(() => {
                const jDepVal = parseNumber(jDeposit);
                const jRateVal = parseFloat(jRate) || 0;
                const jLoanVal = parseNumber(jLoanAmount) || (jDepVal * (parseFloat(jRatio) / 100));
                const wDepVal = parseNumber(wDeposit);
                const wMonVal = parseNumber(wMonthly);
                const wRateVal = parseFloat(wRate) || 0;

                const jMonthlyCost = (jLoanVal * (jRateVal / 100)) / 12;

                const wMonthlyOppCost = (wDepVal * (wRateVal / 100)) / 12;
                const wTotalCost = wMonVal + wMonthlyOppCost;

                const diff = Math.abs(jMonthlyCost - wTotalCost);
                const winner = jMonthlyCost < wTotalCost ? 'Ï†ÑÏÑ∏' : 'ÏõîÏÑ∏';

                const incomeVal = parseNumber(income);
                let rir = 0;
                if (incomeVal > 0) {
                    const currentCost = winner === 'Ï†ÑÏÑ∏' ? jMonthlyCost : wTotalCost;
                    rir = (currentCost / incomeVal) * 100;
                }

                return { jMonthlyCost, wTotalCost, diff, winner, rir, incomeVal, jLoanVal };
            }, [jDeposit, jLoanAmount, jRate, jRatio, wDeposit, wMonthly, wRate, income]);

            const maxVal = Math.max(result.jMonthlyCost, result.wTotalCost, 1);

            // Reset function
            const handleReset = () => {
                setJDeposit('');
                setJLoanAmount('');
                setJRate('4.5');
                setJRatio('80');
                setWDeposit('');
                setWMonthly('');
                setWRate('5.0');
                setIncome('');
            };

            // Share function
            const [copied, setCopied] = useState(false);
            const handleShare = () => {
                const text = `[Ï†ÑÏõîÏÑ∏ ÎπÑÍµê Í≤∞Í≥º]\n\nüìä ${result.winner} Ïú†Î¶¨\nüí∞ Îß§Ïõî ÏïΩ ${formatNumber(parseInt(result.diff))}Ïõê Ï†àÏïΩ\n\nüìç Ï†ÑÏÑ∏ ÏõîÎπÑÏö©: ${formatNumber(parseInt(result.jMonthlyCost))}Ïõê\nüìç ÏõîÏÑ∏ Ï¥ùÎπÑÏö©: ${formatNumber(parseInt(result.wTotalCost))}Ïõê\n\n- Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ Pro`;
                navigator.clipboard.writeText(text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    {/* Base Rate Info + Buttons */}
                    <div className="flex justify-between items-start gap-2">
                        <div className="flex-1 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-2xl flex items-center justify-between border border-blue-100/50 dark:border-blue-800/50 shadow-sm">
                            <div className="flex items-center gap-3">
                                <div className="bg-white dark:bg-slate-700 p-2 rounded-full shadow-sm text-blue-600 dark:text-blue-400">
                                    <TrendingUp size={20} />
                                </div>
                                <div>
                                    <span className="text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider block mb-0.5">Bank of Korea Rate ({BOK_RATE_DATE_DEFAULT})</span>
                                    <div className="text-lg font-extrabold text-slate-800 dark:text-white flex items-center gap-2 flex-wrap">
                                        ÌïúÍµ≠ÏùÄÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ {BOK_RATE_DEFAULT.toFixed(2)}%
                                        <a href="https://www.bok.or.kr/portal/singl/baseRate/progress.do?dataSeCd=01&menuNo=200656" target="_blank" rel="noopener noreferrer" className="text-[10px] bg-blue-100/50 dark:bg-blue-800/50 hover:bg-white dark:hover:bg-slate-700 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded-full border border-blue-200 dark:border-blue-700 transition-all no-print">
                                            ÏµúÏã† ÌôïÏù∏ ‚Üí
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <button
                                onClick={() => {
                                    // ÌÜ†Ïä§Ìä∏Î°ú ÌòÑÏû¨ Í∏àÎ¶¨ ÏÉÅÌÉú ÏïåÎ†§Ï£ºÍ∏∞
                                    alert(`‚úÖ ÌòÑÏû¨ Í∏∞Ï§ÄÍ∏àÎ¶¨: ${BOK_RATE_DEFAULT}%\nüìÖ ÎßàÏßÄÎßâ Í∏àÌÜµÏúÑ Í≤∞Ï†ïÏùº: ${BOK_RATE_DATE_DEFAULT}\n\nÏµúÏã† Í∏àÎ¶¨Îäî ÌïúÍµ≠ÏùÄÌñâ Í≥µÏãù ÌôàÌéòÏù¥ÏßÄÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.`);
                                }}
                                className="p-2 bg-white/50 dark:bg-slate-700/50 rounded-xl text-blue-600 dark:text-blue-400 hover:bg-white dark:hover:bg-slate-600 transition-all no-print ml-2"
                                title="Í∏∞Ï§ÄÍ∏àÎ¶¨ ÌôïÏù∏"
                                aria-label="Í∏∞Ï§ÄÍ∏àÎ¶¨ ÌôïÏù∏"
                            >
                                <RefreshCw size={16} />
                            </button>
                        </div>
                        <button
                            onClick={handleReset}
                            className="p-3 bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-slate-400 hover:text-red-500 dark:hover:text-red-400 hover:border-red-200 dark:hover:border-red-800 transition-all no-print"
                            title="ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî"
                            aria-label="ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî"
                        >
                            <RotateCcw size={20} />
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 group hover:border-blue-200 dark:hover:border-blue-700 transition-colors">
                            <h3 className="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center">
                                <span className="w-2 h-2 rounded-full bg-blue-500 mr-2 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></span>
                                Ï†ÑÏÑ∏ Ï°∞Í±¥
                            </h3>
                            <div className="space-y-5">
                                <NumberInput label="Î≥¥Ï¶ùÍ∏à" value={jDeposit} onChange={setJDeposit} color="blue" />
                                <NumberInput label="ÎåÄÏ∂úÍ∏àÏï°" value={jLoanAmount} onChange={handleLoanAmountChange} color="blue" />
                                <div className="flex gap-3">
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">ÎåÄÏ∂úÍ∏àÎ¶¨ (%)</label>
                                        <input type="number" value={jRate} onChange={(e) => setJRate(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 dark:bg-slate-700 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-slate-600 font-bold text-slate-700 dark:text-white transition-all font-mono tracking-tight" />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">ÎåÄÏ∂úÎπÑÏú® (%)</label>
                                        <input type="number" value={jRatio} onChange={(e) => handleRatioChange(e.target.value)} className="w-full px-4 py-3 text-right bg-slate-50 dark:bg-slate-700 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-slate-600 font-bold text-slate-700 dark:text-white transition-all font-mono tracking-tight" />
                                    </div>
                                </div>
                                {parseNumber(jDeposit) > 0 && parseNumber(jLoanAmount) > 0 && (
                                    <div className="text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-3 py-2 rounded-xl">
                                        üí° ÎåÄÏ∂úÍ∏à: {formatKoreanNumber(jLoanAmount)} ({jRatio}%) ‚Üí Ïõî Ïù¥Ïûê: {formatKoreanNumber(result.jMonthlyCost)}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 group hover:border-orange-200 dark:hover:border-orange-700 transition-colors">
                            <h3 className="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center">
                                <span className="w-2 h-2 rounded-full bg-orange-500 mr-2 shadow-[0_0_10px_rgba(249,115,22,0.5)]"></span>
                                ÏõîÏÑ∏ Ï°∞Í±¥
                            </h3>
                            <div className="space-y-5">
                                <NumberInput label="Î≥¥Ï¶ùÍ∏à" value={wDeposit} onChange={setWDeposit} color="orange" />
                                <NumberInput label="ÏõîÏÑ∏" value={wMonthly} onChange={setWMonthly} color="orange" />
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1.5 block ml-1">Ï†ÑÌôòÏú® (%)</label>
                                    <div className="relative group">
                                        <input
                                            type="number"
                                            value={wRate}
                                            onChange={(e) => setWRate(e.target.value)}
                                            placeholder="0"
                                            className="w-full pl-5 pr-10 py-4 text-right bg-slate-50 dark:bg-slate-700 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-orange-500 focus:bg-white dark:focus:bg-slate-600 font-bold text-slate-700 dark:text-white transition-all font-mono tracking-tight text-lg"
                                        />
                                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm font-medium pointer-events-none">
                                            %
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-slate-900 text-white p-8 rounded-[2.5rem] shadow-2xl shadow-blue-900/20 relative overflow-hidden animate-result-pop">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-blue-500/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                        <div className="absolute bottom-0 left-0 w-48 h-48 bg-orange-500/20 rounded-full blur-3xl -ml-16 -mb-16 pointer-events-none"></div>

                        <div className="relative z-10">
                            {/* Share Button */}
                            <button
                                onClick={handleShare}
                                className={`absolute top-0 right-0 p-2.5 rounded-xl transition-all no-print ${copied ? 'bg-green-500 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20 hover:text-white'}`}
                                title="Í≤∞Í≥º Í≥µÏú†"
                                aria-label="Í≤∞Í≥º Í≥µÏú†ÌïòÍ∏∞"
                            >
                                {copied ? <CheckCircle size={18} /> : <Share2 size={18} />}
                            </button>

                            <div className="text-center mb-10">
                                <p className="text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-3">Recommendation</p>
                                <div className={`text-4xl md:text-5xl font-black flex justify-center items-center gap-4 mb-4 ${result.winner === 'Ï†ÑÏÑ∏' ? 'text-blue-400' : 'text-orange-400'}`}>
                                    {result.winner === 'Ï†ÑÏÑ∏' ? <Home size={40} strokeWidth={2.5} /> : <CheckCircle size={40} strokeWidth={2.5} />}
                                    <span>{result.winner} Ïú†Î¶¨</span>
                                </div>
                                <p className="text-slate-300 font-medium">
                                    Îß§Ïõî ÏïΩ <span className="text-white font-extrabold text-xl mx-1 bg-white/10 px-2 py-1 rounded-lg animate-number-pop">{formatNumber(parseInt(result.diff))}Ïõê</span> Îçî Ï†ÄÎ†¥Ìï¥Ïöî
                                </p>
                            </div>

                            <div className="flex items-end justify-center h-40 gap-8 md:gap-16 px-4 relative z-10">
                                <div className="flex flex-col items-center w-24 group">
                                    <span className="mb-3 text-sm font-bold text-blue-300 transition-opacity duration-300">{formatNumber(parseInt(result.jMonthlyCost))}</span>
                                    <div
                                        className="w-16 bg-gradient-to-t from-blue-600 to-blue-400 rounded-t-2xl transition-all duration-700 relative shadow-lg shadow-blue-500/30 group-hover:w-20"
                                        style={{ height: `${Math.max(Math.round((result.jMonthlyCost / maxVal) * 120), 16)}px` }}
                                    ></div>
                                    <span className="mt-4 text-sm font-bold text-slate-400 uppercase tracking-wider">Ï†ÑÏÑ∏</span>
                                </div>
                                <div className="flex flex-col items-center w-24 group">
                                    <span className="mb-3 text-sm font-bold text-orange-300 transition-opacity duration-300">{formatNumber(parseInt(result.wTotalCost))}</span>
                                    <div
                                        className="w-16 bg-gradient-to-t from-orange-600 to-orange-400 rounded-t-2xl transition-all duration-700 relative shadow-lg shadow-orange-500/30 group-hover:w-20"
                                        style={{ height: `${Math.max(Math.round((result.wTotalCost / maxVal) * 120), 16)}px` }}
                                    ></div>
                                    <span className="mt-4 text-sm font-bold text-slate-400 uppercase tracking-wider">ÏõîÏÑ∏</span>
                                </div>
                                <div className="absolute bottom-9 w-full border-b border-white/10 -z-10 bg-gradient-to-r from-transparent via-white/20 to-transparent h-[1px]"></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. Safety Tab
        const SafetyTab = () => {
            const [price, setPrice] = useState(() => getSafeLocalStorage('sPrice'));
            const [bond, setBond] = useState(() => getSafeLocalStorage('sBond'));
            const [deposit, setDeposit] = useState(() => getSafeLocalStorage('sDeposit'));

            useEffect(() => { localStorage.setItem('sPrice', price); }, [price]);
            useEffect(() => { localStorage.setItem('sBond', bond); }, [bond]);
            useEffect(() => { localStorage.setItem('sDeposit', deposit); }, [deposit]);

            const analysis = useMemo(() => {
                const priceVal = parseNumber(price);
                const bondVal = parseNumber(bond);
                const depositVal = parseNumber(deposit);
                if (priceVal === 0) return null;

                const totalDebt = bondVal + depositVal;
                const ratio = (totalDebt / priceVal) * 100;

                let status = 'ÏïàÏ†Ñ';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';
                let barColor = 'bg-emerald-500';
                let icon = <CheckCircle className="w-8 h-8 text-emerald-500" />;

                if (ratio > 80) {
                    status = 'ÏúÑÌóò (Íπ°ÌÜµÏ†ÑÏÑ∏)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                    barColor = 'bg-red-500';
                    icon = <AlertTriangle className="w-8 h-8 text-red-500" />;
                } else if (ratio > 60) {
                    status = 'Ï£ºÏùò ÌïÑÏöî';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                    barColor = 'bg-orange-500';
                    icon = <Info className="w-8 h-8 text-orange-500" />;
                }

                return { ratio, totalDebt, status, colorClass, barColor, icon };
            }, [price, bond, deposit]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-5">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Shield className="w-5 h-5 mr-3 text-emerald-600" />
                            ÏïàÏ†Ñ ÏßÑÎã® Îç∞Ïù¥ÌÑ∞
                        </h3>
                        <NumberInput label="Îß§Îß§ ÏãúÏÑ∏ (KBÏãúÏÑ∏/Ïã§Í±∞ÎûòÍ∞Ä)" value={price} onChange={setPrice} color="green" />
                        <NumberInput label="ÏÑ†ÏàúÏúÑ Ï±ÑÍ∂å (Í∑ºÏ†ÄÎãπ Îì±)" value={bond} onChange={setBond} color="green" />
                        <NumberInput label="ÎÇòÏùò Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="green" />
                    </div>

                    {analysis ? (
                        <div className={`p-6 rounded-[2rem] border ${analysis.colorClass} transition-all duration-500 shadow-sm relative overflow-hidden`}>
                            <div className="relative z-10">
                                <div className="flex items-center gap-4 mb-6">
                                    <div className="bg-white p-3 rounded-2xl shadow-sm ring-1 ring-black/5">
                                        {analysis.icon}
                                    </div>
                                    <div>
                                        <h4 className="text-2xl font-black">{analysis.status}</h4>
                                        <p className="text-sm font-semibold opacity-70 mt-1">Ï†ÑÏÑ∏Í∞ÄÏú® {analysis.ratio.toFixed(1)}%</p>
                                    </div>
                                </div>

                                <div className="bg-white/60 rounded-2xl p-5 space-y-4 text-sm font-medium backdrop-blur-md border border-white/50">
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-600">ÎÇ¥ Î≥¥Ï¶ùÍ∏à + ÏúµÏûê</span>
                                        <span className="font-bold text-lg">{formatNumber(analysis.totalDebt)}Ïõê</span>
                                    </div>

                                    <div className="w-full bg-slate-200/50 rounded-full h-4 overflow-hidden relative">
                                        {/* ÏïàÏ†Ñ Íµ¨Í∞Ñ ÌëúÏãúÏÑ† */}
                                        <div className="absolute left-[60%] top-0 bottom-0 w-0.5 bg-slate-300 z-10" title="ÏïàÏ†ÑÏÑ† (60%)"></div>
                                        <div className="absolute left-[80%] top-0 bottom-0 w-0.5 bg-slate-300 z-10" title="ÏúÑÌóòÏÑ† (80%)"></div>

                                        <div
                                            className={`h-full rounded-full transition-all duration-1000 ease-out shadow-sm ${analysis.barColor}`}
                                            style={{ width: `${Math.min(analysis.ratio, 100)}%` }}
                                        ></div>
                                    </div>

                                    <div className="flex justify-between text-[11px] font-bold text-slate-400 uppercase tracking-wide">
                                        <span>0%</span>
                                        <span className="text-green-600">60% Safe</span>
                                        <span className="text-red-500">80% Risk</span>
                                        <span>100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-col items-center justify-center py-20 bg-white rounded-3xl border-2 border-dashed border-slate-200 text-slate-400">
                            <Shield className="w-16 h-16 mb-4 text-slate-200 stroke-1" />
                            <p className="text-sm font-bold">Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÏïàÏ†ÑÎèÑÎ•º Î∂ÑÏÑùÌï©ÎãàÎã§</p>
                        </div>
                    )}
                </div>
            );
        };

        // 3. Fee Tab
        const FeeTab = () => {
            const [propType, setPropType] = useState('Ï£ºÌÉù');
            const [dealType, setDealType] = useState('ÏûÑÎåÄÏ∞®');
            const [amount, setAmount] = useState('');

            const result = useMemo(() => {
                const val = parseNumber(amount);
                if (!val) return null;

                let rate = 0;
                let limit = 0;

                if (propType === 'Ï£ºÌÉù') {
                    if (dealType === 'ÏûÑÎåÄÏ∞®') {
                        if (val < 50000000) { rate = 0.5; limit = 200000; }
                        else if (val < 100000000) { rate = 0.4; limit = 300000; }
                        else if (val < 600000000) { rate = 0.3; }
                        else if (val < 1500000000) { rate = 0.4; }
                        else { rate = 0.6; }
                    } else {
                        if (val < 50000000) { rate = 0.6; limit = 250000; }
                        else if (val < 200000000) { rate = 0.5; limit = 800000; }
                        else if (val < 900000000) { rate = 0.4; }
                        else { rate = 0.5; }
                    }
                } else if (propType === 'Ïò§ÌîºÏä§ÌÖî') {
                    rate = dealType === 'ÏûÑÎåÄÏ∞®' ? 0.4 : 0.5;
                } else {
                    rate = 0.9;
                }

                let fee = Math.floor(val * (rate / 100));
                if (limit > 0 && fee > limit) fee = limit;
                const vat = Math.floor(fee * 0.1);

                return { rate, fee, vat, total: fee + vat, limit };
            }, [propType, dealType, amount]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Calculator className="w-5 h-5 mr-3 text-emerald-600" />Í≥ÑÏÇ∞ Ï°∞Í±¥
                        </h3>
                        <div className="space-y-6">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Î¨ºÍ±¥ Ï¢ÖÎ•ò</label>
                                <div className="flex gap-2 bg-slate-100/50 p-1.5 rounded-2xl">
                                    {['Ï£ºÌÉù', 'Ïò§ÌîºÏä§ÌÖî', 'ÏÉÅÍ∞Ä'].map(type => (
                                        <button
                                            key={type}
                                            onClick={() => setPropType(type)}
                                            className={`flex-1 py-3 rounded-xl font-bold text-xs transition-all ${propType === type ? 'bg-white text-emerald-700 shadow-sm ring-1 ring-black/5' : 'text-slate-400 hover:text-slate-600'}`}
                                        >
                                            {type}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í±∞Îûò Ï¢ÖÎ•ò</label>
                                <ToggleGroup options={['ÏûÑÎåÄÏ∞®', 'Îß§Îß§']} value={dealType} onChange={setDealType} color="green" />
                            </div>

                            <NumberInput label="Í±∞Îûò Í∏àÏï° (Î≥¥Ï¶ùÍ∏à/Îß§Îß§Í∞Ä)" value={amount} onChange={setAmount} color="green" />
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-gradient-to-br from-emerald-50 to-teal-50 p-7 rounded-[2.5rem] border border-emerald-100 shadow-lg shadow-emerald-100 relative overflow-hidden">
                            <Calculator className="absolute -bottom-6 -right-6 w-40 h-40 text-emerald-500 opacity-5 rotate-12" />

                            <div className="relative z-10 text-emerald-900">
                                <div className="flex justify-between items-center mb-6">
                                    <h4 className="text-sm font-black uppercase tracking-widest opacity-60">Estimated Fee</h4>
                                    <span className="bg-white/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold text-emerald-600 shadow-sm border border-emerald-100">{result.rate}% Ï†ÅÏö©</span>
                                </div>

                                <div className="space-y-3 mb-8 bg-white/60 backdrop-blur-xl p-5 rounded-2xl border border-white/50">
                                    <div className="flex justify-between text-slate-600 font-medium text-sm">
                                        <span>Ï§ëÍ∞úÏàòÏàòÎ£å</span>
                                        <span>{formatNumber(result.fee)}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-slate-600 font-medium text-sm">
                                        <span>Î∂ÄÍ∞ÄÏÑ∏(10%)</span>
                                        <span>{formatNumber(result.vat)}Ïõê</span>
                                    </div>
                                    {result.limit > 0 && (
                                        <div className="text-xs font-bold text-emerald-600 text-right mt-1">* ÌïúÎèÑÏï° {formatNumber(result.limit)}Ïõê Ï†ÅÏö©</div>
                                    )}
                                </div>

                                <div className="flex justify-between items-end border-t border-emerald-200/50 pt-5">
                                    <span className="font-bold text-emerald-800">Ï¥ù ÏòàÏÉÅ Í∏àÏï°</span>
                                    <span className="text-4xl font-black text-emerald-700 tracking-tight">{formatNumber(result.total)}<span className="text-xl font-medium ml-1 text-emerald-600 align-baseline">Ïõê</span></span>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200">
                            Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // 4. Loan Tab
        const LoanTab = () => {
            const [loanAmount, setLoanAmount] = useState('');
            const [rate, setRate] = useState('4.0');
            const [period, setPeriod] = useState('24');
            const [method, setMethod] = useState('ÎßåÍ∏∞ÏùºÏãú');

            const result = useMemo(() => {
                const principal = parseNumber(loanAmount);
                const r = parseFloat(rate) / 100 / 12;
                const n = parseInt(period);

                if (!principal || !n) return null;

                let monthlyPayment = 0;
                let totalInterest = 0;
                let desc = "";

                if (method === 'ÎßåÍ∏∞ÏùºÏãú') {
                    monthlyPayment = principal * r;
                    totalInterest = monthlyPayment * n;
                    desc = "Îß§Îã¨ Ïù¥ÏûêÎßå, ÏõêÍ∏àÏùÄ ÎßåÍ∏∞Ïóê";
                } else if (method === 'ÏõêÎ¶¨Í∏àÍ∑†Îì±') {
                    monthlyPayment = (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                    totalInterest = (monthlyPayment * n) - principal;
                    desc = "ÏõêÍ∏à+Ïù¥ÏûêÎ•º Îß§Îã¨ ÎòëÍ∞ôÏù¥";
                } else if (method === 'ÏõêÍ∏àÍ∑†Îì±') {
                    const firstMonthInterest = principal * r;
                    const principalPayment = principal / n;
                    monthlyPayment = principalPayment + firstMonthInterest;
                    const lastMonthInterest = (principal / n) * r;
                    totalInterest = (n * (firstMonthInterest + lastMonthInterest)) / 2;
                    desc = "Ï≤´ Îã¨Ïù¥ Í∞ÄÏû• ÎπÑÏã∏Í≥† Í∞êÏÜå";
                }

                return { monthlyPayment, totalInterest, totalPayment: principal + totalInterest, desc };
            }, [loanAmount, rate, period, method]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <DollarSign className="w-5 h-5 mr-3 text-violet-600" /> ÎåÄÏ∂ú Ï°∞Í±¥
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="ÎåÄÏ∂ú Í∏àÏï°" value={loanAmount} onChange={setLoanAmount} color="violet" />

                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ïó∞ Ïù¥ÏûêÏú® (%)</label>
                                    <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full px-4 py-4 border-0 bg-slate-50 rounded-2xl text-right outline-none focus:ring-2 focus:ring-violet-500 focus:bg-white font-bold text-slate-700 transition-all" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Í∏∞Í∞Ñ (Í∞úÏõî)</label>
                                    <input type="number" value={period} onChange={e => setPeriod(e.target.value)} className="w-full px-4 py-4 border-0 bg-slate-50 rounded-2xl text-right outline-none focus:ring-2 focus:ring-violet-500 focus:bg-white font-bold text-slate-700 transition-all" />
                                </div>
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÏÉÅÌôò Î∞©Ïãù</label>
                                <ToggleGroup options={['ÎßåÍ∏∞ÏùºÏãú', 'ÏõêÎ¶¨Í∏àÍ∑†Îì±', 'ÏõêÍ∏àÍ∑†Îì±']} value={method} onChange={setMethod} color="violet" />
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-violet-50 p-6 rounded-[2.5rem] border border-violet-100 shadow-lg shadow-violet-100/50 relative">
                            <div className="absolute top-5 right-5 bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full ring-1 ring-violet-200">
                                <span className="text-violet-700 text-xs font-bold">{result.desc}</span>
                            </div>

                            <div className="mt-8 space-y-4">
                                <div className="flex justify-between items-center bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/5">
                                    <span className="text-slate-500 font-bold text-sm uppercase tracking-wide">
                                        {method === 'ÏõêÍ∏àÍ∑†Îì±' ? 'Ï≤´ Îã¨ ÎÇ©ÏûÖÍ∏à' : 'Ïõî ÏòàÏÉÅ ÎÇ©ÏûÖÍ∏à'}
                                    </span>
                                    <span className="text-2xl font-black text-violet-600">{formatNumber(Math.round(result.monthlyPayment))}Ïõê</span>
                                </div>

                                <div className="px-4 py-2 space-y-3">
                                    <div className="flex justify-between text-sm text-slate-600 font-medium">
                                        <span>Ï¥ù Ïù¥Ïûê ÎπÑÏö©</span>
                                        <span>{formatNumber(Math.round(result.totalInterest))}Ïõê</span>
                                    </div>
                                    <div className="flex justify-between text-sm text-slate-600 font-medium">
                                        <span>Ï¥ù ÏÉÅÌôò Í∏àÏï°</span>
                                        <span className="font-bold text-slate-800">{formatNumber(Math.round(result.totalPayment))}Ïõê</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            ÎåÄÏ∂ú Ï°∞Í±¥ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };


        // 6. Buying Tab (NEW)
        const BuyingTab = () => {
            const [price, setPrice] = useState('');
            const [region, setRegion] = useState('non-adj'); // adj (jojeong), non-adj
            const [count, setCount] = useState('1'); // 1, 2, 3+

            const result = useMemo(() => {
                const p = parseNumber(price);
                if (!p) return null;

                let taxRate = 0.01; // Default 1% (1 house, non-adj, <600m)

                if (count === '1') {
                    if (p <= 600000000) taxRate = 0.01;
                    else if (p <= 900000000) taxRate = 0.01 + ((p - 600000000) / 300000000) * 0.02; // 1~3%
                    else taxRate = 0.03;
                } else if (count === '2') {
                    taxRate = region === 'adj' ? 0.08 : 0.01; // 8% if adj, else basic (simplified 1-3%)
                    if (region !== 'adj') {
                        if (p <= 600000000) taxRate = 0.01;
                        else if (p <= 900000000) taxRate = 0.01 + ((p - 600000000) / 300000000) * 0.02;
                        else taxRate = 0.03;
                    }
                } else { // 3+
                    taxRate = region === 'adj' ? 0.12 : 0.08;
                }

                const eduTax = taxRate * 0.1; // Local Education Tax (Simplified)
                const specialTax = p > 850000000 ? 0.002 : 0; // Rural Special Tax (Simplified condition)

                const acquisitionTax = Math.floor(p * taxRate);
                const totalTax = Math.floor(p * (taxRate + eduTax + specialTax));

                // Bond Discount (Simplified 10% burden of 2.6% bond rate roughly)
                const bondRate = 0.026; // Approx
                const discountRate = 0.12; // 12% discount cost
                const bondCost = Math.floor(p * bondRate * discountRate);

                return { acquisitionTax, totalTax, bondCost, taxRate: (taxRate * 100).toFixed(2) };
            }, [price, region, count]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <Home className="w-5 h-5 mr-3 text-blue-600" /> Îß§Ïàò ÏÑ∏Í∏à Í≥ÑÏÇ∞
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Îß§Îß§ Í∞ÄÍ≤©" value={price} onChange={setPrice} color="blue" />

                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">ÏßÄÏó≠ Íµ¨Î∂Ñ</label>
                                    <ToggleGroup options={['ÎπÑÍ∑úÏ†ú', 'Í∑úÏ†ú(Ï°∞Ï†ï)']} value={region === 'non-adj' ? 'ÎπÑÍ∑úÏ†ú' : 'Í∑úÏ†ú(Ï°∞Ï†ï)'} onChange={(v) => setRegion(v === 'ÎπÑÍ∑úÏ†ú' ? 'non-adj' : 'adj')} color="blue" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2 ml-1">Ï£ºÌÉù Ïàò</label>
                                    <ToggleGroup options={['1Ï±Ñ', '2Ï±Ñ', '3Ï±Ñ+']} value={count === '1' ? '1Ï±Ñ' : count === '2' ? '2Ï±Ñ' : '3Ï±Ñ+'} onChange={(v) => setCount(v === '1Ï±Ñ' ? '1' : v === '2Ï±Ñ' ? '2' : '3')} color="blue" />
                                </div>
                            </div>
                        </div>
                    </div>

                    {result ? (
                        <div className="bg-blue-50 p-6 rounded-[2.5rem] border border-blue-100 shadow-lg relative">
                            <div className="text-center mb-8">
                                <p className="text-sm font-bold text-blue-400 uppercase tracking-widest mb-2">ÏòàÏÉÅ Ï¥ù ÌïÑÏöî ÏûêÍ∏à (ÏÑ∏Í∏à+Ï±ÑÍ∂å)</p>
                                <p className="text-4xl font-black text-blue-900">{formatNumber(result.totalTax + result.bondCost)}Ïõê</p>
                            </div>

                            <div className="bg-white rounded-2xl p-5 space-y-3 shadow-sm ring-1 ring-black/5">
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>Ï∑®ÎìùÏÑ∏ ({result.taxRate}%)</span>
                                    <span>{formatNumber(result.acquisitionTax)}Ïõê</span>
                                </div>
                                <div className="flex justify-between text-sm font-medium text-slate-600">
                                    <span>ÏßÄÎ∞©ÍµêÏú°ÏÑ∏ Îì±</span>
                                    <span>{formatNumber(result.totalTax - result.acquisitionTax)}Ïõê</span>
                                </div>
                                <div className="h-px bg-slate-100 my-2"></div>
                                <div className="flex justify-between text-sm font-bold text-slate-800">
                                    <span>Íµ≠ÎØºÏ£ºÌÉùÏ±ÑÍ∂å (Ìï†Ïù∏Îß§ÎèÑ Í∞ÄÏ†ï)</span>
                                    <span>ÏïΩ {formatNumber(result.bondCost)}Ïõê</span>
                                </div>
                            </div>
                            <p className="text-xs text-center text-blue-300 mt-4">* Ïã§Ï†ú ÏÑ∏Í∏àÏùÄ Î©¥Ï†Å, Í∞êÎ©¥ÏöîÍ±¥(ÏÉùÏï†ÏµúÏ¥à Îì±)Ïóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏäµÎãàÎã§.</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Îß§Îß§Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };

        // 7. DSR Calculator Tab (NEW)
        const DSRTab = () => {
            const [income, setIncome] = useState('');
            const [debt, setDebt] = useState(''); // Annual Principle + Interest
            const [newDebt, setNewDebt] = useState(''); // New Loan Annual P+I

            const result = useMemo(() => {
                const inc = parseNumber(income);
                const d = parseNumber(debt);
                const nd = parseNumber(newDebt);

                if (!inc) return null;

                const totalDebtPayment = d + nd;
                const dsr = (totalDebtPayment / inc) * 100;

                let status = 'Ïó¨Ïú†';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';

                if (dsr > 50) {
                    status = 'Ï¥àÍ≥º (Î∂àÍ∞Ä)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                } else if (dsr > 40) {
                    status = 'Ï£ºÏùò (ÌïúÎèÑÏ†ëÍ∑º)';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                }

                return { dsr, status, colorClass };
            }, [income, debt, newDebt]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <DollarSign className="w-5 h-5 mr-3 text-indigo-600" /> DSR Í≥ÑÏÇ∞ (Ï¥ùÎ∂ÄÏ±ÑÏõêÎ¶¨Í∏àÏÉÅÌôòÎπÑÏú®)
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ïó∞ ÏÜåÎìù" value={income} onChange={setIncome} color="violet" />
                            <NumberInput label="Í∏∞Ï°¥ ÎåÄÏ∂ú Ïó∞ ÏõêÎ¶¨Í∏à ÏÉÅÌôòÏï°" value={debt} onChange={setDebt} color="violet" />
                            <NumberInput label="Ïã†Í∑ú ÎåÄÏ∂ú Ïó∞ ÏõêÎ¶¨Í∏à (ÏòàÏÉÅ)" value={newDebt} onChange={setNewDebt} color="violet" />
                        </div>
                    </div>

                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] border ${result.colorClass} shadow-lg relative overflow-hidden`}>
                            <div className="text-center">
                                <div className="text-sm font-bold opacity-60 uppercase tracking-widest mb-2">My DSR</div>
                                <div className="text-5xl font-black mb-2">{result.dsr.toFixed(2)}%</div>
                                <div className="inline-block px-3 py-1 rounded-full bg-white/50 backdrop-blur-sm font-bold text-sm border border-white/20">
                                    {result.status}
                                </div>
                            </div>
                            <div className="w-full bg-white/40 rounded-full h-4 mt-6 backdrop-blur-sm border border-white/30 p-0.5">
                                <div
                                    className={`h-full rounded-full transition-all duration-1000 shadow-sm ${result.dsr > 40 ? 'bg-red-500' : 'bg-emerald-500'}`}
                                    style={{ width: `${Math.min(result.dsr, 100)}%` }}
                                ></div>
                            </div>
                            <p className="text-xs text-center opacity-60 mt-4">* 1Í∏àÏúµÍ∂å 40%, 2Í∏àÏúµÍ∂å 50% Í∑úÏ†ú Ï†ÅÏö© (2025)</p>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            ÏÜåÎìùÍ≥º Î∂ÄÏ±Ñ Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                        </div>
                    )}
                </div>
            );
        };


        // 8. LTV Tab (Restored)
        const LTVTab = () => {
            const [value, setValue] = useState('');
            const [loan, setLoan] = useState('');

            const result = useMemo(() => {
                const v = parseNumber(value);
                const l = parseNumber(loan);
                if (!v) return null;

                const ltv = (l / v) * 100;

                let status = 'ÏïàÏ†Ñ';
                let colorClass = 'bg-emerald-50 border-emerald-200 text-emerald-900';

                if (ltv > 70) {
                    status = 'ÏúÑÌóò (Í≥†ÏúÑÌóòÍµ∞)';
                    colorClass = 'bg-red-50 border-red-200 text-red-900';
                } else if (ltv > 50) {
                    status = 'Ï£ºÏùò (ÎπÑÏú® ÎÜíÏùå)';
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-900';
                }

                return { ltv, status, colorClass };
            }, [value, loan]);

            return (
                <div className="space-y-6 pb-32 animate-slide-up px-1">
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center">
                            <PieChart className="w-5 h-5 mr-3 text-purple-600" /> Ï£ºÌÉùÎã¥Î≥¥ÎåÄÏ∂ú ÎπÑÏú® (LTV)
                        </h3>
                        <div className="space-y-5">
                            <NumberInput label="Ï£ºÌÉù ÏûêÏÇ∞ Í∞ÄÏπò (Îß§Îß§Í∞Ä)" value={value} onChange={setValue} color="violet" />
                            <NumberInput label="ÎåÄÏ∂ú Ìù¨Îßù Í∏àÏï°" value={loan} onChange={setLoan} color="violet" />
                        </div>
                    </div>

                    {result ? (
                        <div className={`p-6 rounded-[2.5rem] border ${result.colorClass} shadow-lg relative overflow-hidden transition-all duration-500`}>
                            <div className="relative z-10">
                                <div className="text-center mb-6">
                                    <div className="text-sm font-bold opacity-60 uppercase tracking-widest mb-2">Calculated LTV</div>
                                    <div className="text-5xl font-black mb-2">{result.ltv.toFixed(1)}<span className="text-3xl font-bold ml-1">%</span></div>
                                    <div className="inline-block px-3 py-1 rounded-full bg-white/50 backdrop-blur-sm font-bold text-sm border border-white/20">
                                        {result.status}
                                    </div>
                                </div>

                                <div className="w-full bg-white/40 rounded-full h-6 p-1 backdrop-blur-sm border border-white/30">
                                    <div
                                        className={`h-full rounded-full transition-all duration-1000 shadow-sm ${result.ltv > 70 ? 'bg-red-500' : result.ltv > 50 ? 'bg-orange-500' : 'bg-emerald-500'}`}
                                        style={{ width: `${Math.min(result.ltv, 100)}%` }}
                                    ></div>
                                </div>
                                <div className="flex justify-between text-[10px] font-bold opacity-50 mt-2 px-1">
                                    <span>0%</span>
                                    <span>40%</span>
                                    <span>60%</span>
                                    <span>80%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="text-center py-20 text-slate-300 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                            Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ LTVÎ•º Í≥ÑÏÇ∞Ìï©ÎãàÎã§
                        </div>
                    )}
                </div>
            );
        }

        // 5. Tools Tab & Components
        const UnitConverter = () => {
            const [pyung, setPyung] = useState('');
            const [sqm, setSqm] = useState('');
            const sqmId = useId();
            const pyungId = useId();

            const handleSqmChange = (val) => {
                setSqm(val);
                if (val) setPyung((parseFloat(val) / 3.3058).toFixed(2));
                else setPyung('');
            };

            const handlePyungChange = (val) => {
                setPyung(val);
                if (val) setSqm((parseFloat(val) * 3.3058).toFixed(2));
                else setSqm('');
            };

            return (
                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex items-center gap-6 relative">
                        <div className="flex-1 text-center group">
                            <input
                                id={sqmId}
                                type="number"
                                value={sqm}
                                onChange={e => handleSqmChange(e.target.value)}
                                className="w-full py-6 bg-slate-50 rounded-3xl text-center font-black text-3xl outline-none focus:ring-2 focus:ring-indigo-500 text-slate-800 transition-all group-hover:bg-indigo-50 group-hover:text-indigo-600"
                                placeholder="0"
                            />
                            <label htmlFor={sqmId} className="text-xs font-bold text-slate-400 mt-3 block uppercase tracking-widest">Ï†úÍ≥±ÎØ∏ÌÑ∞ („é°)</label>
                        </div>
                        <div className="bg-slate-100 p-3 rounded-full text-slate-400">
                            <ArrowRightLeft size={20} />
                        </div>
                        <div className="flex-1 text-center group">
                            <input
                                id={pyungId}
                                type="number"
                                value={pyung}
                                onChange={e => handlePyungChange(e.target.value)}
                                className="w-full py-6 bg-slate-50 rounded-3xl text-center font-black text-3xl outline-none focus:ring-2 focus:ring-indigo-500 text-slate-800 transition-all group-hover:bg-indigo-50 group-hover:text-indigo-600"
                                placeholder="0"
                            />
                            <label htmlFor={pyungId} className="text-xs font-bold text-slate-400 mt-3 block uppercase tracking-widest">Ìèâ (py)</label>
                        </div>
                    </div>
                </div>
            );
        }

        const MessageWizard = () => {
            const [msgType, setMsgType] = useState('repair');
            const [copied, setCopied] = useState(false);

            const templates = {
                repair: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÎã§Î¶ÑÏù¥ ÏïÑÎãàÎùº ÏßëÏóê ÏàòÎ¶¨Í∞Ä ÌïÑÏöîÌïú Í≥≥Ïù¥ ÏÉùÍ≤® Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\n- Ï¶ùÏÉÅ: \n- ÏÇ¨ÏßÑ Ï≤®Î∂Ä: (ÏÇ¨ÏßÑ)\n- Î∞©Î¨∏ Í∞ÄÎä• ÏãúÍ∞Ñ: \n\nÎßéÏù¥ Î∞îÏÅòÏãúÍ≤†ÏßÄÎßå ÌôïÏù∏ ÌõÑ ÎãµÎ≥Ä Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.\nÍ∞êÏÇ¨Ìï©ÎãàÎã§.`,
                end: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÍ≥ÑÏïΩ ÎßåÎ£åÏùº(202X.XX.XX)Ïóê ÎßûÏ∂∞ Ïù¥ÏÇ¨Î•º Í≥ÑÌöçÌïòÍ≥† ÏûàÏñ¥ ÎØ∏Î¶¨ Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\nÎ≥¥Ï¶ùÍ∏à Î∞òÌôò ÏùºÏ†ï ÎÖºÏùòÍ∞Ä ÌïÑÏöîÌï† Í≤É Í∞ôÏäµÎãàÎã§.\nÌé∏ÌïòÏã§ Îïå Ïó∞ÎùΩ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.`,
                extend: `ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏûÑÎåÄÏù∏Îãò.\n[000Ìò∏] ÏûÑÏ∞®Ïù∏ÏûÖÎãàÎã§.\n\nÍ≥ÑÏïΩ ÎßåÎ£åÍ∞Ä Îã§Í∞ÄÏò§ÎäîÎç∞, ÌòπÏãú Ïó∞Ïû•ÌïòÏó¨ Îçî Í±∞Ï£ºÌï† Ïàò ÏûàÏùÑÏßÄ Ïó¨Ï≠àÏñ¥Î≥¥Í≥†Ïûê Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.\n\nÏ°∞Í±¥ Î≥ÄÎèôÏÇ¨Ìï≠Ïù¥ ÏûàÎã§Î©¥ ÎßêÏîÄ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.\nÍ∞êÏÇ¨Ìï©ÎãàÎã§.`
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(templates[msgType]);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
                        {[{ id: 'repair', label: 'üõ† ÏàòÎ¶¨ ÏöîÏ≤≠' }, { id: 'end', label: 'üëã Ìá¥Í±∞ ÌÜµÎ≥¥' }, { id: 'extend', label: 'ü§ù Ïó∞Ïû• ÏöîÏ≤≠' }].map(t => (
                            <button
                                key={t.id}
                                onClick={() => setMsgType(t.id)}
                                className={`px-4 py-2.5 rounded-full whitespace-nowrap text-xs font-bold transition-all border ${msgType === t.id ? 'bg-pink-50 text-pink-600 border-pink-200 shadow-sm' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`}
                            >
                                {t.label}
                            </button>
                        ))}
                    </div>

                    <div className="relative group">
                        <textarea
                            className="w-full h-56 p-6 bg-slate-50 rounded-3xl border-0 text-sm leading-7 resize-none focus:ring-2 focus:ring-pink-500 outline-none text-slate-700 font-medium transition-all group-hover:bg-white group-hover:shadow-inner"
                            value={templates[msgType]}
                            readOnly
                        ></textarea>
                        <button
                            onClick={copyToClipboard}
                            className={`absolute bottom-5 right-5 px-5 py-2.5 rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg ${copied ? 'bg-green-500 text-white transform scale-105' : 'bg-slate-900 hover:bg-black text-white'}`}
                        >
                            {copied ? <CheckCircle size={14} /> : <Copy size={14} />} {copied ? 'Î≥µÏÇ¨ ÏôÑÎ£å' : 'ÌÖçÏä§Ìä∏ Î≥µÏÇ¨'}
                        </button>
                    </div>
                </div>
            );
        }

        const MovingChecklist = () => {
            const [checked, setChecked] = useState(() => {
                try {
                    const saved = localStorage.getItem('checklist');
                    return saved ? JSON.parse(saved) : {};
                } catch (e) {
                    console.warn('Failed to parse checklist:', e);
                    return {};
                }
            });

            useEffect(() => {
                localStorage.setItem('checklist', JSON.stringify(checked));
            }, [checked]);

            const toggle = (id) => {
                setChecked(prev => ({ ...prev, [id]: !prev[id] }));
            }

            const sections = [
                { title: 'D-30 (Ìïú Îã¨ Ï†Ñ)', items: ['Ïßë ÎÇ¥ÎÜìÍ∏∞ / ÎßåÍ∏∞ ÌÜµÎ≥¥', 'Ïù¥ÏÇ¨ÏóÖÏ≤¥ ÏïåÏïÑÎ≥¥Í∏∞', 'Í∞ÄÍµ¨/Í∞ÄÏ†Ñ Î∞∞Ïπò Íµ¨ÏÉÅ'] },
                { title: 'D-14 (2Ï£º Ï†Ñ)', items: ['Ï£ºÏÜå Î≥ÄÍ≤Ω (Ïö∞Ìé∏Î¨º)', 'ÌèêÍ∏∞Î¨º Ïä§Ìã∞Ïª§ Íµ¨Îß§', 'ÏûÖÏ£º Ï≤≠ÏÜå ÏòàÏïΩ', 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏòàÏïΩ'] },
                { title: 'D-1 (Ï†ÑÎÇ†)', items: ['Í∑ÄÏ§ëÌíà Î≥ÑÎèÑ Î≥¥Í¥Ä', 'ÏÑ∏ÌÉÅÍ∏∞ Î¨º ÎπºÍ∏∞', 'Ïì∞Î†àÍ∏∞ Î¥âÌà¨ Ï§ÄÎπÑ', 'ÌòÑÍ∏à Ï§ÄÎπÑ (ÏûîÍ∏àÏö©)'] },
                { title: 'D-Day (Ïù¥ÏÇ¨ ÎãπÏùº)', items: ['Í≥µÍ≥ºÍ∏à Ï†ïÏÇ∞ (ÏàòÎèÑ/Ï†ÑÍ∏∞)', 'Î∂ÄÎèôÏÇ∞ ÏûîÍ∏à ÏπòÎ•¥Í∏∞', 'Ï†ÑÏûÖ Ïã†Í≥† / ÌôïÏ†ï ÏùºÏûê', 'Ïù∏ÌÑ∞ÎÑ∑ Ïù¥Ï†Ñ ÏÑ§Ïπò'] }
            ];

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2">
                    <div className="space-y-8">
                        {sections.map((section, sIdx) => (
                            <div key={sIdx}>
                                <h4 className="text-xs font-bold text-amber-600 bg-amber-50 inline-block px-3 py-1 rounded-lg mb-3">{section.title}</h4>
                                <div className="space-y-2">
                                    {section.items.map((item, iIdx) => {
                                        const id = `${sIdx}-${iIdx}`;
                                        const isChecked = checked[id];
                                        return (
                                            <div
                                                key={id}
                                                onClick={() => toggle(id)}
                                                className={`flex items-center p-3.5 rounded-xl cursor-pointer transition-all group ${isChecked ? 'bg-slate-50 text-slate-400' : 'bg-white border border-slate-100 hover:border-amber-200 hover:shadow-sm'}`}
                                            >
                                                <div className={`w-5 h-5 rounded-md border-2 flex items-center justify-center mr-3 transition-colors ${isChecked ? 'bg-amber-400 border-amber-400' : 'border-slate-300 group-hover:border-amber-400'}`}>
                                                    {isChecked && <CheckSquare size={14} className="text-white" />}
                                                </div>
                                                <span className={`text-sm font-medium ${isChecked ? 'line-through decoration-slate-300' : 'text-slate-700'}`}>{item}</span>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )
        }

        const Dictionary = () => {
            const [searchTerm, setSearchTerm] = useState('');

            const terms = [
                { t: 'ÎåÄÌï≠Î†•', d: 'ÏßëÏ£ºÏù∏Ïù¥ Î∞îÎÄåÏñ¥ÎèÑ Í≥ÑÏÜç ÏÇ¥ Ïàò ÏûàÍ≥†, Î≥¥Ï¶ùÍ∏àÏùÑ ÎèåÎ†§Î∞õÏùÑ ÎïåÍπåÏßÄ ÎÇòÍ∞ÄÏßÄ ÏïäÏïÑÎèÑ ÎêòÎäî Í∂åÎ¶¨.' },
                { t: 'Ïö∞ÏÑ†Î≥ÄÏ†úÍ∂å', d: 'ÏßëÏù¥ Í≤ΩÎß§Î°ú ÎÑòÏñ¥Í∞îÏùÑ Îïå, ÌõÑÏàúÏúÑ Í∂åÎ¶¨ÏûêÎ≥¥Îã§ Î®ºÏ†Ä ÎèàÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Í∂åÎ¶¨. (ÌôïÏ†ïÏùºÏûê ÌïÑÏàò)' },
                { t: 'Í∑ºÏ†ÄÎãπÍ∂å', d: 'ÏßëÏ£ºÏù∏Ïù¥ ÏßëÏùÑ Îã¥Î≥¥Î°ú ÎπöÏùÑ Ï°åÎã§Îäî Îúª. Îì±Í∏∞Î∂ÄÎì±Î≥∏Ïùò Ï±ÑÍ∂åÏµúÍ≥†Ïï° ÌôïÏù∏Ïù¥ Ï§ëÏöîÌï®.' },
                { t: 'ÌôïÏ†ïÏùºÏûê', d: 'Í≥ÑÏïΩÏÑúÍ∞Ä Ï°¥Ïû¨Ìï®ÏùÑ Ï¶ùÎ™ÖÌïòÎäî Î≤ïÏ†Å ÎÇ†Ïßú. Ï£ºÎØºÏÑºÌÑ∞ÎÇò Îì±Í∏∞ÏÜåÏóêÏÑú Î∞õÏùå.' },
                { t: 'Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò', d: 'Ï†ÑÏÑ∏Í∏àÏùÑ Î™ª ÎèåÎ†§Î∞õÏùÑ Îïå Î≥¥Ï¶ù Í∏∞Í¥Ä(HUG Îì±)Ïù¥ ÎåÄÏã† Í∞öÏïÑÏ£ºÎäî ÏÉÅÌíà.' },
                { t: 'ÏûÑÏ∞®Í∂åÎì±Í∏∞', d: 'Ïù¥ÏÇ¨Î•º Í∞ÄÎçîÎùºÎèÑ ÎåÄÌï≠Î†•Í≥º Ïö∞ÏÑ†Î≥ÄÏ†úÍ∂åÏùÑ Ïú†ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Îì±Í∏∞Î∂ÄÏóê Í∏∞Î°ùÌïòÎäî Í≤É.' }
            ];

            const filtered = terms.filter(item => item.t.includes(searchTerm));

            return (
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mt-2 h-[500px] flex flex-col">
                    <div className="relative mb-6">
                        <input
                            type="text"
                            placeholder="Í∂ÅÍ∏àÌïú Ïö©Ïñ¥ Í≤ÄÏÉâ..."
                            className="w-full pl-11 pr-4 py-4 bg-slate-50 rounded-2xl border-0 outline-none focus:ring-2 focus:ring-cyan-400 text-sm font-bold text-slate-800 transition-all focus:bg-white"
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                    </div>

                    <div className="space-y-3 overflow-y-auto pr-2 custom-scrollbar flex-1">
                        {filtered.length > 0 ? filtered.map((item, idx) => (
                            <div key={idx} className="bg-cyan-50/30 p-5 rounded-2xl border border-cyan-100/50 hover:bg-cyan-50/80 transition-colors">
                                <h4 className="font-bold text-cyan-900 mb-1.5">{item.t}</h4>
                                <p className="text-sm text-slate-600 leading-relaxed font-medium">{item.d}</p>
                            </div>
                        )) : (
                            <div className="text-center py-10 text-slate-400 text-sm font-medium">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
                        )}
                    </div>
                </div>
            )
        }

        // Ï†ÑÏõîÏÑ∏Ï†ÑÌôòÏú® Í≥ÑÏÇ∞Í∏∞
        const ConversionCalculator = () => {
            const [mode, setMode] = useState('toMonthly'); // toMonthly or toDeposit
            const [deposit, setDeposit] = useState('');
            const [monthly, setMonthly] = useState('');
            const [rate, setRate] = useState('5.0');

            const result = useMemo(() => {
                const rateVal = parseFloat(rate) || 0;
                if (mode === 'toMonthly') {
                    const depVal = parseNumber(deposit);
                    return calculateConversion(depVal, rateVal);
                } else {
                    const monVal = parseNumber(monthly);
                    return calculateDepositFromMonthly(monVal, rateVal);
                }
            }, [mode, deposit, monthly, rate]);

            return (
                <div className="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm border border-slate-100 dark:border-slate-700 mt-2">
                    <div className="flex gap-2 mb-6">
                        <button
                            onClick={() => setMode('toMonthly')}
                            className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${mode === 'toMonthly' ? 'bg-violet-500 text-white shadow-lg' : 'bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400'}`}
                        >
                            Î≥¥Ï¶ùÍ∏à ‚Üí ÏõîÏÑ∏
                        </button>
                        <button
                            onClick={() => setMode('toDeposit')}
                            className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${mode === 'toDeposit' ? 'bg-violet-500 text-white shadow-lg' : 'bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400'}`}
                        >
                            ÏõîÏÑ∏ ‚Üí Î≥¥Ï¶ùÍ∏à
                        </button>
                    </div>

                    <div className="space-y-4">
                        {mode === 'toMonthly' ? (
                            <NumberInput label="Ï†ÑÌôòÌï† Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="violet" />
                        ) : (
                            <NumberInput label="Ï†ÑÌôòÌï† ÏõîÏÑ∏" value={monthly} onChange={setMonthly} color="violet" />
                        )}

                        <div>
                            <label className="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-2 block ml-1">Ï†ÑÌôòÏú® (%)</label>
                            <input
                                type="number"
                                value={rate}
                                onChange={(e) => setRate(e.target.value)}
                                className="w-full px-5 py-4 text-right bg-slate-50 dark:bg-slate-700 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-violet-500 font-bold text-slate-700 dark:text-white text-lg"
                            />
                            <p className="text-xs text-slate-400 mt-2 ml-1">* Î≤ïÏ†ï Ï†ÑÌôòÏú® ÏÉÅÌïú: Í∏∞Ï§ÄÍ∏àÎ¶¨({BOK_RATE_DEFAULT}%) + 3.5% = {(BOK_RATE_DEFAULT + 3.5).toFixed(1)}%</p>
                        </div>
                    </div>

                    <div className="mt-6 p-6 bg-gradient-to-r from-violet-50 to-purple-50 dark:from-violet-900/30 dark:to-purple-900/30 rounded-2xl">
                        <p className="text-sm font-medium text-violet-600 dark:text-violet-400 mb-2">
                            {mode === 'toMonthly' ? 'Ï†ÑÌôò Ïãú ÏõîÏÑ∏ Í∏àÏï°' : 'Ï†ÑÌôò Ïãú Î≥¥Ï¶ùÍ∏à Í∏àÏï°'}
                        </p>
                        <p className="text-3xl font-black text-violet-900 dark:text-violet-300">
                            {formatNumber(result)} <span className="text-lg font-bold">Ïõê</span>
                        </p>
                        {mode === 'toMonthly' && result > 0 && (
                            <p className="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                Ïó∞Í∞Ñ {formatNumber(result * 12)}Ïõê Ï∂îÍ∞Ä ÏßÄÏ∂ú
                            </p>
                        )}
                    </div>
                </div>
            );
        };

        // Î≥¥Ï¶ùÎ≥¥ÌóòÎ£å Í≥ÑÏÇ∞Í∏∞
        const InsuranceCalculator = () => {
            const [deposit, setDeposit] = useState('');
            const [years, setYears] = useState('2');
            const [insuranceType, setInsuranceType] = useState('hug');

            const result = useMemo(() => {
                const depVal = parseNumber(deposit);
                const yearsVal = parseInt(years) || 1;

                // Î≥¥ÌóòÎ£åÏú® (Ïã§Ï†úÎäî Î≥¥Ï¶ùÍ∏à, ÏßÄÏó≠, Ï£ºÌÉù Ïú†ÌòïÏóê Îî∞Îùº Îã§Î¶Ñ)
                const rates = {
                    hug: 0.00128,      // HUG Ï†ÑÏÑ∏Î≥¥Ï¶ùÎ≥¥Ìóò ÌèâÍ∑† 0.128%
                    sgi: 0.00115,      // SGIÏÑúÏö∏Î≥¥Ï¶ù ÌèâÍ∑† 0.115%
                    rental: 0.0005    // ÏûÑÏ∞®Í∂åÎì±Í∏∞ ÎπÑÏö© ÏïΩ 0.05%
                };

                const rate = rates[insuranceType] || rates.hug;
                const fee = Math.floor(depVal * rate * yearsVal);
                const monthlyFee = Math.floor(fee / (yearsVal * 12));

                return { fee, monthlyFee, rate: rate * 100 };
            }, [deposit, years, insuranceType]);

            return (
                <div className="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm border border-slate-100 dark:border-slate-700 mt-2">
                    <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                        {[
                            { id: 'hug', label: 'HUG Ï†ÑÏÑ∏Î≥¥Ï¶ù' },
                            { id: 'sgi', label: 'SGI Ï†ÑÏÑ∏Î≥¥Ï¶ù' },
                            { id: 'rental', label: 'ÏûÑÏ∞®Í∂åÎì±Í∏∞' }
                        ].map(t => (
                            <button
                                key={t.id}
                                onClick={() => setInsuranceType(t.id)}
                                className={`flex-1 py-3 px-3 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${insuranceType === t.id ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 dark:bg-slate-700 text-slate-500'}`}
                            >
                                {t.label}
                            </button>
                        ))}
                    </div>

                    <div className="space-y-4">
                        <NumberInput label="Ï†ÑÏÑ∏ Î≥¥Ï¶ùÍ∏à" value={deposit} onChange={setDeposit} color="green" enableUnitToggle={true} />

                        <div>
                            <label className="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-2 block ml-1">Í≥ÑÏïΩ Í∏∞Í∞Ñ (ÎÖÑ)</label>
                            <div className="flex gap-2">
                                {['1', '2', '3'].map(y => (
                                    <button
                                        key={y}
                                        onClick={() => setYears(y)}
                                        className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${years === y ? 'bg-emerald-500 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-500'}`}
                                    >
                                        {y}ÎÖÑ
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="mt-6 p-6 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/30 dark:to-teal-900/30 rounded-2xl">
                        <div className="flex justify-between items-center mb-4">
                            <span className="text-sm font-medium text-emerald-600 dark:text-emerald-400">ÏòàÏÉÅ Î≥¥ÌóòÎ£å (ÏöîÏú® {result.rate.toFixed(3)}%)</span>
                            <span className="text-2xl font-black text-emerald-900 dark:text-emerald-300">{formatNumber(result.fee)}Ïõê</span>
                        </div>
                        <div className="flex justify-between items-center text-sm">
                            <span className="text-slate-500 dark:text-slate-400">Ïõî ÌôòÏÇ∞</span>
                            <span className="font-bold text-slate-700 dark:text-slate-300">ÏïΩ {formatNumber(result.monthlyFee)}Ïõê/Ïõî</span>
                        </div>
                        <p className="text-xs text-slate-400 mt-4">
                            * Ïã§Ï†ú Î≥¥ÌóòÎ£åÎäî Ï£ºÌÉù Ïú†Ìòï, ÏßÄÏó≠, Î≥¥Ï¶ùÍ∏à Íµ¨Í∞ÑÏóê Îî∞Îùº ÏÉÅÏù¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                </div>
            );
        };

        // Í≥ÑÏÇ∞ ÌûàÏä§ÌÜ†Î¶¨
        const HistoryPanel = () => {
            const [history, setHistory] = useState(() => getHistory());

            const handleClear = () => {
                clearHistory();
                setHistory([]);
            };

            const typeLabels = {
                'costCompare': 'Ï†ÑÏõîÏÑ∏ ÎπÑÍµê',
                'safety': 'ÏïàÏ†ÑÏßÑÎã®',
                'fee': 'Ï§ëÍ∞úÎ≥¥Ïàò',
                'loan': 'ÎåÄÏ∂úÍ≥ÑÏÇ∞',
                'tax': 'Ï∑®ÎìùÏÑ∏',
                'dsr': 'DSRÍ≥ÑÏÇ∞',
                'ltv': 'LTVÍ≥ÑÏÇ∞'
            };

            return (
                <div className="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm border border-slate-100 dark:border-slate-700 mt-2">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                            <History size={18} /> ÏµúÍ∑º Í≥ÑÏÇ∞ Í∏∞Î°ù
                        </h3>
                        {history.length > 0 && (
                            <button
                                onClick={handleClear}
                                className="text-xs text-red-500 hover:text-red-600 font-bold flex items-center gap-1"
                            >
                                <Trash2 size={14} /> Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                            </button>
                        )}
                    </div>

                    {history.length === 0 ? (
                        <div className="text-center py-12 text-slate-400">
                            <History size={40} className="mx-auto mb-3 opacity-30" />
                            <p className="text-sm font-medium">Í≥ÑÏÇ∞ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            <p className="text-xs mt-1">Í≥ÑÏÇ∞ Í≤∞Í≥ºÍ∞Ä ÏûêÎèôÏúºÎ°ú Ï†ÄÏû•Îê©ÎãàÎã§</p>
                        </div>
                    ) : (
                        <div className="space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar">
                            {history.map((item, idx) => (
                                <div key={idx} className="p-4 bg-slate-50 dark:bg-slate-700/50 rounded-xl">
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="text-xs font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-0.5 rounded">
                                            {typeLabels[item.type] || item.type}
                                        </span>
                                        <span className="text-xs text-slate-400">{formatDate(item.timestamp)}</span>
                                    </div>
                                    <p className="text-sm font-medium text-slate-700 dark:text-slate-300">
                                        {item.data.summary || JSON.stringify(item.data).slice(0, 50)}
                                    </p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const ToolsTab = () => {
            const [activeTool, setActiveTool] = useState('pyung');

            const tools = [
                { id: 'pyung', label: 'ÌèâÏàòÍ≥ÑÏÇ∞', icon: Grid },
                { id: 'convert', label: 'Ï†ÑÌôòÍ≥ÑÏÇ∞', icon: Percent },
                { id: 'insurance', label: 'Î≥¥Ï¶ùÎ≥¥Ìóò', icon: Shield },
                { id: 'message', label: 'Î¨∏ÏûêÎßàÎ≤ïÏÇ¨', icon: MessageCircle },
                { id: 'checklist', label: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', icon: ClipboardList },
                { id: 'dic', label: 'Ïö©Ïñ¥ÏÇ¨Ï†Ñ', icon: BookOpen },
                { id: 'history', label: 'ÌûàÏä§ÌÜ†Î¶¨', icon: History }
            ];

            const ActiveComponent = {
                pyung: UnitConverter,
                convert: ConversionCalculator,
                insurance: InsuranceCalculator,
                message: MessageWizard,
                checklist: MovingChecklist,
                dic: Dictionary,
                history: HistoryPanel
            }[activeTool];

            return (
                <div className="space-y-4 pb-32 animate-slide-up px-1">
                    <div className="flex bg-white dark:bg-slate-800 p-1.5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-x-auto no-scrollbar">
                        {tools.map(t => {
                            const Icon = t.icon;
                            return (
                                <button
                                    key={t.id}
                                    onClick={() => setActiveTool(t.id)}
                                    aria-label={t.label}
                                    aria-current={activeTool === t.id ? 'page' : undefined}
                                    className={`flex-1 min-w-[60px] py-3 rounded-xl flex flex-col items-center justify-center gap-1 transition-all ${activeTool === t.id ? 'bg-slate-900 dark:bg-indigo-600 text-white shadow-md' : 'text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-600'}`}
                                >
                                    <Icon size={18} className={activeTool === t.id ? "animate-pulse" : ""} />
                                    <span className="text-[10px] font-bold">{t.label}</span>
                                </button>
                            )
                        })}
                    </div>

                    <div className="animate-fade-in">
                        <ActiveComponent />
                    </div>
                </div>
            );
        };

        // --- Toast Component ---
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="toast-container">
                    <div className="toast">{message}</div>
                </div>
            );
        };

        // --- App Component ---
        const App = () => {
            const [activeCategory, setActiveCategory] = useState('rent');
            const [activeSubTab, setActiveSubTab] = useState({
                rent: 0,
                buy: 0,
                bank: 0,
                tools: 0
            });
            const [darkMode, setDarkMode] = useState(() => {
                try {
                    return localStorage.getItem('darkMode') === 'true';
                } catch {
                    return false;
                }
            });
            const [toastMessage, setToastMessage] = useState('');

            // Apply dark mode class to HTML element
            useEffect(() => {
                document.documentElement.classList.toggle('dark', darkMode);
                try {
                    localStorage.setItem('darkMode', darkMode.toString());
                } catch (e) {
                    console.warn('localStorage not available');
                }
            }, [darkMode]);

            const showToast = (message) => {
                setToastMessage(message);
            };

            const categories = [
                { id: 'rent', label: 'Ï†ÑÏõîÏÑ∏', icon: Home },
                { id: 'buy', label: 'Îß§Îß§', icon: TrendingUp },
                { id: 'bank', label: 'ÎåÄÏ∂ú/ÏÑ∏Í∏à', icon: DollarSign },
                { id: 'tools', label: 'ÎèÑÍµ¨', icon: PenTool },
            ];

            const tabs = {
                rent: [
                    { id: 0, label: 'ÎπÑÏö©ÎπÑÍµê', component: CostCompareTab },
                    { id: 1, label: 'ÏïàÏ†ÑÏßÑÎã®', component: SafetyTab },
                    { id: 2, label: 'Ï§ëÍ∞úÎ≥¥Ïàò', component: FeeTab },
                ],
                buy: [
                    { id: 0, label: 'Ï∑®ÎìùÏÑ∏/Ï±ÑÍ∂å', component: BuyingTab },
                    { id: 1, label: 'Ï§ëÍ∞úÎ≥¥Ïàò', component: FeeTab },
                ],
                bank: [
                    { id: 0, label: 'ÎåÄÏ∂úÍ≥ÑÏÇ∞', component: LoanTab },
                    { id: 1, label: 'DSRÍ≥ÑÏÇ∞', component: DSRTab },
                    { id: 2, label: 'LTVÍ≥ÑÏÇ∞', component: LTVTab },
                ],
                tools: [
                    { id: 0, label: 'ÎèÑÍµ¨Î™®Ïùå', component: ToolsTab }
                ]
            };

            const currentTabs = tabs[activeCategory];
            const currentSubTabIdx = activeSubTab[activeCategory];
            const ActiveComponent = currentTabs[currentSubTabIdx].component;

            const handlePrint = () => window.print();
            const toggleDarkMode = () => setDarkMode(prev => !prev);

            return (
                <div className={`max-w-md mx-auto min-h-screen bg-slate-50 dark:bg-slate-900 relative shadow-2xl border-x border-slate-100 dark:border-slate-800 pb-24 transition-colors duration-300`}>
                    {/* Toast */}
                    {toastMessage && <Toast message={toastMessage} onClose={() => setToastMessage('')} />}

                    {/* Header */}
                    <div className="bg-white/80 dark:bg-slate-800/80 backdrop-blur-md sticky top-0 z-30 border-b border-slate-100 dark:border-slate-700">
                        <div className="h-16 px-6 flex items-center justify-between">
                            <h1 className="text-lg font-black text-slate-900 dark:text-white flex items-center gap-2.5 tracking-tight">
                                <div className="bg-indigo-600 p-1.5 rounded-lg text-white shadow-lg shadow-indigo-500/30">
                                    <Home size={16} fill="white" />
                                </div>
                                Î∂ÄÎèôÏÇ∞ ÎßàÏä§ÌÑ∞ <span className="text-indigo-600 dark:text-indigo-400 italic">Pro</span>
                            </h1>
                            <div className="flex items-center gap-1">
                                <button
                                    onClick={toggleDarkMode}
                                    className="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all no-print"
                                    title={darkMode ? "ÎùºÏù¥Ìä∏ Î™®Îìú" : "Îã§ÌÅ¨ Î™®Îìú"}
                                    aria-label={darkMode ? "ÎùºÏù¥Ìä∏ Î™®ÎìúÎ°ú Ï†ÑÌôò" : "Îã§ÌÅ¨ Î™®ÎìúÎ°ú Ï†ÑÌôò"}
                                >
                                    {darkMode ? <Sun size={20} /> : <Moon size={20} />}
                                </button>
                                <button
                                    onClick={handlePrint}
                                    className="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all no-print"
                                    title="PDF Ï†ÄÏû• / Ïù∏ÏáÑ"
                                    aria-label="Ïù∏ÏáÑÌïòÍ∏∞"
                                >
                                    <Printer size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Sub Navigation (Top) */}
                    <div className="px-4 mt-4 sticky top-16 z-20">
                        <div className="bg-white dark:bg-slate-800 p-1.5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex gap-1 overflow-x-auto no-scrollbar">
                            {currentTabs.map((tab, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => setActiveSubTab(prev => ({ ...prev, [activeCategory]: idx }))}
                                    className={`flex-1 min-w-[80px] py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${currentSubTabIdx === idx ? 'bg-slate-900 dark:bg-indigo-600 text-white shadow-md' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700'}`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="p-4">
                        <ActiveComponent />
                    </main>

                    {/* Bottom Navigation (Categories) */}
                    <nav className="fixed bottom-0 max-w-md w-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-xl border-t border-slate-200/60 dark:border-slate-700 pb-safe z-40 rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]" aria-label="Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨">
                        <div className="flex justify-around items-center px-2 py-3">
                            {categories.map((cat) => {
                                const Icon = cat.icon;
                                const isActive = activeCategory === cat.id;
                                return (
                                    <button
                                        key={cat.id}
                                        onClick={() => setActiveCategory(cat.id)}
                                        className={`flex flex-col items-center justify-center w-16 h-14 rounded-2xl transition-all duration-300 ${isActive ? 'text-indigo-600 dark:text-indigo-400' : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'}`}
                                        aria-label={cat.label}
                                        aria-current={isActive ? 'page' : undefined}
                                    >
                                        <Icon size={isActive ? 24 : 20} strokeWidth={isActive ? 2.5 : 2} fill={isActive ? "currentColor" : "none"} className={`transition-all mb-1 ${isActive ? 'transform -translate-y-1' : ''}`} />
                                        <span className={`text-[10px] font-bold transition-all ${isActive ? 'opacity-100' : 'opacity-70'}`}>{cat.label}</span>
                                    </button>
                                );
                            })}
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>