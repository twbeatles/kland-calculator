const a={},n=(t,e="")=>{if(a[t]!==void 0)return a[t];try{const o=localStorage.getItem(t),r=o===null||o===""?e:o;return a[t]=r,r}catch(o){return console.warn("localStorage access failed:",o),e}},g=()=>{try{let t=0;for(let o in localStorage)localStorage.hasOwnProperty(o)&&(t+=(localStorage[o].length+o.length)*2);const e=5*1024*1024;t>e*.85&&l()}catch{}},l=()=>{try{const t=JSON.parse(localStorage.getItem("calcHistory")||"[]");t.length>10&&localStorage.setItem("calcHistory",JSON.stringify(t.slice(0,10)));const e=JSON.parse(localStorage.getItem("errorLog")||"[]");e.length>5&&localStorage.setItem("errorLog",JSON.stringify(e.slice(0,5))),delete a.calcHistory,delete a.errorLog}catch{}},s=(t,e)=>{try{if(e===null){localStorage.removeItem(t),delete a[t];return}g();const o=typeof e=="string"?e:JSON.stringify(e);localStorage.setItem(t,o),a[t]=o}catch(o){if(o.name==="QuotaExceededError"){l();try{const r=typeof e=="string"?e:JSON.stringify(e);localStorage.setItem(t,r),a[t]=r}catch(r){console.warn("localStorage write failed after cleanup:",r)}}else console.warn("localStorage write failed:",o)}},f=(()=>{const t={};return(e,o,r=500)=>{clearTimeout(t[e]),t[e]=setTimeout(()=>s(e,o),r)}})(),c="calcHistory",S=50,d=(t,e)=>{try{const o=n(c,"[]"),r=JSON.parse(o)||[],i=[{id:Date.now(),type:t,data:e,timestamp:new Date().toISOString(),date:new Date().toLocaleDateString("ko-KR")},...r].slice(0,S);s(c,JSON.stringify(i))}catch(o){console.warn("히스토리 저장 실패:",o)}},h=()=>{try{const t=n(c,"[]");return JSON.parse(t)||[]}catch{return[]}},m=()=>{s(c,"[]")};export{s as a,h as b,m as c,f as d,n as g,d as s};
